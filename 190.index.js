(()=>{"use strict";var t,s;Array.prototype.remove=function(t){const s=this.indexOf(t);-1!==s&&this.splice(s,1)},Array.prototype.last=function(){return this.length>0?this[this.length-1]:void 0},Array.prototype.count=function(t){let s=0;return this.forEach((e=>t(e)&&s++)),s},Array.prototype.partition=function(t){const s=[],e=[];return this.forEach((i=>t(i)?s.push(i):e.push(i))),[s,e]},Map.prototype.getOrUpdate=function(t,s){let e=this.get(t);return void 0===e&&(e=s(),this.set(t,e)),e},function(t){t[t.aiPriorityTrain=0]="aiPriorityTrain",t[t.aiPriorityGetIn=1]="aiPriorityGetIn",t[t.aiPriorityCrystal=2]="aiPriorityCrystal",t[t.aiPriorityOre=3]="aiPriorityOre",t[t.aiPriorityRepair=4]="aiPriorityRepair",t[t.aiPriorityClearing=5]="aiPriorityClearing",t[t.aiPriorityDestruction=6]="aiPriorityDestruction",t[t.aiPriorityConstruction=7]="aiPriorityConstruction",t[t.aiPriorityReinforce=8]="aiPriorityReinforce",t[t.aiPriorityRecharge=9]="aiPriorityRecharge"}(t||(t={}));class e{static setFromCfg(t,s){return Object.keys(s).forEach((e=>{var i;const a=(e.startsWith("!")?e.substring(1):e).toLowerCase().replace(/_/g,"").replace(/-/g,"");Object.keys(t).some((i=>t.assignValue(i,a,s[e])))||console.warn("cfg key: "+e+" does not exist in cfg: "+(null===(i=null==t?void 0:t.constructor)||void 0===i?void 0:i.name))})),t}assignValue(t,s,e){if(t.toLowerCase()===s){const i=this[t],a=Array.isArray(i);let h=this.parseValue(s,e);const r=Array.isArray(h);return i&&a!==r&&a&&(h=[h]),this[t]=h,!0}}parseValue(t,s){return s}}class i{constructor(t){[this.r,this.g,this.b]=t}}class a{constructor(t){[this.filename,this.x,this.y]=t}}class h{constructor(t){this.levelsByName=[],Object.keys(t).forEach((s=>{(s.startsWith("Tutorial")||s.startsWith("Level"))&&(this.levelsByName[s]=new r(t[s]))}))}}class r extends e{constructor(t){super(),this.fullName="",this.endGameAvi1="",this.endGameAvi2="",this.allowRename=!1,this.recallOLObjects=!1,this.generateSpiders=!1,this.video="",this.disableEndTeleport=!1,this.disableStartTeleport=!1,this.emergeTimeOut="",this.boulderAnimation="",this.noMultiSelect="",this.noAutoEat="",this.disableToolTipSound="",this.blockSize="",this.digDepth="",this.roughLevel="",this.roofHeight="",this.useRoof="",this.selBoxHeight="",this.fpRotLightRGB="",this.fogColourRGB="",this.highFogColourRGB="",this.fogRate=0,this.fallinMultiplier=0,this.numberOfLandSlidesTillCaveIn=0,this.noFallins=!1,this.oxygenRate=0,this.surfaceMap="",this.predugMap="",this.terrainMap="",this.emergeMap="",this.erodeMap="",this.fallinMap="",this.blockPointersMap="",this.cryOreMap="",this.pathMap="",this.noGather=!1,this.textureSet="",this.rockFallStyle="",this.emergeCreature="",this.safeCaverns="",this.seeThroughWalls="",this.oListFile="",this.ptlFile="",this.nerpFile="",this.nerpMessageFile="",this.objectiveText="",this.objectiveImage640x480=null,this.erodeTriggerTime=0,this.erodeErodeTime=0,this.erodeLockTime=0,this.nextLevel="",this.levelLinks="",this.frontEndX=0,this.frontEndY=0,this.frontEndOpen=!1,this.priorities=[],this.reward=null,this.menuBMP=[],e.setFromCfg(this,t)}parseValue(t,s){return t==="fullName".toLowerCase()?s.replace(/_/g," "):t.endsWith("rgb")?new i(s):"priorities"===t?Object.keys(s).filter((t=>t.toLowerCase()!=="AI_Priority_GetTool".toLowerCase())).map((t=>new o(t,s[t]))):"reward"===t?new l(s):"objectiveimage640x480"===t?new a(s):super.parseValue(t,s)}}class o{constructor(s,e){this.key=function(t,...s){return s.forEach((s=>{t=(t=Object.keys(t).filter((t=>t.toLowerCase()===s.toLowerCase())).map((s=>t[s])))?t[0]:t})),t}(t,s.replace(/_/g,"")),this.enabled=e}}class l extends e{constructor(t){super(),this.enable=!0,this.modifier=null,this.importance=null,this.quota=null,e.setFromCfg(this,t)}parseValue(t,s){return"importance"===t?new n(s):"quota"===t?new d(s):super.parseValue(t,s)}}class n extends e{constructor(t){super(),this.crystals=0,this.timer=0,this.caverns=0,this.constructions=0,this.oxygen=0,this.figures=0,e.setFromCfg(this,t)}}class d extends e{constructor(t){super(),this.crystals=null,this.timer=null,this.caverns=null,this.constructions=null,e.setFromCfg(this,t)}}class c{constructor(t){[this.actionName,this.x,this.y,this.width,this.height,this.description,this.two,this.labelOff,this.labelOn]=t,this.description=this.description.replace(/_/g," ")}}class u{constructor(t){5===t.length||6===t.length?([this.actionName,this.x,this.y,this.label,this.target,this.flag]=t,this.label=Array.isArray(this.label)?this.label.join(","):this.label,this.label=this.label.replace(/_/g," ")):8===t.length?[this.actionName,this.x,this.y,this.imgNormal,this.imgHover,this.imgPressed,this.tooltip,this.target]=t:(console.warn("Unexpected cfg object length: "+t.length),console.log(t))}}class p{constructor(t){[this.actionName,this.x,this.y,this.width,this.height,this.description,this.min,this.max,this.imgOff,this.imgOn,this.imgLeft,this.imgRight,this.btnRightNormal,this.btnLeftNormal,this.btnRightHover,this.btnLeftHover]=t}}class g extends e{constructor(t){super(),this.fullName="",this.title="",this.position=[0,0],this.menuFont="",this.loFont="",this.hiFont="",this.itemCount=0,this.menuImage="",this.autoCenter=!1,this.displayTitle=!1,this.overlays=[],this.playRandom=!1,this.itemsLabel=[],this.itemsSlider=[],this.itemsCycle=[],this.anchored=!1,this.canScroll=!1,e.setFromCfg(this,t)}assignValue(t,s,e){if(s.match(/item\d+/i)){const t=e[0].toLowerCase();if("next"===t||"trigger"===t)this.itemsLabel.push(new u(e));else if("slider"===t)this.itemsSlider.push(new p(e));else{if("cycle"!==t)return console.warn("Unexpected item action name: "+e[0]),!1;this.itemsCycle.push(new c(e))}return!0}return s.match(/overlay\d+/i)?(this.overlays.push(e),!0):super.assignValue(t,s,e)}parseValue(t,s){return t==="fullName".toLowerCase()||"title"===t?s.replace(/_/g," "):super.parseValue(t,s)}}class f extends e{constructor(t){super(),this.menuCount=0,this.menus=[],e.setFromCfg(this,t)}assignValue(t,s,e){return s.match(/menu\d+/i)?(this.menus.push(new g(e)),!0):super.assignValue(t,s,e)}}class m extends e{constructor(t){super(),this.display=!0,this.wallpaper="",this.images=[],this.texts=[],this.boxImages=[],this.fonts=null,this.flics=null,this.scrollSpeed=0,this.centreText=!1,this.vertSpacing=0,this.backFont="",this.font="",this.titleFont="",this.timer=0,this.saveButton="",this.advanceButton="",this.completeText="",this.failedText="",this.quitText="",this.textPos=[0,0],e.setFromCfg(this,t)}assignValue(t,s,e){return"images"===s?(Object.values(e).forEach((t=>this.images.push(new C(t)))),!0):"text"===s?(Object.values(e).forEach((t=>this.texts.push(new S(t)))),!0):"boximages"===s?(Object.values(e).forEach((t=>this.boxImages.push(new C(t)))),!0):"fonts"===s?(this.fonts=new A(e),!0):super.assignValue(t,s,e)}}class C{constructor(t){this.filePath="",this.x=0,this.y=0,[this.filePath,this.x,this.y]=t}}class S{constructor(t){this.text="",this.x=0,this.y=0,[this.text,this.x,this.y]=t}}class A extends e{constructor(t){super(),this.crystals="",this.ore="",this.diggable="",this.constructions="",this.caverns="",this.figures="",this.rockMonsters="",this.oxygen="",this.timer="",this.score="",e.setFromCfg(this,t)}}!function(t){t[t.BITMAP_INFO_HEADER=40]="BITMAP_INFO_HEADER",t[t.BITMAP_V2_INFO_HEADER=52]="BITMAP_V2_INFO_HEADER",t[t.BITMAP_V3_INFO_HEADER=56]="BITMAP_V3_INFO_HEADER",t[t.BITMAP_V4_HEADER=108]="BITMAP_V4_HEADER",t[t.BITMAP_V5_HEADER=124]="BITMAP_V5_HEADER"}(s||(s={}));class w{constructor(t,{toRGBA:s}={toRGBA:!1}){if(this.buffer=t,this.bufferView=new DataView(t.buffer,t.byteOffset,t.byteLength),this.toRGBA=!!s,this.bottomUp=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos=2,"BM"!==this.flag)throw new Error("Invalid BMP File");this.locRed=this.toRGBA?0:3,this.locGreen=this.toRGBA?1:2,this.locBlue=this.toRGBA?2:1,this.locAlpha=this.toRGBA?3:0,this.parseHeader(),this.parseRGBA()}parseHeader(){if(this.fileSize=this.readUInt32LE(),this.reserved1=this.bufferView.getUint16(this.pos,!0),this.pos+=2,this.reserved2=this.bufferView.getUint16(this.pos,!0),this.pos+=2,this.offset=this.readUInt32LE(),this.headerSize=this.readUInt32LE(),!(this.headerSize in s))throw new Error(`Unsupported BMP header size ${this.headerSize}`);if(this.width=this.readUInt32LE(),this.height=this.readUInt32LE(),this.planes=this.bufferView.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.bufferView.getUint16(this.pos,!0),this.pos+=2,this.compression=this.readUInt32LE(),this.rawSize=this.readUInt32LE(),this.hr=this.readUInt32LE(),this.vr=this.readUInt32LE(),this.colors=this.readUInt32LE(),this.importantColors=this.readUInt32LE(),32===this.bitPP?(this.maskAlpha=0,this.maskRed=16711680,this.maskGreen=65280,this.maskBlue=255):16===this.bitPP&&(this.maskAlpha=0,this.maskRed=31744,this.maskGreen=992,this.maskBlue=31),(this.headerSize>s.BITMAP_INFO_HEADER||3===this.compression||6===this.compression)&&(this.maskRed=this.readUInt32LE(),this.maskGreen=this.readUInt32LE(),this.maskBlue=this.readUInt32LE()),(this.headerSize>s.BITMAP_V2_INFO_HEADER||6===this.compression)&&(this.maskAlpha=this.readUInt32LE()),this.headerSize>s.BITMAP_V3_INFO_HEADER&&(this.pos+=s.BITMAP_V4_HEADER-s.BITMAP_V3_INFO_HEADER),this.headerSize>s.BITMAP_V4_HEADER&&(this.pos+=s.BITMAP_V5_HEADER-s.BITMAP_V4_HEADER),this.bitPP<=8||this.colors>0){const t=0===this.colors?1<<this.bitPP:this.colors;this.palette=new Array(t);for(let s=0;s<t;s++){const t=this.buffer[this.pos++],e=this.buffer[this.pos++],i=this.buffer[this.pos++],a=this.buffer[this.pos++];this.palette[s]={red:i,green:e,blue:t,quad:a}}}this.height<0&&(this.height*=-1,this.bottomUp=!1);const t=function(t,s,e,i){const a=1+~t&t,h=1+~s&s,r=1+~e&e,o=1+~i&i,l=t/a+1,n=s/h+1,d=e/r+1,c=i/o+1;return{shiftRed:s=>(s&t)/a*256/l,shiftGreen:t=>(t&s)/h*256/n,shiftBlue:t=>(t&e)/r*256/d,shiftAlpha:0!==i?t=>(t&i)/o*256/c:()=>255}}(this.maskRed,this.maskGreen,this.maskBlue,this.maskAlpha);this.shiftRed=t.shiftRed,this.shiftGreen=t.shiftGreen,this.shiftBlue=t.shiftBlue,this.shiftAlpha=t.shiftAlpha}parseRGBA(){switch(this.data=new Uint8Array(this.width*this.height*4),this.bitPP){case 1:this.bit1();break;case 4:this.bit4();break;case 8:this.bit8();break;case 16:this.bit16();break;case 24:this.bit24();break;default:this.bit32()}}bit1(){const t=Math.ceil(this.width/8),s=t%4,e=0!==s?4-s:0;let i;this.scanImage(e,t,((t,s)=>{s!==i&&(i=s);const e=this.buffer[this.pos++],a=s*this.width*4+8*t*4;for(let s=0;s<8&&8*t+s<this.width;s++){const t=this.palette[e>>7-s&1];this.data[a+4*s+this.locAlpha]=255,this.data[a+4*s+this.locBlue]=t.blue,this.data[a+4*s+this.locGreen]=t.green,this.data[a+4*s+this.locRed]=t.red}}))}bit4(){if(2===this.compression){this.data.fill(0);let t=!1,s=this.bottomUp?this.height-1:0,e=0;for(;e<this.data.length;){const i=this.buffer[this.pos++],a=this.buffer[this.pos++];if(0===i){if(0===a){s+=this.bottomUp?-1:1,e=s*this.width*4,t=!1;continue}if(1===a)break;if(2===a){const t=this.buffer[this.pos++],i=this.buffer[this.pos++];s+=this.bottomUp?-i:i,e+=i*this.width*4+4*t}else{let s=this.buffer[this.pos++];for(let i=0;i<a;i++)e=this.setPixelData(e,t?15&s:(240&s)>>4),1&i&&i+1<a&&(s=this.buffer[this.pos++]),t=!t;1==(a+1>>1&1)&&this.pos++}}else for(let s=0;s<i;s++)e=this.setPixelData(e,t?15&a:(240&a)>>4),t=!t}}else{const t=Math.ceil(this.width/2),s=t%4,e=0!==s?4-s:0;this.scanImage(e,t,((t,s)=>{const e=this.buffer[this.pos++],i=s*this.width*4+2*t*4,a=e>>4;let h=this.palette[a];if(this.data[i+this.locAlpha]=255,this.data[i+this.locBlue]=h.blue,this.data[i+this.locGreen]=h.green,this.data[i+this.locRed]=h.red,2*t+1>=this.width)return!1;const r=15&e;h=this.palette[r],this.data[i+4+this.locAlpha]=255,this.data[i+4+this.locBlue]=h.blue,this.data[i+4+this.locGreen]=h.green,this.data[i+4+this.locRed]=h.red}))}}bit8(){if(1===this.compression){this.data.fill(0);let t=this.bottomUp?this.height-1:0,s=0;for(;s<this.data.length;){const e=this.buffer[this.pos++],i=this.buffer[this.pos++];if(0===e){if(0===i){t+=this.bottomUp?-1:1,s=t*this.width*4;continue}if(1===i)break;if(2===i){const e=this.buffer[this.pos++],i=this.buffer[this.pos++];t+=this.bottomUp?-i:i,s+=i*this.width*4+4*e}else{for(let t=0;t<i;t++){const t=this.buffer[this.pos++];s=this.setPixelData(s,t)}!0&i&&this.pos++}}else for(let t=0;t<e;t++)s=this.setPixelData(s,i)}}else{const t=this.width%4,s=0!==t?4-t:0;this.scanImage(s,this.width,((t,s)=>{const e=this.buffer[this.pos++],i=s*this.width*4+4*t;if(e<this.palette.length){const t=this.palette[e];this.data[i+this.locAlpha]=255,this.data[i+this.locBlue]=t.blue,this.data[i+this.locGreen]=t.green,this.data[i+this.locRed]=t.red}}))}}bit16(){const t=this.width%2*2;this.scanImage(t,this.width,((t,s)=>{const e=s*this.width*4+4*t,i=this.bufferView.getUint16(this.pos,!0);this.pos+=2,this.data[e+this.locRed]=this.shiftRed(i),this.data[e+this.locGreen]=this.shiftGreen(i),this.data[e+this.locBlue]=this.shiftBlue(i),this.data[e+this.locAlpha]=this.shiftAlpha(i)}))}bit24(){const t=this.width%4;this.scanImage(t,this.width,((t,s)=>{const e=s*this.width*4+4*t,i=this.buffer[this.pos++],a=this.buffer[this.pos++],h=this.buffer[this.pos++];this.data[e+this.locAlpha]=255,this.data[e+this.locBlue]=i,this.data[e+this.locGreen]=a,this.data[e+this.locRed]=h}))}bit32(){this.scanImage(0,this.width,((t,s)=>{const e=s*this.width*4+4*t,i=this.readUInt32LE();this.data[e+this.locAlpha]=this.shiftAlpha(i),this.data[e+this.locBlue]=this.shiftBlue(i),this.data[e+this.locGreen]=this.shiftGreen(i),this.data[e+this.locRed]=this.shiftRed(i)}))}scanImage(t=0,s=this.width,e){for(let i=this.height-1;i>=0;i--){const a=this.bottomUp?i:this.height-1-i;for(let t=0;t<s;t++)e.call(this,t,a);this.pos+=t}}readUInt32LE(){const t=this.bufferView.getUint32(this.pos,!0);return this.pos+=4,t}setPixelData(t,s){const{blue:e,green:i,red:a}=this.palette[s];return this.data[t+this.locAlpha]=255,this.data[t+this.locBlue]=e,this.data[t+this.locGreen]=i,this.data[t+this.locRed]=a,t+4}}class y{static parse(t,s=null){var e;const i=new w(t,{toRGBA:!0}),a=new Uint8ClampedArray(i.data);if(s||0===s){const t=null===(e=i.palette)||void 0===e?void 0:e[s];for(let s=0;s<i.data.length;s+=4)a[s+3]=(null==t?void 0:t.red)===a[s]&&(null==t?void 0:t.green)===a[s+1]&&(null==t?void 0:t.blue)===a[s+2]?0:255}return new ImageData(a,i.width,i.height)}}const L=[];for(let t=0;t<256;t++)L[t]=t;L[130]=228,L[142]=196,L[162]=246,L[167]=220,L[171]=252,L[195]=223;class R{static parse(t){const s={},e=[];let i=s,a=!1,h=0,r="",o="";for(let s=0;s<t.length;s++){let l=t[s];123===l&&"FullName"===r&&(l=142);let n=String.fromCharCode(L[l]);if(";"===n||"/"===n?a=!0:10!==l&&13!==l||(a=!1),!a)if(l>32)0===h?"}"===n?i=e.pop():(h++,r=n):1===h?r+=n:2===h?"{"===n?(e.push(i),i={},e[e.length-1][r]=i,h=0):(h++,o=n):3===h&&(o+=n);else if(1===h)h++;else if(3===h){h=0;const t=R.parseValue(o);i.hasOwnProperty(r)?i[r].push(t):i[r]=[t]}}const l=[s];for(;l.length>0;){const t=l.pop();Object.keys(t).forEach((s=>{const e=t[s];Array.isArray(e)?1===e.length?t[s]=e[0]:e.forEach((t=>l.push(t))):Object.keys(e).length>1&&l.push(e)}))}return Object.values(s["Lego*"].Levels).forEach((t=>{t.CryoreMap&&(t.CryOreMap=t.CryoreMap,delete t.CryoreMap),t.CryOreMap&&(t.CryOreMap=t.CryOreMap.replace("Cryo_","Cror_")),t.PredugMap&&(t.PreDugMap=t.PredugMap,delete t.PredugMap);const s=t.TextureSet;Array.isArray(s)&&Array.isArray(s[1])&&(t.TextureSet=s[1])})),s["Lego*"]}static parseValue(t){function s(s){0===(t=t.split(s).filter((t=>""!==t)).map((t=>R.parseValue(t)))).length?t="":1===t.length&&(t=t[0])}const e=Number(t);if(isNaN(e)){const e=(t=t.toString().replace(/\\/g,"/")).toLowerCase();return"true"===e||"false"!==e&&("null"===e?"":(t.includes(":")?s.call(this,":"):t.includes(",")?s.call(this,","):t.includes("|")&&s.call(this,"|"),t))}return e}}class D{parseObjectiveTextFile(t){const s={};let e=b.DROP,i=null,a="",h="";for(let r=0;r<t.length;r++){const o=L[t[r]];let l=String.fromCharCode(o);if(e===b.DROP)if("["===l)i&&(s[i.key]=i),i=new P,e=b.KEY;else if(i&&":"===l){const s=h.toLowerCase();for("objective"===s?(h="",e=b.OBJECTIVE):"failure"===s?(h="",e=b.FAILURE):"completion"===s?(h="",e=b.COMPLETION):"crystalfailure"===s&&(h="",e=b.CRYSTAL_FAILURE);r<t.length&&t[r+1]==="\t".charCodeAt(0);r++);}else"\n"===l||"\r"===l?h="":h+=l;else if(e===b.KEY)if("]"===l)i.key=a,a="",e=b.DROP;else{if("\n"===l||"\r"===l)throw"Malformed objective text file";a+=l}else e===b.OBJECTIVE?"\n"===l||"\r"===l?(i.objective=a,a="",e=b.DROP):a+=l:e===b.FAILURE?"\n"===l||"\r"===l?(i.failure=a,a="",e=b.DROP):a+=l:e===b.COMPLETION?"\n"===l||"\r"===l?(i.completion=a,a="",e=b.DROP):a+=l:e===b.CRYSTAL_FAILURE&&("\n"===l||"\r"===l?(i.crystalFailure=a,a="",e=b.DROP):a+=l)}return i&&(s[i.key]=i),i=null,s}}var b,T;!function(t){t[t.DROP=0]="DROP",t[t.KEY=1]="KEY",t[t.OBJECTIVE=2]="OBJECTIVE",t[t.FAILURE=3]="FAILURE",t[t.COMPLETION=4]="COMPLETION",t[t.CRYSTAL_FAILURE=5]="CRYSTAL_FAILURE"}(b||(b={}));class P{}class F{static parse(t){const s=t.replace(/\r\n/g,"\n").replace(/\r/g,"\n").replace(/\t/g," ").split("\n").map((t=>{const s=t.indexOf("//");s>-1&&(t=t.substring(0,s));const e=t.indexOf(";");return e>-1&&(t=t.substring(0,e)),t})).map((t=>t.trim())).filter((t=>""!==t)).map((t=>t.split(" ").filter((t=>""!==t)))),e={};return F.parseObj(e,s,0),e}static parseObj(t,s,e){for(let i=e;i<s.length;i++){const[e,a]=s[i],h=e.toLowerCase();if("{"===a)t[h]={},i=this.parseObj(t[h],s,i+1);else{if("}"===h)return i;{let s=a.split(":").filter((t=>""!==t)).map((t=>t.split(",").map((t=>t.split("|").map((t=>this.parseValue(t)))))));for(;1===s.length;)s=s[0];t[h]=s}}}return s.length}static parseValue(t){const s=Number(t),e=t.toLowerCase();return isNaN(s)?"false"!==e&&("true"===e||t):s}}class E{constructor(){this.buffer=null,this.entryIndexByName=new Map,this.fLength=[],this.fStart=[]}parseWadFile(t,s=!1){const e=new DataView(t);this.buffer=new Int8Array(t);let i=0;if("WWAD"!==String.fromCharCode.apply(null,this.buffer.slice(i,4)))throw"Invalid WAD0 file provided";s&&console.log("WAD0 file seems legit"),i=4;const a=e.getInt32(i,!0);s&&console.log(a),i=8;let h=i;for(let t=0;t<a;i++)0===this.buffer[i]&&(this.entryIndexByName.set(String.fromCharCode.apply(null,this.buffer.slice(h,i)).replace(/\\/g,"/").toLowerCase(),t),h=i+1,t++);s&&console.log(this.entryIndexByName);for(let t=0;t<a;i++)0===this.buffer[i]&&(h=i+1,t++);s&&console.log("Offset after absolute original names is "+i);for(let t=0;t<a;t++)this.fLength[t]=e.getInt32(i+8,!0),this.fStart[t]=e.getInt32(i+12,!0),i+=16;s&&(console.log(this.fLength),console.log(this.fStart))}getEntryData(t){return new Uint8Array(this.getEntryBuffer(t))}getEntryText(t){let s="";return this.getEntryData(t).forEach((t=>s+=String.fromCharCode(L[t]))),s}getEntryBuffer(t){const s=this.entryIndexByName.get(t.toLowerCase());if(null==s)throw"Entry '"+t+"' not found in WAD file";return this.buffer.slice(this.fStart[s],this.fStart[s]+this.fLength[s])}filterEntryNames(t){const s=new RegExp(t.toLowerCase()),e=[];return this.entryIndexByName.forEach(((t,i)=>{i.match(s)&&e.push(i)})),e}}function B(t){if(!t)return t;let s=t.toString().replace(/\\/g,"/");s.startsWith("/")&&(s=s.substring(1));const e=s.lastIndexOf("/");return s=s.substring(0,e+1),s.startsWith("/")&&(s=s.substring(1)),s}function I(t){if(!t)return t;let s=t.toString().replace(/\\/g,"/");s.startsWith("/")&&(s=s.substring(1));const e=s.lastIndexOf("/");return s.substring(e+1)}function v(t,...s){return s.forEach((s=>{t=(t=Object.keys(t).filter((t=>t.toLowerCase()===s.toLowerCase())).map((s=>t[s])))?t[0]:t})),t}class x{constructor(){this.wad0File=null,this.wad1File=null,this.assetIndex=0,this.totalResources=0,this.assetsFromCfgByName=new Map,this.onMessage=t=>{console.log(t)},this.onInitialLoad=()=>{console.log("Initial loading done.")},this.onAssetLoaded=()=>{},this.onLoadDone=(t,s)=>{console.log("Loading of about "+t+" assets complete! Total load time: "+s+" seconds.")}}loadWadImageAsset(t,s){const e=this.wad0File.getEntryData(t);s(y.parse(e))}loadWadTexture(t,s){const e=this.wad0File.getEntryData(t),i=I(t).match(/^a(\d+).+/i),a=i?parseInt(i[1]):null,h=y.parse(e,a);t.toLowerCase().startsWith("miscanims/crystal")?s(x.grayscaleToGreen(h)):s(h)}static grayscaleToGreen(t){const s=t.data;for(let t=0;t<s.length;t+=4)s[t]=0,s[t+2]=0;return t}loadAlphaImageAsset(t,s){const e=this.wad0File.getEntryData(t),i=y.parse(e);for(let t=0;t<i.data.length;t+=4)i.data[t]<=2&&i.data[t+1]<=2&&i.data[t+2]<=2&&(i.data[t+3]=0);s(i)}loadFontImageAsset(t,s){const e=this.wad0File.getEntryData(t);s(y.parse(e))}loadNerpAsset(t,s){t=t.replace(/.npl$/,".nrn"),s(this.wad0File.getEntryText(t))}loadNerpMsg(t,s){const e=this.parseNerpMsgFile(this.wad0File,t),i=this.parseNerpMsgFile(this.wad1File,t);for(let t=0;t<i.length;t++){e[t]=e[t]||{};const s=i[t];s&&(s.txt&&(e[t].txt=s.txt),s.snd&&(e[t].snd=s.snd))}s(e)}parseNerpMsgFile(t,s){const e=[],i=t.getEntryText(s).split(/[\r\n]/).map((t=>null==t?void 0:t.trim())).filter((t=>!!t));for(let s=0;s<i.length;s++){const a=i[s];if("-"===a)continue;const h=a.match(/\\\[([^\\]+)\\](\s*#([^#]+)#)?/),r=a.match(/^([^$][^#]+)(\s*#([^#]+)#)?/),o=a.match(/\$([^\s]+)\s*([^\s]+)/);if(t===this.wad0File&&h){const t=void 0!==h[3]?this.numericNameToNumber(h[3]):s;e[t]=e[t]||{},e[t].txt=h[1]}else if(t===this.wad1File&&r){const t=void 0!==r[3]?this.numericNameToNumber(r[3]):s;e[t]=e[t]||{},e[t].txt=r[1].replace(/_/g," ").trim()}else{if(!o||3!==o.length)throw"Line in nerps message file did not match anything";{const t=this.numericNameToNumber(o[1]);e[t]=e[t]||{},e[t].snd=o[2].replace(/\\/g,"/")}}}return e}numericNameToNumber(t){if(void 0===t)throw"Numeric name must not be undefined";const s={one:1,two:2,three:3,four:4,five:5,six:6,seven:7,eight:8,nine:9},e={twenty:20,thirty:30,forty:40};let i={ten:10,eleven:11,twelve:12,thirteen:13,fourteen:14,fifteen:15,sixteen:16,seventeen:17,eighteen:18,nineteen:19,eightteen:18}[t]||s[t];if(void 0===i&&Object.keys(e).forEach((a=>{if(t.startsWith(a)){const h=t.replace(a,"");i=e[a]+(h?s[h]:0)}})),void 0===i)throw"Found unexpected numeric name "+t;return i}loadObjectiveTexts(t,s){const e=this.wad1File.getEntryData(t);s((new D).parseObjectiveTextFile(e))}loadMapAsset(t,s){const e=this.wad0File.getEntryData(t);if(e.length<13||"MAP"!==String.fromCharCode.apply(String,e.slice(0,3)))return void console.log("Invalid map data provided");const i={width:e[8],height:e[12],level:[]};let a=[];for(let t=16;t<e.length;t+=2)a.push(e[t]),a.length>=i.width&&(i.level.push(a),a=[]);s(i)}loadObjectListAsset(t,s){const e=this.wad0File.getEntryText(t).split("\n"),i=[];let a=null;for(let t=0;t<e.length;t++){const s=e[t].trim(),h=s.match(/(.+)\s+{/),r=s.match(/driving\s+(.+)/);if(s.length<1||s.startsWith(";")||s.startsWith("Lego*"));else if(h)a={},i[h[1]]=a;else if("}"===s)a=null;else if(r)a.driving=r[1];else{const t=s.split(/\s+/);if(2!==t.length||null===a)throw"Unexpected key value entry: "+s;const e=t[0];let i=t[1];if("xPos"===e||"yPos"===e||"heading"===e)i=parseFloat(i);else if("type"!==e)throw"Unexpected key value entry: "+s;a[e]=i}}s(i)}loadWavAsset(t,s,e){console.error("wav asset loading not yet implemented")}loadLWOFile(t,s){let e;try{e=this.wad0File.getEntryBuffer(t)}catch(s){try{e=this.wad0File.getEntryBuffer("world/shared/"+I(t))}catch(s){return void console.error("Could not load LWO file "+t+"; Error: "+s)}}s(e.buffer)}registerAllAssets(t){this.addAssetFolder(this.loadFontImageAsset,"Interface/Fonts/"),this.addAssetFolder(this.loadAlphaImageAsset,"Interface/Pointers/"),this.addMenuWithAssets(t,"MainMenuFull",!1),this.addMenuWithAssets(t,"PausedMenu"),this.addMenuWithAssets(t,"OptionsMenu"),this.addAsset(this.loadAlphaImageAsset,"Interface/BriefingPanel/BriefingPanel.bmp"),this.addAsset(this.loadObjectiveTexts,"Languages/ObjectiveText.txt"),this.addAlphaImageFolder("Interface/TopPanel/"),this.addAlphaImageFolder("Interface/RightPanel/"),this.addAlphaImageFolder("Interface/RadarPanel/"),this.addAlphaImageFolder("Interface/MessagePanel/"),this.addAsset(this.loadWadImageAsset,"Interface/Airmeter/msgpanel_air_juice.bmp"),this.addAlphaImageFolder("Interface/InfoPanel/"),this.addAlphaImageFolder("Interface/PriorityPanel/"),this.addAlphaImageFolder("Interface/Priorities"),this.addAlphaImageFolder("Interface/CameraControl/"),this.addAlphaImageFolder("Interface/MessageTabs/"),this.addAlphaImageFolder("Interface/IconPanel/"),this.addAlphaImageFolder("Interface/Icons/"),this.addAlphaImageFolder("Interface/Menus/"),this.addAlphaImageFolder("Interface/Buttons/"),this.addAlphaImageFolder("Interface/InfoImages/"),this.addAssetFolder(this.loadAlphaImageAsset,"Interface/FrontEnd/Vol_"),this.addAssetFolder(this.loadWadImageAsset,"Interface/FrontEnd/lp_"),this.addAsset(this.loadAlphaImageAsset,"Interface/FrontEnd/LowerPanel.bmp"),this.addAsset(this.loadNerpAsset,"Levels/nerpnrn.h");const s=new h(v(t,"Levels"));this.onAssetLoaded(0,"Levels",s),Object.values(s.levelsByName).forEach((t=>{t.menuBMP.forEach((t=>{this.addAsset(this.loadAlphaImageAsset,t)})),this.addAsset(this.loadMapAsset,t.surfaceMap),this.addAsset(this.loadMapAsset,t.predugMap),this.addAsset(this.loadMapAsset,t.terrainMap),this.addAsset(this.loadMapAsset,t.blockPointersMap,!0),this.addAsset(this.loadMapAsset,t.cryOreMap),this.addAsset(this.loadMapAsset,t.pathMap,!0),t.fallinMap&&this.addAsset(this.loadMapAsset,t.fallinMap),t.erodeMap&&this.addAsset(this.loadMapAsset,t.erodeMap),this.addAsset(this.loadObjectListAsset,t.oListFile),this.addAsset(this.loadNerpAsset,t.nerpFile),this.addAsset(this.loadNerpMsg,t.nerpMessageFile)})),this.addTextureFolder("World/Shared/");const e=t.BuildingTypes;Object.values(e).forEach((t=>{const s=t.split("/")[1],e=t+"/"+s+".ae";this.addAnimatedEntity(e)})),this.addAnimatedEntity("mini-figures/pilot/pilot.ae"),this.addAnimatedEntity("Creatures/SpiderSB/SpiderSB.ae"),this.addAnimatedEntity("Creatures/bat/bat.ae"),this.addAnimatedEntity(v(t,"MiscObjects","Dynamite")+"/Dynamite.ae"),this.addAnimatedEntity(v(t,"MiscObjects","Barrier")+"/Barrier.ae"),this.addAsset(this.loadLWOFile,"World/Shared/Crystal.lwo"),this.addAsset(this.loadLWOFile,v(t,"MiscObjects","Crystal")+".lwo"),this.addTextureFolder("MiscAnims/Crystal/"),this.addAsset(this.loadLWOFile,v(t,"MiscObjects","Ore")+".lwo"),this.addAsset(this.loadWadTexture,"MiscAnims/Ore/Ore.bmp"),this.addAsset(this.loadLWOFile,"World/Shared/Brick.lwo"),this.addAsset(this.loadLWOFile,v(t,"MiscObjects","ProcessedOre")+".lwo"),this.addAsset(this.loadLWOFile,v(t,"MiscObjects","ElectricFence")+".lwo"),this.addTextureFolder("Buildings/E-Fence/"),this.addAnimatedEntity(v(t,"MiscObjects","Barrier")+"/Barrier.ae"),this.addAnimatedEntity("MiscAnims/Dynamite/Dynamite.ae"),this.addLWSFile("MiscAnims/RockFall/Rock3Sides.lws"),this.addTextureFolder("MiscAnims/RockFall/"),this.addTextureFolder("World/WorldTextures/IceSplit/Ice"),this.addTextureFolder("World/WorldTextures/LavaSplit/Lava"),this.addTextureFolder("World/WorldTextures/RockSplit/Rock");const i=new m(v(t,"Reward"));this.onAssetLoaded(0,"Reward",i),this.addAsset(this.loadWadImageAsset,i.wallpaper),this.addAsset(this.loadFontImageAsset,i.backFont),Object.values(i.fonts).forEach((t=>this.addAsset(this.loadFontImageAsset,t))),i.images.forEach((t=>this.addAsset(this.loadAlphaImageAsset,t.filePath))),i.boxImages.forEach((t=>this.addAsset(this.loadWadImageAsset,t.filePath))),i.saveButton.splice(0,4).forEach((t=>this.addAsset(this.loadWadImageAsset,t))),i.advanceButton.splice(0,4).forEach((t=>this.addAsset(this.loadWadImageAsset,t)))}addAnimatedEntity(t){const s=this.wad0File.getEntryText(t),e=v(F.parse(s),"Lego*");this.onAssetLoaded(0,t,e);const i=B(t);["HighPoly","MediumPoly","LowPoly"].forEach((t=>{const s=v(e,t);s&&Object.keys(s).forEach((t=>{this.addAsset(this.loadLWOFile,i+s[t]+".lwo")}))}));const a=v(e,"Activities");a&&Object.keys(a).forEach((t=>{try{let s=v(a,t);const h=v(e,s),r=v(h,"FILE");!0===v(h,"LWSFILE")?this.addLWSFile(i+r+".lws"):console.error("Found activity which is not an LWS file")}catch(s){console.error(s),console.log(e),console.log(a),console.log(t)}})),this.addTextureFolder(B(t))}addLWSFile(t){const s=this.wad0File.getEntryText(t);this.onAssetLoaded(0,t,s),this.extractLwoFiles(B(t),s).forEach((t=>this.addAsset(this.loadLWOFile,t)))}extractLwoFiles(t,s){const e=s.replace(/\r\n/g,"\n").replace(/\r/g,"\n").replace(/\t/g," ").split("\n").map((t=>t.trim()));if("LWSC"!==e[0])throw"Invalid start of file! Expected 'LWSC' in first line";return e.filter((t=>t.toLowerCase().startsWith("LoadObject ".toLowerCase()))).map((s=>t+I(s.substring("LoadObject ".length)).toLowerCase()))}addAlphaImageFolder(t){this.addAssetFolder(this.loadAlphaImageAsset,t)}addTextureFolder(t){this.addAssetFolder(this.loadWadTexture,t)}addAssetFolder(t,s){this.wad0File.filterEntryNames(s+".+\\.bmp").forEach((s=>{this.addAsset(t,s)}))}addMenuWithAssets(t,s,e=!0){const i=new f(v(t,"Menu",s));this.onAssetLoaded(0,s,i),i.menus.forEach((t=>{const s=e?this.loadAlphaImageAsset:this.loadWadImageAsset,i=Array.isArray(t.menuImage)?t.menuImage[0]:t.menuImage;this.addAsset(s,i),this.addAsset(this.loadFontImageAsset,t.menuFont),this.addAsset(this.loadFontImageAsset,t.loFont),this.addAsset(this.loadFontImageAsset,t.hiFont)}))}addAsset(t,s,e=!1){s&&!this.assetsFromCfgByName.hasOwnProperty(s)&&"NULL"!==s&&this.assetsFromCfgByName.set(s,{method:t.bind(this),assetPath:s,optional:e})}loadAssetsParallel(){const t=[],s=this;this.assetsFromCfgByName.forEach((e=>{t.push(new Promise((t=>{try{e.method(e.assetPath,(i=>{this.assetIndex++,s.onAssetLoaded(this.assetIndex,e.assetPath,i),t()}))}catch(i){if(!e.optional)throw i;this.assetIndex++,s.onAssetLoaded(this.assetIndex,e.assetPath,null),t()}})))})),Promise.all(t).then((()=>{const t=(((new Date).getTime()-this.startTime.getTime())/1e3).toFixed(3).toString();this.onLoadDone(this.totalResources,t)}))}startWithCachedFiles(t){this.startTime=new Date;const s=()=>{this.onMessage("WAD files not found in cache"),t()};this.onMessage("Loading WAD files from cache...");const e=this;this.openLocalCache((t=>{const i=t.get("wad0");i.onerror=s,i.onsuccess=function(){if(void 0===i.result)return void s();e.wad0File=new E;for(let t in i.result)i.result.hasOwnProperty(t)&&(e.wad0File[t]=i.result[t]);const a=t.get("wad1");a.onerror=s,a.onsuccess=function(){if(void 0!==a.result){e.wad1File=new E;for(let t in a.result)a.result.hasOwnProperty(t)&&(e.wad1File[t]=a.result[t]);console.log("WAD files loaded from cache after "+((new Date).getTime()-e.startTime.getTime())/1e3),e.startLoadingProcess()}else s()}}}))}loadWadFiles(t,s){const e=this;Promise.all([this.loadWadFile(t),this.loadWadFile(s)]).then((t=>{e.wad0File=t[0],e.wad1File=t[1],this.openLocalCache((t=>{t.put(e.wad0File,"wad0"),t.put(e.wad1File,"wad1")})),this.startLoadingProcess()}))}loadWadFile(t){return new Promise((s=>{console.log("Loading WAD file from "+t),fetch(t).then((t=>{t.ok&&t.arrayBuffer().then((t=>{const e=new E;e.parseWadFile(t),s(e)}))})).catch((t=>console.error(t)))}))}openLocalCache(t){const s=indexedDB.open("RockRaidersWeb");s.onupgradeneeded=function(){const t=s.result;t.objectStoreNames.contains("wadfiles")&&t.deleteObjectStore("wadfiles"),t.createObjectStore("wadfiles")},s.onsuccess=function(){const e=s.result.transaction(["wadfiles"],"readwrite").objectStore("wadfiles");t(e)}}startLoadingProcess(){this.startTime=new Date,this.assetsFromCfgByName=new Map,this.onMessage("Loading configuration...");const t=R.parse(this.wad1File.getEntryData("Lego.cfg"));this.registerAllAssets(t),this.onMessage("Loading initial assets..."),Promise.all([new Promise((s=>{const e=v(t,"Main","LoadScreen");this.loadWadImageAsset(e,(t=>{this.onAssetLoaded(0,e,t),s()}))})),new Promise((s=>{const e=v(t,"Main","ProgressBar");this.loadWadImageAsset(e,(t=>{this.onAssetLoaded(0,e,t),s()}))})),new Promise((s=>{const e=v(t,"Pointers","Pointer_Standard");this.loadAlphaImageAsset(e,(t=>{this.onAssetLoaded(0,e,t),s()}))})),new Promise((t=>{const s="Interface/Fonts/Font5_Hi.bmp";this.loadFontImageAsset(s,(e=>{this.onAssetLoaded(0,s,e),t()}))}))]).then((()=>{this.onMessage("Start loading assets..."),this.totalResources=this.assetsFromCfgByName.size,this.onInitialLoad(this.totalResources,t),this.assetIndex=0,this.loadAssetsParallel()}))}}class O extends e{constructor(){super(...arguments),this.Levels=0,this.SelfPowered=!1,this.PowerBuilding=!1,this.PickSphere=0,this.TrainDynamite=null,this.CostOre=0,this.CostCrystal=0,this.OxygenCoef=0}}class k extends e{constructor(){super(...arguments),this.RouteSpeed=[],this.RubbleCoef=1,this.PathCoef=1}}class M extends e{constructor(t){super(),this.Pilot=new class extends e{constructor(){super(...arguments),this.Levels=4,this.RouteSpeed=[1.1,1.1,1.1,1.1],this.SoilDrillTime=[4,4,4,4],this.LooseDrillTime=[4,4,4,4],this.MedDrillTime=[8,8,8,8],this.HardDrillTime=[0,0,0,0],this.SeamDrillTime=[10,10,10,10],this.UpgradeTime=[30,45,60,60],this.CollRadius=5,this.CollHeight=12,this.TrackDist=40,this.SingleWidthDig=[!0,!0,!0,!0],this.PickSphere=10,this.RepairValue=[10,15,20,25],this.SurveyRadius=[3,3,3,3],this.Drillsound="SND_pilotdrill",this.Drillfadesound="SND_pilotdrillfade",this.RestPercent=60,this.EnergyDecayRate=.25,this.CanClearRubble=!0,this.NumOfToolsCanCarry=[2,3,4,5],this.CrossLand=!0,this.RubbleCoef=.5,this.PathCoef=2,this.RouteAvoidance=!0,this.UseLegoManTeleporter=!0,this.AwarenessRange=10,this.OxygenCoef=-1,this.CanStrafe=!0,this.EnterToolStore=!0,this.ShowHealthBar=!0}},this.RockMonster=new class extends e{constructor(){super(...arguments),this.Levels=1,this.RouteSpeed=.8,this.TrackDist=50,this.CollRadius=10,this.CollHeight=22,this.AlertRadius=60,this.HealthDecayRate=.6,this.PickSphere=22,this.RepairValue=-10,this.CanScare=!0,this.RestPercent=20,this.CarryMinHealth=15,this.PainThreshold=20,this.StampRadius=80,this.AttackRadius=160,this.CanSteal=!0,this.CrossLand=!0,this.RubbleCoef=1.5,this.GrabMinifigure=!0,this.RouteAvoidance=!0,this.BumpDamage=!0,this.AttackPaths=!0,this.SplitOnZeroHealth=!0,this.CanBeHitByFence=!0,this.Capacity=6,this.PathCoef=.5,this.CanBeShotAt=!0,this.CanFreeze=!0,this.FreezerTime=25,this.FreezerDamage=5,this.CanLaser=!0,this.LaserDamage=110,this.CanPush=!0,this.PusherDist=20,this.PusherDamage=2,this.WakeRadius=25,this.ScaredByBigBangs=!0,this.RemoveReinforcement=!0,this.ShowHealthBar=!0}},this.SmallSpider=new class extends k{constructor(){super(...arguments),this.Levels=1,this.RouteSpeed=[2],this.TrackDist=10,this.CollRadius=0,this.CollHeight=0,this.PickSphere=6,this.AlertRadius=40,this.RandomMove=!0,this.RandomEnterWall=!0,this.CauseSlip=!0,this.CrossLand=!0,this.RubbleCoef=.2,this.DontShowDamage=!0,this.DontShowOnRadar=!0,this.ScaredByBigBangs=!0}},this.Bat=new class extends k{constructor(){super(...arguments),this.Levels=1,this.RouteSpeed=[1],this.TrackDist=10,this.CollRadius=10,this.AlertRadius=10,this.RandomMove=!0,this.randomMoveTime=10,this.CanScare=!0,this.ScaredByBigBangs=!0,this.Flocks=!0,this.FlocksDebug=!1,this.FlocksSmooth=!0,this.FlocksSize=8,this.FlocksTurn=.6,this.FlocksSpeed=1.5,this.FlocksTightness=.8,this.FlocksGoalUpdate=2,this.FlocksRandomness=6,this.FlocksHeight=22,this.CrossLand=!0,this.CrossWater=!0,this.CrossLava=!0,this.DontShowDamage=!0}},this.TinyRM=new class extends e{constructor(){super(...arguments),this.Levels=1,this.RouteSpeed=1.2,this.TrackDist=10,this.CollRadius=0,this.CollHeight=5,this.PickSphere=6,this.AlertRadius=40,this.CrossLand=!0,this.RubbleCoef=1.5,this.DontShowDamage=!0,this.DontShowOnRadar=!0,this.ScaredByPlayer=!0,this.ScaredByBigBangs=!0}},this.TinyIM=new class extends e{constructor(){super(...arguments),this.Levels=1,this.RouteSpeed=1.2,this.TrackDist=10,this.CollRadius=0,this.CollHeight=5,this.PickSphere=6,this.AlertRadius=40,this.CrossLand=!0,this.RubbleCoef=1.5,this.DontShowDamage=!0,this.DontShowOnRadar=!0,this.ScaredByPlayer=!0,this.ScaredByBigBangs=!0}},this.Slug=new class extends e{constructor(){super(...arguments),this.Levels=1,this.RouteSpeed=.3,this.TrackDist=10,this.CollRadius=3,this.CollHeight=7,this.PickSphere=12,this.AlertRadius=40,this.CrossLand=!0,this.RubbleCoef=.3,this.UseHoles=!0,this.DrainPower=!0,this.AttackRadius=280,this.PainThreshold=50,this.CanBeShotAt=!0,this.CanLaser=!0,this.LaserDamage=5,this.CanPush=!0,this.PusherDist=60,this.PusherDamage=5,this.ShowHealthBar=!0,this.ScaredByBigBangs=!0}},this.LavaMonster=new class extends e{constructor(){super(...arguments),this.Levels=1,this.RouteSpeed=.8,this.TrackDist=50,this.CollRadius=10,this.CollHeight=22,this.AlertRadius=60,this.HealthDecayRate=.6,this.PickSphere=22,this.RepairValue=-10,this.CanScare=!0,this.RestPercent=20,this.CarryMinHealth=15,this.PainThreshold=20,this.StampRadius=80,this.AttackRadius=160,this.CanSteal=!0,this.CrossLand=!0,this.RubbleCoef=1.5,this.GrabMinifigure=!0,this.Capacity=7,this.RouteAvoidance=!0,this.BumpDamage=!0,this.AttackPaths=!0,this.SplitOnZeroHealth=!0,this.CanBeHitByFence=!0,this.PathCoef=.5,this.CrossLava=!0,this.CanBeShotAt=!0,this.CanFreeze=!0,this.FreezerTime=75,this.FreezerDamage=40,this.CanLaser=!0,this.LaserDamage=1,this.CanPush=!0,this.PusherDist=60,this.PusherDamage=5,this.WakeRadius=25,this.ScaredByBigBangs=!0,this.RemoveReinforcement=!0,this.ShowHealthBar=!0}},this.IceMonster=new class extends e{constructor(){super(...arguments),this.Levels=1,this.RouteSpeed=.8,this.TrackDist=50,this.CollRadius=10,this.CollHeight=22,this.AlertRadius=60,this.HealthDecayRate=.6,this.PickSphere=22,this.RepairValue=-10,this.CanScare=!0,this.RestPercent=20,this.CarryMinHealth=15,this.PainThreshold=20,this.StampRadius=80,this.AttackRadius=120,this.CanSteal=!0,this.CrossLand=!0,this.RubbleCoef=1.5,this.GrabMinifigure=!0,this.Capacity=5,this.RouteAvoidance=!0,this.BumpDamage=!0,this.AttackPaths=!0,this.SplitOnZeroHealth=!0,this.CanBeHitByFence=!0,this.PathCoef=.5,this.CanBeShotAt=!0,this.CanFreeze=!1,this.FreezerTime=0,this.FreezerDamage=0,this.CanLaser=!0,this.LaserDamage=110,this.CanPush=!0,this.PusherDist=60,this.PusherDamage=2,this.WakeRadius=25,this.ScaredByBigBangs=!0,this.RemoveReinforcement=!0,this.ShowHealthBar=!0}},this.Hoverboard=new class extends e{constructor(){super(...arguments),this.Levels=8,this.RouteSpeed=[3,3,5,5,3,3,5,5],this.SurveyRadius=[0,0,0,0,4,4,4,4],this.TrackDist=50,this.CollRadius=8,this.CollHeight=12,this.PickSphere=16,this.CanBeDriven=!0,this.CrossLand=!0,this.UseSmallTeleporter=!0,this.CanStrafe=!0,this.CostCrystal=1,this.UpgradeCostOre=[0,5,10,0],this.UpgradeCostStuds=[0,1,2,0],this.ShowHealthBar=!0,this.EngineSound="SND_SmallEngine"}},this.SmallHeli=new class extends e{constructor(){super(...arguments),this.Levels=1,this.RouteSpeed=2.5,this.TrackDist=50,this.CollRadius=10,this.CollHeight=12,this.PickSphere=20,this.CanBeDriven=!0,this.CrossLand=!0,this.CrossWater=!0,this.CrossLava=!0,this.UseSmallTeleporter=!0,this.CanStrafe=!0,this.CostCrystal=3,this.ShowHealthBar=!0,this.EngineSound="SND_HeliEngine"}},this.Smallmlp=new class extends e{constructor(){super(...arguments),this.Levels=4,this.RouteSpeed=[.5,.5,.5,.5],this.TrackDist=50,this.CollRadius=12,this.CollHeight=22,this.PickSphere=26,this.CanBeDriven=!0,this.CrossLand=!0,this.UseSmallTeleporter=!0,this.Tracker=!0,this.CanDoubleSelect=!0,this.CostCrystal=3,this.UpgradeCostOre=[0,0,0,10],this.UpgradeCostStuds=[0,0,0,2],this.ShowHealthBar=!0,this.EngineSound="SND_MediumEngine"}},this.SmallCat=new class extends e{constructor(){super(...arguments),this.Levels=3,this.RouteSpeed=[2,3,4],this.TrackDist=50,this.CollRadius=12,this.CollHeight=12,this.PickSphere=26,this.CrossWater=!0,this.CanBeDriven=!0,this.UseWaterTeleporter=!0,this.CostCrystal=2,this.MaxCarry=[1,1,1],this.GetInAtLand=!0,this.GetOutAtLand=!0,this.TakeCarryingDrivers=!0,this.ShowHealthBar=!0,this.EngineSound="SND_Catamaran"}},this.SmallDigger=new class extends e{constructor(){super(...arguments),this.Levels=8,this.RouteSpeed=[2,2,4,4,2,2,4,4],this.SoilDrillTime=[1,1,1,1,1,1,1,1],this.LooseDrillTime=[2,1,2,1,2,1,2,1],this.MedDrillTime=[4,2,4,2,4,2,4,2],this.HardDrillTime=[180,150,180,150,180,150,180,150],this.SeamDrillTime=[8,4,8,4,8,4,8,4],this.MaxCarry=[0,0,0,0,0,0,0,0],this.SurveyRadius=[0,0,0,0,4,4,4,4],this.TrackDist=50,this.CollRadius=10,this.CollHeight=12,this.PickSphere=20,this.CanBeDriven=!0,this.CrossLand=!0,this.RouteAvoidance=!0,this.UseSmallTeleporter=!0,this.VehicleCanBeCarried=!0,this.CostCrystal=1,this.UpgradeCostOre=[0,5,10,10],this.UpgradeCostStuds=[0,1,2,2],this.ShowHealthBar=!0,this.EngineSound="SND_SmallEngine"}},this.SmallTruck=new class extends e{constructor(){super(...arguments),this.Levels=16,this.RouteSpeed=[2,2,3,3,2,2,3,3,2,2,3,3,2,2,3,3],this.MaxCarry=[3,3,3,3,3,3,3,3,6,6,6,6,6,6,6,6],this.CarryStart=[0,0,0,0,0,0,0,0,3,3,3,3,3,3,3,3],this.SurveyRadius=[0,0,0,0,4,4,4,4,0,0,0,0,4,4,4,4],this.TrackDist=50,this.CollRadius=10,this.CollHeight=12,this.PickSphere=20,this.CanBeDriven=!0,this.CrossLand=!0,this.UseSmallTeleporter=!0,this.VehicleCanBeCarried=!0,this.CostCrystal=2,this.EnterToolStore=!0,this.UpgradeCostOre=[5,5,10,0],this.UpgradeCostStuds=[1,1,2,0],this.ShowHealthBar=!0,this.EngineSound="SND_SmallEngine"}},this.Bulldozer=new class extends e{constructor(){super(...arguments),this.Levels=16,this.RouteSpeed=[.5,.5,.8,.8,.5,.5,.8,.8,.5,.5,.8,.8,.5,.5,.8,.8],this.MaxCarry=[0,0,0,0,0,0,0,0,2,2,2,2,2,2,2,2],this.SurveyRadius=[0,0,0,0,5,5,5,5,0,0,0,0,5,5,5,5],this.TrackDist=80,this.CollRadius=18,this.CollHeight=26,this.PickSphere=40,this.CrossLand=!0,this.CanClearRubble=!0,this.UseBigTeleporter=!0,this.CanBeDriven=!0,this.CostCrystal=4,this.InvisibleDriver=!0,this.UpgradeCostOre=[5,5,20,0],this.UpgradeCostStuds=[1,1,4,0],this.ShowHealthBar=!0,this.EngineSound="SND_MediumEngine"}},this.WalkerDigger=new class extends e{constructor(){super(...arguments),this.Levels=8,this.RouteSpeed=[.5,.5,.8,.8,.5,.5,.8,.8],this.SoilDrillTime=[1,1,1,1,1,1,1,1],this.LooseDrillTime=[.8,.4,.8,.4,.8,.4,.8,.4],this.MedDrillTime=[2,1,2,1,2,1,2,1],this.HardDrillTime=[180,150,180,150,180,150,180,150],this.SeamDrillTime=[4,2,4,2,4,2,4,2],this.SurveyRadius=[0,0,0,0,5,5,5,5],this.TrackDist=80,this.CollRadius=15,this.CollHeight=33,this.PickSphere=35,this.CrossLand=!0,this.UseBigTeleporter=!0,this.CostCrystal=3,this.CanBeDriven=!0,this.InvisibleDriver=!0,this.CanStrafe=!0,this.DrillSound="DrillSFX_Grinder",this.DrillFadeSound="DrillSFX_GrinderFade",this.UpgradeCostOre=[0,5,20,20],this.UpgradeCostStuds=[0,1,4,4],this.ShowHealthBar=!0,this.EngineSound="SND_MediumEngine"}},this.LargeDigger=new class extends e{constructor(){super(...arguments),this.Levels=4,this.RouteSpeed=[.3,.3,.6,.6],this.SoilDrillTime=[1,1,1,1],this.LooseDrillTime=[.4,.2,.4,.2],this.MedDrillTime=[.8,.4,.8,.4],this.HardDrillTime=[1,.5,1,.5],this.SeamDrillTime=[1,.5,1,.5],this.TrackDist=80,this.CollRadius=22,this.CollHeight=30,this.PickSphere=50,this.CrossLand=!0,this.UseBigTeleporter=!0,this.Tracker=!0,this.CanDoubleSelect=!0,this.CanBeDriven=!0,this.CostCrystal=5,this.InvisibleDriver=!0,this.DrillSound="DrillSFX_Grinder",this.DrillFadeSound="DrillSFX_GrinderFade",this.UpgradeCostOre=[0,0,15,20],this.UpgradeCostStuds=[0,0,3,4],this.ShowHealthBar=!0,this.EngineSound="SND_LargeEngine"}},this.LargeCat=new class extends e{constructor(){super(...arguments),this.Levels=1,this.RouteSpeed=1.5,this.SurveyRadius=0,this.TrackDist=80,this.CollRadius=22,this.CollHeight=25,this.PickSphere=50,this.CanBeDriven=!0,this.CrossWater=!0,this.UseWaterTeleporter=!0,this.ClassAsLarge=!0,this.CarryVehicles=!0,this.CostCrystal=4,this.EngineSound="SND_Catamaran",this.ShowHealthBar=!0}},this.LargeHeli=new class extends e{constructor(){super(...arguments),this.Levels=3,this.RouteSpeed=[.3,.4,.5],this.TrackDist=80,this.CollRadius=0,this.CollHeight=0,this.PickSphere=20,this.ShowHealthBar=!0,this.EngineSound="SND_HeliEngine"}},this.LargeMLP=new class extends e{constructor(){super(...arguments),this.Levels=8,this.RouteSpeed=[.4,.4,.4,.4,.4,.4,.4,.4],this.SurveyRadius=[0,0,0,0,5,5,5,5],this.TrackDist=80,this.CollRadius=20,this.CollHeight=24,this.PickSphere=47,this.CrossLand=!0,this.UseBigTeleporter=!0,this.Tracker=!0,this.CanDoubleSelect=!0,this.CostCrystal=4,this.CanBeDriven=!0,this.InvisibleDriver=!0,this.UpgradeCostOre=[0,5,0,25],this.UpgradeCostStuds=[0,1,0,5],this.ShowHealthBar=!0,this.EngineSound="SND_LargeEngine"}},this.Barracks=new class extends O{constructor(){super(...arguments),this.Levels=3,this.TrackDist=50,this.CollHeight=23,this.CollRadius=15,this.PickSphere=30,this.CostOre=15,this.CostRefinedOre=3,this.CostCrystal=3,this.SnaxULike=!0,this.TrainDriver=[!0,!0,!0],this.CrystalDrain=[1,1,1],this.DamageCausesCallToArms=!0,this.OxygenCoef=10,this.EngineSound="SND_BuildingHum",this.ShowHealthBar=!0}},this.Powerstation=new class extends O{constructor(){super(...arguments),this.Levels=2,this.TrackDist=80,this.ProcessCrystal=!0,this.CollHeight=31,this.CollRadius=15,this.PickSphere=32,this.CostOre=12,this.CostRefinedOre=3,this.CostCrystal=2,this.PowerBuilding=!0,this.DamageCausesCallToArms=!0,this.EngineSound="SND_PowerBuildingHum",this.ShowHealthBar=!0}},this.OreRefinery=new class extends O{constructor(){super(...arguments),this.Levels=4,this.TrackDist=60,this.ProcessOre=!0,this.CollHeight=16,this.CollRadius=15,this.PickSphere=30,this.CostOre=20,this.CostRefinedOre=4,this.CostCrystal=3,this.CrystalDrain=[1,1,1,1],this.DamageCausesCallToArms=!0,this.MaxCarry=[5,4,3,2],this.EngineSound="SND_BuildingHum",this.ShowHealthBar=!0}},this.TeleportPad=new class extends O{constructor(){super(...arguments),this.Levels=3,this.TrackDist=60,this.SmallTeleporter=!0,this.ManTeleporter=!0,this.CollHeight=20,this.CollRadius=15,this.PickSphere=30,this.CostOre=8,this.CostRefinedOre=2,this.CrystalDrain=[1,1,1],this.DamageCausesCallToArms=!0,this.TrainPilot=[!0,!0,!0],this.EngineSound="SND_BuildingHum",this.ShowHealthBar=!0}},this.TeleportBIG=new class extends O{constructor(){super(...arguments),this.Levels=2,this.TrackDist=50,this.BigTeleporter=!0,this.CollHeight=17,this.CollRadius=15,this.PickSphere=30,this.CostOre=20,this.CostRefinedOre=4,this.CostCrystal=2,this.CrystalDrain=[1,1],this.DamageCausesCallToArms=!0,this.EngineSound="SND_BuildingHum",this.ShowHealthBar=!0}},this.Docks=new class extends O{constructor(){super(...arguments),this.Levels=1,this.TrackDist=60,this.CollHeight=20,this.CollRadius=15,this.PickSphere=30,this.CostOre=8,this.CostRefinedOre=2,this.CostCrystal=1,this.WaterEntrances=1,this.WaterTeleporter=!0,this.CrystalDrain=1,this.DamageCausesCallToArms=!0,this.TrainSailor=!0,this.EngineSound="SND_BuildingHum",this.ShowHealthBar=!0}},this.Toolstation=new class extends O{constructor(){super(...arguments),this.Levels=3,this.TrackDist=50,this.ManTeleporter=!0,this.CollHeight=16,this.CollRadius=15,this.PickSphere=30,this.ToolStore=!0,this.StoreObjects=!0,this.SelfPowered=!0,this.DamageCausesCallToArms=!0,this.TrainDynamite=[!1,!1,!0],this.FunctionCoef=[1,1,1],this.ShowHealthBar=!0}},this.GunStation=new class extends O{constructor(){super(...arguments),this.Levels=2,this.TrackDist=60,this.CollHeight=33,this.CollRadius=15,this.PickSphere=30,this.CostOre=15,this.CostRefinedOre=3,this.CostCrystal=1,this.Tracker=!0,this.CanDoubleSelect=!0,this.CrystalDrain=[1,1],this.DamageCausesCallToArms=!0,this.FunctionCoef=[1,.5],this.EngineSound="SND_BuildingHum",this.ShowHealthBar=!0}},this.Geodome=new class extends O{constructor(){super(...arguments),this.Levels=3,this.TrackDist=50,this.CollHeight=20,this.CollRadius=15,this.PickSphere=30,this.CostOre=15,this.CostRefinedOre=3,this.CostCrystal=3,this.SurveyRadius=[6,8,12],this.CrystalDrain=[1,1,1],this.DamageCausesCallToArms=!0,this.TrainScanner=[!0,!0,!0],this.EngineSound="SND_BuildingHum",this.ShowHealthBar=!0}},this.Upgrade=new class extends O{constructor(){super(...arguments),this.Levels=2,this.TrackDist=80,this.CollHeight=40,this.CollRadius=15,this.PickSphere=32,this.CostOre=20,this.CostRefinedOre=4,this.CostCrystal=3,this.UpgradeBuilding=!0,this.CrystalDrain=[1,1],this.DamageCausesCallToArms=!0,this.FunctionCoef=[.8,1.6],this.TrainRepair=[!0,!0],this.EngineSound="SND_BuildingHum",this.ShowHealthBar=!0}},this.PowerCrystal=new class extends e{constructor(){super(...arguments),this.Levels=1,this.TrackDist=20,this.CollHeight=2,this.PickSphere=6}},this.ProcessedOre=new class extends e{constructor(){super(...arguments),this.Levels=1,this.TrackDist=20,this.CollHeight=2,this.PickSphere=8}},this.Ore=new class extends e{constructor(){super(...arguments),this.Levels=1,this.TrackDist=20,this.CollHeight=2,this.PickSphere=6}},this.Boulder=new class extends e{constructor(){super(...arguments),this.Levels=1,this.CollRadius=2}},this.Pusher=new class extends e{constructor(){super(...arguments),this.Levels=1,this.CollRadius=1}},this.Freezer=new class extends e{constructor(){super(...arguments),this.Levels=1,this.CollRadius=1}},this.LaserShot=new class extends e{constructor(){super(...arguments),this.Levels=1,this.ColRadius=1}},this.ElectricFence=new class extends e{constructor(){super(...arguments),this.Levels=1,this.TrackDist=50,this.CollRadius=5,this.CollHeight=18,this.PickSphere=20,this.DamageCausesCallToArms=!0}},this.Path=new class extends e{constructor(){super(...arguments),this.Levels=1,this.CostOre=2,this.CostRefinedOre=1}},e.setFromCfg(this,t)}assignValue(t,s,i){if(t.toLowerCase()===s)return e.setFromCfg(this[t],i),!0}}!function(t){t[t.MSG=0]="MSG",t[t.CFG=1]="CFG",t[t.CACHE_MISS=2]="CACHE_MISS",t[t.SFX=3]="SFX",t[t.ASSET=4]="ASSET",t[t.DONE=5]="DONE"}(T||(T={}));class H{constructor(t){this.type=null,this.type=t}static createTextMessage(t){return{type:T.MSG,text:t}}static createCfgLoaded(t,s){return{type:T.CFG,cfg:t,stats:new M(t.Stats),totalResources:s}}static createAssetLoaded(t,s,e){return{type:T.ASSET,assetName:s,assetObj:e}}static createLoadDone(t,s){return{type:T.DONE,totalResources:t,loadingTimeSeconds:s}}}const N=self;function _(t){N.postMessage(t)}N.addEventListener("message",(t=>{const s=new x;s.onMessage=t=>_(H.createTextMessage(t)),s.onInitialLoad=(t,s)=>_(H.createCfgLoaded(s,t)),s.onAssetLoaded=(t,s,e)=>{_(H.createAssetLoaded(t,s,e))},s.onLoadDone=(t,s)=>{_(H.createLoadDone(t,s))};const e=t.data;e?s.loadWadFiles(e.wad0FileUrl,e.wad1FileUrl):s.startWithCachedFiles((()=>_(new H(T.CACHE_MISS))))}))})();
//# sourceMappingURL=190.index.js.map