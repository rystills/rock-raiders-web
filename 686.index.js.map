{"version":3,"sources":["webpack://rock-raiders-web/./site/modal/WadFileSelectionModal.ts","webpack://rock-raiders-web/./src/resource/wadworker/Resources.ts","webpack://rock-raiders-web/./src/resource/wadworker/InitLoadingMessage.ts","webpack://rock-raiders-web/./src/core/ImageHelper.js","webpack://rock-raiders-web/./src/resource/wadworker/WadUtil.ts","webpack://rock-raiders-web/./src/core/Util.ts","webpack://rock-raiders-web/./src/scene/model/anim/AnimationEntityType.ts","webpack://rock-raiders-web/./src/resource/AnimatedMesh.ts","webpack://rock-raiders-web/./src/resource/LWOLoader.ts","webpack://rock-raiders-web/./src/game/model/Selectable.ts","webpack://rock-raiders-web/./src/scene/model/anim/AnimClip.ts","webpack://rock-raiders-web/./src/scene/model/anim/AnimSubObj.ts","webpack://rock-raiders-web/./src/scene/DebugHelper.ts","webpack://rock-raiders-web/./src/game/model/entity/building/Building.ts","webpack://rock-raiders-web/./src/scene/model/BaseEntity.ts","webpack://rock-raiders-web/./src/event/EventKeyEnum.ts","webpack://rock-raiders-web/./src/event/EventBus.ts","webpack://rock-raiders-web/./src/event/WorldEvents.ts","webpack://rock-raiders-web/./src/event/GameEvent.ts","webpack://rock-raiders-web/./src/game/model/job/JobState.ts","webpack://rock-raiders-web/./src/game/model/job/JobType.ts","webpack://rock-raiders-web/./src/game/model/job/Job.ts","webpack://rock-raiders-web/./src/scene/model/PathTarget.ts","webpack://rock-raiders-web/./src/scene/model/collect/CollectableEntity.ts","webpack://rock-raiders-web/./src/game/model/job/CollectJob.ts","webpack://rock-raiders-web/./src/scene/model/activities/BaseActivity.ts","webpack://rock-raiders-web/./src/scene/model/activities/AnimEntityActivity.ts","webpack://rock-raiders-web/./src/scene/model/activities/RaiderActivity.ts","webpack://rock-raiders-web/./src/scene/model/activities/BuildingActivity.ts","webpack://rock-raiders-web/./src/scene/model/CollectionTarget.ts","webpack://rock-raiders-web/./src/game/model/job/PriorityIdentifier.ts","webpack://rock-raiders-web/./src/event/LocalEvents.ts","webpack://rock-raiders-web/./src/scene/model/anim/AnimEntity.ts","webpack://rock-raiders-web/./src/scene/model/activities/DynamiteActivity.ts","webpack://rock-raiders-web/./src/scene/model/collect/Dynamite.ts","webpack://rock-raiders-web/./src/game/model/GameState.ts","webpack://rock-raiders-web/./src/scene/model/collect/Crystal.ts","webpack://rock-raiders-web/./src/scene/model/collect/Ore.ts","webpack://rock-raiders-web/./src/scene/model/RaiderSkill.ts","webpack://rock-raiders-web/./src/scene/model/activities/BarrierActivity.ts","webpack://rock-raiders-web/./src/scene/model/collect/Barrier.ts","webpack://rock-raiders-web/./src/scene/model/map/Surface.ts","webpack://rock-raiders-web/./src/scene/model/map/SurfaceType.ts","webpack://rock-raiders-web/./src/event/WorldLocationEvent.ts","webpack://rock-raiders-web/./src/resource/wadworker/WorkerMessage.ts","webpack://rock-raiders-web/./src/scene/model/map/SurfaceGeometry.ts","webpack://rock-raiders-web/./src/scene/model/map/BuildPlacementMarkerMesh.ts","webpack://rock-raiders-web/./src/scene/model/map/BuildPlacementMarker.ts","webpack://rock-raiders-web/./src/scene/SceneManager.ts","webpack://rock-raiders-web/./src/resource/LWSCLoader.ts","webpack://rock-raiders-web/./src/resource/AnimEntityLoader.ts","webpack://rock-raiders-web/./src/core/BitmapFont.ts","webpack://rock-raiders-web/./src/cfg/BaseConfig.ts","webpack://rock-raiders-web/./src/event/EventTypeEnum.ts","webpack://rock-raiders-web/./src/cfg/BuildingEntityStats.ts","webpack://rock-raiders-web/./src/cfg/MovableEntityStats.ts","webpack://rock-raiders-web/./src/cfg/GameStatsCfg.ts","webpack://rock-raiders-web/./src/resource/ResourceManager.ts","webpack://rock-raiders-web/./src/screen/ScreenLayer.ts","webpack://rock-raiders-web/./src/event/EventManager.ts","webpack://rock-raiders-web/./src/screen/BaseScreen.ts","webpack://rock-raiders-web/./src/screen/LoadingScreen.ts","webpack://rock-raiders-web/./src/menu/MainMenuBaseItem.ts","webpack://rock-raiders-web/./src/menu/MainMenuLabelButton.ts","webpack://rock-raiders-web/./src/menu/MainMenuIconButton.ts","webpack://rock-raiders-web/./src/menu/MainMenuLayer.ts","webpack://rock-raiders-web/./src/menu/MainMenuLevelButton.ts","webpack://rock-raiders-web/./src/menu/MainMenuPanel.ts","webpack://rock-raiders-web/./src/menu/MainMenuWindow.ts","webpack://rock-raiders-web/./src/menu/LevelSelectLayer.ts","webpack://rock-raiders-web/./src/screen/MainMenuScreen.ts","webpack://rock-raiders-web/./src/scene/model/map/astar.ts","webpack://rock-raiders-web/./src/scene/TerrainLoader.ts","webpack://rock-raiders-web/./src/scene/model/map/TerrainPath.ts","webpack://rock-raiders-web/./src/scene/model/map/Terrain.ts","webpack://rock-raiders-web/./src/scene/model/EntityStep.ts","webpack://rock-raiders-web/./src/scene/model/MoveState.ts","webpack://rock-raiders-web/./src/scene/model/MovableEntity.ts","webpack://rock-raiders-web/./src/scene/model/FulfillerEntity.ts","webpack://rock-raiders-web/./src/scene/model/RaiderTool.ts","webpack://rock-raiders-web/./src/scene/model/Raider.ts","webpack://rock-raiders-web/./src/scene/model/BuildingEntity.ts","webpack://rock-raiders-web/./src/scene/model/activities/MonsterActivity.ts","webpack://rock-raiders-web/./src/game/model/entity/monster/Monster.ts","webpack://rock-raiders-web/./src/game/model/entity/monster/SmallSpider.ts","webpack://rock-raiders-web/./src/game/model/entity/monster/Bat.ts","webpack://rock-raiders-web/./src/scene/ObjectListLoader.ts","webpack://rock-raiders-web/./src/game/model/job/surface/SurfaceJob.ts","webpack://rock-raiders-web/./src/game/model/job/surface/DynamiteJob.ts","webpack://rock-raiders-web/./src/core/NerpRunner.ts","webpack://rock-raiders-web/./src/core/NerpParser.ts","webpack://rock-raiders-web/./src/game/model/job/PriorityList.ts","webpack://rock-raiders-web/./src/game/model/job/MoveJob.ts","webpack://rock-raiders-web/./src/scene/WorldManager.ts","webpack://rock-raiders-web/./src/game/layer/SelectionLayer.ts","webpack://rock-raiders-web/./src/game/model/job/surface/DrillJob.ts","webpack://rock-raiders-web/./src/game/model/job/surface/ClearRubbleJob.ts","webpack://rock-raiders-web/./src/game/model/job/surface/CompletePowerPathJob.ts","webpack://rock-raiders-web/./src/scene/model/BuildingSite.ts","webpack://rock-raiders-web/./src/game/layer/GameLayer.ts","webpack://rock-raiders-web/./src/game/gui/base/BaseElement.ts","webpack://rock-raiders-web/./src/game/gui/base/Panel.ts","webpack://rock-raiders-web/./src/game/gui/base/Button.ts","webpack://rock-raiders-web/./src/game/gui/sidebar/SideBarLabel.ts","webpack://rock-raiders-web/./src/game/gui/sidebar/PanelCrystalSideBar.ts","webpack://rock-raiders-web/./src/game/gui/infodock/ButtonInfoDockCfg.ts","webpack://rock-raiders-web/./src/game/gui/toppanel/ButtonPriorityListCfg.ts","webpack://rock-raiders-web/./src/game/gui/toppanel/ButtonTopCfg.ts","webpack://rock-raiders-web/./src/cfg/ButtonsCfg.ts","webpack://rock-raiders-web/./src/game/gui/radar/RadarPanel.ts","webpack://rock-raiders-web/./src/game/gui/messagepanel/TextInfoMessage.ts","webpack://rock-raiders-web/./src/game/gui/messagepanel/MessagePanel.ts","webpack://rock-raiders-web/./src/cfg/IconPanelBackButtonCfg.ts","webpack://rock-raiders-web/./src/cfg/MenuItemCfg.ts","webpack://rock-raiders-web/./src/game/gui/main/IconPanelButton.ts","webpack://rock-raiders-web/./src/game/gui/main/IconSubPanel.ts","webpack://rock-raiders-web/./src/game/gui/main/BuildingPanel.ts","webpack://rock-raiders-web/./src/game/gui/main/SmallVehiclePanel.ts","webpack://rock-raiders-web/./src/game/gui/main/LargeVehiclePanel.ts","webpack://rock-raiders-web/./src/game/gui/main/SelectBasePanel.ts","webpack://rock-raiders-web/./src/game/model/job/surface/ReinforceJob.ts","webpack://rock-raiders-web/./src/game/gui/main/SelectWallPanel.ts","webpack://rock-raiders-web/./src/scene/model/collect/ElectricFence.ts","webpack://rock-raiders-web/./src/game/gui/main/SelectFloorPanel.ts","webpack://rock-raiders-web/./src/game/gui/main/SelectRubblePanel.ts","webpack://rock-raiders-web/./src/game/gui/main/IconPanelToggleButton.ts","webpack://rock-raiders-web/./src/game/gui/main/SelectBuildingPanel.ts","webpack://rock-raiders-web/./src/game/model/job/EatJob.ts","webpack://rock-raiders-web/./src/game/gui/main/SelectRaiderPanel.ts","webpack://rock-raiders-web/./src/game/gui/main/SelectVehiclePanel.ts","webpack://rock-raiders-web/./src/core/Area.ts","webpack://rock-raiders-web/./src/game/model/job/TrainJob.ts","webpack://rock-raiders-web/./src/game/gui/main/TrainRaiderPanel.ts","webpack://rock-raiders-web/./src/game/model/job/GetToolJob.ts","webpack://rock-raiders-web/./src/game/gui/main/GetToolPanel.ts","webpack://rock-raiders-web/./src/game/gui/main/IconPanelButtonLabel.ts","webpack://rock-raiders-web/./src/game/gui/main/MainPanel.ts","webpack://rock-raiders-web/./src/game/gui/base/ToggleButton.ts","webpack://rock-raiders-web/./src/game/gui/toppanel/TopPanel.ts","webpack://rock-raiders-web/./src/game/gui/infodock/InfoDockButton.ts","webpack://rock-raiders-web/./src/game/gui/infodock/InfoDockPanel.ts","webpack://rock-raiders-web/./src/cfg/PanelsCfg.ts","webpack://rock-raiders-web/./src/game/gui/toppanel/PriorityListPanel.ts","webpack://rock-raiders-web/./src/game/gui/infodock/InfoMessagesEntryConfig.ts","webpack://rock-raiders-web/./src/game/gui/infodock/InfoMessagesConfig.ts","webpack://rock-raiders-web/./src/game/gui/infodock/InformationPanel.ts","webpack://rock-raiders-web/./src/game/gui/toppanel/PriorityButtonsConfig.ts","webpack://rock-raiders-web/./src/game/gui/toppanel/PriorityPositionsEntry.ts","webpack://rock-raiders-web/./src/game/gui/messagepanel/TextInfoMessageEntryConfig.ts","webpack://rock-raiders-web/./src/game/gui/messagepanel/TextInfoMessageConfig.ts","webpack://rock-raiders-web/./src/game/layer/GuiBaseLayer.ts","webpack://rock-raiders-web/./src/game/layer/GuiMainLayer.ts","webpack://rock-raiders-web/./src/game/Supervisor.ts","webpack://rock-raiders-web/./src/game/gui/briefing/BriefingPanel.ts","webpack://rock-raiders-web/./src/game/gui/overlay/MenuCycleItem.ts","webpack://rock-raiders-web/./src/game/gui/overlay/MenuSliderItem.ts","webpack://rock-raiders-web/./src/game/gui/overlay/MenuLabelItem.ts","webpack://rock-raiders-web/./src/game/gui/overlay/MenuLayer.ts","webpack://rock-raiders-web/./src/game/gui/overlay/MenuBasePanel.ts","webpack://rock-raiders-web/./src/game/gui/overlay/OptionsPanel.ts","webpack://rock-raiders-web/./src/game/gui/overlay/PausePanel.ts","webpack://rock-raiders-web/./src/core/Rect.ts","webpack://rock-raiders-web/./src/cfg/DialogCfg.ts","webpack://rock-raiders-web/./src/cfg/BriefingPanelCfg.ts","webpack://rock-raiders-web/./src/game/layer/OverlayLayer.ts","webpack://rock-raiders-web/./src/screen/GameScreen.ts","webpack://rock-raiders-web/./src/menu/RewardScreenButton.ts","webpack://rock-raiders-web/./src/screen/RewardScreen.ts","webpack://rock-raiders-web/./src/main.ts"],"names":["parentId","onStart","rootElement","document","getElementById","appendChild","createElement","classList","add","tabIndex","setAttribute","modalDialog","modalContent","modalHeader","modalTitle","innerText","id","modalBody","navTabList","navFileBtn","WadFileSelectionModal","appendNavButton","navUrlBtn","navTabContent","this","appendNavFileTab","appendNavUrlTab","modal","backdrop","keyboard","parent","active","controlTarget","navBtn","type","String","labelledBy","navFileTab","appendNavTab","wad0File","appendWadFileGroup","wad1File","btnStartFile","addEventListener","disabled","wad0FileUrl","URL","createObjectURL","files","wad1FileUrl","filename","wadFileGroup","wadFileLabel","innerHTML","wadFileInput","required","navUrlTab","urlHint","wad0Url","appendWadUrlGroup","wad1Url","btnStartUrl","value","navTab","example","wadUrlGroup","wadUrlLabel","wadUrlInput","show","hide","Worker_fn","Worker","createContext","width","height","console","error","result","y","x","fillStyle","fillRect","createDummyContext","canvas","context","getContext","createDummyImgData","ImageData","e","px","py","setPixel","imgData","r","g","b","a","n","data","getPixel","iGet","obj","keys","forEach","keyname","Object","filter","key","toLowerCase","map","url","strUrl","toString","replace","startsWith","substring","lastInd","lastIndexOf","decodeString","TextDecoder","decode","decodeFilepath","getRandomInclusive","min","max","Math","ceil","floor","random","getRandom","getRandomSign","clearTimeoutSafe","timeout","clearTimeout","clearIntervalSafe","interval","clearInterval","Array","prototype","remove","element","index","indexOf","splice","Map","getOrUpdate","updateCallback","get","undefined","set","carryNullName","depositNullName","toolNullName","mediumPoly","highPoly","fPPoly","activities","mesh","textureSequences","dispose","s","geometry","isArray","material","mat","SURF_VTRN","getVector3AtOffset","view","offset","vector","getFloat32","z","SelectionType","path","verbose","materials","vertices","indices","uvs","sequenceIntervals","log","parsePoints","chunkOffset","chunkSize","numVertices","Float32Array","i","vertexIndex","vertexOffset","parseSurfaceNames","buffer","surfaceNames","Uint8Array","split","length","new_material","name","side","push","parsePolygons","totalNumIndices","numIndices","getInt16","materialIndex","addGroup","currentIndex","Uint16Array","faceIndices","Int16Array","COUNTER_CLOCKWISE","parseSurface","getUint8","materialName","textureFlags","textureSize","textureCenter","shininess","subchunkOffset","subchunkType","getInt32","subchunkSize","colorArray","color","fromArray","join","flags","getUint16","warn","blending","depthWrite","edgeTransparencyThreshold","luminosity","emissiveIntensity","diffuse","specular","reflection","reflectivity","transparency","opacity","transparent","vLuminosity","vDiffuse","vSpecular","toArray","textureTypeName","textureValue","textureColorArray","textureFilepath","sequenceTexture","endsWith","match","textureFilename","ResourceManager","filterTextureSequenceNames","setInterval","getTexture","SEQUENCE_TEXTURE_FRAMERATE","lTextureName","size","center","XAXIS_BIT","groups","group","start","count","uvIndex","u","v","planarMapUVS","parse","DataView","getUint32","fileSize","byteLength","ID4_SIZE","cursor","chunkType","setIndex","computeVertexNormals","AnimatedMesh","magic","looping","transcoef","firstFrame","lastFrame","framesPerSecond","bodies","degToRad","relPos","relRot","relScale","parentObjInd","model","radVec","degX","degY","degZ","setFrameAndFollowing","animationFrameIndex","infos","c","setOpacityAndFollowing","Stats","stats","setMode","domElement","style","position","left","top","body","visibility","renderStart","begin","renderDone","end","folder","blocksPathSurface","secondaryBuildingPart","secondaryPowerPath","hasPrimaryPowerPath","waterPathSurface","aeFile","slice","getByName","buildingType","TOOLSTATION","TELEPORT_PAD","DOCKS","POWER_STATION","BARRACKS","UPGRADE","GEODOME","ORE_REFINERY","GUNSTATION","TELEPORT_BIG","Building","EventKey","level","getPosition","clone","getPosition2D","getHeading","rotation","onDiscover","visible","getCurrentSurface","worldMgr","sceneManager","terrain","getSurfaceFromWorld","removeFromScene","scene","EntityType","publishEvent","event","blockedEvents","includes","eventKey","isLocal","getListener","callback","registerEventListener","eventListener","entityKey","GameEvent","job","WorldEvent","JOB_CREATE","JobEvent","JOB_DELETE","RAIDER_REQUESTED","collectableType","MATERIAL_AMOUNT_CHANGED","surface","SPAWN_DYNAMITE","entity","ENTITY_ADDED","ENTITY_REMOVED","JobState","CAVERN_DISCOVERED","ORE_FOUND","building","BUILDING_UPGRADED","raider","skill","RAIDER_TRAINED","JobType","fulfiller","jobstate","OPEN","assign","unassign","cancel","CANCELED","stopJob","isQualified","isQualifiedWithTool","isQualifiedWithTraining","onJobComplete","COMPLETE","Job","CollectableType","location","targetLocation","isInArea","item","COLLECT","getWorkplaces","PathTarget","carries","hasTarget","getPriorityIdentifier","getCollectableType","ELECTRIC_FENCE","electricFence","targetSurface","canPlaceFence","fence","PublicJob","activityKey","Stand","AnimEntityActivity","BaseActivity","Route","RaiderActivity","RunPanic","Drill","Walk","Reinforce","Reverse","TurnLeft","TurnRight","CantDo","Collect","Clear","Carry","CarryTurnLeft","CarryTurnRight","CarryStand","Dynamite","Place","Deposit","TeleportIn","Repair","rest","routeRubble","CarryRubble","Eat","FireLaser","GetUp","ThrownByRockMonster","Slip","Train","Recharge","Waiting1","Waiting2","Waiting3","Waiting4","Hoverboard","Standhoverboard","HitLefthoverboard","HitRighthoverboard","HitFronthoverboard","HitBackhoverboard","SMALLTRUCK","StandSMALLTRUCK","HitLeftSMALLTRUCK","HitRightSMALLTRUCK","HitFrontSMALLTRUCK","HitBackSMALLTRUCK","SMALLheli","StandSMALLheli","HitLeftSMALLheli","HitRightSMALLheli","HitFrontSMALLheli","HitBackSMALLheli","SMALLCAT","StandSMALLCAT","HitLeftSMALLCAT","HitRightSMALLCAT","HitFrontSMALLCAT","HitBackSMALLCAT","SMALLMLP","StandSMALLMLP","HitLeftSMALLMLP","HitRightSMALLMLP","HitFrontSMALLMLP","HitBackSMALLMLP","LARGECAT","StandLARGECAT","HitLeftLARGECAT","HitRightLARGECAT","HitFrontLARGECAT","HitBackLARGECAT","SMALLDIGGER","StandSMALLDIGGER","Teleport","BuildingActivity","Explode","Unpowered","site","canGatherItem","activity","getDefaultActivity","gatherItem","addItem","carryJoint","changeActivity","CollectPathTarget","addItemToStorage","CRYSTAL","GameState","numCrystal","EventBus","MaterialAmountChanged","ORE","numOre","getDropAction","targets","targetSite","updateTargets","getCarryTargets","resetTarget","sites","buildingSites","needs","getRandomDropPosition","buildings","getBuildingsByType","getTargetBuildingTypes","getDropPosition2D","some","t","complete","isPowered","collectablesUndiscovered","collectables","JobCreateEvent","CollectJob","setTargetSite","unAssign","BaseEntity","PriorityIdentifier","LocalEvent","SELECTED_SURFACE","SelectionEvent","SELECTED_BUILDING","SELECTED_RAIDER","vehicle","SELECTED_VEHICLE","DESELECTED_ENTITY","SURFACE_CHANGED","AIR_LEVEL_CHANGED","CANCEL_BUILD_MODE","entityType","poly","animation","animationTimeout","selectionFrame","pickSphere","pickSphereRadius","depositJoint","getToolJoint","radiusSq","beamUp","EntityDeselected","AnimEntity","moveUp","TILESIZE","counter","NATIVE_FRAMERATE","setTimeout","onAnimationDone","durationTimeMs","lActivityKey","anim","setAnimation","bind","children","polyModel","lBodyName","polyPart","parentInd","sphere","setFromObject","getBoundingSphere","radius","animate","frameIndex","p","copy","scale","hasOwnProperty","nextFrame","standardDurationTimeMs","timeoutTimeMs","createPickSphere","pickSphereCenter","getPickSphereCenter","userData","selectable","createSelectionFrame","getBoundingBoxCenter","getCenter","sub","applyMatrix4","makeScale","selectionFrameTextureSize","ctx","strength","round","selectionFrameTexture","selectionMaterial","depthTest","selectionFrameSize","Normal","DynamiteActivity","TickDown","getAnimationEntityType","isExplodable","hasOneBuildingOf","getDigPositions","DYNAMITE","ignite","getCenterWorld","lookAt","collapse","GameResultState","resource2","getResource","mesh2","SceneManager","registerMesh","LWOLoader","resource","emissive","PowerCrystal","aiPriorityCrystal","CollectableEntity","Ore","aiPriorityOre","DRIVER","RaiderSkill","ENGINEER","GEOLOGIST","PILOT","SAILOR","DEMOLITION","Short","Expand","Long","BARRIER","aiPriorityConstruction","BarrierActivity","barrier","WALL_TYPE","reset","resultState","RUNNING","levelFullName","numBrick","usedCrystals","neededCrystals","airlevel","selectedEntities","selectionType","buildingsUndiscovered","raiders","raidersUndiscovered","requestedRaiders","vehicles","vehiclesUndiscovered","spiders","spidersBySurface","bats","totalCrystals","totalOres","totalDiggables","remainingDiggables","totalCaverns","discoveredCaverns","levelStartTime","levelStopTime","rewardConfig","priorityList","oxygenRate","buildModeSelection","buildingTypes","bt","getClosestBuildingByType","targetBuildings","closest","minDist","bPos","getDropPosition","dist","distanceToSquared","hasBuildingWithUpgrades","upgrades","getTrainingSites","training","TrainDynamite","selectEntities","entities","previouslySelected","stillSelected","deselect","selectionEvents","freshlySelected","selectionEvent","select","len","GROUP","getSelectionType","getMaxRaiders","MAX_RAIDER_BASE","ADDITIONAL_RAIDER_PER_SUPPORT","discoverSurface","minX","minZ","maxX","maxZ","discoverEntities","undiscovered","discovered","pos","dropMaterial","quantity","Crystal","Barrier","quota","importance","scoreCrystals","crystals","Infinity","scoreTimer","gameTimeSeconds","timer","scoreCaverns","caverns","scoreConstructions","constructions","scoreOxygen","oxygen","scoreFigures","figures","SURFACE","BUILDING","getNearbySpiders","currentSurface","nearbySpiders","getSurface","options","shaping","matIndex","drillable","drillableHard","explodable","reinforcable","getByNum","typeNum","SurfaceType","POWER_PATH_BUILDING","SOLID_ROCK","HARD_ROCK","LOOSE_ROCK","DIRT","LAVA","ORE_SEAM","WATER","CRYSTAL_SEAM","RECHARGE_SEAM","SLUG_HOLE","RUBBLE4","RUBBLE3","RUBBLE2","RUBBLE1","GROUND","POWER_PATH","POWER_PATH_SITE","LOCATION_DEATH","WorldLocationEvent","LOCATION_MONSTER","LOCATION_CRYSTAL_FOUND","LOCATION_UNDER_ATTACK","LOCATION_LANDSLIDE","LOCATION_POWER_DRAIN","LOCATION_SLUG_EMERGE","LOCATION_RAIDER_DISCOVERED","surfaceType","heightOffset","containedOres","containedCrystals","selected","reinforced","jobs","surfaceRotation","seamLevel","fallinTimeout","fallinGrp","wallType","needsMeshUpdate","topLeftHeightOffset","topRightHeightOffset","bottomLeftHeightOffset","bottomRightHeightOffset","rubblePositions","hasPower","jobType","DRILL","REINFORCE","BLOW","surfaceJob","hasJobType","discoverNeighbors","foundCave","surf","getSurfaceOrNull","cancelJobs","getRandomPosition","CavernDiscovered","dropContainedOre","crystal","addCollectable","CrystalFoundEvent","isSupported","updateSurfaceMeshes","floorGroup","updateWorldMatrix","dropAmount","OreFoundEvent","JobDeleteEvent","updateJobColor","reduceRubble","shift","updateTexture","SurfaceChanged","surfLeft","surfTopLeft","surfTop","surfTopRight","surfRight","surfBottomRight","surfBottom","surfBottomLeft","isHighGround","surf1","surf2","surf3","updateMesh","force","topLeftVertex","topRightVertex","bottomLeftVertex","bottomRightVertex","WALL","WEIRD_CREVICE","updateGeometry","cancelReinforceJobs","graphWalk","grid","weight","getGraphWalkWeight","otherJobs","textureName","textureSet","texturebasename","updatePowerPathTexture","CORNER","INVERTED_CORNER","texture","accessMaterials","isPath","right","bottom","pathSum","PI","avgHeight","sum","cnt","args","Boolean","h","HEIGHT_MULTIPLER","SurfaceGeometry","create","setHex","SurfaceSelectedEvent","getSelectionCenter","sort","l","colorPriority","hasRubble","isWalkable","isDrillable","isDrillableHard","isReinforcable","isDigable","digPosition","reinforce","getCenterWorld2D","getTerrainHeight","setFallinLevel","fallinLevel","originPos","targetPos","findFallInOrigin","findFallInTarget","scheduleFallin","targetX","targetY","createFallin","fallinPosition","LandslideEvent","content","LWSCLoader","dx","dy","rotateOnAxis","atan2","makeRubble","m","getFloorHeight","worldX","worldZ","sx","sy","dy0","Surface","interpolate","dy1","y0","y1","containedOre","setBuilding","resetGraphWalk","setHasPower","state","recursive","neighbors","WorkerMessageType","topLeftHeight","topRightHeight","bottomRightHeight","bottomLeftHeight","uvOffset","uv","bufferVertices","bufferNormals","addFaceAndNormals","normal","subVectors","cross","normalize","uvIndexes","bufferVertexUvs","bufferGeometry","BufferAttribute","copyVector3sArray","copyVector2sArray","standardColor","BuildPlacementMarkerMesh","updateState","heading","primaryPosition","applyAxisAngle","resetColor","markAsInvalid","buildingMarkerPrimary","buildingMarkerSecondary","powerPathMarkerPrimary","powerPathMarkerSecondary","waterPathMarker","sdx","sdz","lastCheck","visibleSurfaces","primarySurface","barrierLocations","BuildPlacementMarker","buildingMarkerColor","pathMarkerColor","waterMarkerColor","updateAllMarker","hideAllMarker","multiplyScalar","buildMode","sdxv","sdzv","abs","sign","every","maxFps","debugHelper","DebugHelper","renderer","antialias","setClearColor","camera","controls","mouseButtons","LEFT","MIDDLE","RIGHT","buildMarker","selectEntitiesByRay","rx","ry","raycaster","setFromCamera","intersects","intersectObjects","object","selectEntitiesInFrustum","r1x","r1y","r2x","r2y","startPoint","endPoint","Number","EPSILON","updateProjectionMatrix","updateMatrixWorld","tmpPoint","vecNear","vecTopLeft","vecTopRight","vecDownRight","vecDownLeft","setFromMatrixPosition","matrixWorld","unproject","vectemp1","vectemp2","vectemp3","deep","MAX_VALUE","frustum","planes","setFromCoplanarPoints","containsPoint","setupScene","ambientColor","ambientLight","cursorTorchlight","distance","startScene","renderInterval","animRequest","requestAnimationFrame","render","disposeScene","cancelAnimationFrame","meshRegistry","animatedMesh","animationClip","AnimClip","lines","lineIndex","trim","sceneFileVersion","parseInt","line","parseFrameBlock","parseObjectBlock","parseLine","frameStep","subObj","AnimSubObj","lwoBuffer","lenInfos","lenFrames","numOfInformationChannels","numOfKeyframes","frameNum","loadModels","root","getPath","AnimationEntityType","polyname","polykey","act","file","isLws","fontImageData","cols","rows","letters","chars","maxCharWidth","getActualCharacterWidth","rowPixelIndex","colPixelIndex","charHeight","extractData","actualWidth","startX","startY","alpha","createTextImage","text","maxWidth","autoCenter","determineRows","row","rowX","rowY","letterX","letterImgData","charAt","img","putImageData","spaceWidth","rowText","rowWidth","word","wordWidth","letter","letterImg","createTextMessage","msg","MSG","createCfgLoaded","cfg","totalResources","CFG","createAssetLoaded","assetIndex","assetName","assetObj","ASSET","createLoadDone","loadingTimeSeconds","DONE","MOUSE_BUTTON","POINTER_EVENT","KEY_EVENT","setFromCfg","config","cfgObj","cfgKey","lCfgKeyName","objKey","assignValue","cfgValue","currentValue","currentIsArray","parsedValue","parseValue","parsedIsArray","Levels","SelfPowered","PowerBuilding","PickSphere","CostOre","CostCrystal","OxygenCoef","getByType","Toolstation","TeleportPad","Docks","Powerstation","Barracks","Upgrade","Geodome","OreRefinery","GunStation","TeleportBIG","BaseConfig","RouteSpeed","RubbleCoef","PathCoef","Pilot","SoilDrillTime","LooseDrillTime","MedDrillTime","HardDrillTime","SeamDrillTime","UpgradeTime","CollRadius","CollHeight","TrackDist","SingleWidthDig","RepairValue","SurveyRadius","Drillsound","Drillfadesound","RestPercent","EnergyDecayRate","CanClearRubble","NumOfToolsCanCarry","CrossLand","RouteAvoidance","UseLegoManTeleporter","AwarenessRange","CanStrafe","EnterToolStore","ShowHealthBar","RockMonster","AlertRadius","HealthDecayRate","CanScare","CarryMinHealth","PainThreshold","StampRadius","AttackRadius","CanSteal","GrabMinifigure","BumpDamage","AttackPaths","SplitOnZeroHealth","CanBeHitByFence","Capacity","CanBeShotAt","CanFreeze","FreezerTime","FreezerDamage","CanLaser","LaserDamage","CanPush","PusherDist","PusherDamage","WakeRadius","ScaredByBigBangs","RemoveReinforcement","SmallSpider","RandomMove","RandomEnterWall","CauseSlip","DontShowDamage","DontShowOnRadar","MovableEntityStats","Bat","randomMoveTime","Flocks","FlocksDebug","FlocksSmooth","FlocksSize","FlocksTurn","FlocksSpeed","FlocksTightness","FlocksGoalUpdate","FlocksRandomness","FlocksHeight","CrossWater","CrossLava","TinyRM","ScaredByPlayer","TinyIM","Slug","UseHoles","DrainPower","LavaMonster","IceMonster","CanBeDriven","UseSmallTeleporter","UpgradeCostOre","UpgradeCostStuds","EngineSound","SmallHeli","Smallmlp","Tracker","CanDoubleSelect","SmallCat","UseWaterTeleporter","MaxCarry","GetInAtLand","GetOutAtLand","TakeCarryingDrivers","SmallDigger","VehicleCanBeCarried","SmallTruck","CarryStart","Bulldozer","UseBigTeleporter","InvisibleDriver","WalkerDigger","DrillSound","DrillFadeSound","LargeDigger","LargeCat","ClassAsLarge","CarryVehicles","LargeHeli","LargeMLP","CostRefinedOre","SnaxULike","TrainDriver","CrystalDrain","DamageCausesCallToArms","BuildingEntityStats","ProcessCrystal","ProcessOre","SmallTeleporter","ManTeleporter","TrainPilot","BigTeleporter","WaterEntrances","WaterTeleporter","TrainSailor","ToolStore","StoreObjects","FunctionCoef","TrainScanner","UpgradeBuilding","TrainRepair","ProcessedOre","Boulder","Pusher","Freezer","LaserShot","ColRadius","ElectricFence","Path","startLoadingFromCache","startLoading","startLoadingFromUrl","InitLoadingMessage","worker","onmessage","resourceByName","onAssetLoaded","onMessage","configuration","GameStatsCfg","onInitialLoad","CACHE_MISS","onCacheMissed","onLoadDone","postMessage","basename","lBasename","resourceName","lName","getImageData","imageName","lImageName","getImage","getImageOrNull","lSharedTextureName","needsUpdate","getMap","aeFilename","cfgRoot","AnimEntityLoader","getBitmapFont","fontCache","BitmapFont","getDefaultFont","withContext","background","setZIndex","zIndex","compareZ","layerA","layerB","aIndex","bIndex","resize","redraw","onRedraw","isActive","toCanvasCoords","windowX","windowY","clientRect","getBoundingClientRect","handlePointerEvent","eventEnum","handleKeyEvent","handleWheelEvent","fixedWidth","SPRITE_RESOLUTION_WIDTH","fixedHeight","SPRITE_RESOLUTION_HEIGHT","toScaledCoords","cx","cy","scaleX","scaleY","ScreenLayer","cursorName","createCursor","curUrl","revokeObjectURL","curImg","toDataURL","ScaledLayer","screen","gameCanvasContainer","isInRect","preventDefault","MOVE","DOWN","UP","eventType","nonBubblingClone","PointerEvent","bubbles","clientX","clientY","pointerType","button","ctrlKey","metaKey","shiftKey","layers","WheelEvent","deltaX","deltaY","deltaZ","ratio","focus","eventMgr","EventManager","window","onWindowResize","cursorLayer","addLayer","CursorLayer","layer","offsetWidth","maxHeight","offsetHeight","idealHeight","firstLayer","rect","setLoadingMessage","font","fillText","enableGraphicMode","imgBackground","imgProgress","imgLoading","drawImage","loadingBarWidth","increaseLoadingState","BaseScreen","scrollAffected","needsRedraw","hover","pressed","actionName","targetIndex","checkHover","onHoverChange","checkSetPressed","setReleased","draw","labelImgLo","labelImgHi","loFont","label","hiFont","target","MainMenuBaseItem","imgNormal","imgHover","imgPressed","tooltip","menuCfg","items","scrollY","scrollSpeedY","scrollInterval","menuImage","titleImage","fullName","itemsLabel","MainMenuLabelButton","MainMenuIconButton","displayTitle","that","setScrollY","absY","canScroll","scrollAreaHeight","setScrollSpeedY","MAIN","showMainMenu","selectLevel","levelKey","pow","scrollYBefore","levelCfg","imgActive","imgInactive","imgCross","unlocked","frontEndX","frontEndY","menuBMP","frontEndOpen","area","w","imgFirstLine","imgSecondLine","setFirstLine","setSecondLine","modeLevel","levelsCfg","levelTextCfg","LevelTextCfg","MainMenuPanel","panelImgData","panelPos","levelTextWindow","MainMenuWindow","tutorial","levelsByName","levelButton","MainMenuLevelButton","MainMenuLayer","winCfg","panelCfg","onLevelSelected","menus","title","LevelSelectLayer","showLevelSelection","levelName","pathTo","node","curr","unshift","PathMap","PredugMap","astar","search","graph","cleanDirty","heuristic","heuristics","manhattan","openHeap","BinaryHeap","f","closestNode","markDirty","currentNode","pop","closed","il","neighbor","isWall","gScore","getCost","beenVisited","visited","rescoreElement","pos0","pos1","diagonal","D2","sqrt","d1","d2","cleanNode","gridIn","nodes","dirtyNodes","GridNode","init","ret","graphString","rowDebug","fromNeighbor","scoreFunction","sinkDown","bubbleUp","parentN","elemScore","child2N","child1N","swap","child1Score","child1","child2","locations","lengthSq","addLocation","surfaces","roofGroup","cachedPaths","bSurf","worldPosition","getSurfaceFromWorldXZ","getSurfaceFromWorld2D","clear","findPath","startSurface","endSurface","TerrainPath","cacheIdentifier","cachedPath","searchPath","startNode","endNode","worldPath","leftSurface","topSurface","rightSurface","bottomSurface","leftSurface2","topSurface2","rightSurface2","bottomSurface2","loadTerrain","levelConf","tileSize","blockSize","Terrain","themeName","terrainMap","pathMap","surfaceMap","predugMap","cryOreMap","fallinMap","erodeMap","surfaceTypeNum","predugLevel","CAVERN_EXPOSED","SLUG_HOLE_EXPOSED","SLUG_HOLE_HIDDEN","CAVERN_HIDDEN","pathMapLevel","NONE","RUBBLE","currentCryOre","Graph","MoveState","dz","vec","targetReached","currentPath","getSpeed","isOnPath","moveToClosestTarget","equals","paths","findPathToTarget","TARGET_UNREACHABLE","nextLocation","firstLocation","step","determineStep","TARGET_REACHED","getRouteActivity","MOVED","getEntityStep","entitySpeed","stepLengthSq","JOB_ACTION_RANGE","setLength","EntityStep","determinePosY","isOnRubble","workInterval","followUpJob","jobWorkplaces","work","resetWorkInterval","dropItem","getWorldPosition","pickupItem","setJob","MovableEntity","RaiderTool","HAMMER","SHOVEL","SPANNER","FREEZERGUN","LASER","PUSHERGUN","BIRDSCARER","tools","skills","slipped","EntityAddedEvent","RAIDER","RaiderDiscoveredEvent","RaiderSelected","isDriving","spider","slip","onDeath","moveToClosestWorkplace","drillTimeMs","focusPoint","rotateAround","completeJob","CLEAR_RUBBLE","dynamite","moveResult","dropAction","TRAIN","RaiderTrained","GET_TOOL","tool","EAT","COMPLETE_POWER_PATH","hasTool","hasSkill","FulfillerEntity","powerSwitch","spawning","upgradeCostOre","upgradeCostBrick","crystalsInUse","inBeam","turnOnPower","BuildingSelected","worldPos","dropPos2D","hasMaxLevel","upgrade","canUpgrade","BRICK","BuildingUpgraded","spawnMaterials","turnOffPower","MonsterActivity","onLevelEnd","moveTimeout","startMoving","onMove","prevSurface","nextSurface","findTarget","currentCenter","targetZ","Monster","startRandomMove","bat","loadObjectList","objectListConf","values","olObject","lTypeName","xPos","yPos","terrainY","radHeading","update","setTorchPosition","Raider","BuildingEntity","primaryPathSurface","secondaryOffset","secondarySurface","pathOffset","pathSurface","requiredTool","requiredSkill","aiPriorityDestruction","SurfaceJob","debug","onLevelComplete","nerpInterval","registers","fill","timers","scriptLines","statements","macrosByName","labelsByName","halted","programCounter","messages","messagePermit","startExecution","execute","pauseExecution","checkRegister","register","num","isNaN","Error","checkRegisterValue","getR","setR","addR","setTimer","Date","getTime","getTimer","setLevelCompleted","setLevelFail","FAILED","setTutorialFlags","setMessagePermit","messagesAllowed","setBuildingsUpgradeLevel","typeName","setToolStoreLevel","setTeleportPadLevel","setPowerStationLevel","setBarracksLevel","getToolStoresBuilt","getMinifiguresOnLevel","getCrystalsCurrentlyStored","getObjectiveSwitch","setMessageTimerValues","arg1","arg2","arg3","getMessageTimer","cameraUnlock","setMessage","messageNumber","arrowDisabled","txt","setCameraGotoTutorial","getTutorialBlockIsGround","getTutorialBlockIsPath","getUnitAtBlock","getOxygenLevel","getObjectiveShowing","addPoweredCrystals","disallowAll","getPoweredPowerStationsBuilt","getPoweredBarracksBuilt","getRecordObjectAtTutorial","getHiddenObjectsFound","callMethod","methodName","methodArgs","setRegisterMatch","addRegisterMatch","getRegisterMatch","setTimerMatch","getTimerMatch","lMethodName","memberName","apply","conditional","conditionResult","executeStatement","expression","invoke","argValues","comparator","jump","statement","nerpScript","nerpRunner","NerpRunner","includeName","includedRunner","NerpParser","concat","firstLine","macroLines","mLine","append","macroLine","macroCall","replaceMacros","labelMatch","preProcess","labelName","macro","RegExp","number","opSplit","brackets","spaceSplit","jumpMatch","priorities","levelDefault","current","toggle","enabled","upOne","tmp","entry","PriorityEntry","pushToTop","getPriority","priority","j","levelPriorityEntry","spawnRaiderInterval","oxygenUpdateInterval","checkSpawnRaiders","CHECK_SPANW_RAIDER_TIMER","targetBuilding","DynamiteJob","updateOxygen","UPDATE_OXYGEN_TIMER","setup","gameScreen","reward","PriorityList","ambientRgb","maxAmbRgb","normalizedRgb","TerrainLoader","oListFile","ObjectListLoader","nerpFile","nerpMessageFile","now","stop","setSize","getTerrainIntersectionPoint","point","intersect","intersectObject","collectable","world","spawnBuildings","RaiderRequested","station","walkOutPos","MoveJob","applyEuler","diff","reduce","AirLevelChanged","selectStart","setWorldManager","worldManager","startSelection","changeSelection","screenX","screenY","clearRect","strokeStyle","lineWidth","strokeRect","aiPriorityClearing","placedItems","workplaces","placed","neededByType","assignedByType","onSiteByType","needed","checkComplete","neededType","CompletePowerPathJob","rightDown","intersectionPoint","getTerrainPositionFromEvent","neededOre","BuildingSite","closestToolstation","BarrierPathTarget","CancelBuildMode","SECONDARY","createSurfaceJob","DrillJob","ClearRubbleJob","dispatchEvent","DEV_MODE","surfJob","relX","relY","hidden","addChild","child","updatePosition","drawHover","drawTooltip","onClick","isInactive","inRect","stateChanged","checkClick","checkRelease","release","notifyRedraw","xOut","yOut","xIn","yIn","movedIn","setMovedIn","onDone","toggleState","updateAnimation","PANEL_ANIMATION_MULTIPLIER","speed","diffX","diffY","BaseElement","btnCfg","buttonType","imgDisabled","normalFile","highlightFile","pressedFile","disabledFile","textAlign","buttonsCfg","labelOre","SideBarLabel","panelButtonCrystalSideBarOre","totalOre","labelCrystal","panelButtonCrystalSideBarCrystals","imgNoCrystal","imgSmallCrystal","imgUsedCrystal","imgOre","updateQuantities","curX","curY","imgCrystal","Panel","ButtonCfg","panelButtonInfoDockGoto","panelButtonInfoDockClose","panelButtonPriorityListDisable","panelButtonPriorityListUpOne","panelButtonPriorityListClose","panelButtonPriorityListReset","panelButtonTopPanelCallToArms","panelButtonTopPanelOptions","panelButtonTopPanelPriorities","panelRadar","panelCrystalSideBar","panelTopPanel","panelInformation","panelPriorityList","panelCameraControl","panelInfoDock","panelEncyclopedia","btnCfgValue","arr","ButtonRadarCfg","ButtonCrystalSideBarCfg","ButtonTopCfg","ButtonInformationCfg","ButtonPriorityListCfg","ButtonCameraControlCfg","ButtonInfoDockCfg","panelButtonInformationToggle","panelButtonInformationFunction","panelButtonCameraControlZoomIn","panelButtonCameraControlZoomOut","panelButtonCameraControlCycleBuildings","panelButtonCameraControlRotate","BaseButtonCfg","buttonImageFilename","panelFillCfg","panelOverlayCfg","overlay","btnToggle","Button","panelButtonRadarToggle","btnMap","panelButtonRadarMapView","btnTagged","panelButtonRadarTaggedObjectView","panelButtonRadarZoomIn","panelButtonRadarZoomOut","infoMessageEntryConfig","textImage","infoImage","imageFilename","textInfoMessageConfig","imgAir","currentMessage","messageTimeout","crystalFound","TextInfoMessage","textCrystalFound","msgSpaceToContinue","textSpaceToContinue","cavernDiscovered","textCavernDiscovered","oreFound","textOreFound","msgAirSupplyLow","textAirSupplyLow","msgAirSupplyRunningOut","textAirSupplyRunningOut","msgGameCompleted","textGameCompleted","msgManTrained","textManTrained","msgUnitUpgraded","textUnitUpgraded","textInfoMessage","unsetMessage","txtX","infoX","tooltipSfx","tooltipDisabled","tooltipDisabledSfx","hotkey","menuItemCfg","itemKey","parentWidth","menuIndex","isDisabled","autoRedraw","targetState","numOfItems","onBackPanel","backBtn","iconPanelButtons","backBtnCfg","IconPanelBackButtonCfg","frameImgCfg","imgName","imgNameWoBackName","addMenuItem","menuItemGroup","MenuItemCfg","menuItem","IconPanelButton","addBuildMenuItem","IconSubPanel","aiPriorityReinforce","itemDrill","addWallMenuItem","itemReinforce","ReinforceJob","itemDynamite","itemDeselect","createJob","selectedSurface","SpawnDynamiteEvent","SelectBasePanel","pathItem","removeItem","placeFenceItem","toolstation","clearRubbleItem","menuItemOffCfg","menuItemOnCfg","imgOnNormal","imgOnHover","imgOnPressed","imgOnDisabled","onToggleStateChange","powerSwitchItem","IconPanelToggleButton","upgradeItem","deleteBuildingItem","feedItem","selectedRaiders","EatJob","getToolItem","trainItem","deleteRaiderItem","x0","x1","SurfacePathTarget","targetArea","Area","trainDynamite","TrainJob","addGetToolItem","pathToToolstation","GetToolJob","targetPosition","subPanels","mainPanel","addSubPanel","buildingPanel","BuildingPanel","smallVehiclePanel","SmallVehiclePanel","largeVehiclePanel","LargeVehiclePanel","selectWallPanel","SelectWallPanel","selectFloorPanel","SelectFloorPanel","selectRubblePanel","SelectRubblePanel","selectBuildingPanel","SelectBuildingPanel","selectRaiderPanel","SelectRaiderPanel","trainRaiderPanel","TrainRaiderPanel","getToolPanel","GetToolPanel","selectVehiclePanel","SelectVehiclePanel","teleportRaider","MAX_RAIDER_REQUEST","IconPanelButtonLabel","buildingItem","smallVehicleItem","largeVehicleItem","onSelectedSurfaceChange","selectSubPanel","childPanel","targetPanel","subPanel","updated","isPressed","btnCallToArms","ToggleButton","btnOptions","btnPriorities","infoMessagesEntryConfig","InfoButtonCfg","animationSpeedX","animationSpeedY","message","buttonClicked","showButton","slideToTarget","Promise","resolve","infoMessagesConfig","informationPanel","stackButtons","gotoLatestMessage","dropLatestMessage","InfoDockButton","infoGenericDeath","infoGenericMonster","infoCrystalFound","infoUnderAttack","infoLandslide","infoPowerDrain","infoSlugEmerge","infoFoundMinifigure","btn","slideStackIntoPosition","then","slideInButton","prev","cur","pushFirst","setText","promises","all","panelRadarFill","panelRadarOverlay","panelMessages","panelMessagesSide","PanelCfg","prioPositions","prioByName","buttonCfg","setList","resetList","aiPriorityTrain","aiPriorityGetIn","aiPriorityRepair","aiPriorityRecharge","prioButton","sfx","timing","flag","InfoMessagesEntryConfig","sfxName","TextInfoMessageEntryConfig","panels","addPanel","panel","hit","onOptionsShow","panelsCfg","PanelsCfg","ButtonsCfg","InformationPanel","InfoDockPanel","InfoMessagesConfig","priorityButtonsConfig","PriorityButtonsConfig","priorityPositionsConfig","PriorityPositionsEntry","PriorityListPanel","TopPanel","panelMain","MainPanel","PanelCrystalSideBar","MessagePanel","TextInfoMessageConfig","RadarPanel","GuiBaseLayer","assignInterval","checkRubbleInterval","assignJobs","JOB_SCHEDULE_INTERVAL","checkUnclearedRubble","CHECK_CLEARRUBBLE_INTERVAL","availableJobs","unemployedRaider","closestRaider","closestRaiderIndex","minDistance","closestToolRaider","closestToolRaiderIndex","minToolDistance","closestToolstationPosition","closestNeededTool","closestTrainingRaider","closestTrainingRaiderIndex","minTrainingDistance","closestTrainingArea","closestNeededTraining","pathToJob","raiderPosition","neededTool","neededTraining","pathToTraining","rad","imgTitle","titleRelX","titleRelY","btnNext","btnBack","imgBack","imgParagraph","paragraph","titleFont","titleWindow","nextButtonCfg","nextParagraph","backButtonCfg","prevParagraph","setParagraph","objectiveText","objectiveBackImgCfg","textFont","textWindow","messagePanel","itemCfg","labelX","imgTextNormal","description","imgTextHover","imgLabelOffNormal","labelOff","imgLabelOffHover","imgLabelOnNormal","labelOn","imgLabelOnHover","imgLabel","sliderX","onValueChanged","imgLeft","imgOff","imgOn","imgRight","leftBtn","btnLeftNormal","btnLeftHover","rightBtn","btnRightNormal","btnRightHover","posX","dw","loImg","hiImg","itemsTrigger","itemsNext","menuFont","MenuLabelItem","itemsCycle","MenuCycleItem","itemsSlider","MenuSliderItem","layersByKey","MenuLayer","pausePanel","selectLayer","onRepeatBriefing","MenuBasePanel","onAbortGame","onRestartGame","image","okWindow","cancelWindow","contrastOverlay","Rect","dialogCfg","DialogCfg","panelPause","PausePanel","panelOptions","OptionsPanel","panelBriefing","BriefingPanel","BriefingPanelCfg","setActivePanel","lEventKey","gameLayer","GameLayer","selectionLayer","SelectionLayer","guiLayer","GuiMainLayer","overlayLayer","OverlayLayer","WorldManager","jobSupervisor","Supervisor","restartLevel","startLevel","setupAndStartLevel","objective","objectiveImage640x480","conf","imgNormalFilepath","imgHoverFilepath","imgPressedFilepath","imgDisabledFilepath","resultIndex","resultLastIndex","images","boxes","fonts","texts","uncoverTimeout","backgroundImg","wallpaper","filePath","boxImages","fontKey","labelFont","backFont","resultsLayer","btnSave","btnAdvance","descriptionTextLayer","btnLayer","RewardScreenButton","saveButton","advanceButton","onAdvance","uncoverResult","levelFullNameImg","resultText","quitText","completeText","failedText","resultValues","percentString","timeString","score","gameResultTextImg","box","vertSpacing","descriptionTextImg","textPos","tx","ty","actual","lessIsMore","padLeft","padding","seconds","ss","minutes","mm","loadingScreen","LoadingScreen","wadfileSelectModal","mainMenuScreen","MainMenuScreen","GameScreen","rewardScreen","RewardScreen","params","URLSearchParams"],"mappings":"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","file":"686.index.js","sourcesContent":["import { Modal } from 'bootstrap'\n\nexport class WadFileSelectionModal {\n\n    public onStart: (wad0Url, wad1Url) => any = null\n\n    private readonly modal: Modal\n\n    constructor(parentId: string) {\n        const rootElement = document.getElementById(parentId).appendChild(document.createElement('div'))\n        rootElement.classList.add('modal')\n        rootElement.tabIndex = -1\n        rootElement.setAttribute('role', 'dialog')\n        rootElement.setAttribute('aria-hidden', 'true')\n\n        const modalDialog = rootElement.appendChild(document.createElement('div'))\n        modalDialog.classList.add('modal-dialog')\n        rootElement.setAttribute('role', 'document')\n\n        const modalContent = modalDialog.appendChild(document.createElement('div'))\n        modalContent.classList.add('modal-content')\n\n        const modalHeader = modalContent.appendChild(document.createElement('div'))\n        modalHeader.classList.add('modal-header')\n        const modalTitle = modalHeader.appendChild(document.createElement('h5'))\n        modalTitle.classList.add('modal-title')\n        modalTitle.innerText = 'Load .wad files'\n        modalTitle.id = 'wadfileSelectModalLabel'\n        rootElement.setAttribute('aria-labelledby', modalTitle.id)\n\n        const modalBody = modalContent.appendChild(document.createElement('div'))\n        modalBody.classList.add('modal-body')\n\n        const hint = modalBody.appendChild(document.createElement('p'))\n        hint.innerText = 'Assets not included! In order to play the game, please select the game files.'\n\n        const navTabs = modalBody.appendChild(document.createElement('nav'))\n        const navTabList = navTabs.appendChild(document.createElement('div'))\n        navTabList.id = 'nav-tab'\n        navTabList.classList.add('nav', 'nav-tabs')\n        navTabList.setAttribute('role', 'tablist')\n\n        const navFileBtn = WadFileSelectionModal.appendNavButton(navTabList, true, 'nav-file-tab', 'nav-file', 'Local files (recommended)')\n        const navUrlBtn = WadFileSelectionModal.appendNavButton(navTabList, false, 'nav-url-tab', 'nav-url', 'Online from URL')\n\n        const navTabContent = modalBody.appendChild(document.createElement('div'))\n        navTabContent.classList.add('tab-content')\n        this.appendNavFileTab(navTabContent, navFileBtn.id)\n        this.appendNavUrlTab(navTabContent, navUrlBtn.id)\n\n        // rootElement has to be a valid bootstrap HTML modal before we can instantiate it\n        this.modal = new Modal(rootElement, {backdrop: 'static', keyboard: false})\n    }\n\n    private static appendNavButton(parent: HTMLDivElement, active: boolean, id: string, controlTarget: string, innerText: string) {\n        const navBtn = parent.appendChild(document.createElement('button'))\n        navBtn.classList.add('nav-link')\n        if (active) navBtn.classList.add('active')\n        navBtn.id = id\n        navBtn.setAttribute('data-bs-toggle', 'tab')\n        navBtn.setAttribute('data-bs-target', '#' + controlTarget)\n        navBtn.type = 'button'\n        navBtn.setAttribute('role', 'tab')\n        navBtn.setAttribute('aria-controls', controlTarget)\n        navBtn.setAttribute('aria-selected', String(active))\n        navBtn.innerText = innerText\n        return navBtn\n    }\n\n    private appendNavFileTab(parent: HTMLDivElement, labelledBy: string) {\n        const navFileTab = WadFileSelectionModal.appendNavTab(parent, true, 'nav-file', labelledBy)\n\n        const wad0File = WadFileSelectionModal.appendWadFileGroup(navFileTab, 'wad0-file', 'LegoRR0.wad')\n        const wad1File = WadFileSelectionModal.appendWadFileGroup(navFileTab, 'wad1-file', 'LegoRR1.wad')\n\n        const btnStartFile = navFileTab.appendChild(document.createElement('button'))\n        btnStartFile.type = 'submit'\n        btnStartFile.classList.add('btn', 'btn-primary', 'float-end')\n        btnStartFile.id = 'button-start-file'\n        btnStartFile.innerText = 'Start Game'\n        btnStartFile.addEventListener('click', () => {\n            btnStartFile.disabled = true\n            const wad0FileUrl = URL.createObjectURL(wad0File.files[0])\n            const wad1FileUrl = URL.createObjectURL(wad1File.files[0])\n            this.onStart(wad0FileUrl, wad1FileUrl)\n        })\n    }\n\n    private static appendWadFileGroup(parent: HTMLDivElement, id: string, filename: string) {\n        const wadFileGroup = parent.appendChild(document.createElement('div'))\n        wadFileGroup.classList.add('my-3')\n        const wadFileLabel = wadFileGroup.appendChild(document.createElement('label'))\n        wadFileLabel.setAttribute('for', id)\n        wadFileLabel.classList.add('form-label')\n        wadFileLabel.innerHTML = 'Select <span class=\"fw-bold\">' + filename + '</span> here:'\n        const wadFileInput = wadFileGroup.appendChild(document.createElement('input'))\n        wadFileInput.type = 'file'\n        wadFileInput.classList.add('form-control')\n        wadFileInput.id = id\n        wadFileInput.required = true\n        return wadFileInput\n    }\n\n    private appendNavUrlTab(parent: HTMLDivElement, labelledBy: string) {\n        const navUrlTab = WadFileSelectionModal.appendNavTab(parent, false, 'nav-url', labelledBy)\n\n        const urlHint = navUrlTab.appendChild(document.createElement('div'))\n        urlHint.classList.add('my-3')\n        urlHint.innerText = 'Direct links with correct Allow-Origin-CORS-Headers required here.'\n\n        const wad0Url = WadFileSelectionModal.appendWadUrlGroup(navUrlTab, 'wad0-url', 'LegoRR0.wad', 'https://drive.google.com/uc?export=download&id=11t9AJnGCWnEWlLxSsYQeB_Y4jrKfxVxQ')\n        const wad1Url = WadFileSelectionModal.appendWadUrlGroup(navUrlTab, 'wad1-url', 'LegoRR1.wad', 'https://drive.google.com/uc?export=download&id=11t9AJnGCWnEWlLxSsYQeB_Y4jrKfxVxQ')\n\n        const btnStartUrl = navUrlTab.appendChild(document.createElement('button'))\n        btnStartUrl.type = 'submit'\n        btnStartUrl.classList.add('btn', 'btn-primary', 'float-end')\n        btnStartUrl.id = 'button-start-url'\n        btnStartUrl.innerText = 'Start Game'\n        btnStartUrl.addEventListener('click', () => {\n            btnStartUrl.disabled = true\n            // XXX show loading progress for WAD files\n            this.onStart(wad0Url.value, wad1Url.value)\n        })\n    }\n\n    private static appendNavTab(parent: HTMLDivElement, active: boolean, id: string, labelledBy: string) {\n        const navTab = parent.appendChild(document.createElement('div'))\n        navTab.classList.add('tab-pane', 'fade')\n        if (active) navTab.classList.add('show', 'active')\n        navTab.id = id\n        navTab.setAttribute('role', 'tabpanel')\n        navTab.setAttribute('aria-labelledby', labelledBy)\n        return navTab\n    }\n\n    private static appendWadUrlGroup(parent: HTMLDivElement, id: string, filename: string, example: string) {\n        const wadUrlGroup = parent.appendChild(document.createElement('div'))\n        wadUrlGroup.classList.add('my-3')\n        const wadUrlLabel = wadUrlGroup.appendChild(document.createElement('label'))\n        wadUrlLabel.setAttribute('for', id)\n        wadUrlLabel.classList.add('form-label')\n        wadUrlLabel.innerHTML = 'Enter url for <span class=\"fw-bold\">' + filename + '</span> here:'\n        const wadUrlInput = wadUrlGroup.appendChild(document.createElement('input'))\n        wadUrlInput.type = 'url'\n        wadUrlInput.classList.add('form-control')\n        wadUrlInput.id = id\n        wadUrlInput.required = true\n        wadUrlInput.value = example\n        return wadUrlInput\n    }\n\n    public show() {\n        this.modal.show()\n    }\n\n    public hide() {\n        this.modal.hide()\n    }\n\n}\n","export default function Worker_fn() {\n  return new Worker(__webpack_public_path__ + \"index.worker.js\");\n}\n","export class InitLoadingMessage {\n\n    wad0FileUrl: string\n    wad1FileUrl: string\n\n    constructor(wad0FileUrl: string, wad1FileUrl: string) {\n        this.wad0FileUrl = wad0FileUrl\n        this.wad1FileUrl = wad1FileUrl\n    }\n\n}\n","/**\n * creates a new context with the specified dimensions.\n * @param width: the desired width of the new context\n * @param height: the desired height of the new context\n * @returns RenderingContext the newly created canvas\n */\nexport function createContext(width, height) {\n    if (width < 1 || height < 1) {\n        console.error('Can\\'t create context with size ' + width + ' x ' + height);\n        return createDummyContext(64, 64);\n    }\n    const canvas = document.createElement('canvas');\n    canvas.setAttribute('width', width);\n    canvas.setAttribute('height', height);\n    const context = canvas.getContext('2d');\n    context.width = width;\n    context.height = height;\n    return context;\n}\n\n/**\n * This method is intended to increase stability by providing an (ugly) placeholder image in case the right one is missing\n * @param width: expected width of the original image\n * @param height: expected height of the original image\n */\nexport function createDummyContext(width, height) {\n    const result = createContext(width, height);\n    for (let y = 0; y < height; y += 16) {\n        for (let x = 0; x < width; x += 16) {\n            if (x / 16 % 2 === y / 16 % 2) {\n                result.fillStyle = 'rgb(0,255,255)';\n            } else {\n                result.fillStyle = 'rgb(255,0,255)';\n            }\n            result.fillRect(x, y, 16, 16);\n        }\n    }\n    return result;\n}\n\nexport function createDummyImgData(width, height) {\n    const result = new ImageData(width, height);\n    for (let y = 0; y < height; y += 16) {\n        for (let x = 0; x < width; x += 16) {\n            const e = x / 16 % 2 === y / 16 % 2;\n            for (let px = x; px < x + 16; px++) {\n                for (let py = y; py < y + 16; py++) {\n                    setPixel(result, px, py, e ? 0 : 255, e ? 255 : 0, 255);\n                }\n            }\n        }\n    }\n    return result;\n}\n\nexport function setPixel(imgData, x, y, r, g, b, a = 255) {\n    const n = (y * imgData.width + x) * 4;\n    imgData.data[n] = r;\n    imgData.data[n + 1] = g;\n    imgData.data[n + 2] = b;\n    imgData.data[n + 3] = a;\n}\n\nexport function getPixel(imgData, x, y) {\n    const n = (y * imgData.width + x) * 4;\n    return {r: imgData.data[n], g: imgData.data[n + 1], b: imgData.data[n + 2], a: imgData.data[n + 3]};\n}\n\nexport function copyPixel(originData, targetData, x, y) {\n    const p = getPixel(originData);\n    setPixel(targetData, p.r, p.g, p.b, p.a);\n}\n","export function getPath(url: string): string {\n    if (!url) return url\n    let strUrl = url.toString().replace(/\\\\/g, '/')\n    if (strUrl.startsWith('/')) strUrl = strUrl.substring(1)\n    const lastInd = strUrl.lastIndexOf('/')\n    strUrl = strUrl.substring(0, lastInd + 1)\n    if (strUrl.startsWith('/')) strUrl = strUrl.substring(1)\n    return strUrl\n}\n\nexport function getFilename(url: string): string {\n    if (!url) return url\n    let strUrl = url.toString().replace(/\\\\/g, '/')\n    if (strUrl.startsWith('/')) strUrl = strUrl.substring(1)\n    const lastInd = strUrl.lastIndexOf('/')\n    return strUrl.substring(lastInd + 1)\n}\n\nexport function iGet(obj, ...keys: string[]): any {\n    keys.forEach((keyname) => {\n        obj = Object.keys(obj)\n            .filter((key) => key.toLowerCase() === keyname.toLowerCase())\n            .map((key) => obj[key])\n        obj = obj ? obj[0] : obj\n    })\n    return obj\n}\n","export function getFilename(url: string) {\n    if (!url) return url\n    let strUrl = url.toString().replace(/\\\\/g, '/')\n    if (strUrl.startsWith('/')) strUrl = strUrl.substring(1)\n    const lastInd = strUrl.lastIndexOf('/')\n    return strUrl.substring(lastInd + 1)\n}\n\nexport function iGet(obj, ...keys: string[]): any {\n    keys.forEach((keyname) => {\n        obj = Object.keys(obj)\n            .filter((key) => key.toLowerCase() === keyname.toLowerCase())\n            .map((key) => obj[key])\n        obj = obj ? obj[0] : obj\n    })\n    return obj\n}\n\nexport function decodeString(data) {\n    return new TextDecoder().decode(data).replace(/\\0/g, '')\n}\n\nexport function decodeFilepath(data) {\n    return decodeString(data).replace(/\\\\/g, '/')\n}\n\nexport function getRandomInclusive(min, max) {\n    min = Math.ceil(min)\n    max = Math.floor(max)\n    return Math.floor(Math.random() * (max - min + 1)) + min\n}\n\nexport function getRandom(max) {\n    return getRandomInclusive(0, max)\n}\n\nexport function getRandomSign() {\n    return -1 + getRandomInclusive(0, 1) * 2\n}\n\nexport function clearTimeoutSafe(timeout: NodeJS.Timeout) {\n    if (timeout) clearTimeout(timeout)\n    return null\n}\n\nexport function clearIntervalSafe(interval: NodeJS.Timeout) {\n    if (interval) clearInterval(interval)\n    return null\n}\n\ndeclare global {\n\n    interface Array<T> {\n        remove(element: T): T\n    }\n\n    interface Map<K, V> {\n        getOrUpdate(key: K, updateCallback: () => V): V\n    }\n\n}\n\nArray.prototype.remove = function <T>(element: T): void {\n    const index = this.indexOf(element)\n    if (index !== -1) this.splice(index, 1)\n}\n\n// noinspection JSUnusedGlobalSymbols\nMap.prototype.getOrUpdate = function <K, V>(key: K, updateCallback: () => V): V {\n    let value = this.get(key)\n    if (value === undefined) {\n        value = updateCallback()\n        this.set(key, value)\n    }\n    return value\n}\n","import { AnimClip } from './AnimClip'\n\nexport class AnimationEntityType {\n\n    carryNullName: string = ''\n    depositNullName: string = ''\n    toolNullName: string = ''\n    mediumPoly: {} = {}\n    highPoly: {} = {}\n    fPPoly: {} = {}\n    activities: Map<string, { file: string, transcoef: number, lwsfile: boolean, animation: AnimClip }> = new Map()\n\n}\n","import { Mesh } from 'three'\nimport { clearIntervalSafe } from '../core/Util'\n\nexport class AnimatedMesh {\n\n    mesh: Mesh = null\n    textureSequences = []\n\n    constructor(mesh: Mesh, textureSequences: any[]) {\n        this.mesh = mesh\n        this.textureSequences = textureSequences\n    }\n\n    dispose() {\n        this.textureSequences.forEach((s) => clearIntervalSafe(s))\n        this.mesh.geometry.dispose()\n        Array.isArray(this.mesh.material) ? this.mesh.material.forEach(mat => mat.dispose()) : this.mesh.material?.dispose()\n    }\n\n}\n","// noinspection JSUnusedLocalSymbols\n\n/**\n * @author Marcus-Bizal https://github.com/marcbizal\n * patched by Scarabol\n *\n * This loader loads LWOB files exported from LW6.\n *\n * Support\n *  -\n */\n\nimport { AdditiveBlending, BufferAttribute, BufferGeometry, Color, DoubleSide, Mesh, MeshPhongMaterial, Vector3 } from 'three'\nimport { decodeFilepath, decodeString, getFilename } from '../core/Util'\nimport { ResourceManager } from './ResourceManager'\nimport { SEQUENCE_TEXTURE_FRAMERATE } from '../main'\nimport { AnimatedMesh } from './AnimatedMesh'\n\n// HEADER SPEC //\nconst LWO_MAGIC = 0x4C574F42 // \"LWOB\"\nconst OFF_MAGIC = 8\n\n/********************/\n/* TYPE SIZES START */\n/********************/\n\nconst ID4_SIZE = 4\nconst I1_SIZE = 1\nconst I2_SIZE = 2\nconst I4_SIZE = 4\nconst F4_SIZE = 4\n\nconst COL4_SIZE = 4\nconst VEC12_SIZE = 12\nconst IP2_SIZE = 2\nconst FP4_SIZE = 4\nconst DEG4_SIZE = 4\n\n/********************/\n/*  TYPE SIZES END  */\n/********************/\n\n/*********************/\n/* CHUNK TYPES START */\n/*********************/\n\nconst LWO_FORM = 0x464F524D\nconst LWO_PNTS = 0x504E5453\nconst LWO_SFRS = 0x53524653\nconst LWO_POLS = 0x504F4C53\nconst LWO_CRVS = 0x43525653\nconst LWO_PCHS = 0x50434853\nconst LWO_SURF = 0x53555246\n\nconst CHUNK_HEADER_SIZE = 8\nconst SUBCHUNK_HEADER_SIZE = 6\n\n/*********************/\n/*  CHUNK TYPES END  */\n/*********************/\n\n/**************************/\n/* SURF DEFINITIONS START */\n/**************************/\n\n/**************************/\n/* SURF DEFINITIONS START */\n/**************************/\n\nconst SURF_COLR = 0x434F4C52\nconst SURF_FLAG = 0x464C4147\n\n// Base Shading Values (Fixed Point)\nconst SURF_LUMI = 0x4C554D49\nconst SURF_DIFF = 0x44494646\nconst SURF_SPEC = 0x53504543\nconst SURF_REFL = 0x5245464C\nconst SURF_TRAN = 0x5452414E\n\n// Base Shading Values (Floating Point)\nconst SURF_VLUM = 0x564C554D\nconst SURF_VDIF = 0x56444946\nconst SURF_VSPC = 0x56535043\nconst SURF_VRFL = 0x5646524C\nconst SURF_VTRN = 0x5654524E\n\nconst SURF_GLOS = 0x474C4F53\nconst SURF_RFLT = 0x52464C54\nconst SURF_RIMG = 0x52494D47\nconst SURF_RIND = 0x52494E44\nconst SURF_EDGE = 0x45444745\nconst SURF_SMAN = 0x534D414E\n\n/**************************/\n/*  SURF DEFINITIONS END  */\n/**************************/\n\n/*****************************/\n/* TEXTURE DEFINITIONS START */\n/*****************************/\n\n// Start of Definition\nconst SURF_CTEX = 0x43544558\nconst SURF_DTEX = 0x44544558\nconst SURF_STEX = 0x53544558\nconst SURF_RTEX = 0x52544558\nconst SURF_TTEX = 0x54544558\nconst SURF_LTEX = 0x4C544558\nconst SURF_BTEX = 0x42544558\n\n// Flags\nconst SURF_TFLG = 0x54464C47\n\n// Location and Size\nconst SURF_TSIZ = 0x5453495A\nconst SURF_TCTR = 0x54435452\nconst SURF_TFAL = 0x5446414C\nconst SURF_TVEL = 0x5456454C\n\n// Color\nconst SURF_TCLR = 0x54434C52\n\n// Value\nconst SURF_TVAL = 0x54434C52\n\n// Bump Amplitude\nconst SURF_TAMP = 0x54414D50\n\n// Image Map\nconst SURF_TIMG = 0x54494D47\n\n// Image Alpha\nconst SURF_TALP = 0x54414C50\n\n// Image Wrap Options\nconst SURF_TWRP = 0x54575250\n\n// Antialiasing Strength\nconst SURF_TAAS = 0x54414153\n\n// Texture Opacity\nconst SURF_TOPC = 0x544F5043\n\n/*****************************/\n/*  TEXTURE DEFINITIONS END  */\n/*****************************/\n\n/*************************/\n/* FLAG DEFINITION START */\n/*************************/\n\nconst LUMINOUS_BIT = 1\nconst OUTLINE_BIT = 2\nconst SMOOTHING_BIT = 4\nconst COLORHIGHLIGHTS_BIT = 8\nconst COLORFILTER_BIT = 16\nconst OPAQUEEDGE_BIT = 32\nconst TRANSPARENTEDGE_BIT = 64\nconst SHARPTERMINATOR_BIT = 128\nconst DOUBLESIDED_BIT = 256\nconst ADDITIVE_BIT = 512\nconst SHADOWALPHA_BIT = 1024\n\n/*************************/\n/*  FLAG DEFINITION END  */\n/*************************/\n\n/*************************/\n/* TFLG DEFINITION START */\n/*************************/\n\nconst XAXIS_BIT = 1\nconst YAXIS_BIT = 2\nconst ZAXIS_BIT = 4\nconst WORLDCOORDS_BIT = 8\nconst NEGATIVEIMAGE_BIT = 16\nconst PIXELBLENDING_BIT = 32\nconst ANTIALIASING_BIT = 64\n\n/*************************/\n/*  TFLG DEFINITION END  */\n\n/*************************/\n\nfunction getVector3AtOffset(view, offset) {\n    let vector = new Vector3()\n    vector.x = view.getFloat32(offset)\n    vector.y = view.getFloat32(offset + F4_SIZE)\n    vector.z = view.getFloat32(offset + (F4_SIZE * 2))\n    return vector\n}\n\nfunction planarMapUVS(geometry, vertices, uvs, indices, materialIndex, size, center, flags) {\n    // Check to ensure that one of the flags is set, if not throw an error.\n    const mask = XAXIS_BIT | YAXIS_BIT | ZAXIS_BIT\n    if (flags & mask) {\n        for (let group of geometry.groups) {\n            if (group.materialIndex !== materialIndex) continue\n\n            for (let i = group.start; i < group.start + group.count; i++) {\n\n                let vertexIndex = indices[i] * 3\n                let x = vertices[vertexIndex] - center.x\n                let y = vertices[vertexIndex + 1] - center.y\n                let z = vertices[vertexIndex + 2] - center.z\n\n                let uvIndex = indices[i] * 2\n                let u = 0\n                let v = 0\n\n                if (flags & XAXIS_BIT) {\n                    u = z / size.z + 0.5\n                    v = y / size.y + 0.5\n                } else if (flags & YAXIS_BIT) {\n                    u = x / size.x + 0.5\n                    v = z / size.z + 0.5\n                } else if (flags & ZAXIS_BIT) {\n                    u = x / size.x + 0.5\n                    v = y / size.y + 0.5\n                }\n\n                uvs[uvIndex] = u\n                uvs[uvIndex + 1] = v\n            }\n        }\n    } else {\n        // console.warn(\"LWOLoader.planarMapUVS: No axis bit is set!\"); // XXX what is this about\n    }\n}\n\nexport class LWOLoader {\n\n    COUNTER_CLOCKWISE: false\n\n    path: string = ''\n    verbose: boolean = false\n    materials: MeshPhongMaterial[] = []\n    geometry: BufferGeometry = new BufferGeometry()\n    vertices: Float32Array = null\n    indices: Uint16Array = null\n    uvs: Float32Array = null\n    sequenceIntervals = []\n\n    constructor(path: string, verbose: boolean = false) {\n        this.path = path\n        this.verbose = verbose\n        if (this.verbose) console.log('LWO path: ' + this.path)\n    }\n\n    parsePoints(view, chunkOffset, chunkSize) {\n        if (chunkSize % VEC12_SIZE !== 0) {\n            console.error('LWOLoader.parse: F12 does not evenly divide into chunk size (' + chunkSize + '). Possible corruption.')\n            return\n        }\n\n        let numVertices = (chunkSize / F4_SIZE) / 3\n        this.vertices = new Float32Array(numVertices * 3)\n        this.uvs = new Float32Array(numVertices * 2)\n\n        for (let i = 0; i < numVertices; i++) {\n            let vertexIndex = i * 3\n            let vertexOffset = vertexIndex * F4_SIZE\n            this.vertices[vertexIndex] = view.getFloat32(chunkOffset + vertexOffset) \t\t\t\t// x\n            this.vertices[vertexIndex + 1] = view.getFloat32(chunkOffset + vertexOffset + F4_SIZE) \t// y\n            this.vertices[vertexIndex + 2] = view.getFloat32(chunkOffset + vertexOffset + (F4_SIZE * 2)) \t// z\n        }\n    }\n\n    parseSurfaceNames(buffer, chunkOffset, chunkSize) {\n        let textChunk = new TextDecoder().decode(new Uint8Array(buffer, chunkOffset, chunkSize))\n        let surfaceNames = textChunk.split('\\0').filter(function (s) {\n            return s !== ''\n        })\n\n        for (let i = 0; i < surfaceNames.length; i++) {\n            const new_material = new MeshPhongMaterial()\n            new_material.name = surfaceNames[i]\n            new_material.side = DoubleSide\n\n            this.materials.push(new_material)\n        }\n        if (this.verbose) console.log('LWO contains ' + this.materials.length + ' materials with following names: ' + surfaceNames)\n    }\n\n    parsePolygons(view, chunkOffset, chunkSize) {\n        // Gather some initial data so that we can get the proper size\n        let totalNumIndices = 0\n        let offset = 0\n        while (offset < chunkSize) {\n            const numIndices = view.getInt16(chunkOffset + offset)\n            const materialIndex = view.getInt16(chunkOffset + offset + 2 + (numIndices * 2))\n\n            this.geometry.addGroup(totalNumIndices, (numIndices - 2) * 3, materialIndex - 1)\n\n            totalNumIndices += (numIndices - 2) * 3\n            offset += 4 + (numIndices * 2)\n        }\n\n        offset = 0\n        let currentIndex = 0\n        this.indices = new Uint16Array(totalNumIndices)\n        while (offset < chunkSize) {\n            let numIndices = view.getInt16(chunkOffset + offset)\n\n            offset += 2\n\n            let faceIndices = new Int16Array(numIndices)\n            for (let i = 0; i <= numIndices; i++) {\n                faceIndices[i] = view.getInt16(chunkOffset + offset + (i * 2))\n            }\n\n            for (let i = 0; i < numIndices - 2; i++) {\n                if (this.COUNTER_CLOCKWISE) {\n                    this.indices[currentIndex++] = faceIndices[0]\n                    this.indices[currentIndex++] = faceIndices[i + 2]\n                    this.indices[currentIndex++] = faceIndices[i + 1]\n                } else {\n                    this.indices[currentIndex++] = faceIndices[0]\n                    this.indices[currentIndex++] = faceIndices[i + 1]\n                    this.indices[currentIndex++] = faceIndices[i + 2]\n                }\n            }\n\n            offset += 2 + (numIndices * 2)\n        }\n    }\n\n    parseSurface(view, buffer, chunkOffset, chunkSize) {\n        let offset = 0\n        while (view.getUint8(chunkOffset + offset) !== 0) offset++\n\n        let materialName = decodeString(new Uint8Array(buffer, chunkOffset, offset))\n        if (this.verbose) console.log('Parsing surface: ' + materialName)\n        let materialIndex = -1\n        let material: MeshPhongMaterial = null\n\n        let textureFlags = 0\n        let textureSize = new Vector3(0, 0, 0)\n        let textureCenter = new Vector3(0, 0, 0)\n        // let textureFalloff = new Vector3(0, 0, 0);\n        // let textureVelocity = new Vector3(0, 0, 0);\n\n        for (let i = 0; i < this.materials.length; i++) {\n            if (this.materials[i].name === materialName) {\n                materialIndex = i\n                material = this.materials[i]\n            }\n        }\n\n        if (!material) {\n            console.error('LWOLoader.parse: Surface in SURF chunk does not exist in SRFS')\n            return\n        }\n\n        material.shininess = 0\n\n        while (offset < chunkSize) {\n            const subchunkOffset = chunkOffset + offset\n            if (view.getUint8(subchunkOffset) === 0) {\n                offset++\n            } else {\n                const subchunkType = view.getInt32(subchunkOffset)\n                const subchunkSize = view.getInt16(subchunkOffset + ID4_SIZE)\n\n                if (this.verbose) console.log('Parsing subchunk ' + new TextDecoder().decode(new Uint8Array(buffer, subchunkOffset, ID4_SIZE)) + ' at ' + subchunkOffset + '; length ' + subchunkSize)\n\n                switch (subchunkType) {\n                    case SURF_COLR:\n                        const colorArray = [\n                            view.getUint8(subchunkOffset + SUBCHUNK_HEADER_SIZE + 0) / 255,\n                            view.getUint8(subchunkOffset + SUBCHUNK_HEADER_SIZE + 1) / 255,\n                            view.getUint8(subchunkOffset + SUBCHUNK_HEADER_SIZE + 2) / 255,\n                        ]\n                        material.color = new Color().fromArray(colorArray)\n                        if (this.verbose) console.log('Material color (COLR): ' + colorArray.join(' '))\n                        break\n                    case SURF_FLAG:\n                        const flags = view.getUint16(subchunkOffset + SUBCHUNK_HEADER_SIZE)\n                        if (this.verbose) console.log('Flags (FLAG): ' + flags.toString(2))\n                        // if (this.verbose && flags & LUMINOUS_BIT) console.warn('Flag is set but unhandled: luminous') // flag replaced with LUMI below\n                        if (this.verbose && flags & OUTLINE_BIT) console.warn('Flag is set but unhandled: outline')\n                        if (this.verbose && flags & SMOOTHING_BIT) console.warn('Flag is set but unhandled: smoothing')\n                        if (this.verbose && flags & COLORHIGHLIGHTS_BIT) console.warn('Flag is set but unhandled: colorHighlights')\n                        if (this.verbose && flags & COLORFILTER_BIT) console.warn('Flag is set but unhandled: colorFilter')\n                        if (this.verbose && flags & OPAQUEEDGE_BIT) console.warn('Flag is set but unhandled: opaqueEdge')\n                        if (this.verbose && flags & TRANSPARENTEDGE_BIT) console.warn('Flag is set but unhandled: transparentEdge')\n                        if (this.verbose && flags & SHARPTERMINATOR_BIT) console.warn('Flag is set but unhandled: sharpTerminator')\n                        if (flags & DOUBLESIDED_BIT) material.side = DoubleSide\n                        if (flags & ADDITIVE_BIT) {\n                            material.blending = AdditiveBlending\n                            material.depthWrite = false // otherwise transparent parts \"carve out\" objects behind\n                        }\n                        if (this.verbose && flags & SHADOWALPHA_BIT) console.warn('Flag is set but unhandled: shadowAlpha')\n                        break\n                    case SURF_EDGE:\n                        const edgeTransparencyThreshold = view.getFloat32(subchunkOffset + SUBCHUNK_HEADER_SIZE)\n                        if (this.verbose) console.warn('Edge transparency threshold (0.0 to 1.0): ' + edgeTransparencyThreshold)\n                        break\n                    case SURF_LUMI:\n                        const luminosity = view.getInt16(subchunkOffset + SUBCHUNK_HEADER_SIZE) / 256\n                        if (this.verbose) console.log('Luminosity (LUMI): ' + luminosity)\n                        material.emissiveIntensity = luminosity\n                        break\n                    case SURF_DIFF:\n                        const diffuse = view.getInt16(subchunkOffset + SUBCHUNK_HEADER_SIZE) / 256\n                        if (this.verbose) console.log('Diffuse (DIFF): ' + diffuse)\n                        if (!diffuse) material.color = null\n                        break\n                    case SURF_SPEC:\n                        const specular = view.getInt16(subchunkOffset + SUBCHUNK_HEADER_SIZE) / 256\n                        // material.specular = material.color.multiplyScalar(specular);\n                        if (this.verbose) console.warn('Specular (SPEC): ' + specular)\n                        break\n                    case SURF_REFL:\n                        let reflection = 0\n                        if (reflection === SURF_VRFL) {\n                            reflection = view.getFloat32(subchunkOffset + SUBCHUNK_HEADER_SIZE)\n                        } else {\n                            reflection = view.getInt16(subchunkOffset + SUBCHUNK_HEADER_SIZE) / 256\n                        }\n                        material.reflectivity = reflection\n                        if (this.verbose) console.log('Reflectivity (REFL): ' + material.reflectivity)\n                        break\n                    case SURF_TRAN:\n                    case SURF_VTRN:\n                        let transparency = 0\n                        if (subchunkType === SURF_VTRN) {\n                            transparency = view.getFloat32(subchunkOffset + SUBCHUNK_HEADER_SIZE)\n                        } else {\n                            transparency = view.getInt16(subchunkOffset + SUBCHUNK_HEADER_SIZE) / 256\n                        }\n                        material.opacity = 1 - transparency\n                        if (this.verbose) console.log('Opacity (TRAN/VTRN): ' + material.opacity)\n                        material.transparent = material.opacity < 1\n                        break\n                    case SURF_VLUM:\n                        const vLuminosity = view.getFloat32(subchunkOffset + SUBCHUNK_HEADER_SIZE)\n                        if (this.verbose) console.log('Luminosity (VLUM): ' + vLuminosity)\n                        material.emissiveIntensity = vLuminosity\n                        break\n                    case SURF_VDIF:\n                        let vDiffuse = view.getFloat32(subchunkOffset + SUBCHUNK_HEADER_SIZE)\n                        if (this.verbose) console.log('Diffuse (VDIF): ' + vDiffuse)\n                        // material.vertexColors = !!vDiffuse // XXX push vertex colors first\n                        break\n                    case SURF_VSPC:\n                        let vSpecular = view.getFloat32(subchunkOffset + SUBCHUNK_HEADER_SIZE)\n                        // material.specular = material.color.multiplyScalar(vSpecular);\n                        if (this.verbose) console.warn('Specular (VSPC): ' + vSpecular)\n                        break\n                    case SURF_TFLG:\n                        textureFlags = view.getUint16(subchunkOffset + SUBCHUNK_HEADER_SIZE)\n                        if (this.verbose) console.log('Flags (TFLG): ' + textureFlags.toString(2))\n                        if (this.verbose && textureFlags & XAXIS_BIT) console.warn('Flag is set but unhandled: X Axis')\n                        if (this.verbose && textureFlags & YAXIS_BIT) console.warn('Flag is set but unhandled: Y Axis')\n                        if (this.verbose && textureFlags & ZAXIS_BIT) console.warn('Flag is set but unhandled: Z Axis')\n                        if (this.verbose && textureFlags & WORLDCOORDS_BIT) console.warn('Flag is set but unhandled: World Coords')\n                        if (this.verbose && textureFlags & NEGATIVEIMAGE_BIT) console.warn('Flag is set but unhandled: Negative Image')\n                        if (this.verbose && textureFlags & PIXELBLENDING_BIT) console.warn('Flag is set but unhandled: Pixel Blending')\n                        if (this.verbose && textureFlags & ANTIALIASING_BIT) console.log('Flag is set: Antialiasing') // turned on by default\n                        break\n                    case SURF_TSIZ:\n                        textureSize = getVector3AtOffset(view, subchunkOffset + SUBCHUNK_HEADER_SIZE)\n                        if (this.verbose) console.warn('Texture size (TSIZ): ' + textureSize.toArray().join(' '))\n                        break\n                    case SURF_TCTR:\n                        textureCenter = getVector3AtOffset(view, subchunkOffset + SUBCHUNK_HEADER_SIZE)\n                        if (this.verbose) console.warn('Texture center (TCTR): ' + textureCenter.toArray().join(' '))\n                        break\n                    case SURF_CTEX:\n                    case SURF_DTEX:\n                    case SURF_STEX:\n                    case SURF_RTEX:\n                    case SURF_TTEX:\n                    case SURF_BTEX:\n                        const textureTypeName = decodeFilepath(new Uint8Array(buffer, subchunkOffset + SUBCHUNK_HEADER_SIZE, subchunkSize))\n                        if (this.verbose) console.log('Texture typename: ' + textureTypeName)\n                        // XXX handle different texture types\n                        break\n                    case SURF_TVAL: // always 0 in the game\n                        const textureValue = view.getUint16(subchunkOffset + SUBCHUNK_HEADER_SIZE) / 256\n                        if (this.verbose) console.warn('Texture value (TVAL): ' + textureValue)\n                        break\n                    case SURF_TCLR:\n                        const textureColorArray = [\n                            view.getUint8(subchunkOffset + SUBCHUNK_HEADER_SIZE + 0) / 255,\n                            view.getUint8(subchunkOffset + SUBCHUNK_HEADER_SIZE + 1) / 255,\n                            view.getUint8(subchunkOffset + SUBCHUNK_HEADER_SIZE + 2) / 255,\n                            view.getUint8(subchunkOffset + SUBCHUNK_HEADER_SIZE + 3) / 255,\n                        ]\n                        // const textureColor = new Color().fromArray(textureColorArray);\n                        // seems to be 0 0 0 anyway...\n                        if (this.verbose) console.log('Texture color (TCLR): ' + textureColorArray.join(' '))\n                        break\n                    case SURF_TIMG:\n                        let textureFilepath = decodeFilepath(new Uint8Array(buffer, subchunkOffset + SUBCHUNK_HEADER_SIZE, subchunkSize))\n                        if (this.verbose) console.log('Texture filepath (TIMG): ' + textureFilepath)\n                        if (textureFilepath === '(none)') break\n                        let sequenceTexture = false\n                        if (textureFilepath.endsWith(' (sequence)')) {\n                            sequenceTexture = true\n                            textureFilepath = textureFilepath.substring(0, textureFilepath.length - ' (sequence)'.length)\n                        }\n                        let filename = getFilename(textureFilepath)\n                        material.transparent = !!filename.match(/^a\\d+.+.bmp/i)\n                        const textureFilename = this.path + filename\n                        if (sequenceTexture) {\n                            const match = textureFilename.match(/(.+\\D)0+(\\d+)\\..+/)\n                            const sequenceNames = ResourceManager.filterTextureSequenceNames(match[1])\n                            if (sequenceNames) {\n                                let seqNum = 0\n                                this.sequenceIntervals.push(setInterval(() => {\n                                    material.map = ResourceManager.getTexture(sequenceNames[seqNum])\n                                    material.color = null // no need for color, when color map (texture) in use\n                                    seqNum++\n                                    if (seqNum >= sequenceNames.length) seqNum = 0\n                                }, 1000 / SEQUENCE_TEXTURE_FRAMERATE))\n                            }\n                        }\n                        const lTextureName = textureFilename.toLowerCase()\n                        if (lTextureName === 'miscanims/barrier/a_side.bmp' // workaround (TODO actually never add unknown textures?)\n                            || lTextureName === 'miscanims/barrier/a_top.bmp'\n                            || lTextureName === 'miscanims/barrier/a_bstripes.bmp'\n                            || lTextureName === 'buildings/geo-dome/a_walkie.bmp'\n                            || lTextureName === 'world/shared/teofoilreflections.jpg'\n                            || lTextureName === 'buildings/barracks/wingbase3.bmp'\n                        ) {\n                            break\n                        }\n                        material.map = ResourceManager.getTexture(textureFilename)\n                        material.color = null // no need for color, when color map (texture) in use\n                        break\n                    default: // TODO implement all LWO features\n                        if (this.verbose) console.warn('Found unrecognised SURF subchunk type ' + new TextDecoder().decode(new Uint8Array(buffer, subchunkOffset, ID4_SIZE)) + ' at ' + subchunkOffset + '; length ' + subchunkSize)\n                        break\n                }\n\n                offset += SUBCHUNK_HEADER_SIZE + subchunkSize\n            }\n        }\n\n        planarMapUVS(this.geometry, this.vertices, this.uvs, this.indices, materialIndex, textureSize, textureCenter, textureFlags)\n    }\n\n    parse(buffer: ArrayBuffer): AnimatedMesh {\n        const view = new DataView(buffer)\n\n        if (view.getUint32(0) !== LWO_FORM) {\n            console.error('LWOLoader.parse: Cannot find header.')\n            return\n        }\n\n        const fileSize = view.getUint32(ID4_SIZE)\n        if (fileSize + CHUNK_HEADER_SIZE !== view.byteLength) {\n            console.warn('LWOLoader.parse: Discrepancy between size in header (' + (fileSize + CHUNK_HEADER_SIZE) + ' bytes) and actual size (' + view.byteLength + ' bytes).')\n        }\n\n        let magicOffset = ID4_SIZE + I4_SIZE\n        if (view.getUint32(magicOffset) !== LWO_MAGIC) {\n            const magic = decodeString(new Uint8Array(buffer, magicOffset, ID4_SIZE))\n            console.error('LWOLoader.parse: Invalid magic ID (' + magic + ') in LWO header.')\n            return\n        }\n\n        let cursor = 12\n        while (cursor < view.byteLength) {\n            // Skip null byte padding\n            if (view.getUint8(cursor) === 0) {\n                cursor++\n            } else {\n                const chunkType = view.getInt32(cursor)\n                const chunkSize = view.getInt32(cursor + ID4_SIZE)\n\n                cursor += CHUNK_HEADER_SIZE\n\n                switch (chunkType) {\n                    case LWO_PNTS:\n                        this.parsePoints(view, cursor, chunkSize)\n                        break\n                    case LWO_SFRS:\n                        this.parseSurfaceNames(buffer, cursor, chunkSize)\n                        break\n                    case LWO_POLS:\n                        this.parsePolygons(view, cursor, chunkSize)\n                        break\n                    case LWO_SURF:\n                        this.parseSurface(view, buffer, cursor, chunkSize)\n                        break\n                    default:\n                        console.warn('Found unrecognised chunk type ' + decodeString(new Uint8Array(buffer, cursor - CHUNK_HEADER_SIZE, ID4_SIZE)) + ' at ' + cursor)\n                }\n\n                cursor += chunkSize\n            }\n\n        }\n\n        this.geometry.setAttribute('position', new BufferAttribute(this.vertices, 3))\n        this.geometry.setAttribute('uv', new BufferAttribute(this.uvs, 2))\n        this.geometry.setIndex(new BufferAttribute(this.indices, 1))\n        this.geometry.computeVertexNormals()\n\n        return new AnimatedMesh(new Mesh(this.geometry, this.materials), this.sequenceIntervals)\n    }\n}\n","import { Vector3 } from 'three'\nimport { SelectionEvent } from '../../event/LocalEvents'\n\nexport interface Selectable {\n\n    getSelectionType(): SelectionType;\n\n    select(): SelectionEvent;\n\n    deselect(): any;\n\n    getSelectionCenter(): Vector3;\n\n}\n\nexport enum SelectionType {\n\n    SURFACE,\n    PILOT,\n    BUILDING,\n    VEHICLE,\n    GROUP,\n\n}\n","import { AnimSubObj } from './AnimSubObj'\n\nexport class AnimClip {\n\n    looping: boolean = false\n    transcoef: number = 1\n    firstFrame: number = null\n    lastFrame: number = null\n    framesPerSecond: number = null\n    bodies: AnimSubObj[] = []\n\n}\n","import { Euler, MathUtils, Object3D, Vector3 } from 'three'\nimport degToRad = MathUtils.degToRad\n\nexport class AnimSubObj {\n\n    name: string = ''\n    filename: string = ''\n    relPos: Vector3[] = []\n    relRot: Euler[] = []\n    relScale: Vector3[] = []\n    opacity: number[] = []\n    parentObjInd: number = null\n    model: Object3D = null\n\n    radVec(degX: number, degY: number, degZ: number) {\n        return new Euler(degToRad(degY), degToRad(degX), degToRad(degZ), 'YXZ')\n    }\n\n    setFrameAndFollowing(animationFrameIndex: number, lastFrame: number, infos: number[]) {\n        this.relPos[animationFrameIndex] = new Vector3(infos[0], infos[1], infos[2])\n        this.relRot[animationFrameIndex] = this.radVec(infos[3], infos[4], infos[5])\n        this.relScale[animationFrameIndex] = new Vector3(infos[6], infos[7], infos[8])\n        for (let c = animationFrameIndex; c <= lastFrame; c++) {\n            this.relPos[c] = this.relPos[animationFrameIndex]\n            this.relRot[c] = this.relRot[animationFrameIndex]\n            this.relScale[c] = this.relScale[animationFrameIndex]\n        }\n    }\n\n    setOpacityAndFollowing(animationFrameIndex: number, lastFrame: number, value: number) {\n        for (let c = animationFrameIndex; c <= lastFrame; c++) {\n            this.opacity[c] = value\n        }\n    }\n\n}\n","const Stats = require('stats.js')\n\nexport class DebugHelper {\n\n    stats\n\n    constructor() {\n        this.stats = new Stats()\n        this.stats.setMode(0) // 0: fps, 1: ms\n\n        this.stats.domElement.style.position = 'absolute'\n        this.stats.domElement.style.left = '0px'\n        this.stats.domElement.style.top = '0px'\n\n        document.body.appendChild(this.stats.domElement)\n        this.hide()\n    }\n\n    show() {\n        this.stats.domElement.style.visibility = 'visible'\n    }\n\n    hide() {\n        this.stats.domElement.style.visibility = 'hidden'\n    }\n\n    renderStart() {\n        this.stats.begin()\n    }\n\n    renderDone() {\n        this.stats.end()\n    }\n\n}\n","export class Building {\n\n    // XXX dynamically read building types from cfg at BuildingTypes\n    static readonly TOOLSTATION = new Building('Toolstation', 'Buildings/Toolstation', false)\n    static readonly TELEPORT_PAD = new Building('TeleportPad', 'Buildings/Teleports')\n    static readonly DOCKS = new Building('Docks', 'Buildings/Docks', true,\n        null, null, true, {x: 0, y: 1})\n    static readonly POWER_STATION = new Building('Powerstation', 'Buildings/Powerstation', true,\n        {x: 1, y: 0})\n    static readonly BARRACKS = new Building('Barracks', 'Buildings/Barracks')\n    static readonly UPGRADE = new Building('Upgrade', 'Buildings/Upgrade')\n    static readonly GEODOME = new Building('Geo-dome', 'Buildings/Geo-dome', true,\n        {x: 0, y: -1}, null, false)\n    static readonly ORE_REFINERY = new Building('OreRefinery', 'Buildings/OreRefinery', true,\n        {x: 0, y: 1})\n    static readonly GUNSTATION = new Building('Gunstation', 'Buildings/gunstation', true,\n        null, null, false)\n    static readonly TELEPORT_BIG = new Building('TeleportBIG', 'Buildings/BIGTeleport', true,\n        {x: -1, y: 0}, {x: -1, y: -1})\n\n    name: string\n    aeFile: string\n    blocksPathSurface: boolean\n    secondaryBuildingPart: { x: number, y: number }\n    secondaryPowerPath: { x: number, y: number }\n    hasPrimaryPowerPath: boolean\n    waterPathSurface: { x: number, y: number }\n\n    constructor(name: string, folder: string, blocksPathSurface: boolean = true, secondaryBuildingPart: { x: number, y: number } = null, secondaryPowerPath: { x: number, y: number } = null, hasPrimaryPowerPath: boolean = true, waterPathSurface: { x: number, y: number } = null) {\n        this.name = name\n        this.aeFile = folder + '/' + folder.slice(folder.lastIndexOf('/') + 1) + '.ae'\n        this.blocksPathSurface = blocksPathSurface\n        this.secondaryBuildingPart = secondaryBuildingPart\n        this.secondaryPowerPath = secondaryPowerPath\n        this.hasPrimaryPowerPath = hasPrimaryPowerPath\n        this.waterPathSurface = waterPathSurface\n    }\n\n    static getByName(buildingType: string) {\n        const typename = buildingType.slice(buildingType.lastIndexOf('/') + 1).toLowerCase()\n        switch (typename) {\n            case 'toolstation':\n                return this.TOOLSTATION\n            case 'teleports':\n                return this.TELEPORT_PAD\n            case 'docks':\n                return this.DOCKS\n            case 'powerstation':\n                return this.POWER_STATION\n            case 'barracks':\n                return this.BARRACKS\n            case 'upgrade':\n                return this.UPGRADE\n            case 'geo-dome':\n                return this.GEODOME\n            case 'orerefinery':\n                return this.ORE_REFINERY\n            case 'gunstation':\n                return this.GUNSTATION\n            case 'teleportbig':\n                return this.TELEPORT_BIG\n            default:\n                throw 'Unknown building type: ' + buildingType\n        }\n    }\n\n}\n","import { WorldManager } from '../WorldManager'\nimport { Group, Vector2 } from 'three'\nimport { Surface } from './map/Surface'\n\nexport abstract class BaseEntity {\n\n    worldMgr: WorldManager\n    group: Group = new Group()\n    level: number = 0\n\n    abstract get stats()\n\n    getPosition() {\n        return this.group.position.clone()\n    }\n\n    getPosition2D() {\n        return new Vector2(this.group.position.x, this.group.position.z)\n    }\n\n    getHeading(): number {\n        return this.group.rotation.y\n    }\n\n    onDiscover() {\n        this.group.visible = true\n    }\n\n    getCurrentSurface(): Surface {\n        return this.worldMgr.sceneManager.terrain.getSurfaceFromWorld(this.group.position)\n    }\n\n    removeFromScene() {\n        this.worldMgr.sceneManager.scene.remove(this.group)\n    }\n\n}\n","export enum EventKey {\n\n    SELECTED_SURFACE,\n    SELECTED_BUILDING,\n    SELECTED_RAIDER,\n    SELECTED_VEHICLE,\n\n    DESELECTED_ENTITY,\n\n    JOB_CREATE,\n    JOB_DELETE,\n\n    RAIDER_REQUESTED,\n\n    MATERIAL_AMOUNT_CHANGED,\n\n    SPAWN_DYNAMITE,\n\n    ENTITY_ADDED,\n    ENTITY_REMOVED,\n\n    CAVERN_DISCOVERED,\n\n    ORE_FOUND,\n\n    BUILDING_UPGRADED,\n\n    RAIDER_TRAINED,\n\n    LOCATION_DEATH,\n    LOCATION_MONSTER,\n    LOCATION_CRYSTAL_FOUND,\n    LOCATION_UNDER_ATTACK,\n    LOCATION_LANDSLIDE,\n    LOCATION_POWER_DRAIN,\n    LOCATION_SLUG_EMERGE,\n    LOCATION_RAIDER_DISCOVERED,\n\n    SURFACE_CHANGED,\n    AIR_LEVEL_CHANGED,\n    CANCEL_BUILD_MODE,\n\n}\n","import { GameEvent } from './GameEvent'\nimport { EventKey } from './EventKeyEnum'\n\nexport class EventBus {\n\n    static eventListener = new Map<EventKey, ((event: GameEvent) => any)[]>()\n    static blockedEvents = []\n\n    static publishEvent(event: GameEvent) {\n        if (this.blockedEvents.includes(event.eventKey)) return // event is currently blocked from publishing\n        if (!event.isLocal) console.log('Event published: ' + EventKey[event.eventKey])\n        this.blockedEvents.push(event.eventKey)\n        this.getListener(event.eventKey).forEach((callback) => callback(event))\n        this.blockedEvents.remove(event.eventKey)\n    }\n\n    static registerEventListener(eventKey: EventKey, callback: (GameEvent) => any) {\n        this.getListener(eventKey).push(callback)\n    }\n\n    private static getListener(eventKey: EventKey) {\n        return this.eventListener.getOrUpdate(eventKey, () => [])\n    }\n\n    // TODO cleanup/unregister all event listener at level end?!\n\n}\n","import { PublicJob } from '../game/model/job/Job'\nimport { CollectableType } from '../scene/model/collect/CollectableEntity'\nimport { AnimEntity } from '../scene/model/anim/AnimEntity'\nimport { Surface } from '../scene/model/map/Surface'\nimport { BuildingEntity } from '../scene/model/BuildingEntity'\nimport { FulfillerEntity } from '../scene/model/FulfillerEntity'\nimport { RaiderSkill } from '../scene/model/RaiderSkill'\nimport { GameEvent } from './GameEvent'\nimport { EventKey } from './EventKeyEnum'\n\nexport class WorldEvent extends GameEvent {\n\n    constructor(entityKey: EventKey) {\n        super(entityKey)\n        this.isLocal = false\n    }\n\n}\n\nexport class JobEvent extends WorldEvent {\n\n    job: PublicJob\n\n    constructor(eventKey: EventKey, job: PublicJob) {\n        super(eventKey)\n        this.job = job\n    }\n\n}\n\nexport class JobCreateEvent extends JobEvent {\n\n    constructor(job: PublicJob) {\n        super(EventKey.JOB_CREATE, job)\n    }\n\n}\n\nexport class JobDeleteEvent extends JobEvent {\n\n    constructor(job: PublicJob) {\n        super(EventKey.JOB_DELETE, job)\n    }\n\n}\n\nexport class RaiderRequested extends WorldEvent {\n\n    constructor() {\n        super(EventKey.RAIDER_REQUESTED)\n    }\n\n}\n\nexport class MaterialAmountChanged extends WorldEvent {\n\n    collectableType: CollectableType\n\n    constructor(collectableType: CollectableType) {\n        super(EventKey.MATERIAL_AMOUNT_CHANGED)\n        this.collectableType = collectableType\n    }\n\n}\n\nexport class SpawnDynamiteEvent extends WorldEvent {\n\n    surface: Surface\n\n    constructor(surface: Surface) {\n        super(EventKey.SPAWN_DYNAMITE)\n        this.surface = surface\n    }\n\n}\n\nexport class EntityAddedEvent extends WorldEvent {\n\n    type: EntityType\n    entity: AnimEntity\n\n    constructor(type: EntityType, entity: AnimEntity) {\n        super(EventKey.ENTITY_ADDED)\n        this.type = type\n        this.entity = entity\n    }\n\n}\n\nexport class EntityRemovedEvent extends WorldEvent {\n\n    type: EntityType\n    entity: AnimEntity\n\n    constructor(type: EntityType, entity: AnimEntity) {\n        super(EventKey.ENTITY_REMOVED)\n        this.type = type\n        this.entity = entity\n    }\n\n}\n\nexport enum EntityType {\n\n    RAIDER,\n    VEHICLE,\n    BUILDING,\n\n}\n\nexport class CavernDiscovered extends WorldEvent {\n\n    constructor() {\n        super(EventKey.CAVERN_DISCOVERED)\n    }\n\n}\n\nexport class OreFoundEvent extends WorldEvent {\n\n    constructor() {\n        super(EventKey.ORE_FOUND)\n    }\n\n}\n\nexport class BuildingUpgraded extends WorldEvent {\n\n    building: BuildingEntity\n\n    constructor(building: BuildingEntity) {\n        super(EventKey.BUILDING_UPGRADED)\n        this.building = building\n    }\n\n}\n\nexport class RaiderTrained extends WorldEvent {\n\n    entity: FulfillerEntity\n    skill: RaiderSkill\n\n    constructor(raider: FulfillerEntity, skill: RaiderSkill) {\n        super(EventKey.RAIDER_TRAINED)\n        this.entity = raider\n        this.skill = skill\n    }\n\n}\n","import { EventKey } from './EventKeyEnum'\n\nexport class GameEvent {\n\n    eventKey: EventKey\n    isLocal: boolean\n\n    constructor(eventKey: EventKey) {\n        this.eventKey = eventKey\n    }\n\n}\n","export enum JobState {\n\n    OPEN,\n    COMPLETE,\n    CANCELED,\n\n}\n","export enum JobType {\n\n    DRILL,\n    REINFORCE,\n    BLOW,\n    CLEAR_RUBBLE,\n    COLLECT,\n    CARRY,\n    MOVE,\n    TRAIN,\n    GET_TOOL,\n    EAT,\n    COMPLETE_POWER_PATH,\n\n}\n","import { FulfillerEntity } from '../../../scene/model/FulfillerEntity'\nimport { RaiderSkill } from '../../../scene/model/RaiderSkill'\nimport { RaiderTool } from '../../../scene/model/RaiderTool'\nimport { JobType } from './JobType'\nimport { JobState } from './JobState'\nimport { PriorityIdentifier } from './PriorityIdentifier'\nimport { PathTarget } from '../../../scene/model/PathTarget'\n\nexport abstract class Job {\n\n    type: JobType\n    jobstate: JobState\n    fulfiller: FulfillerEntity[] = []\n\n    protected constructor(type: JobType) {\n        this.type = type\n        this.jobstate = JobState.OPEN\n    }\n\n    assign(fulfiller: FulfillerEntity) {\n        const index = this.fulfiller.indexOf(fulfiller)\n        if (fulfiller && index === -1) {\n            this.fulfiller.push(fulfiller)\n        }\n    }\n\n    unassign(fulfiller: FulfillerEntity) {\n        this.fulfiller.remove(fulfiller)\n    }\n\n    cancel() {\n        this.jobstate = JobState.CANCELED\n        const fulfiller = this.fulfiller // ensure consistency while processing\n        this.fulfiller = []\n        fulfiller.forEach((fulfiller) => fulfiller.stopJob())\n    }\n\n    isQualified(fulfiller: FulfillerEntity): boolean {\n        return true\n    }\n\n    isQualifiedWithTool(fulfiller: FulfillerEntity): RaiderTool {\n        return null\n    }\n\n    isQualifiedWithTraining(fulfiller: FulfillerEntity): RaiderSkill {\n        return null\n    }\n\n    onJobComplete() {\n        this.jobstate = JobState.COMPLETE\n    }\n\n    abstract getWorkplaces(): PathTarget[];\n\n}\n\nexport abstract class PublicJob extends Job {\n\n    abstract getPriorityIdentifier(): PriorityIdentifier\n\n}\n","import { Vector2 } from 'three'\n\nexport class PathTarget {\n\n    targetLocation: Vector2\n\n    constructor(location: Vector2) {\n        this.targetLocation = location\n    }\n\n    isInArea(position: Vector2): boolean {\n        return false\n    }\n\n}\n","import { BaseEntity } from '../BaseEntity'\nimport { GameState } from '../../../game/model/GameState'\nimport { EventBus } from '../../../event/EventBus'\nimport { JobCreateEvent } from '../../../event/WorldEvents'\nimport { Carryable } from './Carryable'\nimport { CollectJob } from '../../../game/model/job/CollectJob'\nimport { CollectPathTarget } from '../CollectionTarget'\nimport { Building } from '../../../game/model/entity/building/Building'\nimport { BuildingSite } from '../BuildingSite'\nimport { PriorityIdentifier } from '../../../game/model/job/PriorityIdentifier'\n\nexport abstract class CollectableEntity extends BaseEntity implements Carryable {\n\n    targets: CollectPathTarget[] = []\n    targetSite: BuildingSite = null\n\n    abstract getTargetBuildingTypes(): Building[];\n\n    hasTarget(): boolean {\n        return this.updateTargets().length > 0\n    }\n\n    getCarryTargets(): CollectPathTarget[] {\n        return this.updateTargets()\n    }\n\n    resetTarget() {\n        this.targets = []\n        this.targetSite = null\n        this.updateTargets()\n    }\n\n    protected updateTargets(): CollectPathTarget[] {\n        if (this.targets.length < 1) {\n            const sites = GameState.buildingSites.filter((b) => b.needs(this.getCollectableType()))\n            if (sites.length > 0) {\n                this.targets = sites.map((s) => new CollectPathTarget(s.getRandomDropPosition(), s, null))\n            } else {\n                const buildings = GameState.getBuildingsByType(...this.getTargetBuildingTypes())\n                if (buildings.length > 0) {\n                    this.targets = buildings.map((b) => new CollectPathTarget(b.getDropPosition2D(), null, b))\n                }\n            }\n        } else if (this.targets.some((t) => t.site && t.site.complete)) {\n            this.resetTarget()\n        } else if (this.targets.some((t) => t.building && !t.building.isPowered())) {\n            this.resetTarget()\n        }\n        return this.targets\n    }\n\n    onDiscover() {\n        super.onDiscover()\n        GameState.collectablesUndiscovered.remove(this)\n        GameState.collectables.push(this)\n        EventBus.publishEvent(new JobCreateEvent(new CollectJob(this)))\n    }\n\n    abstract getCollectableType(): CollectableType\n\n    abstract getPriorityIdentifier(): PriorityIdentifier\n\n    setTargetSite(site: BuildingSite) {\n        if (this.targetSite === site) return\n        this.targetSite?.unAssign(this)\n        this.targetSite = site\n        this.targetSite?.assign(this)\n    }\n\n}\n\nexport enum CollectableType {\n\n    DYNAMITE,\n    CRYSTAL,\n    ORE,\n    BRICK,\n    BARRIER,\n    ELECTRIC_FENCE,\n\n}\n","import { CollectableEntity, CollectableType } from '../../../scene/model/collect/CollectableEntity'\nimport { FulfillerEntity } from '../../../scene/model/FulfillerEntity'\nimport { PublicJob } from './Job'\nimport { JobType } from './JobType'\nimport { PriorityIdentifier } from './PriorityIdentifier'\nimport { PathTarget } from '../../../scene/model/PathTarget'\nimport { ElectricFence } from '../../../scene/model/collect/ElectricFence'\n\nexport class CollectJob extends PublicJob {\n\n    item: CollectableEntity\n\n    constructor(item: CollectableEntity) {\n        super(JobType.COLLECT)\n        this.item = item\n    }\n\n    getWorkplaces(): PathTarget[] {\n        return [new PathTarget(this.item.getPosition2D())]\n    }\n\n    isQualified(fulfiller: FulfillerEntity) {\n        return fulfiller.carries === null && this.item.hasTarget()\n    }\n\n    getPriorityIdentifier(): PriorityIdentifier {\n        return this.item.getPriorityIdentifier()\n    }\n\n    onJobComplete() {\n        super.onJobComplete()\n        if (this.item.getCollectableType() === CollectableType.ELECTRIC_FENCE) {\n            const electricFence = this.item as ElectricFence\n            if (electricFence.targetSurface.canPlaceFence()) {\n                this.item.worldMgr.sceneManager.scene.add(this.item.group)\n                electricFence.targetSurface.fence = electricFence\n            } // TODO else dispose item entity with mesh\n        }\n    }\n\n}\n","export class BaseActivity {\n\n    activityKey: string\n\n    constructor(activityKey: string) {\n        this.activityKey = activityKey\n    }\n\n}\n","import { BaseActivity } from './BaseActivity'\n\nexport class AnimEntityActivity extends BaseActivity {\n\n    static Stand = new AnimEntityActivity('Activity_Stand')\n\n}\n","import { AnimEntityActivity } from './AnimEntityActivity'\n\nexport class RaiderActivity extends AnimEntityActivity {\n\n    static Route = new RaiderActivity('Activity_Route')\n    static RunPanic = new RaiderActivity('Activity_RunPanic')\n    static Drill = new RaiderActivity('Activity_Drill')\n    static Walk = new RaiderActivity('!Activity_Walk')\n    static Reinforce = new RaiderActivity('Activity_Reinforce')\n    static Reverse = new RaiderActivity('!Activity_Reverse')\n    static TurnLeft = new RaiderActivity('!Activity_TurnLeft')\n    static TurnRight = new RaiderActivity('!Activity_TurnRight')\n    static CantDo = new RaiderActivity('!Activity_CantDo')\n    static Collect = new RaiderActivity('Activity_Collect')\n    static Clear = new RaiderActivity('Activity_Clear')\n    static Carry = new RaiderActivity('Activity_Carry')\n    static CarryTurnLeft = new RaiderActivity('!Activity_CarryTurnLeft')\n    static CarryTurnRight = new RaiderActivity('!Activity_CarryTurnRight')\n    static CarryStand = new RaiderActivity('Activity_CarryStand')\n    static Dynamite = new RaiderActivity('Activity_Dynamite')\n    static Place = new RaiderActivity('Activity_Place')\n    static Deposit = new RaiderActivity('!Activity_Deposit')\n    static TeleportIn = new RaiderActivity('Activity_TeleportIn')\n    static Repair = new RaiderActivity('Activity_Repair')\n    static rest = new RaiderActivity('Activity_rest')\n    static routeRubble = new RaiderActivity('!Activity_routeRubble')\n    static CarryRubble = new RaiderActivity('!Activity_CarryRubble')\n    static Eat = new RaiderActivity('Activity_Eat')\n    static FireLaser = new RaiderActivity('Activity_FireLaser')\n    static GetUp = new RaiderActivity('!Activity_GetUp')\n    static ThrownByRockMonster = new RaiderActivity('Activity_ThrownByRockMonster')\n    static Slip = new RaiderActivity('Activity_Slip')\n    static Train = new RaiderActivity('Activity_Train')\n    static Recharge = new RaiderActivity('!Activity_Recharge')\n\n    static Waiting1 = new RaiderActivity('Activity_Waiting1')\n    static Waiting2 = new RaiderActivity('Activity_Waiting2')\n    static Waiting3 = new RaiderActivity('Activity_Waiting3')\n    static Waiting4 = new RaiderActivity('Activity_Waiting4')\n\n    static Hoverboard = new RaiderActivity('Activity_Hoverboard')\n    static Standhoverboard = new RaiderActivity('Activity_Standhoverboard')\n    static HitLefthoverboard = new RaiderActivity('!Activity_HitLefthoverboard')\n    static HitRighthoverboard = new RaiderActivity('!Activity_HitRighthoverboard')\n    static HitFronthoverboard = new RaiderActivity('!Activity_HitFronthoverboard')\n    static HitBackhoverboard = new RaiderActivity('!Activity_HitBackhoverboard')\n\n    static SMALLTRUCK = new RaiderActivity('Activity_SMALLTRUCK')\n    static StandSMALLTRUCK = new RaiderActivity('Activity_StandSMALLTRUCK')\n    static HitLeftSMALLTRUCK = new RaiderActivity('!Activity_HitLeftSMALLTRUCK')\n    static HitRightSMALLTRUCK = new RaiderActivity('!Activity_HitRightSMALLTRUCK')\n    static HitFrontSMALLTRUCK = new RaiderActivity('!Activity_HitFrontSMALLTRUCK')\n    static HitBackSMALLTRUCK = new RaiderActivity('!Activity_HitBackSMALLTRUCK')\n\n    static SMALLheli = new RaiderActivity('Activity_SMALLheli')\n    static StandSMALLheli = new RaiderActivity('Activity_StandSMALLheli')\n    static HitLeftSMALLheli = new RaiderActivity('!Activity_HitLeftSMALLheli')\n    static HitRightSMALLheli = new RaiderActivity('!Activity_HitRightSMALLheli')\n    static HitFrontSMALLheli = new RaiderActivity('!Activity_HitFrontSMALLheli')\n    static HitBackSMALLheli = new RaiderActivity('!Activity_HitBackSMALLheli')\n\n    static SMALLCAT = new RaiderActivity('Activity_SMALLCAT')\n    static StandSMALLCAT = new RaiderActivity('Activity_StandSMALLCAT')\n    static HitLeftSMALLCAT = new RaiderActivity('!Activity_HitLeftSMALLCAT')\n    static HitRightSMALLCAT = new RaiderActivity('!Activity_HitRightSMALLCAT')\n    static HitFrontSMALLCAT = new RaiderActivity('!Activity_HitFrontSMALLCAT')\n    static HitBackSMALLCAT = new RaiderActivity('!Activity_HitBackSMALLCAT')\n\n    static SMALLMLP = new RaiderActivity('Activity_SMALLMLP')\n    static StandSMALLMLP = new RaiderActivity('Activity_StandSMALLMLP')\n    static HitLeftSMALLMLP = new RaiderActivity('!Activity_HitLeftSMALLMLP')\n    static HitRightSMALLMLP = new RaiderActivity('!Activity_HitRightSMALLMLP')\n    static HitFrontSMALLMLP = new RaiderActivity('!Activity_HitFrontSMALLMLP')\n    static HitBackSMALLMLP = new RaiderActivity('!Activity_HitBackSMALLMLP')\n\n    static LARGECAT = new RaiderActivity('Activity_LARGECAT')\n    static StandLARGECAT = new RaiderActivity('Activity_StandLARGECAT')\n    static HitLeftLARGECAT = new RaiderActivity('!Activity_HitLeftLARGECAT')\n    static HitRightLARGECAT = new RaiderActivity('!Activity_HitRightLARGECAT')\n    static HitFrontLARGECAT = new RaiderActivity('!Activity_HitFrontLARGECAT')\n    static HitBackLARGECAT = new RaiderActivity('!Activity_HitBackLARGECAT')\n\n    static SMALLDIGGER = new RaiderActivity('Activity_SMALLDIGGER')\n    static StandSMALLDIGGER = new RaiderActivity('Activity_StandSMALLDIGGER')\n\n}\n","import { AnimEntityActivity } from './AnimEntityActivity'\n\nexport class BuildingActivity extends AnimEntityActivity {\n\n    static Teleport = new BuildingActivity('Activity_Teleport')\n    static Deposit = new BuildingActivity('Activity_Deposit')\n    static Explode = new BuildingActivity('Activity_Explode')\n    static Unpowered = new BuildingActivity('Activity_Unpowered')\n\n}\n","import { Vector2 } from 'three'\nimport { RaiderActivity } from './activities/RaiderActivity'\nimport { CollectableEntity, CollectableType } from './collect/CollectableEntity'\nimport { PathTarget } from './PathTarget'\nimport { BuildingSite } from './BuildingSite'\nimport { Building } from '../../game/model/entity/building/Building'\nimport { BuildingEntity } from './BuildingEntity'\nimport { BuildingActivity } from './activities/BuildingActivity'\nimport { GameState } from '../../game/model/GameState'\nimport { EventBus } from '../../event/EventBus'\nimport { MaterialAmountChanged } from '../../event/WorldEvents'\n\nexport interface CollectionTarget {\n\n    getDropAction(): RaiderActivity\n\n    gatherItem(item: CollectableEntity)\n\n}\n\nexport class CollectPathTarget extends PathTarget implements CollectionTarget {\n\n    site: BuildingSite\n    building: BuildingEntity\n\n    constructor(location: Vector2, site: BuildingSite, building: BuildingEntity) {\n        super(location)\n        this.site = site\n        this.building = building\n    }\n\n    canGatherItem(): boolean {\n        if (this.building) {\n            return this.building.activity.activityKey === this.building.getDefaultActivity().activityKey\n        }\n        return true\n    }\n\n    gatherItem(item: CollectableEntity) {\n        if (this.site) {\n            this.site.addItem(item)\n        } else if (this.building) {\n            if (this.building.type === Building.POWER_STATION || this.building.type === Building.ORE_REFINERY) {\n                if (this.building.carryJoint) {\n                    this.building.carryJoint.add(item.group)\n                    item.group.position.set(0, 0, 0)\n                }\n                this.building.changeActivity(BuildingActivity.Deposit, () => {\n                    this.building.changeActivity()\n                    if (this.building.carryJoint) this.building.carryJoint.remove(item.group)\n                    CollectPathTarget.addItemToStorage(item)\n                    // TODO dispose item\n                })\n            } else {\n                CollectPathTarget.addItemToStorage(item)\n            }\n        } else {\n            item.worldMgr.sceneManager.scene.add(item.group)\n        }\n    }\n\n    private static addItemToStorage(item: CollectableEntity) {\n        switch (item.getCollectableType()) {\n            case CollectableType.CRYSTAL:\n                GameState.numCrystal++\n                EventBus.publishEvent(new MaterialAmountChanged(item.getCollectableType()))\n                break\n            case CollectableType.ORE:\n                GameState.numOre++\n                EventBus.publishEvent(new MaterialAmountChanged(item.getCollectableType()))\n                break\n        }\n    }\n\n    getDropAction(): RaiderActivity {\n        if (this.building && (this.building.type === Building.POWER_STATION || this.building.type === Building.ORE_REFINERY)) {\n            return RaiderActivity.Deposit\n        } else {\n            return RaiderActivity.Place\n        }\n    }\n\n}\n","export enum PriorityIdentifier {\n\n    aiPriorityTrain,\n    aiPriorityGetIn,\n    aiPriorityCrystal,\n    aiPriorityOre,\n    aiPriorityRepair,\n    aiPriorityClearing,\n    aiPriorityDestruction,\n    aiPriorityConstruction,\n    aiPriorityReinforce,\n    aiPriorityRecharge,\n\n}\n","import { GameEvent } from './GameEvent'\nimport { BuildingEntity } from '../scene/model/BuildingEntity'\nimport { Surface } from '../scene/model/map/Surface'\nimport { Raider } from '../scene/model/Raider'\nimport { VehicleEntity } from '../scene/model/VehicleEntity'\nimport { EventKey } from './EventKeyEnum'\n\nexport class LocalEvent extends GameEvent {\n\n    constructor(eventKey: EventKey) {\n        super(eventKey)\n        this.isLocal = true\n    }\n\n}\n\nexport class SelectionEvent extends LocalEvent {\n\n    constructor(eventKey: EventKey) {\n        super(eventKey)\n    }\n\n}\n\nexport class SurfaceSelectedEvent extends SelectionEvent {\n\n    surface: Surface\n\n    constructor(surface: Surface) {\n        super(EventKey.SELECTED_SURFACE)\n        this.surface = surface\n    }\n\n}\n\nexport class BuildingSelected extends SelectionEvent {\n\n    building: BuildingEntity\n\n    constructor(building: BuildingEntity) {\n        super(EventKey.SELECTED_BUILDING)\n        this.building = building\n    }\n\n}\n\nexport class RaiderSelected extends SelectionEvent {\n\n    raider: Raider\n\n    constructor(raider: Raider) {\n        super(EventKey.SELECTED_RAIDER)\n        this.raider = raider\n    }\n\n}\n\nexport class VehicleSelected extends SelectionEvent {\n\n    vehicle: VehicleEntity\n\n    constructor(vehicle: VehicleEntity) {\n        super(EventKey.SELECTED_VEHICLE)\n        this.vehicle = vehicle\n    }\n\n}\n\nexport class EntityDeselected extends LocalEvent {\n\n    constructor() {\n        super(EventKey.DESELECTED_ENTITY)\n    }\n\n}\n\nexport class SurfaceChanged extends LocalEvent {\n\n    surface: Surface\n\n    constructor(surface: Surface) {\n        super(EventKey.SURFACE_CHANGED)\n        this.surface = surface\n    }\n\n}\n\nexport class AirLevelChanged extends LocalEvent {\n\n    constructor() {\n        super(EventKey.AIR_LEVEL_CHANGED)\n    }\n\n}\n\nexport class CancelBuildMode extends LocalEvent {\n\n    constructor() {\n        super(EventKey.CANCEL_BUILD_MODE)\n    }\n\n}\n","import { Box3, CanvasTexture, Matrix4, Mesh, MeshBasicMaterial, MeshPhongMaterial, Object3D, Sphere, SphereGeometry, Sprite, SpriteMaterial, Vector3 } from 'three'\nimport { AnimClip } from './AnimClip'\nimport { clearTimeoutSafe, iGet } from '../../../core/Util'\nimport { AnimationEntityType } from './AnimationEntityType'\nimport { BaseEntity } from '../BaseEntity'\nimport { AnimSubObj } from './AnimSubObj'\nimport { createContext } from '../../../core/ImageHelper'\nimport { BaseActivity } from '../activities/BaseActivity'\nimport { NATIVE_FRAMERATE, TILESIZE } from '../../../main'\nimport { EventBus } from '../../../event/EventBus'\nimport { EntityDeselected } from '../../../event/LocalEvents'\nimport { AnimEntityActivity } from '../activities/AnimEntityActivity'\n\nexport abstract class AnimEntity extends BaseEntity {\n\n    entityType: AnimationEntityType = null\n    poly: Object3D[] = []\n    animation: AnimClip = null\n    animationTimeout: NodeJS.Timeout = null\n    selectionFrame: Sprite = null\n    pickSphere: Mesh = null\n    pickSphereRadius: number = 10 / 2\n    carryJoint: Object3D = null\n    depositJoint: Object3D = null\n    getToolJoint: Object3D = null\n    activity: BaseActivity = null\n    radiusSq: number = 0\n\n    protected constructor(entityType: AnimationEntityType) {\n        super()\n        this.entityType = entityType\n    }\n\n    beamUp() {\n        // TODO avoid all further state changes and mark as unavailable here\n        // TODO publish event: check jobs with this target, update power state...\n        EventBus.publishEvent(new EntityDeselected())\n        this.changeActivity()\n        // TODO insert beam animation\n        AnimEntity.moveUp(this, 6 * TILESIZE)\n    }\n\n    private static moveUp(entity: AnimEntity, counter: number) {\n        if (counter > 0) {\n            counter--\n            entity.group.position.y += (TILESIZE / NATIVE_FRAMERATE) / 2\n            setTimeout(() => AnimEntity.moveUp(entity, counter), 1000 / NATIVE_FRAMERATE)\n        } else {\n            entity.removeFromScene()\n        }\n    }\n\n    changeActivity(activity: AnimEntityActivity = this.getDefaultActivity(), onAnimationDone = null, durationTimeMs: number = null) {\n        if (this.activity === activity) return\n        this.activity = activity\n        let lActivityKey = activity.activityKey.toLowerCase()\n        let anim = this.entityType.activities.get(lActivityKey)\n        if (!anim) { // find by prefix\n            this.entityType.activities.forEach((a, key) => {\n                if (!anim && lActivityKey.startsWith(key)) anim = a\n            })\n        }\n        if (!anim?.animation) {\n            console.warn('Activity ' + activity.activityKey + ' unknown or has no animation defined')\n            console.log(this.entityType.activities)\n            return\n        }\n        this.setAnimation(anim?.animation, onAnimationDone, durationTimeMs)\n    }\n\n    private setAnimation(animation: AnimClip, onAnimationDone = null, durationTimeMs = null) {\n        if (onAnimationDone) onAnimationDone.bind(this)\n        this.animation = animation\n        this.animation.looping = true\n        this.animationTimeout = clearTimeoutSafe(this.animationTimeout)\n        this.group.remove(...this.poly)\n        this.poly = []\n        const carries = (this.carryJoint && this.carryJoint.children) || []\n        this.carryJoint = null\n        // bodies are defined in animation and second in high/medium/low poly groups\n        this.animation.bodies.forEach((body) => {\n            let model: Object3D = iGet(this.entityType.highPoly, body.name)\n            if (!model) model = iGet(this.entityType.mediumPoly, body.name)\n            if (!model) model = body.model\n            const polyModel = model.clone(true)\n            this.poly.push(polyModel)\n            if (body.name) {\n                const lBodyName = body.name.toLowerCase()\n                if (lBodyName === this.entityType.carryNullName?.toLowerCase()) {\n                    this.carryJoint = polyModel\n                    if (carries.length > 0) this.carryJoint.add(...carries)\n                } else if (lBodyName === this.entityType.depositNullName?.toLowerCase()) {\n                    this.depositJoint = polyModel\n                } else if (lBodyName === this.entityType.toolNullName?.toLowerCase()) {\n                    this.getToolJoint = polyModel\n                }\n            }\n        })\n        this.animation.bodies.forEach((body, index) => { // not all bodies may have been added in first iteration\n            const polyPart = this.poly[index]\n            const parentInd = body.parentObjInd\n            if (parentInd !== undefined && parentInd !== null) { // can be 0\n                this.poly[parentInd].add(polyPart)\n            } else {\n                this.group.add(polyPart)\n            }\n        })\n        const sphere = new Sphere()\n        new Box3().setFromObject(this.group).getBoundingSphere(sphere)\n        this.radiusSq = sphere.radius * sphere.radius\n        this.animate(0, onAnimationDone, durationTimeMs)\n    }\n\n    private animate(frameIndex, onAnimationDone, durationTimeMs) {\n        if (this.poly.length !== this.animation.bodies.length) throw 'Cannot animate poly. Length differs from bodies length'\n        this.animation.bodies.forEach((body: AnimSubObj, index) => {\n            const p = this.poly[index]\n            p.position.copy(body.relPos[frameIndex])\n            p.rotation.copy(body.relRot[frameIndex])\n            p.scale.copy(body.relScale[frameIndex])\n            if (p.hasOwnProperty('material')) {\n                const material = p['material']\n                const opacity = body.opacity[frameIndex]\n                if (material && opacity !== undefined) {\n                    const matArr = Array.isArray(material) ? material : [material]\n                    matArr.forEach((mat: MeshPhongMaterial) => {\n                        mat.opacity = opacity\n                        mat.transparent = material.opacity < 1\n                    })\n                }\n            }\n        })\n        this.animationTimeout = clearTimeoutSafe(this.animationTimeout)\n        let nextFrame = frameIndex + 1\n        if (nextFrame <= this.animation.lastFrame || !onAnimationDone || (durationTimeMs !== null && durationTimeMs > 0)) {\n            if (nextFrame > this.animation.lastFrame) {\n                nextFrame = this.animation.firstFrame\n            }\n            const standardDurationTimeMs = 1000 / this.animation.framesPerSecond * this.animation.transcoef\n            if (durationTimeMs !== null) durationTimeMs -= standardDurationTimeMs\n            const that = this\n            const timeoutTimeMs = durationTimeMs !== null ? Math.max(0, Math.min(durationTimeMs, standardDurationTimeMs)) : standardDurationTimeMs\n            this.animationTimeout = setTimeout(() => that.animate(nextFrame, onAnimationDone, durationTimeMs), timeoutTimeMs) // TODO get this in sync with threejs\n        } else if (onAnimationDone) {\n            onAnimationDone()\n        }\n    }\n\n    getDefaultActivity(): AnimEntityActivity {\n        return AnimEntityActivity.Stand\n    }\n\n    createPickSphere() {\n        if (this.pickSphere) return\n        const pickSphereCenter = this.getPickSphereCenter()\n        const geometry = new SphereGeometry(this.pickSphereRadius, this.pickSphereRadius, this.pickSphereRadius)\n        const material = new MeshBasicMaterial({color: 0xffff00, visible: false}) // change visible to true for debugging\n        this.pickSphere = new Mesh(geometry, material)\n        this.pickSphere.userData = {selectable: this}\n        this.pickSphere.position.copy(pickSphereCenter)\n        this.group.add(this.pickSphere)\n        this.createSelectionFrame(pickSphereCenter)\n    }\n\n    getPickSphereCenter(): Vector3 {\n        return this.getBoundingBoxCenter()\n    }\n\n    getBoundingBoxCenter() {\n        const center = new Vector3()\n        new Box3().setFromObject(this.group).getCenter(center)\n        center.sub(this.group.position)\n        center.applyMatrix4(new Matrix4().makeScale(-1, 1, 1))\n        return center\n    }\n\n    private createSelectionFrame(pickSphereCenter: Vector3) {\n        const selectionFrameTextureSize = 128\n        const ctx = createContext(selectionFrameTextureSize, selectionFrameTextureSize)\n        ctx.fillStyle = '#0f0'\n        const strength = Math.round(25 / this.pickSphereRadius)\n        const length = selectionFrameTextureSize / 6\n        ctx.fillRect(0, 0, length, strength)\n        ctx.fillRect(0, 0, strength, length)\n        ctx.fillRect(selectionFrameTextureSize - length, 0, length, strength)\n        ctx.fillRect(selectionFrameTextureSize - strength, 0, strength, length)\n        ctx.fillRect(selectionFrameTextureSize - strength, selectionFrameTextureSize - length, strength, length)\n        ctx.fillRect(selectionFrameTextureSize - length, selectionFrameTextureSize - strength, length, strength)\n        ctx.fillRect(0, selectionFrameTextureSize - strength, length, strength)\n        ctx.fillRect(0, selectionFrameTextureSize - length, strength, length)\n        const selectionFrameTexture = new CanvasTexture(ctx.canvas)\n        const selectionMaterial = new SpriteMaterial({map: selectionFrameTexture, depthTest: false})\n        this.selectionFrame = new Sprite(selectionMaterial)\n        this.selectionFrame.position.copy(pickSphereCenter)\n        const selectionFrameSize = this.pickSphereRadius * 2\n        this.selectionFrame.scale.set(selectionFrameSize, selectionFrameSize, selectionFrameSize)\n        this.selectionFrame.visible = false\n        this.group.add(this.selectionFrame)\n    }\n\n}\n","import { BaseActivity } from './BaseActivity'\n\nexport class DynamiteActivity extends BaseActivity {\n\n    static Normal = new DynamiteActivity('Normal')\n    static TickDown = new DynamiteActivity('TickDown')\n\n}\n","import { ResourceManager } from '../../../resource/ResourceManager'\nimport { CollectableType } from './CollectableEntity'\nimport { Building } from '../../../game/model/entity/building/Building'\nimport { AnimEntity } from '../anim/AnimEntity'\nimport { Carryable } from './Carryable'\nimport { Surface } from '../map/Surface'\nimport { GameState } from '../../../game/model/GameState'\nimport { DynamiteActivity } from '../activities/DynamiteActivity'\nimport { AnimEntityActivity } from '../activities/AnimEntityActivity'\nimport { PathTarget } from '../PathTarget'\n\nexport class Dynamite extends AnimEntity implements Carryable {\n\n    targetSurface: Surface\n\n    constructor() {\n        super(ResourceManager.getAnimationEntityType('MiscAnims/Dynamite/Dynamite.ae'))\n        this.changeActivity()\n    }\n\n    get stats() {\n        return {}\n    }\n\n    hasTarget(): boolean {\n        return this.targetSurface && this.targetSurface.isExplodable() || GameState.hasOneBuildingOf(Building.TOOLSTATION)\n    }\n\n    getCarryTargets(): PathTarget[] {\n        if (this.targetSurface && this.targetSurface.isExplodable()) {\n            return this.targetSurface.getDigPositions().map((p) => new PathTarget(p))\n        } else {\n            return GameState.getBuildingsByType(Building.TOOLSTATION).map((b) => b.getDropPosition2D())\n                .map((p) => new PathTarget(p))\n        }\n    }\n\n    getCollectableType(): CollectableType {\n        return CollectableType.DYNAMITE\n    }\n\n    ignite() {\n        // TODO add as explosive and scare em all!\n        this.worldMgr.sceneManager.scene.add(this.group)\n        const center = this.targetSurface.getCenterWorld()\n        center.y = this.group.position.y\n        this.group.lookAt(center)\n        this.changeActivity(DynamiteActivity.TickDown, () => {\n            this.removeFromScene()\n            this.targetSurface.collapse()\n            // TODO add explosion animation\n            // TODO damage raider, vehicle, buildings\n        })\n    }\n\n    getDefaultActivity(): AnimEntityActivity {\n        return DynamiteActivity.Normal\n    }\n\n}\n","import { BuildingEntity } from '../../scene/model/BuildingEntity'\nimport { Building } from './entity/building/Building'\nimport { Selectable, SelectionType } from './Selectable'\nimport { Raider } from '../../scene/model/Raider'\nimport { VehicleEntity } from '../../scene/model/VehicleEntity'\nimport { CollectableEntity, CollectableType } from '../../scene/model/collect/CollectableEntity'\nimport { Vector3 } from 'three'\nimport { ADDITIONAL_RAIDER_PER_SUPPORT, MAX_RAIDER_BASE, TILESIZE } from '../../main'\nimport { Surface } from '../../scene/model/map/Surface'\nimport { BaseEntity } from '../../scene/model/BaseEntity'\nimport { EventBus } from '../../event/EventBus'\nimport { EntityDeselected } from '../../event/LocalEvents'\nimport { BuildingSite } from '../../scene/model/BuildingSite'\nimport { Dynamite } from '../../scene/model/collect/Dynamite'\nimport { Crystal } from '../../scene/model/collect/Crystal'\nimport { Ore } from '../../scene/model/collect/Ore'\nimport { LevelRewardConfig } from '../../cfg/LevelsCfg'\nimport { PriorityList } from './job/PriorityList'\nimport { SmallSpider } from './entity/monster/SmallSpider'\nimport { Bat } from './entity/monster/Bat'\nimport { RaiderSkill } from '../../scene/model/RaiderSkill'\nimport { MaterialAmountChanged } from '../../event/WorldEvents'\nimport { Barrier } from '../../scene/model/collect/Barrier'\n\nexport enum GameResultState {\n\n    RUNNING,\n    COMPLETE,\n    FAILED,\n\n}\n\nexport class GameState {\n\n    static resultState: GameResultState = GameResultState.RUNNING\n    static levelFullName: string = ''\n    static numCrystal: number = 0\n    static numOre: number = 0\n    static numBrick: number = 0\n    static usedCrystals: number = 0\n    static neededCrystals: number = 0\n    static airlevel: number = 1 // airlevel in percent from 0 to 1.0\n    static selectedEntities: Selectable[] = []\n    static selectionType: SelectionType = null\n    static buildings: BuildingEntity[] = []\n    static buildingsUndiscovered: BuildingEntity[] = []\n    static raiders: Raider[] = []\n    static raidersUndiscovered: Raider[] = []\n    static requestedRaiders: number = 0\n    static vehicles: VehicleEntity[] = []\n    static vehiclesUndiscovered: VehicleEntity[] = []\n    static collectables: CollectableEntity[] = []\n    static collectablesUndiscovered: CollectableEntity[] = []\n    static buildingSites: BuildingSite[] = []\n    static spiders: SmallSpider[] = []\n    static spidersBySurface: Map<Surface, SmallSpider[]> = new Map()\n    static bats: Bat[] = []\n    static totalCrystals: number = 0\n    static totalOres: number = 0\n    static totalDiggables: number = 0\n    static remainingDiggables: number = 0\n    static totalCaverns: number = 0\n    static discoveredCaverns: number = 0\n    static levelStartTime: number = 0\n    static levelStopTime: number = 0\n    static rewardConfig: LevelRewardConfig = null\n    static priorityList: PriorityList = null\n    static oxygenRate: number = 0\n    static buildModeSelection: Building = null\n\n    static reset() {\n        this.resultState = GameResultState.RUNNING\n        this.levelFullName = ''\n        this.numCrystal = 0\n        this.numOre = 0\n        this.numBrick = 0\n        this.usedCrystals = 0\n        this.neededCrystals = 0\n        this.airlevel = 1\n        this.selectedEntities = []\n        this.selectionType = null\n        this.buildings = []\n        this.buildingsUndiscovered = []\n        this.raiders = []\n        this.raidersUndiscovered = []\n        this.requestedRaiders = 0\n        this.vehicles = []\n        this.vehiclesUndiscovered = []\n        this.collectables = []\n        this.collectablesUndiscovered = []\n        this.buildingSites = []\n        this.spiders = []\n        this.spidersBySurface = new Map()\n        this.bats = []\n        this.totalCrystals = 0\n        this.totalOres = 0\n        this.totalDiggables = 0\n        this.remainingDiggables = 0\n        this.totalCaverns = 0\n        this.discoveredCaverns = 0\n        this.levelStartTime = 0\n        this.levelStopTime = 0\n        this.rewardConfig = null\n        this.priorityList = null\n        this.oxygenRate = 0\n        this.buildModeSelection = null\n    }\n\n    static getBuildingsByType(...buildingTypes: Building[]): BuildingEntity[] {\n        return this.buildings.filter(b => b.isPowered() && buildingTypes.some(bt => b.type === bt))\n    }\n\n    static getClosestBuildingByType(position: Vector3, ...buildingTypes: Building[]): BuildingEntity {\n        const targetBuildings = GameState.getBuildingsByType(...buildingTypes)\n        let closest = null, minDist = null\n        targetBuildings.forEach((b) => {\n            const bPos = b.getDropPosition()\n            const dist = position.distanceToSquared(bPos) // TODO better use pathfinding\n            if (closest === null || dist < minDist) {\n                closest = b\n                minDist = dist\n            }\n        })\n        return closest\n    }\n\n    static hasOneBuildingOf(...buildings: Building[]): boolean {\n        return this.buildings.some((b) => buildings.some((type) => b.type === type) && b.isPowered())\n    }\n\n    static hasBuildingWithUpgrades(building: Building, upgrades: number = 0): boolean {\n        return this.buildings.some((b) => b.type === building && b.level >= upgrades && b.isPowered())\n    }\n\n    static getTrainingSites(position: Vector3, training: RaiderSkill): BuildingEntity[] {\n        if (training === RaiderSkill.DEMOLITION) {\n            return this.buildings.filter((b) => {\n                return b.stats.TrainDynamite && b.stats.TrainDynamite[b.level]\n            })\n        }\n        return []\n    }\n\n    static selectEntities(entities: Selectable[]) {\n        this.selectedEntities = this.selectedEntities.filter((previouslySelected) => {\n            const stillSelected = entities.indexOf(previouslySelected) !== -1\n            if (!stillSelected) previouslySelected.deselect()\n            return stillSelected\n        })\n        // add new entities that are selectable\n        const selectionEvents = []\n        entities.forEach((freshlySelected) => {\n            const selectionEvent = freshlySelected.select()\n            if (selectionEvent) {\n                this.selectedEntities.push(freshlySelected)\n                selectionEvents.push(selectionEvent)\n            }\n        })\n        // determine and set next selection type\n        const len = this.selectedEntities.length\n        if (len > 1) {\n            this.selectionType = SelectionType.GROUP\n        } else if (len === 1) {\n            this.selectionType = this.selectedEntities[0].getSelectionType()\n        } else if (this.selectionType !== null) {\n            this.selectionType = null\n            EventBus.publishEvent(new EntityDeselected())\n        }\n        // AFTER updating selected entities and selection type, publish all events\n        selectionEvents.forEach((event) => EventBus.publishEvent(event))\n    }\n\n    static getMaxRaiders(): number {\n        return MAX_RAIDER_BASE + this.getBuildingsByType(Building.BARRACKS).length * ADDITIONAL_RAIDER_PER_SUPPORT\n    }\n\n    static discoverSurface(surface: Surface) {\n        const minX = surface.x * TILESIZE, minZ = surface.y * TILESIZE\n        const maxX = minX + TILESIZE, maxZ = minZ + TILESIZE\n        this.discoverEntities(this.raidersUndiscovered, minX, maxX, minZ, maxZ)\n        this.discoverEntities(this.buildingsUndiscovered, minX, maxX, minZ, maxZ)\n        this.discoverEntities(this.vehiclesUndiscovered, minX, maxX, minZ, maxZ)\n        this.discoverEntities(this.collectablesUndiscovered, minX, maxX, minZ, maxZ)\n    }\n\n    static discoverEntities(undiscovered: BaseEntity[], minX, maxX, minZ, maxZ) {\n        const discovered = []\n        undiscovered.forEach((e) => {\n            const pos = e.getPosition()\n            if (pos.x >= minX && pos.x < maxX && pos.z >= minZ && pos.z < maxZ) {\n                e.onDiscover()\n                discovered.push(e)\n            }\n        })\n        discovered.forEach((r) => undiscovered.remove(r))\n    }\n\n    static dropMaterial(type: CollectableType, quantity: number): CollectableEntity[] {\n        const result = []\n        if (type === CollectableType.DYNAMITE) {\n            for (let c = 0; c < quantity; c++) result.push(new Dynamite())\n        } else if (type === CollectableType.CRYSTAL) {\n            while (GameState.numCrystal > 0 && result.length < quantity) {\n                GameState.numCrystal--\n                result.push(new Crystal())\n            }\n        } else if (type === CollectableType.ORE) {\n            while (GameState.numOre > 0 && result.length < quantity) {\n                GameState.numOre--\n                result.push(new Ore())\n            }\n        } else if (type === CollectableType.BARRIER) {\n            for (let c = 0; c < quantity; c++) result.push(new Barrier())\n        } else {\n            console.error('Material drop not yet implemented: ' + type)\n        }\n        if (result.length > 0) EventBus.publishEvent(new MaterialAmountChanged(type))\n        return result\n    }\n\n    static get gameTimeSeconds() {\n        return Math.round((GameState.levelStopTime - GameState.levelStartTime) / 1000)\n    }\n\n    static get score() {\n        if (!GameState.rewardConfig) return 0\n        let quota = GameState.rewardConfig.quota\n        let importance = GameState.rewardConfig.importance\n        const scoreCrystals = GameState.numCrystal >= (quota.crystals || Infinity) ? importance.crystals : 0\n        const scoreTimer = GameState.gameTimeSeconds <= (quota.timer || 0) ? importance.timer : 0\n        const scoreCaverns = quota.caverns ? Math.min(1, GameState.discoveredCaverns / quota.caverns) * importance.caverns : 0\n        const scoreConstructions = quota.constructions ? Math.min(1, GameState.buildings.length / quota.constructions * importance.constructions) : 0\n        const scoreOxygen = GameState.airlevel * importance.oxygen\n        const scoreFigures = GameState.raiders.length >= MAX_RAIDER_BASE ? importance.figures : 0\n        return Math.round(scoreCrystals + scoreTimer + scoreCaverns + scoreConstructions + scoreOxygen + scoreFigures) / 100\n    }\n\n    static get selectedSurface(): Surface {\n        return this.selectionType === SelectionType.SURFACE && this.selectedEntities.length > 0 ? this.selectedEntities[0] as Surface : null\n    }\n\n    static get selectedBuilding(): BuildingEntity {\n        return this.selectionType === SelectionType.BUILDING && this.selectedEntities.length > 0 ? this.selectedEntities[0] as BuildingEntity : null\n    }\n\n    static get selectedRaiders(): Raider[] {\n        return (this.selectionType === SelectionType.PILOT || this.selectionType === SelectionType.GROUP) && this.selectedEntities.length > 0 ? this.selectedEntities as Raider[] : []\n    }\n\n    static get totalOre(): number {\n        return this.numOre + this.numBrick * 5\n    }\n\n    static getNearbySpiders(entity: BaseEntity): SmallSpider[] {\n        const terrain = entity.worldMgr.sceneManager.terrain\n        const currentSurface = terrain.getSurfaceFromWorld(entity.getPosition())\n        const nearbySpiders: SmallSpider[] = []\n        for (let x = currentSurface.x; x <= currentSurface.x + 1; x++) {\n            for (let y = currentSurface.y; y <= currentSurface.y + 1; y++) {\n                const surface = terrain.getSurface(x, y)\n                nearbySpiders.push(...(GameState.spidersBySurface.get(surface) || []))\n            }\n        }\n        return nearbySpiders\n    }\n\n}\n","import { LWOLoader } from '../../../resource/LWOLoader'\nimport { ResourceManager } from '../../../resource/ResourceManager'\nimport { AdditiveBlending, Color, Material, MeshPhongMaterial } from 'three'\nimport { CollectableEntity, CollectableType } from './CollectableEntity'\nimport { Building } from '../../../game/model/entity/building/Building'\nimport { SceneManager } from '../../SceneManager'\nimport { PriorityIdentifier } from '../../../game/model/job/PriorityIdentifier'\n\nexport class Crystal extends CollectableEntity {\n\n    constructor() {\n        super()\n        const resource2 = ResourceManager.getResource('MiscAnims/Crystal/vlp_greencrystal.lwo')\n        const mesh2 = SceneManager.registerMesh(new LWOLoader('MiscAnims/Crystal/').parse(resource2));\n        (mesh2.material as Material[]).forEach((mat: MeshPhongMaterial) => {\n            mat.blending = AdditiveBlending\n            mat.depthWrite = false // otherwise transparent parts \"carve out\" objects behind\n            mat.opacity = 0.5 // XXX read from LWO file?\n            mat.transparent = mat.opacity < 1\n        })\n        mesh2.scale.set(1.75, 1.75, 1.75) // XXX derive from texture scale?\n        this.group.add(mesh2)\n        const resource = ResourceManager.getResource('World/Shared/Crystal.lwo') // highpoly version\n        const mesh = SceneManager.registerMesh(new LWOLoader('World/Shared/').parse(resource));\n        (mesh.material as Material[]).forEach((mat: MeshPhongMaterial) => {\n            mat.emissive = new Color(0, 8, 0) // XXX read from LWO file?\n            mat.color = new Color(0, 0, 0) // XXX read from LWO file?\n            mat.opacity = 0.4 // XXX read from LWO file?\n            mat.transparent = mat.opacity < 1\n        })\n        this.group.add(mesh)\n    }\n\n    get stats() {\n        return ResourceManager.stats.PowerCrystal\n    }\n\n    getTargetBuildingTypes(): Building[] {\n        return [Building.POWER_STATION, Building.TOOLSTATION]\n    }\n\n    onDiscover() {\n        super.onDiscover()\n        console.log('An energy crystal has been discovered')\n    }\n\n    getCollectableType(): CollectableType {\n        return CollectableType.CRYSTAL\n    }\n\n    getPriorityIdentifier(): PriorityIdentifier {\n        return PriorityIdentifier.aiPriorityCrystal\n    }\n\n}\n","import { LWOLoader } from '../../../resource/LWOLoader'\nimport { ResourceManager } from '../../../resource/ResourceManager'\nimport { CollectableEntity, CollectableType } from './CollectableEntity'\nimport { Building } from '../../../game/model/entity/building/Building'\nimport { SceneManager } from '../../SceneManager'\nimport { PriorityIdentifier } from '../../../game/model/job/PriorityIdentifier'\n\nexport class Ore extends CollectableEntity {\n\n    constructor() {\n        super()\n        const resource = ResourceManager.getResource('MiscAnims/Ore/Ore1st.lwo')\n        const mesh = SceneManager.registerMesh(new LWOLoader('MiscAnims/Ore/').parse(resource))\n        this.group.add(mesh)\n    }\n\n    get stats() {\n        return ResourceManager.stats.Ore\n    }\n\n    getTargetBuildingTypes(): Building[] {\n        return [Building.ORE_REFINERY, Building.TOOLSTATION]\n    }\n\n    onDiscover() {\n        super.onDiscover()\n        console.log('Ore has been discovered')\n    }\n\n    getCollectableType(): CollectableType {\n        return CollectableType.ORE\n    }\n\n    getPriorityIdentifier(): PriorityIdentifier {\n        return PriorityIdentifier.aiPriorityOre\n    }\n\n}\n","export class RaiderSkill {\n\n    static DRIVER = new RaiderSkill('driver')\n    static ENGINEER = new RaiderSkill('engineer')\n    static GEOLOGIST = new RaiderSkill('geologist')\n    static PILOT = new RaiderSkill('pilot')\n    static SAILOR = new RaiderSkill('sailor')\n    static DEMOLITION = new RaiderSkill('demolition')\n\n    name: string\n\n    constructor(name: string) {\n        this.name = name\n    }\n\n}\n","import { AnimEntityActivity } from './AnimEntityActivity'\n\nexport class BarrierActivity extends AnimEntityActivity {\n\n    static Short = new AnimEntityActivity('Short')\n    static Expand = new AnimEntityActivity('Expand')\n    static Long = new AnimEntityActivity('Long')\n    static Teleport = new AnimEntityActivity('Teleport')\n\n}\n","import { ResourceManager } from '../../../resource/ResourceManager'\nimport { CollectableEntity, CollectableType } from './CollectableEntity'\nimport { PriorityIdentifier } from '../../../game/model/job/PriorityIdentifier'\nimport { AnimEntity } from '../anim/AnimEntity'\nimport { Carryable } from './Carryable'\nimport { BarrierActivity } from '../activities/BarrierActivity'\nimport { PathTarget } from '../PathTarget'\nimport { BuildingSite } from '../BuildingSite'\nimport { CollectPathTarget } from '../CollectionTarget'\nimport { Vector2 } from 'three'\n\nexport class Barrier extends AnimEntity implements Carryable {\n\n    targets: BarrierPathTarget[] = []\n    targetSite: BuildingSite = null\n\n    constructor() {\n        super(ResourceManager.getAnimationEntityType('MiscAnims/Barrier/Barrier.ae'))\n        this.changeActivity()\n    }\n\n    get stats() {\n        return null\n    }\n\n    getCollectableType(): CollectableType {\n        return CollectableType.BARRIER\n    }\n\n    getPriorityIdentifier(): PriorityIdentifier {\n        return PriorityIdentifier.aiPriorityConstruction\n    }\n\n    hasTarget(): boolean {\n        return this.targets.length > 0\n    }\n\n    getDefaultActivity(): BarrierActivity {\n        return BarrierActivity.Short\n    }\n\n    getCarryTargets(): PathTarget[] {\n        return this.targets\n    }\n\n    setTargetSite(site: BuildingSite) { // FIXME refactor this, somewhat used by carryable/collectable\n        this.targetSite = site\n    }\n\n}\n\nexport class BarrierPathTarget extends CollectPathTarget {\n\n    constructor(location: Vector2, site) {\n        super(location, site, null)\n    }\n\n    gatherItem(item: CollectableEntity) {\n        const barrier = item as any as Barrier // FIXME refactor this\n        barrier.targetSite.addItem(barrier as any as CollectableEntity) // FIXME refactor this\n        // FIXME set heading for barrier\n        barrier.changeActivity(BarrierActivity.Expand, () => {\n            barrier.changeActivity(BarrierActivity.Long)\n        })\n    }\n\n}\n","import { Group, Mesh, MeshPhongMaterial, Vector2, Vector3 } from 'three'\nimport { Terrain } from './Terrain'\nimport { SurfaceType } from './SurfaceType'\nimport { ResourceManager } from '../../../resource/ResourceManager'\nimport { Selectable, SelectionType } from '../../../game/model/Selectable'\nimport { EventBus } from '../../../event/EventBus'\nimport { SelectionEvent, SurfaceChanged, SurfaceSelectedEvent } from '../../../event/LocalEvents'\nimport { CavernDiscovered, JobCreateEvent, JobDeleteEvent, OreFoundEvent } from '../../../event/WorldEvents'\nimport { clearTimeoutSafe, getRandom, getRandomSign } from '../../../core/Util'\nimport { Crystal } from '../collect/Crystal'\nimport { Ore } from '../collect/Ore'\nimport { HEIGHT_MULTIPLER, TILESIZE } from '../../../main'\nimport { GameState } from '../../../game/model/GameState'\nimport { SurfaceJob } from '../../../game/model/job/surface/SurfaceJob'\nimport { LWSCLoader } from '../../../resource/LWSCLoader'\nimport { AnimSubObj } from '../anim/AnimSubObj'\nimport { SurfaceGeometry } from './SurfaceGeometry'\nimport { CrystalFoundEvent, LandslideEvent } from '../../../event/WorldLocationEvent'\nimport { JobType } from '../../../game/model/job/JobType'\nimport { EventKey } from '../../../event/EventKeyEnum'\nimport { BuildingEntity } from '../BuildingEntity'\nimport { ElectricFence } from '../collect/ElectricFence'\n\nexport class Surface implements Selectable {\n\n    terrain: Terrain\n    surfaceType: SurfaceType\n    x: number\n    y: number\n    containedOres: number = 0\n    containedCrystals: number = 0\n    heightOffset: number = null\n    discovered: boolean = false\n    selected: boolean = false\n    reinforced: boolean = false\n    jobs: SurfaceJob[] = []\n    surfaceRotation: number = 0\n    seamLevel: number = 0\n    fallinTimeout = null\n\n    fallinGrp: Group = null\n    animationTimeout = null\n\n    wallType: WALL_TYPE = null\n    mesh: Mesh = null\n    needsMeshUpdate: boolean = false\n\n    topLeftHeightOffset: number = 0\n    topRightHeightOffset: number = 0\n    bottomLeftHeightOffset: number = 0\n    bottomRightHeightOffset: number = 0\n\n    rubblePositions: Vector2[] = []\n\n    building: BuildingEntity = null\n    fence: ElectricFence = null\n    hasPower: boolean = false\n\n    constructor(terrain: Terrain, surfaceType: SurfaceType, x: number, y: number, heightOffset: number) {\n        this.terrain = terrain\n        this.surfaceType = surfaceType\n        if (surfaceType === SurfaceType.CRYSTAL_SEAM || surfaceType === SurfaceType.ORE_SEAM) this.seamLevel = 4\n        this.x = x\n        this.y = y\n        this.heightOffset = heightOffset\n        EventBus.registerEventListener(EventKey.JOB_CREATE, (event: JobCreateEvent) => {\n            const jobType = event.job.type\n            if (jobType === JobType.DRILL || jobType === JobType.REINFORCE || jobType === JobType.BLOW) {\n                const surfaceJob = event.job as SurfaceJob\n                if (surfaceJob.surface === this) this.jobs.push(surfaceJob)\n            }\n        })\n    }\n\n    hasJobType(type: JobType) {\n        return this.jobs.some((job) => job.type === type)\n    }\n\n    /**\n     * @return {boolean} Returns true, if a new cave has been discovered\n     */\n    discoverNeighbors(): boolean {\n        if (!this.discovered) GameState.discoverSurface(this)\n        this.discovered = true\n        this.needsMeshUpdate = true\n        let foundCave = false\n        if (this.surfaceType.floor) {\n            for (let x = this.x - 1; x <= this.x + 1; x++) {\n                for (let y = this.y - 1; y <= this.y + 1; y++) {\n                    if (x !== this.x || y !== this.y) {\n                        const surf = this.terrain.getSurfaceOrNull(x, y)\n                        if (surf && !surf.discovered) {\n                            foundCave = surf.discoverNeighbors() || surf.surfaceType.floor\n                            surf.needsMeshUpdate = true\n                        }\n                    }\n                }\n            }\n        }\n        return foundCave\n    }\n\n    collapse() {\n        this.cancelJobs()\n        this.fallinTimeout = clearTimeoutSafe(this.fallinTimeout)\n        this.surfaceType = SurfaceType.RUBBLE4\n        this.rubblePositions = [this.getRandomPosition(), this.getRandomPosition(), this.getRandomPosition(), this.getRandomPosition()]\n        this.containedOres += 4\n        this.needsMeshUpdate = true\n        // discover surface and all neighbors\n        const foundCave = this.discoverNeighbors()\n        if (foundCave) EventBus.publishEvent(new CavernDiscovered())\n        // drop contained ores and crystals\n        this.dropContainedOre(this.containedOres - 4)\n        for (let c = 0; c < this.containedCrystals; c++) {\n            const crystal = this.terrain.worldMgr.addCollectable(new Crystal(), this.getRandomPosition())\n            EventBus.publishEvent(new CrystalFoundEvent(crystal.getPosition()))\n        }\n        // check for unsupported neighbors\n        for (let x = this.x - 1; x <= this.x + 1; x++) {\n            for (let y = this.y - 1; y <= this.y + 1; y++) {\n                if (x !== this.x || y !== this.y) {\n                    const surf = this.terrain.getSurface(x, y)\n                    surf.needsMeshUpdate = true\n                    if (!surf.isSupported()) surf.collapse()\n                }\n            }\n        }\n        // update meshes\n        this.terrain.updateSurfaceMeshes()\n        this.terrain.floorGroup.updateWorldMatrix(true, true)\n    }\n\n    private dropContainedOre(dropAmount: number) {\n        for (let c = 0; c < dropAmount && this.containedOres > 0; c++) {\n            this.containedOres--\n            this.terrain.worldMgr.addCollectable(new Ore(), this.getRandomPosition())\n            EventBus.publishEvent(new OreFoundEvent())\n        }\n    }\n\n    getRandomPosition(): Vector2 {\n        return new Vector2(this.x * TILESIZE + TILESIZE / 2 + getRandomSign() * getRandom(TILESIZE / 4),\n            this.y * TILESIZE + TILESIZE / 2 + getRandomSign() * getRandom(TILESIZE / 4))\n    }\n\n    cancelJobs() {\n        const jobs = this.jobs // ensure consistency while processing\n        this.jobs = []\n        jobs.forEach((job) => EventBus.publishEvent(new JobDeleteEvent(job)))\n        this.updateJobColor()\n    }\n\n    reduceRubble() {\n        this.rubblePositions.shift()\n        if (this.surfaceType === SurfaceType.RUBBLE4) this.surfaceType = SurfaceType.RUBBLE3\n        else if (this.surfaceType === SurfaceType.RUBBLE3) this.surfaceType = SurfaceType.RUBBLE2\n        else if (this.surfaceType === SurfaceType.RUBBLE2) this.surfaceType = SurfaceType.RUBBLE1\n        else if (this.surfaceType === SurfaceType.RUBBLE1) this.surfaceType = SurfaceType.GROUND\n        this.dropContainedOre(this.containedOres - this.rubblePositions.length)\n        this.updateTexture()\n        EventBus.publishEvent(new SurfaceChanged(this))\n    }\n\n    isSupported(): boolean {\n        if (this.surfaceType.floor) return true\n        const surfLeft = this.terrain.getSurface(this.x - 1, this.y)\n        const surfTopLeft = this.terrain.getSurface(this.x - 1, this.y - 1)\n        const surfTop = this.terrain.getSurface(this.x, this.y - 1)\n        const surfTopRight = this.terrain.getSurface(this.x + 1, this.y - 1)\n        const surfRight = this.terrain.getSurface(this.x + 1, this.y)\n        const surfBottomRight = this.terrain.getSurface(this.x + 1, this.y + 1)\n        const surfBottom = this.terrain.getSurface(this.x, this.y + 1)\n        const surfBottomLeft = this.terrain.getSurface(this.x - 1, this.y + 1)\n\n        function isHighGround(surf1: Surface, surf2: Surface, surf3: Surface) {\n            return !surf1.discovered || !surf2.discovered || !surf3.discovered ||\n                (!surf1.surfaceType.floor && !surf2.surfaceType.floor && !surf3.surfaceType.floor)\n        }\n\n        return isHighGround(surfLeft, surfTopLeft, surfTop)\n            || isHighGround(surfTop, surfTopRight, surfRight)\n            || isHighGround(surfRight, surfBottomRight, surfBottom)\n            || isHighGround(surfBottom, surfBottomLeft, surfLeft)\n    }\n\n    updateMesh(force: boolean = true) {\n        if (!force && !this.needsMeshUpdate) return\n        this.needsMeshUpdate = false\n\n        const topLeftVertex = new Vector3(this.x, 0, this.y)\n        const topRightVertex = new Vector3(this.x + 1, 0, this.y)\n        const bottomLeftVertex = new Vector3(this.x, 0, this.y + 1)\n        const bottomRightVertex = new Vector3(this.x + 1, 0, this.y + 1)\n\n        const surfLeft = this.terrain.getSurface(this.x - 1, this.y)\n        const surfTopLeft = this.terrain.getSurface(this.x - 1, this.y - 1)\n        const surfTop = this.terrain.getSurface(this.x, this.y - 1)\n        const surfTopRight = this.terrain.getSurface(this.x + 1, this.y - 1)\n        const surfRight = this.terrain.getSurface(this.x + 1, this.y)\n        const surfBottomRight = this.terrain.getSurface(this.x + 1, this.y + 1)\n        const surfBottom = this.terrain.getSurface(this.x, this.y + 1)\n        const surfBottomLeft = this.terrain.getSurface(this.x - 1, this.y + 1)\n\n        function isHighGround(surf1: Surface, surf2: Surface, surf3: Surface) {\n            return !surf1.discovered || !surf2.discovered || !surf3.discovered ||\n                (!surf1.surfaceType.floor && !surf2.surfaceType.floor && !surf3.surfaceType.floor)\n        }\n\n        if (!this.discovered) {\n            topLeftVertex.y = 1\n            topRightVertex.y = 1\n            bottomRightVertex.y = 1\n            bottomLeftVertex.y = 1\n        } else if (!this.surfaceType.floor) {\n            if (isHighGround(surfLeft, surfTopLeft, surfTop)) topLeftVertex.y = 1\n            if (isHighGround(surfTop, surfTopRight, surfRight)) topRightVertex.y = 1\n            if (isHighGround(surfRight, surfBottomRight, surfBottom)) bottomRightVertex.y = 1\n            if (isHighGround(surfBottom, surfBottomLeft, surfLeft)) bottomLeftVertex.y = 1\n        }\n\n        // update mesh (geometry), if wall type changed\n        let wallType = topLeftVertex.y + topRightVertex.y + bottomRightVertex.y + bottomLeftVertex.y\n        if (wallType === WALL_TYPE.WALL && topLeftVertex.y === bottomRightVertex.y) wallType = WALL_TYPE.WEIRD_CREVICE\n\n        if (this.wallType !== wallType) {\n            this.wallType = wallType\n            this.updateGeometry(topLeftVertex, bottomRightVertex, topRightVertex, bottomLeftVertex, surfTopLeft, surfTop, surfLeft, surfTopRight, surfRight, surfBottomRight, surfBottom, surfBottomLeft)\n            if (this.wallType !== WALL_TYPE.WALL) this.cancelReinforceJobs()\n        }\n\n        this.updateTexture()\n        this.updateJobColor()\n        this.terrain.graphWalk.grid[this.x][this.y].weight = this.getGraphWalkWeight()\n    }\n\n    cancelReinforceJobs() {\n        const otherJobs = []\n        this.jobs.forEach((job) => {\n            if (job.type === JobType.REINFORCE) {\n                EventBus.publishEvent(new JobDeleteEvent(job))\n            } else {\n                otherJobs.push(job)\n            }\n        })\n        this.jobs = otherJobs\n        this.updateJobColor()\n    }\n\n    updateTexture() {\n        let textureName = this.terrain.textureSet.texturebasename\n        if (!this.discovered) {\n            textureName += '70'\n        } else if (this.surfaceType === SurfaceType.POWER_PATH) {\n            textureName += this.updatePowerPathTexture()\n        } else if (!this.surfaceType.shaping) {\n            if (this.surfaceType === SurfaceType.POWER_PATH_BUILDING && this.hasPower) {\n                textureName += '66'\n            } else {\n                textureName += this.surfaceType.matIndex.toString()\n            }\n        } else if (this.wallType === WALL_TYPE.WEIRD_CREVICE) {\n            textureName += '77'\n        } else {\n            if (this.wallType === WALL_TYPE.CORNER) {\n                textureName += '5'\n            } else if (this.wallType === WALL_TYPE.INVERTED_CORNER) {\n                textureName += '3'\n            } else if (this.reinforced) {\n                textureName += '2'\n            } else {\n                textureName += '0'\n            }\n            textureName += this.surfaceType.matIndex\n        }\n        textureName += '.bmp'\n\n        const texture = ResourceManager.getTexture(textureName)\n        texture.center.set(0.5, 0.5)\n        texture.rotation = this.surfaceRotation\n\n        this.accessMaterials().forEach((mat) => mat.map = texture)\n    }\n\n    private updatePowerPathTexture(): string {\n        this.surfaceRotation = 0\n        const left = this.terrain.getSurface(this.x - 1, this.y).isPath()\n        const top = this.terrain.getSurface(this.x, this.y - 1).isPath()\n        const right = this.terrain.getSurface(this.x + 1, this.y).isPath()\n        const bottom = this.terrain.getSurface(this.x, this.y + 1).isPath()\n        const pathSum = (left ? 1 : 0) + (top ? 1 : 0) + (right ? 1 : 0) + (bottom ? 1 : 0)\n        if (pathSum === 0 || pathSum === 1) {\n            if (left) this.surfaceRotation = -Math.PI / 2\n            if (top) this.surfaceRotation = Math.PI\n            if (right) this.surfaceRotation = Math.PI / 2\n            return this.hasPower ? '75' : '65'\n        } else if (pathSum === 2) {\n            if (left === right) {\n                this.surfaceRotation = left ? Math.PI / 2 : 0\n                return this.hasPower ? '72' : '62'\n            } else {\n                if (left && bottom) this.surfaceRotation = -Math.PI / 2\n                if (left && top) this.surfaceRotation = Math.PI\n                if (top && right) this.surfaceRotation = Math.PI / 2\n                return this.hasPower ? '73' : '63'\n            }\n        } else if (pathSum === 3) {\n            if (!top) this.surfaceRotation = -Math.PI / 2\n            if (!right) this.surfaceRotation = Math.PI\n            if (!bottom) this.surfaceRotation = Math.PI / 2\n            return this.hasPower ? '74' : '64'\n        } else {\n            return this.hasPower ? '71' : '60'\n        }\n    }\n\n    accessMaterials(): MeshPhongMaterial[] {\n        if (!this.mesh || !this.mesh.material) return []\n        if (Array.isArray(this.mesh.material)) {\n            return this.mesh.material as MeshPhongMaterial[]\n        } else {\n            return [this.mesh.material as MeshPhongMaterial]\n        }\n    }\n\n    updateGeometry(topLeftVertex: Vector3, bottomRightVertex: Vector3, topRightVertex: Vector3, bottomLeftVertex: Vector3, surfTopLeft: Surface, surfTop: Surface, surfLeft: Surface, surfTopRight: Surface, surfRight: Surface, surfBottomRight: Surface, surfBottom: Surface, surfBottomLeft: Surface) {\n        if (this.mesh) this.terrain.floorGroup.remove(this.mesh)\n        this.mesh?.geometry?.dispose()\n\n        function avgHeight(...args: Surface[]) {\n            let sum = 0, cnt = 0\n            args.map(s => s.heightOffset).filter(Boolean).forEach(h => {\n                sum += h\n                cnt++\n            })\n            return sum / cnt\n        }\n\n        this.topLeftHeightOffset = avgHeight(surfTopLeft, surfTop, this, surfLeft) * HEIGHT_MULTIPLER\n        this.topRightHeightOffset = avgHeight(surfTop, surfTopRight, surfRight, this) * HEIGHT_MULTIPLER\n        this.bottomRightHeightOffset = avgHeight(this, surfRight, surfBottomRight, surfBottom) * HEIGHT_MULTIPLER\n        this.bottomLeftHeightOffset = avgHeight(surfLeft, this, surfBottom, surfBottomLeft) * HEIGHT_MULTIPLER\n        const geometry = SurfaceGeometry.create(this.wallType, topLeftVertex, bottomRightVertex, topRightVertex, bottomLeftVertex,\n            topLeftVertex.y + this.topLeftHeightOffset,\n            topRightVertex.y + this.topRightHeightOffset,\n            bottomRightVertex.y + this.bottomRightHeightOffset,\n            bottomLeftVertex.y + this.bottomLeftHeightOffset,\n        )\n\n        this.mesh = new Mesh(geometry, new MeshPhongMaterial({shininess: 0}))\n        this.mesh.userData = {selectable: this}\n\n        this.terrain.floorGroup.add(this.mesh)\n        this.terrain.floorGroup.updateWorldMatrix(true, true) // otherwise ray intersection is not working before rendering\n    }\n\n    getSelectionType(): SelectionType {\n        return SelectionType.SURFACE\n    }\n\n    select(): SelectionEvent {\n        if (this.surfaceType.selectable && (this.wallType !== WALL_TYPE.INVERTED_CORNER && this.wallType !== WALL_TYPE.WEIRD_CREVICE) && !this.selected) {\n            this.selected = true\n            this.accessMaterials().forEach((mat) => mat.color.setHex(0x6060a0))\n            return new SurfaceSelectedEvent(this)\n        }\n        return null\n    }\n\n    deselect(): any {\n        if (this.selected) {\n            this.selected = false\n            this.updateJobColor()\n        }\n    }\n\n    getSelectionCenter(): Vector3 {\n        return null // not used\n    }\n\n    updateJobColor() {\n        const sortedJobs = this.jobs.sort((l, r) => -l.colorPriority + r.colorPriority)\n        const color = sortedJobs[0]?.color || 0xffffff\n        this.accessMaterials().forEach((mat) => mat.color.setHex(color))\n    }\n\n    hasRubble(): boolean {\n        return this.rubblePositions.length > 0\n    }\n\n    isPath(): boolean {\n        return this.surfaceType === SurfaceType.POWER_PATH || this.surfaceType === SurfaceType.POWER_PATH_BUILDING\n    }\n\n    isWalkable(): boolean {\n        return this.surfaceType.floor && this.discovered && this.surfaceType !== SurfaceType.LAVA && this.surfaceType !== SurfaceType.WATER && !this.building?.type.blocksPathSurface\n    }\n\n    isDrillable(): boolean {\n        return this.surfaceType.drillable && this.discovered && (this.wallType === WALL_TYPE.WALL || this.wallType === WALL_TYPE.CORNER)\n    }\n\n    isDrillableHard(): boolean {\n        return this.surfaceType.drillableHard && this.discovered && (this.wallType === WALL_TYPE.WALL || this.wallType === WALL_TYPE.CORNER)\n    }\n\n    isReinforcable(): boolean {\n        return this.surfaceType.reinforcable && this.discovered && this.wallType === WALL_TYPE.WALL && !this.reinforced\n    }\n\n    isExplodable(): boolean {\n        return this.surfaceType.explodable && this.discovered && (this.wallType === WALL_TYPE.WALL || this.wallType === WALL_TYPE.CORNER)\n    }\n\n    isDigable(): boolean {\n        return this.isDrillable() || this.isExplodable()\n    }\n\n    getDigPositions(): Vector2[] {\n        const digPosition = []\n        if (this.terrain.getSurface(this.x - 1, this.y).isWalkable()) digPosition.push(new Vector2(this.x * TILESIZE - 1, this.y * TILESIZE + TILESIZE / 2))\n        if (this.terrain.getSurface(this.x, this.y - 1).isWalkable()) digPosition.push(new Vector2(this.x * TILESIZE + TILESIZE / 2, this.y * TILESIZE - 1))\n        if (this.terrain.getSurface(this.x + 1, this.y).isWalkable()) digPosition.push(new Vector2(this.x * TILESIZE + TILESIZE + 1, this.y * TILESIZE + TILESIZE / 2))\n        if (this.terrain.getSurface(this.x, this.y + 1).isWalkable()) digPosition.push(new Vector2(this.x * TILESIZE + TILESIZE / 2, this.y * TILESIZE + TILESIZE + 1))\n        return digPosition\n    }\n\n    reinforce() {\n        this.reinforced = true\n        this.cancelReinforceJobs()\n        this.fallinTimeout = clearTimeoutSafe(this.fallinTimeout)\n        this.updateTexture()\n    }\n\n    getCenterWorld2D(): Vector2 {\n        return new Vector2(this.x * TILESIZE + TILESIZE / 2, this.y * TILESIZE + TILESIZE / 2)\n    }\n\n    getCenterWorld(): Vector3 {\n        const center = this.getCenterWorld2D()\n        return new Vector3(center.x, this.terrain.worldMgr.getTerrainHeight(center.x, center.y), center.y)\n    }\n\n    setFallinLevel(fallinLevel: number) {\n        if (fallinLevel < 1) return\n        let originPos\n        let targetPos\n        if (this.surfaceType.floor) {\n            originPos = this.terrain.findFallInOrigin(this.x, this.y)\n            targetPos = [this.x, this.y]\n        } else {\n            originPos = [this.x, this.y]\n            targetPos = this.terrain.findFallInTarget(this.x, this.y)\n        }\n        if (originPos && targetPos) {\n            this.terrain.getSurface(originPos[0], originPos[1]).scheduleFallin(targetPos[0], targetPos[1])\n        }\n    }\n\n    scheduleFallin(targetX: number, targetY: number) {\n        this.fallinTimeout = setTimeout(() => {\n            this.createFallin(targetX, targetY)\n            this.scheduleFallin(targetX, targetY)\n        }, (30 + getRandom(60)) * 1000) // TODO adapt timer to level multiplier and fallin value\n    }\n\n    createFallin(targetX: number, targetY: number) {\n        const fallinPosition = this.terrain.getSurface(targetX, targetY).getCenterWorld()\n        EventBus.publishEvent(new LandslideEvent(fallinPosition))\n\n        // TODO refactor mesh and animation handling\n        const content = ResourceManager.getResource('MiscAnims/RockFall/Rock3Sides.lws')\n        const animation = new LWSCLoader('MiscAnims/RockFall/').parse(content)\n        this.fallinGrp = new Group()\n        this.fallinGrp.position.copy(fallinPosition)\n        const dx = this.x - targetX, dy = targetY - this.y\n        this.fallinGrp.rotateOnAxis(new Vector3(0, 1, 0), Math.atan2(dy, dx) + Math.PI / 2)\n        this.terrain.worldMgr.sceneManager.scene.add(this.fallinGrp)\n        const poly = []\n        animation.bodies.forEach((body) => {\n            const polyModel = body.model.clone(true)\n            poly.push(polyModel)\n        })\n        animation.bodies.forEach((body, index) => { // not all bodies may have been added in first iteration\n            const polyPart = poly[index]\n            const parentInd = body.parentObjInd\n            if (parentInd !== undefined && parentInd !== null) { // can be 0\n                poly[parentInd].add(polyPart)\n            } else {\n                this.fallinGrp.add(polyPart)\n            }\n        })\n        this.animate(poly, animation, 0)\n\n        this.terrain.getSurface(targetX, targetY).makeRubble()\n    }\n\n    animate(poly, animation, frameIndex) {\n        if (poly.length !== animation.bodies.length) throw 'Cannot animate poly. Length differs from bodies length'\n        animation.bodies.forEach((body: AnimSubObj, index) => {\n            const p = poly[index]\n            p.position.copy(body.relPos[frameIndex])\n            p.rotation.copy(body.relRot[frameIndex])\n            p.scale.copy(body.relScale[frameIndex])\n            if (p.hasOwnProperty('material')) {\n                const material = p['material']\n                const opacity = body.opacity[frameIndex]\n                if (material && opacity !== undefined) {\n                    const matArr = Array.isArray(material) ? material : [material]\n                    matArr.forEach((mat: MeshPhongMaterial) => {\n                        mat.opacity = opacity\n                        mat.transparent = material.opacity < 1\n                    })\n                }\n            }\n        })\n        this.animationTimeout = null\n        if (!(frameIndex + 1 > animation.lastFrame) || animation.looping) {\n            let nextFrame = frameIndex + 1\n            if (nextFrame > animation.lastFrame) {\n                nextFrame = animation.firstFrame\n            }\n            const that = this\n            this.animationTimeout = setTimeout(() => that.animate(poly, animation, nextFrame), 1000 / animation.framesPerSecond * animation.transcoef)\n        } else {\n            this.terrain.worldMgr.sceneManager.scene.remove(this.fallinGrp)\n            this.fallinGrp = null\n        }\n    }\n\n    dispose() {\n        this.accessMaterials().forEach(m => m.dispose())\n        this.mesh?.geometry?.dispose()\n    }\n\n    getFloorHeight(worldX: number, worldZ: number) {\n        const sx = worldX / TILESIZE - this.x\n        const sy = worldZ / TILESIZE - this.y\n        const dy0 = Surface.interpolate(this.topLeftHeightOffset, this.topRightHeightOffset, sx)\n        const dy1 = Surface.interpolate(this.bottomLeftHeightOffset, this.bottomRightHeightOffset, sx)\n        return Surface.interpolate(dy0, dy1, sy) * TILESIZE\n    }\n\n    private static interpolate(y0: number, y1: number, x: number): number {\n        return y0 + x * (y1 - y0)\n    }\n\n    get neighbors(): Surface[] {\n        return [this.terrain.getSurface(this.x - 1, this.y), this.terrain.getSurface(this.x, this.y - 1),\n            this.terrain.getSurface(this.x + 1, this.y), this.terrain.getSurface(this.x, this.y + 1)]\n    }\n\n    makeRubble(containedOre: number = 0) {\n        this.rubblePositions = [this.getRandomPosition(), this.getRandomPosition(), this.getRandomPosition(), this.getRandomPosition()]\n        this.containedOres += containedOre\n        this.surfaceType = SurfaceType.RUBBLE4\n        this.updateTexture()\n    }\n\n    setBuilding(building: BuildingEntity) {\n        this.building = building\n        this.terrain.graphWalk.grid[this.x][this.y].weight = this.getGraphWalkWeight()\n        this.terrain.resetGraphWalk()\n    }\n\n    getGraphWalkWeight(): number {\n        return this.isWalkable() ? this.hasRubble() ? 4 : 1 : 0\n    }\n\n    setHasPower(state: boolean, recursive: boolean) {\n        if (this.hasPower === state) return\n        this.hasPower = state\n        this.updateTexture()\n        if (recursive) this.neighbors.forEach((n) => n.isPath() && n.setHasPower(state, recursive))\n    }\n\n    canPlaceFence(): boolean { // TODO performance this can be cached\n        return (this.surfaceType === SurfaceType.GROUND || this.isPath()) && !this.building && !this.fence &&\n            [1, 2].some((n) => {\n                return !!this.terrain.getSurface(this.x - n, this.y).building ||\n                    !!this.terrain.getSurface(this.x, this.y - n).building ||\n                    !!this.terrain.getSurface(this.x + n, this.y).building ||\n                    !!this.terrain.getSurface(this.x, this.y + n).building ||\n                    !!this.terrain.getSurface(this.x - n, this.y).fence ||\n                    !!this.terrain.getSurface(this.x, this.y - n).fence ||\n                    !!this.terrain.getSurface(this.x + n, this.y).fence ||\n                    !!this.terrain.getSurface(this.x, this.y + n).fence\n            })\n    }\n\n}\n\nexport enum WALL_TYPE {\n\n    CORNER = 1,\n    WALL = 2,\n    INVERTED_CORNER = 3,\n    WEIRD_CREVICE = 20,\n\n}\n","export class SurfaceType {\n\n    name: string // humand readable, maybe used as label lateron\n    shaping: boolean = false\n    matIndex: string = '00'\n    floor: boolean = false\n    selectable: boolean = false\n    drillable: boolean = false\n    drillableHard: boolean = false\n    explodable: boolean = false\n    reinforcable: boolean = false\n\n    constructor(options: Partial<SurfaceType> = {}) {\n        Object.assign(this, options)\n    }\n\n    static readonly GROUND = new SurfaceType({name: 'ground', floor: true, selectable: true})\n    static readonly SOLID_ROCK = new SurfaceType({name: 'solid rock', shaping: true, matIndex: '5'})\n    static readonly HARD_ROCK = new SurfaceType({\n        name: 'hard rock',\n        shaping: true,\n        matIndex: '4',\n        selectable: true,\n        drillableHard: true,\n        explodable: true,\n        reinforcable: true,\n    })\n    static readonly LOOSE_ROCK = new SurfaceType({\n        name: 'loose rock',\n        shaping: true,\n        matIndex: '3',\n        selectable: true,\n        drillable: true,\n        drillableHard: true,\n        explodable: true,\n        reinforcable: true,\n    })\n    static readonly DIRT = new SurfaceType({\n        name: 'dirt',\n        shaping: true,\n        matIndex: '1',\n        selectable: true,\n        drillable: true,\n        drillableHard: true,\n        explodable: true,\n        reinforcable: true,\n    })\n    static readonly SLUG_HOLE = new SurfaceType({name: 'slug hole', floor: true, matIndex: '30'})\n    static readonly LAVA = new SurfaceType({name: 'lava', floor: true, matIndex: '46'})\n    static readonly ORE_SEAM = new SurfaceType({\n        name: 'ore seam',\n        matIndex: '40',\n        selectable: true,\n        drillable: true,\n        drillableHard: true,\n        explodable: true,\n        reinforcable: true,\n    })\n    static readonly WATER = new SurfaceType({name: 'water', floor: true, matIndex: '45'})\n    static readonly CRYSTAL_SEAM = new SurfaceType({\n        name: 'energy crystal seam',\n        matIndex: '20',\n        selectable: true,\n        drillable: true,\n        drillableHard: true,\n        explodable: true,\n        reinforcable: true,\n    })\n    static readonly RECHARGE_SEAM = new SurfaceType({name: 'recharge seam', matIndex: '67'})\n    static readonly POWER_PATH = new SurfaceType({\n        name: 'power path all',\n        floor: true,\n        matIndex: '60',\n        selectable: true,\n    })\n    static readonly POWER_PATH_SITE = new SurfaceType({\n        name: 'power path site',\n        floor: true,\n        matIndex: '61',\n        selectable: true,\n    })\n    static readonly POWER_PATH_BUILDING = new SurfaceType({name: 'power path', floor: true, matIndex: '76'})\n    static readonly RUBBLE1 = new SurfaceType({\n        name: 'rubble 1',\n        floor: true,\n        matIndex: '13',\n        selectable: true,\n    })\n    static readonly RUBBLE2 = new SurfaceType({\n        name: 'rubble 2',\n        floor: true,\n        matIndex: '12',\n        selectable: true,\n    })\n    static readonly RUBBLE3 = new SurfaceType({\n        name: 'rubble 3',\n        floor: true,\n        matIndex: '11',\n        selectable: true,\n    })\n    static readonly RUBBLE4 = new SurfaceType({\n        name: 'rubble 4',\n        floor: true,\n        matIndex: '10',\n        selectable: true,\n    })\n\n    static getByNum(typeNum: number) {\n        switch (typeNum) {\n            case 0:\n                return SurfaceType.POWER_PATH_BUILDING\n            case 1:\n                return SurfaceType.SOLID_ROCK\n            case 2:\n                return SurfaceType.HARD_ROCK\n            case 3:\n                return SurfaceType.LOOSE_ROCK\n            case 4:\n            case 5: // soil(5) was removed pre-release, so replace it with dirt(4)\n                return SurfaceType.DIRT\n            case 6:\n                return SurfaceType.LAVA\n            case 8:\n                return SurfaceType.ORE_SEAM\n            case 9:\n                return SurfaceType.WATER\n            case 10:\n                return SurfaceType.CRYSTAL_SEAM\n            case 11:\n                return SurfaceType.RECHARGE_SEAM\n            case 30:\n            case 40:\n                return SurfaceType.SLUG_HOLE\n            case 100:\n                return SurfaceType.RUBBLE4\n            case 101:\n                return SurfaceType.RUBBLE3\n            case 102:\n                return SurfaceType.RUBBLE2\n            case 103:\n                return SurfaceType.RUBBLE1\n            default:\n                console.error('Unexpected surface type num: ' + typeNum)\n                return SurfaceType.SOLID_ROCK\n        }\n    }\n}\n","import { WorldEvent } from './WorldEvents'\nimport { Vector3 } from 'three'\nimport { EventKey } from './EventKeyEnum'\n\nexport class WorldLocationEvent extends WorldEvent {\n\n    location: Vector3\n\n    constructor(entityKey: EventKey, location: Vector3) {\n        super(entityKey)\n        this.location = location\n    }\n\n}\n\nexport class GenericDeathEvent extends WorldLocationEvent {\n\n    constructor(location: Vector3) {\n        super(EventKey.LOCATION_DEATH, location)\n    }\n\n}\n\nexport class GenericMonsterEvent extends WorldLocationEvent {\n\n    constructor(location: Vector3) {\n        super(EventKey.LOCATION_MONSTER, location)\n    }\n\n}\n\nexport class CrystalFoundEvent extends WorldLocationEvent {\n\n    constructor(location: Vector3) {\n        super(EventKey.LOCATION_CRYSTAL_FOUND, location)\n    }\n\n}\n\nexport class UnderAttackEvent extends WorldLocationEvent {\n\n    constructor(location: Vector3) {\n        super(EventKey.LOCATION_UNDER_ATTACK, location)\n    }\n\n}\n\nexport class LandslideEvent extends WorldLocationEvent {\n\n    constructor(location: Vector3) {\n        super(EventKey.LOCATION_LANDSLIDE, location)\n    }\n\n}\n\nexport class PowerDrainEvent extends WorldLocationEvent {\n\n    constructor(location: Vector3) {\n        super(EventKey.LOCATION_POWER_DRAIN, location)\n    }\n\n}\n\nexport class SlugEmergeEvent extends WorldLocationEvent {\n\n    constructor(location: Vector3) {\n        super(EventKey.LOCATION_SLUG_EMERGE, location)\n    }\n\n}\n\nexport class RaiderDiscoveredEvent extends WorldLocationEvent {\n\n    constructor(location: Vector3) {\n        super(EventKey.LOCATION_RAIDER_DISCOVERED, location)\n    }\n\n}\n","export class WorkerMessage {\n\n    type: WorkerMessageType = null\n    text?: string\n    cfg?: any\n    totalResources?: number\n    assetName?: string\n    assetObj?: any\n    loadingTimeSeconds?: string\n\n    constructor(type: WorkerMessageType) {\n        this.type = type\n    }\n\n    static createTextMessage(msg: string): WorkerMessage {\n        return {type: WorkerMessageType.MSG, text: msg}\n    }\n\n    static createCfgLoaded(cfg: any, totalResources: number): WorkerMessage {\n        return {type: WorkerMessageType.CFG, cfg: cfg, totalResources: totalResources}\n    }\n\n    static createAssetLoaded(assetIndex: number, assetName: string, assetObj: any) {\n        return {type: WorkerMessageType.ASSET, assetName: assetName, assetObj: assetObj}\n    }\n\n    static createLoadDone(totalResources: number, loadingTimeSeconds: string) {\n        return {type: WorkerMessageType.DONE, totalResources: totalResources, loadingTimeSeconds: loadingTimeSeconds}\n    }\n\n}\n\nexport enum WorkerMessageType {\n\n    MSG,\n    CFG,\n    CACHE_MISS,\n    SFX,\n    ASSET,\n    DONE,\n\n}\n","import { BufferGeometry, Vector2, Vector3 } from 'three'\nimport { WALL_TYPE } from './Surface'\nimport { BufferAttribute } from 'three/src/core/BufferAttribute'\n\nexport class SurfaceGeometry {\n\n    public static create(wallType: WALL_TYPE,\n                         topLeftVertex: Vector3, bottomRightVertex: Vector3, topRightVertex: Vector3, bottomLeftVertex: Vector3,\n                         topLeftHeight: number, topRightHeight: number, bottomRightHeight: number, bottomLeftHeight: number,\n    ) {\n        let uvOffset = 0\n\n        // not-rotated\n        // 1 ?\n        // ? 0\n        if (topLeftVertex.y && !bottomRightVertex.y &&\n            (wallType === WALL_TYPE.INVERTED_CORNER || ((wallType === WALL_TYPE.WALL || wallType === WALL_TYPE.WEIRD_CREVICE) === Boolean(topRightVertex.y)))) {\n            uvOffset = 0\n        }\n\n        // 90 clock-wise\n        // ? 1\n        // 0 ?\n        if (topRightVertex.y && !bottomLeftVertex.y &&\n            (wallType === WALL_TYPE.INVERTED_CORNER || ((wallType === WALL_TYPE.WALL || wallType === WALL_TYPE.WEIRD_CREVICE) === Boolean(bottomRightVertex.y)))) {\n            uvOffset = 3\n        }\n\n        // 180 clock-wise\n        // 0 ?\n        // ? 1\n        if (bottomRightVertex.y && !topLeftVertex.y &&\n            (wallType === WALL_TYPE.INVERTED_CORNER || ((wallType === WALL_TYPE.WALL || wallType === WALL_TYPE.WEIRD_CREVICE) === Boolean(bottomLeftVertex.y)))) {\n            uvOffset = 2\n        }\n\n        // 270 clock-wise\n        // ? 0\n        // 1 ?\n        if (bottomLeftVertex.y && !topRightVertex.y &&\n            (wallType === WALL_TYPE.INVERTED_CORNER || ((wallType === WALL_TYPE.WALL || wallType === WALL_TYPE.WEIRD_CREVICE) === Boolean(topLeftVertex.y)))) {\n            uvOffset = 1\n        }\n\n        if (wallType === WALL_TYPE.WALL || wallType === WALL_TYPE.WEIRD_CREVICE) {\n            if (topLeftVertex.y && bottomRightVertex.y) {\n                uvOffset = 0\n            }\n            if (topRightVertex.y && bottomLeftVertex.y) {\n                uvOffset = 3\n            }\n        }\n\n        /*\n        //\t\t0---1                1         0---1\n        //\t\t|   |  becomes      /|   and   |  /\n        //\t\t|   |             /  |         |/\n        //\t\t3---2            3---2         3\n        //\n        //\t\tOR\n        //\n        //\t\t0---1            0             0---1\n        //\t\t|   |  becomes   |\\    \t and    \\  |\n        //\t\t|   |            |  \\             \\|\n        //\t\t3---2            3---2             2\n        //\n        //\t\tTriangles 0-1-3 and 0-3-2\n        //\t\tQuad 0-1-3-2\n        */\n\n        const uv = [\n            new Vector2(0, 1),\n            new Vector2(1, 1),\n            new Vector2(1, 0),\n            new Vector2(0, 0),\n        ]\n\n        const bufferVertices = []\n        const bufferNormals = []\n\n        function addFaceAndNormals(a, b, c) {\n            bufferVertices.push(a, b, c)\n            const normal = new Vector3().subVectors(c, b)\n            normal.cross(new Vector3().subVectors(a, b))\n            normal.normalize()\n            bufferNormals.push(normal, normal, normal)\n        }\n\n        const uvIndexes = []\n        if (topRightVertex.y !== bottomLeftVertex.y ||\n            ((wallType === WALL_TYPE.WALL || wallType === WALL_TYPE.WEIRD_CREVICE) && !(topRightVertex.y && bottomLeftVertex.y))) {\n            uvIndexes.push(1, 3, 2)\n            uvIndexes.push(1, 0, 3)\n\n            // apply height fine-tuning\n            topLeftVertex.y = topLeftHeight\n            topRightVertex.y = topRightHeight\n            bottomRightVertex.y = bottomRightHeight\n            bottomLeftVertex.y = bottomLeftHeight\n\n            addFaceAndNormals(topRightVertex, bottomLeftVertex, bottomRightVertex)\n            addFaceAndNormals(topRightVertex, topLeftVertex, bottomLeftVertex)\n        } else {\n            uvIndexes.push(0, 3, 2)\n            uvIndexes.push(0, 2, 1)\n\n            // apply height fine-tuning\n            topLeftVertex.y = topLeftHeight\n            topRightVertex.y = topRightHeight\n            bottomRightVertex.y = bottomRightHeight\n            bottomLeftVertex.y = bottomLeftHeight\n\n            addFaceAndNormals(topLeftVertex, bottomLeftVertex, bottomRightVertex)\n            addFaceAndNormals(topLeftVertex, bottomRightVertex, topRightVertex)\n        }\n\n        const bufferVertexUvs = uvIndexes.map(i => uv[(i + uvOffset) % 4])\n\n        const bufferGeometry = new BufferGeometry()\n        bufferGeometry.setAttribute('position', new BufferAttribute(new Float32Array(18), 3).copyVector3sArray(bufferVertices))\n        bufferGeometry.setAttribute('normal', new BufferAttribute(new Float32Array(18), 3).copyVector3sArray(bufferNormals))\n        bufferGeometry.setAttribute('uv', new BufferAttribute(new Float32Array(12), 2).copyVector2sArray(bufferVertexUvs))\n        return bufferGeometry\n    }\n}\n","import { SurfaceGeometry } from './SurfaceGeometry'\nimport { WALL_TYPE } from './Surface'\nimport { Mesh, MeshPhongMaterial, Vector3 } from 'three'\n\nexport class BuildPlacementMarkerMesh extends Mesh {\n\n    static readonly geometry = SurfaceGeometry.create(WALL_TYPE.WALL, new Vector3(0, 0, 0), new Vector3(1, 0, 1),\n        new Vector3(1, 0, 0), new Vector3(0, 0, 1),\n        1, 1, 1, 1,\n    )\n\n    standardColor: number\n\n    constructor(standardColor: number) {\n        super(BuildPlacementMarkerMesh.geometry, new MeshPhongMaterial({\n            shininess: 0,\n            transparent: true,\n            opacity: 0.4,\n            color: standardColor,\n        }))\n        this.standardColor = standardColor\n        this.visible = false\n    }\n\n    updateState(position: { x: number, y: number }, heading: number, primaryPosition: Vector3) {\n        this.visible = !!position\n        if (position) {\n            this.position.set(position.x, 0, position.y)\n                .applyAxisAngle(new Vector3(0, 1, 0), -heading - Math.PI / 2)\n                .add(primaryPosition)\n        }\n    }\n\n    resetColor() {\n        (this.material as MeshPhongMaterial).color.setHex(this.standardColor)\n    }\n\n    markAsInvalid() {\n        (this.material as MeshPhongMaterial).color.setHex(0x500000)\n    }\n\n}\n","import { Group, Vector2 } from 'three'\nimport { TILESIZE } from '../../../main'\nimport { GameState } from '../../../game/model/GameState'\nimport { BuildPlacementMarkerMesh } from './BuildPlacementMarkerMesh'\nimport { Terrain } from './Terrain'\nimport { SurfaceType } from './SurfaceType'\nimport { Surface } from './Surface'\n\nexport class BuildPlacementMarker {\n\n    static readonly buildingMarkerColor: number = 0x005000\n    static readonly pathMarkerColor: number = 0x505000\n    static readonly waterMarkerColor: number = 0x000050\n\n    group: Group = new Group()\n    buildingMarkerPrimary: BuildPlacementMarkerMesh = null\n    buildingMarkerSecondary: BuildPlacementMarkerMesh = null\n    powerPathMarkerPrimary: BuildPlacementMarkerMesh = null\n    powerPathMarkerSecondary: BuildPlacementMarkerMesh = null\n    waterPathMarker: BuildPlacementMarkerMesh = null\n    heading: number = 0\n    sdx: number = 0\n    sdz: number = 0\n    lastCheck: boolean = false\n    visibleSurfaces: Surface[] = []\n    primarySurface: Surface = null\n    barrierLocations: Vector2[] = []\n\n    constructor() {\n        this.group.scale.set(TILESIZE, TILESIZE, TILESIZE)\n        this.buildingMarkerPrimary = new BuildPlacementMarkerMesh(BuildPlacementMarker.buildingMarkerColor)\n        this.buildingMarkerSecondary = new BuildPlacementMarkerMesh(BuildPlacementMarker.buildingMarkerColor)\n        this.powerPathMarkerPrimary = new BuildPlacementMarkerMesh(BuildPlacementMarker.pathMarkerColor)\n        this.powerPathMarkerSecondary = new BuildPlacementMarkerMesh(BuildPlacementMarker.pathMarkerColor)\n        this.waterPathMarker = new BuildPlacementMarkerMesh(BuildPlacementMarker.waterMarkerColor)\n        this.group.add(this.buildingMarkerPrimary)\n        this.group.add(this.buildingMarkerSecondary)\n        this.group.add(this.powerPathMarkerPrimary)\n        this.group.add(this.powerPathMarkerSecondary)\n        this.group.add(this.waterPathMarker)\n    }\n\n    updateAllMarker(terrain: Terrain, position: Vector2 = null): boolean {\n        if (!position || !GameState.buildModeSelection) {\n            this.hideAllMarker()\n            return false\n        }\n        position.multiplyScalar(1 / TILESIZE)\n        // FIXME use surface height offsets, refactor terrain map/data handling before\n        const buildMode = GameState.buildModeSelection\n        this.buildingMarkerPrimary.visible = true\n        this.buildingMarkerPrimary.position.set(Math.floor(position.x), 0, Math.floor(position.y))\n        const sdxv = position.x - this.buildingMarkerPrimary.position.x - 0.5\n        const sdzv = position.y - this.buildingMarkerPrimary.position.z - 0.5\n        const sdx = Math.abs(sdxv) > Math.abs(sdzv) ? Math.sign(sdxv) : 0\n        const sdz = Math.abs(sdzv) > Math.abs(sdxv) ? Math.sign(sdzv) : 0\n        if (this.sdx === sdx && this.sdz === sdz) return this.lastCheck\n        this.sdx = sdx\n        this.sdz = sdz\n        this.heading = Math.atan2(sdz, sdx)\n        this.buildingMarkerSecondary.updateState(buildMode.secondaryBuildingPart, this.heading, this.buildingMarkerPrimary.position)\n        this.powerPathMarkerPrimary.visible = buildMode.hasPrimaryPowerPath\n        this.powerPathMarkerPrimary.position.set(Math.floor(position.x + sdx), 0, Math.floor(position.y + sdz))\n        this.powerPathMarkerSecondary.updateState(buildMode.secondaryPowerPath, this.heading, this.buildingMarkerPrimary.position)\n        this.waterPathMarker.updateState(buildMode.waterPathSurface, this.heading, this.buildingMarkerPrimary.position)\n        this.visibleSurfaces = [this.buildingMarkerPrimary, this.buildingMarkerSecondary, this.powerPathMarkerPrimary, this.powerPathMarkerSecondary]\n            .filter((c) => c.visible).map((c) => terrain.getSurface(c.position.x, c.position.z))\n        this.primarySurface = this.visibleSurfaces[0]\n        this.lastCheck = this.visibleSurfaces.every((s) => s.surfaceType === SurfaceType.GROUND)\n            && [this.powerPathMarkerPrimary, this.powerPathMarkerSecondary]\n                .every((c) => !c.visible || terrain.getSurface(c.position.x, c.position.z).neighbors\n                    .some((n) => n.surfaceType === SurfaceType.POWER_PATH))\n        this.barrierLocations = []\n        const center = this.primarySurface.getCenterWorld2D()\n        this.barrierLocations.push(new Vector2(center.x - TILESIZE / 2, center.y))\n        this.barrierLocations.push(new Vector2(center.x, center.y - TILESIZE / 2))\n        this.barrierLocations.push(new Vector2(center.x + TILESIZE / 2, center.y))\n        this.barrierLocations.push(new Vector2(center.x, center.y + TILESIZE / 2))\n        if (this.buildingMarkerSecondary.visible) {\n            // FIXME adapt locations for buildings with two building surfaces\n        }\n        return this.lastCheck\n    }\n\n    hideAllMarker() {\n        this.buildingMarkerPrimary.visible = false\n        this.buildingMarkerSecondary.visible = false\n        this.powerPathMarkerPrimary.visible = false\n        this.powerPathMarkerSecondary.visible = false\n        this.waterPathMarker.visible = false\n        this.lastCheck = false\n    }\n\n    resetColor() {\n        this.group.children.forEach((c) => (c as BuildPlacementMarkerMesh).resetColor())\n    }\n\n    markAsInvalid() {\n        this.group.children.forEach((c) => (c as BuildPlacementMarkerMesh).markAsInvalid())\n    }\n\n}\n","import { AmbientLight, Color, Frustum, Mesh, MOUSE, PerspectiveCamera, PointLight, Raycaster, Scene, Vector3, WebGLRenderer } from 'three'\nimport { DebugHelper } from './DebugHelper'\nimport { MapControls } from 'three/examples/jsm/controls/OrbitControls'\nimport { GameState } from '../game/model/GameState'\nimport { Selectable } from '../game/model/Selectable'\nimport { Terrain } from './model/map/Terrain'\nimport { TILESIZE } from '../main'\nimport { clearIntervalSafe } from '../core/Util'\nimport { AnimatedMesh } from '../resource/AnimatedMesh'\nimport { BuildPlacementMarker } from './model/map/BuildPlacementMarker'\nimport { EventBus } from '../event/EventBus'\nimport { EventKey } from '../event/EventKeyEnum'\n\nexport class SceneManager {\n\n    static meshRegistry: AnimatedMesh[] = []\n\n    maxFps: number = 30 // most animations use 25 fps so this should be enough\n    renderer: WebGLRenderer\n    debugHelper: DebugHelper = new DebugHelper()\n    renderInterval\n    animRequest\n    scene: Scene\n    camera: PerspectiveCamera\n    ambientLight: AmbientLight\n    light: PointLight\n    terrain: Terrain\n    controls: MapControls\n    cursorTorchlight: PointLight\n    buildMarker: BuildPlacementMarker\n\n    constructor(canvas: HTMLCanvasElement) {\n        this.renderer = new WebGLRenderer({antialias: true, canvas: canvas})\n        this.renderer.setClearColor(0x000000)\n\n        this.camera = new PerspectiveCamera(30, canvas.width / canvas.height, 0.1, 5000) // TODO make these params configurable\n\n        this.controls = new MapControls(this.camera, this.renderer.domElement)\n        this.controls.mouseButtons = {LEFT: null, MIDDLE: MOUSE.ROTATE, RIGHT: MOUSE.PAN}\n        // this.controls.maxPolarAngle = Math.PI * 0.45; // TODO dynamically adapt to terrain height at camera position\n\n        this.buildMarker = new BuildPlacementMarker()\n        EventBus.registerEventListener(EventKey.CANCEL_BUILD_MODE, () => {\n            GameState.buildModeSelection = null\n            this.buildMarker.hideAllMarker()\n        })\n    }\n\n    selectEntitiesByRay(rx: number, ry: number) {\n        const raycaster = new Raycaster()\n        raycaster.setFromCamera({x: rx, y: ry}, this.camera)\n        let intersects = raycaster.intersectObjects(GameState.raiders.map((r) => r.pickSphere))\n        if (intersects.length < 1) intersects = raycaster.intersectObjects(GameState.vehicles.map((v) => v.pickSphere))\n        if (intersects.length < 1) intersects = raycaster.intersectObjects(GameState.buildings.map((b) => b.pickSphere))\n        if (intersects.length < 1 && this.terrain) intersects = raycaster.intersectObjects(this.terrain.floorGroup.children)\n        const selected = []\n        if (intersects.length > 0) {\n            const userData = intersects[0].object.userData\n            if (userData && userData.hasOwnProperty('selectable')) {\n                const selectable = userData['selectable']\n                if (selectable) selected.push(selectable)\n            }\n        }\n        GameState.selectEntities(selected)\n    }\n\n    selectEntitiesInFrustum(r1x: number, r1y: number, r2x: number, r2y: number) {\n        const startPoint = new Vector3(r1x, r1y, 0.5)\n        const endPoint = new Vector3(r2x, r2y, 0.5)\n        // Avoid invalid frustum\n        if (startPoint.x === endPoint.x) {\n            endPoint.x += Number.EPSILON\n        }\n        if (startPoint.y === endPoint.y) {\n            endPoint.y += Number.EPSILON\n        }\n        // update camera\n        this.camera.updateProjectionMatrix()\n        this.camera.updateMatrixWorld()\n        // update frustum\n        const tmpPoint = new Vector3()\n        tmpPoint.copy(startPoint)\n        tmpPoint.x = Math.min(startPoint.x, endPoint.x)\n        tmpPoint.y = Math.max(startPoint.y, endPoint.y)\n        endPoint.x = Math.max(startPoint.x, endPoint.x)\n        endPoint.y = Math.min(startPoint.y, endPoint.y)\n\n        const vecNear = new Vector3()\n        const vecTopLeft = new Vector3()\n        const vecTopRight = new Vector3()\n        const vecDownRight = new Vector3()\n        const vecDownLeft = new Vector3()\n        vecNear.setFromMatrixPosition(this.camera.matrixWorld)\n        vecTopLeft.copy(tmpPoint)\n        vecTopRight.set(endPoint.x, tmpPoint.y, 0)\n        vecDownRight.copy(endPoint)\n        vecDownLeft.set(tmpPoint.x, endPoint.y, 0)\n\n        vecTopLeft.unproject(this.camera)\n        vecTopRight.unproject(this.camera)\n        vecDownRight.unproject(this.camera)\n        vecDownLeft.unproject(this.camera)\n\n        const vectemp1 = new Vector3()\n        const vectemp2 = new Vector3()\n        const vectemp3 = new Vector3()\n        vectemp1.copy(vecTopLeft).sub(vecNear)\n        vectemp2.copy(vecTopRight).sub(vecNear)\n        vectemp3.copy(vecDownRight).sub(vecNear)\n        vectemp1.normalize()\n        vectemp2.normalize()\n        vectemp3.normalize()\n\n        const deep = Number.MAX_VALUE\n        vectemp1.multiplyScalar(deep)\n        vectemp2.multiplyScalar(deep)\n        vectemp3.multiplyScalar(deep)\n        vectemp1.add(vecNear)\n        vectemp2.add(vecNear)\n        vectemp3.add(vecNear)\n\n        const frustum = new Frustum()\n        const planes = frustum.planes\n\n        planes[0].setFromCoplanarPoints(vecNear, vecTopLeft, vecTopRight)\n        planes[1].setFromCoplanarPoints(vecNear, vecTopRight, vecDownRight)\n        planes[2].setFromCoplanarPoints(vecDownRight, vecDownLeft, vecNear)\n        planes[3].setFromCoplanarPoints(vecDownLeft, vecTopLeft, vecNear)\n        planes[4].setFromCoplanarPoints(vecTopRight, vecDownRight, vecDownLeft)\n        planes[5].setFromCoplanarPoints(vectemp3, vectemp2, vectemp1)\n        planes[5].normal.multiplyScalar(-1)\n\n        let entities: Selectable[] = GameState.raiders.filter((r) => frustum.containsPoint(r.getSelectionCenter()))\n        entities.push(...(GameState.vehicles.filter((v) => frustum.containsPoint(v.getSelectionCenter()))))\n        if (entities.length < 1) entities = GameState.buildings.filter((b) => frustum.containsPoint(b.getSelectionCenter()))\n        GameState.selectEntities(entities)\n    }\n\n    setupScene(ambientColor: Color) {\n        this.scene = new Scene()\n\n        this.ambientLight = new AmbientLight(ambientColor, 0.4)\n        this.scene.add(this.ambientLight)\n\n        this.cursorTorchlight = new PointLight(0xffffff, 1.5, 4, 1)\n        this.cursorTorchlight.distance *= TILESIZE\n        this.scene.add(this.cursorTorchlight)\n\n        this.scene.add(this.buildMarker.group)\n    }\n\n    startScene() {\n        this.debugHelper.show()\n        this.renderInterval = setInterval(() => {\n            this.animRequest = requestAnimationFrame(() => {\n                this.debugHelper.renderStart()\n                this.renderer.render(this.scene, this.camera)\n                this.debugHelper.renderDone()\n            })\n        }, 1000 / this.maxFps)\n    }\n\n    disposeScene() {\n        this.debugHelper.hide()\n        this.renderInterval = clearIntervalSafe(this.renderInterval)\n        if (this.animRequest) {\n            cancelAnimationFrame(this.animRequest)\n            this.animRequest = null\n        }\n        this.terrain?.dispose()\n        this.terrain = null\n        SceneManager.meshRegistry.forEach(mesh => mesh.dispose())\n        SceneManager.meshRegistry = []\n    }\n\n    static registerMesh(animatedMesh: AnimatedMesh): Mesh {\n        this.meshRegistry.push(animatedMesh)\n        return animatedMesh.mesh\n    }\n\n}\n","/**\n * @author Scarabol https://github.com/scarabol\n *\n * This loader loads LWSC files exported from LW\n *\n * File format description: http://www.martinreddy.net/gfx/3d/LWSC.txt\n */\n\nimport { AnimClip } from '../scene/model/anim/AnimClip'\nimport { AnimSubObj } from '../scene/model/anim/AnimSubObj'\nimport { Group } from 'three'\nimport { getFilename } from '../core/Util'\nimport { ResourceManager } from './ResourceManager'\nimport { LWOLoader } from './LWOLoader'\nimport { SceneManager } from '../scene/SceneManager'\n\nexport class LWSCLoader {\n\n    path: string = ''\n    verbose: boolean = false\n    animationClip: AnimClip = new AnimClip()\n    lines: string[] = []\n    lineIndex: number = 0\n\n    constructor(path: string, verbose: boolean = false) {\n        this.path = path\n        this.verbose = verbose\n        if (this.verbose) console.log('Using verbose mode')\n    }\n\n    parse(content): AnimClip {\n        this.lines = content.replace(/\\r\\n/g, '\\n').replace(/\\r/g, '\\n') // normalize newlines\n            .replace(/\\t/g, ' ') // tabs to spaces\n            .split('\\n')\n            .map(l => l.trim())\n\n        if (this.lines[0] !== 'LWSC') {\n            throw 'Invalid start of file! Expected \\'LWSC\\' in first line'\n        }\n\n        const sceneFileVersion = parseInt(this.lines[1], 10)\n        if (sceneFileVersion !== 1) {\n            console.warn('Unexpected scene file version: ' + sceneFileVersion)\n        }\n\n        for (this.lineIndex = 2; this.lineIndex < this.lines.length; this.lineIndex++) {\n            let line = this.lines[this.lineIndex]\n            if (!line) continue // empty line: object separator\n            const key = line.split(' ')[0]\n            if (key === 'FirstFrame') {\n                this.parseFrameBlock()\n            } else if (key === 'AddNullObject' || key === 'LoadObject') {\n                this.parseObjectBlock()\n                if (this.verbose) console.log(this.animationClip.bodies[this.animationClip.bodies.length - 1])\n            } else if (line.startsWith('PreviewFirstFrame ') || line.startsWith('PreviewLastFrame ') || line.startsWith('PreviewFrameStep ')) {\n                // only used in editor\n            } else {\n                // console.warn('Unexpected line: ' + line); // TODO analyze remaining entries\n            }\n        }\n\n        if (this.verbose) console.log(this.animationClip)\n        return this.animationClip\n    }\n\n    parseLine(line: string): string[] {\n        return line.split(' ').filter((l: string) => l !== '')\n    }\n\n    parseFrameBlock() {\n        for (; this.lineIndex < this.lines.length; this.lineIndex++) {\n            const line = this.lines[this.lineIndex]\n            if (!line) return\n            const [key, value] = this.parseLine(line)\n            if (key === 'FirstFrame') {\n                this.animationClip.firstFrame = parseInt(value)\n            } else if (key === 'LastFrame') {\n                this.animationClip.lastFrame = parseInt(value)\n            } else if (key === 'FrameStep') {\n                const frameStep = parseInt(value)\n                if (frameStep !== 1) console.error('Animation frameStep has unexpected value: ' + frameStep)\n            } else if (key === 'FramesPerSecond') {\n                this.animationClip.framesPerSecond = parseInt(value)\n            } else if (key === 'PreviewFirstFrame' || key === 'PreviewLastFrame' || key === 'PreviewFrameStep') {\n                // only used in editor\n            } else {\n                console.warn('Unexpected key in frame block')\n            }\n        }\n        console.error('Parsing block reached content end')\n    }\n\n    parseObjectBlock(): AnimSubObj {\n        const subObj = new AnimSubObj()\n        this.animationClip.bodies.push(subObj)\n        for (; this.lineIndex < this.lines.length; this.lineIndex++) {\n            let line = this.lines[this.lineIndex]\n            if (!line) return\n            const [key, value] = this.parseLine(line)\n            if (key === 'AddNullObject' || key === 'LoadObject') {\n                if (key === 'LoadObject') {\n                    const filename = getFilename(value)\n                    subObj.name = filename.slice(0, filename.length - '.lwo'.length)\n                    subObj.filename = this.path + filename\n                    const lwoBuffer = ResourceManager.getResource(subObj.filename)\n                    subObj.model = SceneManager.registerMesh(new LWOLoader(this.path).parse(lwoBuffer))\n                } else if (key === 'AddNullObject') {\n                    subObj.name = value\n                    subObj.model = new Group()\n                } else {\n                    throw 'Unexpected line: ' + line\n                }\n            } else if (key === 'ObjectMotion') {\n                let line = this.lines[++this.lineIndex]\n                const lenInfos = parseInt(line)\n                line = this.lines[++this.lineIndex]\n                const lenFrames = parseInt(line)\n                this.lineIndex++\n                for (let c = 0; c < lenFrames; c++) {\n                    let line = this.lines[this.lineIndex + c * 2]\n                    if (line.startsWith('EndBehavior')) break\n                    const infos = line.split(' ').map(Number)\n                    if (infos.length !== lenInfos) console.warn('Number of infos (' + infos.length + ') does not match if specified count (' + lenInfos + ')')\n                    line = this.lines[this.lineIndex + c * 2 + 1]\n                    const animationFrameIndex = parseInt(line.split(' ')[0]) // other entries in line should be zeros\n                    subObj.setFrameAndFollowing(animationFrameIndex, this.animationClip.lastFrame, infos)\n                }\n                this.lineIndex += lenFrames * 2\n            } else if (key === 'ParentObject') {\n                subObj.parentObjInd = Number(value) - 1 // index is 1 based\n                if (this.verbose) console.log('parent obj ind is: ' + subObj.parentObjInd)\n            } else if (key === 'ShowObject ' || key === 'LockedChannels') {\n                // only used in editor\n            } else if (key === 'ShadowOptions') { // TODO implement shadow options (bitwise)\n                // 0 - Self Shadow\n                // 1 - Cast Shadow\n                // 2 - Receive Shadow\n            } else if (key === 'ObjDissolve') {\n                if (value == '(envelope)') {\n                    let line = this.lines[++this.lineIndex]\n                    const numOfInformationChannels = parseInt(line)\n                    if (numOfInformationChannels !== 1) console.error('Number of information channels for opacity is not 1, but: ' + numOfInformationChannels)\n                    line = this.lines[++this.lineIndex]\n                    const numOfKeyframes = parseInt(line)\n                    this.lineIndex++\n                    for (let c = 0; c < numOfKeyframes; c++) {\n                        let line = this.lines[this.lineIndex + c * 2]\n                        if (line.startsWith('EndBehavior')) break\n                        const opacity = 1 - Number(line)\n                        line = this.lines[this.lineIndex + c * 2 + 1]\n                        const frameNum = Number(line.split(' ')[0])\n                        subObj.setOpacityAndFollowing(frameNum, this.animationClip.lastFrame, opacity)\n                    }\n                    this.lineIndex += numOfKeyframes * 2\n                } else {\n                    const opacity = 1 - Number(value)\n                    subObj.setOpacityAndFollowing(0, this.animationClip.lastFrame, opacity)\n                }\n            } else {\n                // console.log('Unhandled line in object block: ' + line); // TODO analyze unhandled lines\n            }\n        }\n        console.error('Parsing block reached content end')\n        return subObj\n    }\n\n}\n","import { AnimationEntityType } from '../scene/model/anim/AnimationEntityType'\nimport { getPath, iGet } from './wadworker/WadUtil'\nimport { ResourceManager } from './ResourceManager'\nimport { LWOLoader } from './LWOLoader'\nimport { LWSCLoader } from './LWSCLoader'\nimport { SceneManager } from '../scene/SceneManager'\nimport { AnimClip } from '../scene/model/anim/AnimClip'\n\nexport class AnimEntityLoader {\n\n    static loadModels(url, root): AnimationEntityType {\n        const path = getPath(url)\n\n        const entityType = new AnimationEntityType()\n\n        entityType.carryNullName = iGet(root, 'CarryNullName')\n        entityType.depositNullName = iGet(root, 'DepositNullName')\n        entityType.toolNullName = iGet(root, 'ToolNullName')\n\n        // TODO load other poly quality models (if available)\n        // let mediumPoly = iGet(root, 'MediumPoly');\n        // if (mediumPoly) {\n        //     Object.keys(mediumPoly).forEach((key) => {\n        //         const polyname = mediumPoly[key];\n        //         const polykey = key.startsWith('!') ? key.slice(1) : key;\n        //         const polyfile = path + polyname + '.lwo';\n        //         console.log('polyfile');\n        //         console.log(polyfile);\n        //         // new LWOLoader().load(polyfile, (model) => {\n        //         //     mediumPoly[polykey] = {polyname: polyname, polyfile: polyfile, model: model};\n        //         // }, undefined, () => {\n        //         //     console.error('Could not load poly ' + polyname + ' from ' + polyfile);\n        //         // });\n        //     });\n        //     Object.keys(mediumPoly).filter((polykey) => polykey.startsWith('!')).forEach((polykey) => delete mediumPoly[polykey]);\n        // }\n\n        const highPoly = iGet(root, 'highpoly')\n        if (highPoly) {\n            entityType.highPoly = {}\n            Object.keys(highPoly).forEach((key) => {\n                const polyname = highPoly[key] + '.lwo'\n                const polykey = key.startsWith('!') ? key.slice(1) : key\n                const lwoBuffer = ResourceManager.getResource(path + polyname)\n                entityType.highPoly[polykey] = SceneManager.registerMesh(new LWOLoader(path).parse(lwoBuffer))\n            })\n        }\n\n        // let fPoly = (root)['fppoly'];\n        // if (fPoly) {\n        //     Object.keys(fPoly).forEach((camera) => {\n        //         Object.keys(fPoly[camera]).forEach((key) => {\n        //             const polyname = fPoly[camera][key];\n        //             const polykey = key.startsWith('!') ? key.slice(1) : key;\n        //             if (polyname !== 'null') {\n        //                 const polyfile = path + polyname + '.lwo';\n        //                 new LWOLoader().load(polyfile, (model) => {\n        //                     fPoly[camera][polykey] = {polyname: polyname, polyfile: polyfile, model: model};\n        //                 }, undefined, () => {\n        //                     console.error('Could not load poly ' + polyname + ' from ' + polyfile);\n        //                 });\n        //             } else {\n        //                 fPoly[camera][key] = {polyname: polyname, polyfile: null, model: new Group()};\n        //             }\n        //         });\n        //         Object.keys(fPoly[camera]).filter((polykey) => polykey.startsWith('!')).forEach((polykey) => delete fPoly[polykey][camera]);\n        //     });\n        // }\n\n        const activities = iGet(root, 'Activities')\n        if (activities) {\n            Object.keys(activities).forEach((activity) => {\n                try {\n                    let keyname = iGet(activities, activity)\n                    const act: { file: string, transcoef: number, lwsfile: boolean, animation: AnimClip } = iGet(root, keyname)\n                    const file = iGet(act, 'FILE')\n                    const isLws = iGet(act, 'LWSFILE') === true\n                    const transcoef = iGet(act, 'TRANSCOEF')\n                    const looping = iGet(act, 'LOOPING') === true\n                    if (isLws) {\n                        const content = ResourceManager.getResource(path + file + '.lws')\n                        act.animation = new LWSCLoader(path).parse(content)\n                        act.animation.looping = looping\n                        act.animation.transcoef = transcoef ? Number(transcoef) : 1\n                        entityType.activities.set(activity.toLowerCase(), act)\n                    } else {\n                        console.error('Found activity which is not an LWS file')\n                    }\n                } catch (e) {\n                    console.error(e)\n                    console.log(root)\n                    console.log(activities)\n                    console.log(activity)\n                }\n            })\n        }\n\n        return entityType\n    }\n\n}\n","import { createContext, createDummyImgData, getPixel, setPixel } from './ImageHelper'\n\nexport class BitmapFont {\n\n    charHeight: number\n    letters: ImageData[] = []\n\n    constructor(fontImageData: ImageData, cols = 10, rows = 19) { // font images always consist of 10 columns and 19 rows with last row empty\n        // actually chars are font dependent and have to be externalized in future\n        // maybe CP850 was used... not sure, doesn't fit...\n        const chars = [' ', '!', '\"', '#', '$', '%', '⌵', '`', '(', ')',\n            '*', '+', ',', '-', '.', '/', '0', '1', '2', '3',\n            '4', '5', '6', '7', '8', '9', ':', ';', '<', '=',\n            '>', '?', '@', 'A', 'B', 'C', 'D', 'E', 'F', 'G',\n            'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q',\n            'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z', '[',\n            '\\\\', ']', '^', '_', '\\'', 'a', 'b', 'c', 'd', 'e',\n            'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o',\n            'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y',\n            'z', 'Ä', 'Å', 'Á', 'À', 'Â', 'Ã', 'Ą', 'ä', 'å',\n            'á', 'à', 'â', 'ã', 'ą', 'Ë', 'E̊', 'É', 'È', 'É',\n            'Ę', 'ë', 'e̊', 'é', 'è', 'e̊', 'ę̊', '', '', '',\n            '', '', '', '', '', 'Ö', '', '', '', '',\n            'ö', '', '', '', '', 'Ü', '', '', '', 'ü',\n            '', '', '', '', '', '', '', '', '', '',\n            '', '', '', '', '', '', '', '', '', '',\n            '', '', '', 'ß', '', '', '', 'Ñ', '', 'ñ',\n            '',\n        ] // XXX complete this character list\n\n        const maxCharWidth = fontImageData.width / cols\n        this.charHeight = fontImageData.height / rows\n\n        function getActualCharacterWidth(imgData) {\n            for (let y = 0; y < imgData.height / rows; y++) { // find non-empty row first\n                let rowPixelIndex = y * 4 * imgData.width\n                if (imgData.data[rowPixelIndex] !== 255 && imgData.data[rowPixelIndex + 2] !== 255) { // red/blue pixels indicate end of character\n                    for (let x = 0; x < maxCharWidth; x++) {\n                        let colPixelIndex = x * 4\n                        if (imgData.data[colPixelIndex] === 255 || imgData.data[colPixelIndex + 2] === 255) { // red/blue pixels indicate end of character\n                            return x\n                        }\n                    }\n                    return maxCharWidth\n                }\n            }\n            return 0\n        }\n\n        for (let i = 0; i < chars.length; i++) {\n            let imgData = this.extractData(fontImageData, (i % 10) * maxCharWidth, Math.floor(i / 10) * this.charHeight, maxCharWidth, this.charHeight)\n            let actualWidth = getActualCharacterWidth(imgData)\n            if (actualWidth > 0) {\n                imgData = this.extractData(imgData, 0, 0, actualWidth, this.charHeight)\n            } else {\n                imgData = createDummyImgData(maxCharWidth, this.charHeight)\n            }\n            this.letters[chars[i]] = imgData\n        }\n    }\n\n    extractData(imgData, startX, startY, width, height): ImageData {\n        const alpha = getPixel(imgData, startX + width - 1, startY + height - 1)\n        const result = new ImageData(width, height)\n        for (let x = 0; x < width; x++) {\n            for (let y = 0; y < height; y++) {\n                const p = getPixel(imgData, startX + x, startY + y)\n                if (p.r === alpha.r && p.g === alpha.g && p.b === alpha.b) p.a = 0 // apply alpha channel\n                setPixel(result, x, y, p.r, p.g, p.b, p.a)\n            }\n        }\n        return result\n    }\n\n    createTextImage(text: string, maxWidth?: number, autoCenter: boolean = true): HTMLCanvasElement {\n        if (text === undefined || text === null || text.length < 1) {\n            // empty text requested, context with width 0 is not allowed, but 1 with alpha is close enough\n            return createContext(1, 1).canvas\n        }\n        text = text.replace(/_/g, ' ')\n        const rows = this.determineRows(text, maxWidth)\n        const width = Math.max(...(rows.map(r => r.width)))\n        const result = new ImageData(width, this.charHeight * rows.length)\n        rows.forEach((row, index) => {\n            const rowX = autoCenter ? Math.round((width - row.width) / 2) : 0\n            const rowY = index * this.charHeight\n            let letterX = 0\n            for (let c = 0; c < row.text.length; c++) {\n                const letterImgData = this.letters[row.text.charAt(c)]\n                if (letterImgData) {\n                    for (let x = letterX; x < letterX + letterImgData.width; x++) {\n                        for (let y = 0; y < letterImgData.height; y++) {\n                            const p = getPixel(letterImgData, x - letterX, y)\n                            setPixel(result, rowX + x, rowY + y, p.r, p.g, p.b, p.a)\n                        }\n                    }\n                    letterX += letterImgData.width\n                } // missing letter issue already reported above\n            }\n        })\n        const img: CanvasRenderingContext2D = createContext(result.width, result.height)\n        img.putImageData(result, 0, 0)\n        return img.canvas\n    }\n\n    private determineRows(text: string, maxWidth?: number): { text: string, width: number }[] {\n        const spaceWidth = this.letters[' '].width\n        const rows: { text: string, width: number }[] = []\n        let rowText = ''\n        let rowWidth = 0\n        text.split(' ').map(word => {\n            let wordWidth = 0\n            for (let c = 0; c < word.length; c++) {\n                const letter = word.charAt(c)\n                const letterImg = this.letters[letter]\n                if (letterImg) {\n                    wordWidth += letterImg.width\n                } else {\n                    console.error('Letter \\'' + letter + '\\' not found in charset! Ignoring it')\n                }\n            }\n            if (rowWidth > 0) {\n                if (!maxWidth || rowWidth + spaceWidth + wordWidth < maxWidth) {\n                    rowText += ' ' + word\n                    rowWidth += spaceWidth + wordWidth\n                } else {\n                    rows.push({text: rowText, width: rowWidth})\n                    rowText = word\n                    rowWidth = wordWidth\n                }\n            } else {\n                rowText += word\n                rowWidth += wordWidth\n            }\n            return wordWidth\n        })\n        if (rowWidth > 0) rows.push({text: rowText, width: rowWidth})\n        return rows\n    }\n}\n","export class BaseConfig {\n\n    static setFromCfg(config: BaseConfig, cfgObj: any) {\n        Object.keys(cfgObj).forEach((cfgKey) => {\n            const lCfgKeyName = (cfgKey.startsWith('!') ? cfgKey.substring(1) : cfgKey)\n                .toLowerCase()\n                .replace(/_/g, '') // Activity_Stand\n                .replace(/-/g, '') // Geo-dome\n            const found = Object.keys(config).some((objKey) => {\n                return config.assignValue(objKey, lCfgKeyName, cfgObj[cfgKey])\n            })\n            if (!found) {\n                console.warn('cfg key does not exist: ' + cfgKey)\n            }\n        })\n        return config\n    }\n\n    assignValue(objKey, lCfgKeyName, cfgValue): boolean {\n        if (objKey.toLowerCase() === lCfgKeyName) {\n            const currentValue = this[objKey]\n            const currentIsArray = Array.isArray(currentValue)\n            let parsedValue = this.parseValue(lCfgKeyName, cfgValue)\n            const parsedIsArray = Array.isArray(parsedValue)\n            if (currentValue && currentIsArray !== parsedIsArray) {\n                if (currentIsArray) {\n                    parsedValue = [parsedValue]\n                    // } else {\n                    //     console.warn('Array overwrite conflict for key ' + objKey + ' with existing value (' + currentValue + ') and new value (' + parsedValue + ')')\n                }\n            }\n            this[objKey] = parsedValue\n            return true\n        }\n    }\n\n    parseValue(lCfgKeyName: string, cfgValue: any): any {\n        return cfgValue\n    }\n\n}\n","// noinspection JSUnusedGlobalSymbols\nexport enum MOUSE_BUTTON {\n    MAIN = 0,\n    MIDDLE = 1,\n    SECONDARY = 2\n}\n\nexport enum POINTER_EVENT {\n    MOVE,\n    DOWN,\n    UP,\n}\n\nexport enum KEY_EVENT {\n    DOWN,\n    UP,\n}\n","import { BaseConfig } from './BaseConfig'\nimport { Building } from '../game/model/entity/building/Building'\nimport { ResourceManager } from '../resource/ResourceManager'\n\nexport class BuildingEntityStats extends BaseConfig {\n\n    Levels: number = 0\n    SelfPowered: boolean = false\n    PowerBuilding: boolean = false\n    PickSphere: number = 0\n    TrainDynamite: boolean[] = null\n    CostOre: number = 0\n    CostCrystal: number = 0\n    OxygenCoef: number = 0\n\n    static getByType(type: Building): BuildingEntityStats {\n        switch (type) {\n            case Building.TOOLSTATION:\n                return ResourceManager.stats.Toolstation\n            case Building.TELEPORT_PAD:\n                return ResourceManager.stats.TeleportPad\n            case Building.DOCKS:\n                return ResourceManager.stats.Docks\n            case Building.POWER_STATION:\n                return ResourceManager.stats.Powerstation\n            case Building.BARRACKS:\n                return ResourceManager.stats.Barracks\n            case Building.UPGRADE:\n                return ResourceManager.stats.Upgrade\n            case Building.GEODOME:\n                return ResourceManager.stats.Geodome\n            case Building.ORE_REFINERY:\n                return ResourceManager.stats.OreRefinery\n            case Building.GUNSTATION:\n                return ResourceManager.stats.GunStation\n            case Building.TELEPORT_BIG:\n                return ResourceManager.stats.TeleportBIG\n        }\n        throw 'Unexpected building type: '+type\n    }\n\n}\n","import { BaseConfig } from './BaseConfig'\n\nexport class MovableEntityStats extends BaseConfig {\n\n    RouteSpeed: number[] = []\n    RubbleCoef: number = 1\n    PathCoef: number = 1\n\n}\n","// noinspection JSUnusedGlobalSymbols\n\nimport { BaseConfig } from './BaseConfig'\nimport { BuildingEntityStats } from './BuildingEntityStats'\nimport { MovableEntityStats } from './MovableEntityStats'\n\nexport class GameStatsCfg extends BaseConfig {\n\n    Pilot = new class PilotStats extends BaseConfig {\n        Levels: number = 4\n        RouteSpeed: number[] = [1.10, 1.10, 1.10, 1.10]\n        SoilDrillTime: number[] = [4.0, 4.0, 4.0, 4.0] // Time in seconds to drill through the rock.\n        LooseDrillTime: number[] = [4.0, 4.0, 4.0, 4.0]\n        MedDrillTime: number[] = [8.0, 8.0, 8.0, 8.0]\n        HardDrillTime: number[] = [0.0, 0.0, 0.0, 0.0] // Zero means the object cannot drill the rock type\n        SeamDrillTime: number[] = [10.0, 10.0, 10.0, 10.0] // Either or both ore or crystal.\n        UpgradeTime: number[] = [30.0, 45.0, 60.0, 60.0] // Last entry is ignored as it can never upgrade from that.\n        CollRadius: number = 5.0\n        CollHeight: number = 12.0\n        TrackDist: number = 40.0\n        SingleWidthDig: boolean[] = [true, true, true, true]\n        PickSphere: number = 10.0\n        RepairValue: number[] = [10.0, 15.0, 20.0, 25.0]\n        SurveyRadius: number[] = [3, 3, 3, 3]\n        Drillsound: string = 'SND_pilotdrill'\n        Drillfadesound: string = 'SND_pilotdrillfade'\n        RestPercent: number = 60.0\n        EnergyDecayRate: number = 0.25\n        CanClearRubble: boolean = true\n        NumOfToolsCanCarry: number[] = [2, 3, 4, 5]\n        CrossLand: boolean = true\n        RubbleCoef: number = 0.5\n        PathCoef: number = 2.0\n        RouteAvoidance: boolean = true\n        UseLegoManTeleporter: boolean = true\n        AwarenessRange: number = 10.0\n        OxygenCoef: number = -1.0\n        CanStrafe: boolean = true\n        EnterToolStore: boolean = true\n        ShowHealthBar: boolean = true\n    }\n\n    RockMonster = new class RockMonsterStats extends BaseConfig {\n        Levels: number = 1\n        RouteSpeed: number = 0.8\n        TrackDist: number = 50.0\n        CollRadius: number = 10.0\n        CollHeight: number = 22.0\n        AlertRadius: number = 60.0\n        HealthDecayRate: number = 0.6 // Reduce health by 'n' every second.\n        PickSphere: number = 22.0\n        RepairValue: number = -10.0\n        CanScare: boolean = true\n        RestPercent: number = 20.0\n        CarryMinHealth: number = 15.0\n        PainThreshold: number = 20.0\n        StampRadius: number = 80.0\n        AttackRadius: number = 160.0\n        CanSteal: boolean = true\n        CrossLand: boolean = true\n        RubbleCoef: number = 1.5\n        GrabMinifigure: boolean = true\n        RouteAvoidance: boolean = true\n        BumpDamage: boolean = true\n        AttackPaths: boolean = true\n        SplitOnZeroHealth: boolean = true\n        CanBeHitByFence: boolean = true\n        Capacity: number = 6 // How many crystals it can eat\n        PathCoef: number = 0.5\n        // Statistics about the weapons\n        CanBeShotAt: boolean = true // Can this monster be shot at by lego men\n        CanFreeze: boolean = true // Can this object be frozen\n        FreezerTime: number = 25.0 // Time this object is frozen for\n        FreezerDamage: number = 5.0 // Damage that freezing causes\n        CanLaser: boolean = true // Can this object be lasered\n        LaserDamage: number = 110.0 // Damage sustained by a laser\n        CanPush: boolean = true // Can this object be pusher'ed\n        PusherDist: number = 20.0 // Distance the object is pushed 40=1 block\n        PusherDamage: number = 2.0 // Damage that the pusher gun causes\n        WakeRadius: number = 25.0\n        ScaredByBigBangs: boolean = true\n        RemoveReinforcement: boolean = true\n        ShowHealthBar: boolean = true\n    }\n\n    SmallSpider = new class SmallSpiderStats extends MovableEntityStats {\n        Levels: number = 1\n        RouteSpeed: number[] = [2.0]\n        TrackDist: number = 10.0\n        CollRadius: number = 0.0\n        CollHeight: number = 0.0\n        PickSphere: number = 6.0\n        AlertRadius: number = 40.0\n        RandomMove: boolean = true\n        RandomEnterWall: boolean = true\n        CauseSlip: boolean = true\n        CrossLand: boolean = true\n        RubbleCoef: number = 0.2\n        DontShowDamage: boolean = true\n        DontShowOnRadar: boolean = true\n        ScaredByBigBangs: boolean = true\n    }\n\n    Bat = new class BatStats extends MovableEntityStats {\n        Levels: number = 1\n        RouteSpeed: number[] = [1.0]\n        TrackDist: number = 10.0\n        CollRadius: number = 10.0\n        AlertRadius: number = 10.0 // Alert radius (causes attack mode)\n        RandomMove: boolean = true // Random movement\n        randomMoveTime: number = 10\n        CanScare: boolean = true // Scare away the player\n        ScaredByBigBangs: boolean = true\n        // Flock parameters.\n        Flocks: boolean = true // Set this to create a flock for this object.\n        FlocksDebug: boolean = false // If this is set the actual lego objects animation is displayed at the \"lego\" position.\n        FlocksSmooth: boolean = true // Smooths out the orientation of the flocks elements.\n        FlocksSize: number = 8 // Number of the given item in the flock.  (Default 5)\n        FlocksTurn: number = 0.6 // Turning speed of the bat. (0.6 default)\n        FlocksSpeed: number = 1.5 // Velocity of the flock. (2.0 default)\n        FlocksTightness: number = 0.8 // Tightness of the flock. (2.0 default)\n        FlocksGoalUpdate: number = 2.0 // How often the flocks goal is updated (25 per second).  (2.0 default)\n        FlocksRandomness: number = 6.0 // Randomness of goals. (2.0 default)\n        FlocksHeight: number = 22.0 // Height above the ground of the flock elements.  (30.0 default)\n        CrossLand: boolean = true\n        CrossWater: boolean = true\n        CrossLava: boolean = true\n        DontShowDamage: boolean = true\n    }\n\n    TinyRM = new class TinyRMStats extends BaseConfig {\n        Levels: number = 1\n        RouteSpeed: number = 1.2\n        TrackDist: number = 10.0\n        CollRadius: number = 0.0\n        CollHeight: number = 5.0\n        PickSphere: number = 6.0\n        AlertRadius: number = 40.0\n        CrossLand: boolean = true\n        RubbleCoef: number = 1.5\n        DontShowDamage: boolean = true\n        DontShowOnRadar: boolean = true\n        ScaredByPlayer: boolean = true\n        ScaredByBigBangs: boolean = true\n    }\n\n    TinyIM = new class TinyIMStats extends BaseConfig {\n        Levels: number = 1\n        RouteSpeed: number = 1.2\n        TrackDist: number = 10.0\n        CollRadius: number = 0.0\n        CollHeight: number = 5.0\n        PickSphere: number = 6.0\n        AlertRadius: number = 40.0\n        CrossLand: boolean = true\n        RubbleCoef: number = 1.5\n        DontShowDamage: boolean = true\n        DontShowOnRadar: boolean = true\n        ScaredByPlayer: boolean = true\n        ScaredByBigBangs: boolean = true\n    }\n\n    Slug = new class SlugStats extends BaseConfig {\n        Levels: number = 1\n        RouteSpeed: number = 0.3\n        TrackDist: number = 10.0\n        CollRadius: number = 3.0\n        CollHeight: number = 7.0\n        PickSphere: number = 12.0\n        AlertRadius: number = 40.0\n        CrossLand: boolean = true\n        RubbleCoef: number = 0.3\n        UseHoles: boolean = true\n        DrainPower: boolean = true\n        AttackRadius: number = 280.0\n        PainThreshold: number = 50.0\n        CanBeShotAt: boolean = true\n        CanLaser: boolean = true\n        LaserDamage: number = 5.0\n        CanPush: boolean = true // Can this object be pusher'ed\n        PusherDist: number = 60.0 // Distance the object is pushed\n        PusherDamage: number = 5.0 // Damage that the pusher gun causes\n        ShowHealthBar: boolean = true\n        ScaredByBigBangs: boolean = true\n    }\n\n    LavaMonster = new class LavaMonsterStats extends BaseConfig {\n        Levels: number = 1\n        RouteSpeed: number = 0.8\n        TrackDist: number = 50.0\n        CollRadius: number = 10.0\n        CollHeight: number = 22.0\n        AlertRadius: number = 60.0\n        HealthDecayRate: number = 0.6 // Reduce health by 'n' every second.\n        PickSphere: number = 22.0\n        RepairValue: number = -10.0\n        CanScare: boolean = true\n        RestPercent: number = 20.0\n        CarryMinHealth: number = 15.0\n        PainThreshold: number = 20.0\n        StampRadius: number = 80.0\n        AttackRadius: number = 160.0\n        CanSteal: boolean = true\n        CrossLand: boolean = true\n        RubbleCoef: number = 1.5\n        GrabMinifigure: boolean = true\n        Capacity: number = 7 // How many crystals it can eat\n        RouteAvoidance: boolean = true\n        BumpDamage: boolean = true\n        AttackPaths: boolean = true\n        SplitOnZeroHealth: boolean = true\n        CanBeHitByFence: boolean = true\n        PathCoef: number = 0.5\n        CrossLava: boolean = true\n        // Statistics about the weapons\n        CanBeShotAt: boolean = true // Can this monster be shot at by lego men\n        CanFreeze: boolean = true // Can this object be frozen\n        FreezerTime: number = 75.0 // Time this object is frozen for\n        FreezerDamage: number = 40.0 // Damage that freezing causes\n        CanLaser: boolean = true // Can this object be lasered\n        LaserDamage: number = 1.0 // Damage sustained by a laser\n        CanPush: boolean = true // Can this object be pusher'ed\n        PusherDist: number = 60.0 // Distance the object is pushed\n        PusherDamage: number = 5.0 // Damage that the pusher gun causes\n        WakeRadius: number = 25.0\n        ScaredByBigBangs: boolean = true\n        RemoveReinforcement: boolean = true\n        ShowHealthBar: boolean = true\n    }\n\n    IceMonster = new class IceMonsterStats extends BaseConfig {\n        Levels: number = 1\n        RouteSpeed: number = 0.8\n        TrackDist: number = 50.0\n        CollRadius: number = 10.0\n        CollHeight: number = 22.0\n        AlertRadius: number = 60.0\n        HealthDecayRate: number = 0.6 // Reduce health by 'n' every second.\n        PickSphere: number = 22.0\n        RepairValue: number = -10.0\n        CanScare: boolean = true\n        RestPercent: number = 20.0\n        CarryMinHealth: number = 15.0\n        PainThreshold: number = 20.0\n        StampRadius: number = 80.0\n        AttackRadius: number = 120.0\n        CanSteal: boolean = true\n        CrossLand: boolean = true\n        RubbleCoef: number = 1.5\n        GrabMinifigure: boolean = true\n        Capacity: number = 5 // How many crystals it can eat\n        RouteAvoidance: boolean = true\n        BumpDamage: boolean = true\n        AttackPaths: boolean = true\n        SplitOnZeroHealth: boolean = true\n        CanBeHitByFence: boolean = true\n        PathCoef: number = 0.5\n        // Statistics about the weapons\n        CanBeShotAt: boolean = true // Can this monster be shot at by lego men\n        CanFreeze: boolean = false // Can this object be frozen\n        FreezerTime: number = 0.0 // Time this object is frozen for\n        FreezerDamage: number = 0.0 // Damage that freezing causes\n        CanLaser: boolean = true // Can this object be lasered\n        LaserDamage: number = 110.0 // Damage sustained by a laser\n        CanPush: boolean = true // Can this object be pusher'ed\n        PusherDist: number = 60.0 // Distance the object is pushed\n        PusherDamage: number = 2.0 // Damage that the pusher gun causes\n        WakeRadius: number = 25.0\n        ScaredByBigBangs: boolean = true\n        RemoveReinforcement: boolean = true\n        ShowHealthBar: boolean = true\n    }\n\n    Hoverboard = new class HoverboardStats extends BaseConfig { // [Carry][Scan][Speed][Drill]    (No drill or carry)\n        Levels: number = 8\n        RouteSpeed: number[] = [3.0, 3.0, 5.0, 5.0, 3.0, 3.0, 5.0, 5.0]\n        SurveyRadius: number[] = [0, 0, 0, 0, 4, 4, 4, 4]\n        TrackDist: number = 50.0\n        CollRadius: number = 8.0\n        CollHeight: number = 12.0\n        PickSphere: number = 16.0\n        CanBeDriven: boolean = true\n        CrossLand: boolean = true\n        UseSmallTeleporter: boolean = true\n        CanStrafe: boolean = true\n        CostCrystal: number = 1\n        UpgradeCostOre: number[] = [0, 5, 10, 0]\n        UpgradeCostStuds: number[] = [0, 1, 2, 0]\n        ShowHealthBar: boolean = true\n        EngineSound: string = 'SND_SmallEngine'\n    }\n\n    SmallHeli = new class SmallHeliStats extends BaseConfig {\n        Levels: number = 1\n        RouteSpeed: number = 2.50\n        TrackDist: number = 50.0\n        CollRadius: number = 10.0\n        CollHeight: number = 12.0\n        PickSphere: number = 20.0\n        CanBeDriven: boolean = true\n        CrossLand: boolean = true\n        CrossWater: boolean = true\n        CrossLava: boolean = true\n        UseSmallTeleporter: boolean = true\n        CanStrafe: boolean = true\n        CostCrystal: number = 3\n        ShowHealthBar: boolean = true\n        EngineSound: string = 'SND_HeliEngine'\n    }\n\n    Smallmlp = new class SmallmlpStats extends BaseConfig {\n        Levels: number = 4\n        RouteSpeed: number[] = [0.50, 0.50, 0.50, 0.50]\n        TrackDist: number = 50.0\n        CollRadius: number = 12.0\n        CollHeight: number = 22.0\n        PickSphere: number = 26.0\n        CanBeDriven: boolean = true\n        CrossLand: boolean = true\n        UseSmallTeleporter: boolean = true\n        Tracker: boolean = true\n        CanDoubleSelect: boolean = true\n        CostCrystal: number = 3\n        UpgradeCostOre: number[] = [0, 0, 0, 10]\n        UpgradeCostStuds: number[] = [0, 0, 0, 2]\n        ShowHealthBar: boolean = true\n        EngineSound: string = 'SND_MediumEngine'\n    }\n\n    SmallCat = new class SmallCatStats extends BaseConfig {\n        Levels: number = 3\n        RouteSpeed: number[] = [2.0, 3.0, 4.0]\n        TrackDist: number = 50.0\n        CollRadius: number = 12.0\n        CollHeight: number = 12.0\n        PickSphere: number = 26.0\n        CrossWater: boolean = true\n        CanBeDriven: boolean = true\n        UseWaterTeleporter: boolean = true\n        CostCrystal: number = 2\n        MaxCarry: number[] = [1, 1, 1]\n        GetInAtLand: boolean = true\n        GetOutAtLand: boolean = true\n        TakeCarryingDrivers: boolean = true\n        ShowHealthBar: boolean = true\n        EngineSound: string = 'SND_Catamaran'\n    }\n\n    SmallDigger = new class SmallDiggerStats extends BaseConfig {\n        Levels: number = 8\n        RouteSpeed: number[] = [2.0, 2.0, 4.0, 4.0, 2.0, 2.0, 4.0, 4.0]\n        SoilDrillTime: number[] = [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0]\n        LooseDrillTime: number[] = [2.0, 1.0, 2.0, 1.0, 2.0, 1.0, 2.0, 1.0]\n        MedDrillTime: number[] = [4.0, 2.0, 4.0, 2.0, 4.0, 2.0, 4.0, 2.0]\n        HardDrillTime: number[] = [180.0, 150.0, 180.0, 150.0, 180.0, 150.0, 180.0, 150.0]\n        SeamDrillTime: number[] = [8.0, 4.0, 8.0, 4.0, 8.0, 4.0, 8.0, 4.0]\n        MaxCarry: number[] = [0, 0, 0, 0, 0, 0, 0, 0]\n        SurveyRadius: number[] = [0, 0, 0, 0, 4, 4, 4, 4]\n        TrackDist: number = 50.0\n        CollRadius: number = 10.0\n        CollHeight: number = 12.0\n        PickSphere: number = 20.0\n        CanBeDriven: boolean = true\n        CrossLand: boolean = true\n        RouteAvoidance: boolean = true\n        UseSmallTeleporter: boolean = true\n        VehicleCanBeCarried: boolean = true\n        CostCrystal: number = 1\n        UpgradeCostOre: number[] = [0, 5, 10, 10]\n        UpgradeCostStuds: number[] = [0, 1, 2, 2]\n        ShowHealthBar: boolean = true\n        EngineSound: string = 'SND_SmallEngine'\n    }\n\n    SmallTruck = new class SmallTruckStats extends BaseConfig { // [Carry][Scan][Speed][Drill]    (No drill)\n        Levels: number = 16\n        RouteSpeed: number[] = [2.0, 2.0, 3.0, 3.0, 2.0, 2.0, 3.0, 3.0, 2.0, 2.0, 3.0, 3.0, 2.0, 2.0, 3.0, 3.0]\n        MaxCarry: number[] = [3, 3, 3, 3, 3, 3, 3, 3, 6, 6, 6, 6, 6, 6, 6, 6]\n        CarryStart: number[] = [0, 0, 0, 0, 0, 0, 0, 0, 3, 3, 3, 3, 3, 3, 3, 3]\n        SurveyRadius: number[] = [0, 0, 0, 0, 4, 4, 4, 4, 0, 0, 0, 0, 4, 4, 4, 4]\n        TrackDist: number = 50.0\n        CollRadius: number = 10.0\n        CollHeight: number = 12.0\n        PickSphere: number = 20.0\n        CanBeDriven: boolean = true\n        CrossLand: boolean = true\n        UseSmallTeleporter: boolean = true\n        VehicleCanBeCarried: boolean = true\n        CostCrystal: number = 2\n        EnterToolStore: boolean = true\n        UpgradeCostOre: number[] = [5, 5, 10, 0]\n        UpgradeCostStuds: number[] = [1, 1, 2, 0]\n        ShowHealthBar: boolean = true\n        EngineSound: string = 'SND_SmallEngine'\n    }\n\n    Bulldozer = new class BulldozerStats extends BaseConfig { // [Carry][Scan][Speed][Drill]    (No drill)\n        Levels: number = 16\n        RouteSpeed: number[] = [0.5, 0.5, 0.8, 0.8, 0.5, 0.5, 0.8, 0.8, 0.5, 0.5, 0.8, 0.8, 0.5, 0.5, 0.8, 0.8]\n        MaxCarry: number[] = [0, 0, 0, 0, 0, 0, 0, 0, 2, 2, 2, 2, 2, 2, 2, 2]\n        SurveyRadius: number[] = [0, 0, 0, 0, 5, 5, 5, 5, 0, 0, 0, 0, 5, 5, 5, 5]\n        TrackDist: number = 80.0\n        CollRadius: number = 18.0\n        CollHeight: number = 26.0\n        PickSphere: number = 40.0\n        CrossLand: boolean = true\n        CanClearRubble: boolean = true\n        UseBigTeleporter: boolean = true\n        CanBeDriven: boolean = true\n        CostCrystal: number = 4\n        InvisibleDriver: boolean = true\n        UpgradeCostOre: number[] = [5, 5, 20, 0]\n        UpgradeCostStuds: number[] = [1, 1, 4, 0]\n        ShowHealthBar: boolean = true\n        EngineSound: string = 'SND_MediumEngine'\n    }\n\n    WalkerDigger = new class WalkerDiggerStats extends BaseConfig { // [Carry][Scan][Speed][Drill]    (No carry)\n        Levels: number = 8\n        RouteSpeed: number[] = [0.50, 0.50, 0.80, 0.80, 0.50, 0.50, 0.80, 0.80]\n        SoilDrillTime: number[] = [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0]\n        LooseDrillTime: number[] = [0.80, 0.40, 0.80, 0.40, 0.80, 0.40, 0.80, 0.40]\n        MedDrillTime: number[] = [2.0, 1.0, 2.0, 1.0, 2.0, 1.0, 2.0, 1.0]\n        HardDrillTime: number[] = [180.0, 150.0, 180.0, 150.0, 180.0, 150.0, 180.0, 150.0]\n        SeamDrillTime: number[] = [4.0, 2.0, 4.0, 2.0, 4.0, 2.0, 4.0, 2.0]\n        SurveyRadius: number[] = [0, 0, 0, 0, 5, 5, 5, 5]\n        TrackDist: number = 80.0\n        CollRadius: number = 15.0\n        CollHeight: number = 33.0\n        PickSphere: number = 35.0\n        CrossLand: boolean = true\n        UseBigTeleporter: boolean = true\n        CostCrystal: number = 3\n        CanBeDriven: boolean = true\n        InvisibleDriver: boolean = true\n        CanStrafe: boolean = true\n        DrillSound: string = 'DrillSFX_Grinder'\n        DrillFadeSound: string = 'DrillSFX_GrinderFade'\n        UpgradeCostOre: number[] = [0, 5, 20, 20]\n        UpgradeCostStuds: number[] = [0, 1, 4, 4]\n        ShowHealthBar: boolean = true\n        EngineSound: string = 'SND_MediumEngine'\n    }\n\n    LargeDigger = new class LargeDiggerStats extends BaseConfig { // [Carry][Scan][Speed][Drill]    (No carry or scan)\n        Levels: number = 4\n        RouteSpeed: number[] = [0.30, 0.30, 0.60, 0.60]\n        SoilDrillTime: number[] = [1.0, 1.0, 1.0, 1.0]\n        LooseDrillTime: number[] = [0.40, 0.20, 0.40, 0.20]\n        MedDrillTime: number[] = [0.80, 0.40, 0.80, 0.40]\n        HardDrillTime: number[] = [1.0, 0.50, 1.0, 0.50]\n        SeamDrillTime: number[] = [1.0, 0.50, 1.0, 0.50]\n        TrackDist: number = 80.0\n        CollRadius: number = 22.0\n        CollHeight: number = 30.0\n        PickSphere: number = 50.0\n        CrossLand: boolean = true\n        UseBigTeleporter: boolean = true\n        Tracker: boolean = true\n        CanDoubleSelect: boolean = true\n        CanBeDriven: boolean = true\n        CostCrystal: number = 5\n        InvisibleDriver: boolean = true\n        DrillSound: string = 'DrillSFX_Grinder'\n        DrillFadeSound: string = 'DrillSFX_GrinderFade'\n        UpgradeCostOre: number[] = [0, 0, 15, 20]\n        UpgradeCostStuds: number[] = [0, 0, 3, 4]\n        ShowHealthBar: boolean = true\n        EngineSound: string = 'SND_LargeEngine'\n    }\n\n    LargeCat = new class LargeCatStats extends BaseConfig { // [Carry][Scan][Speed][Drill] (No carry) (Drill???)\n        Levels: number = 1\n        RouteSpeed: number = 1.50\n        SurveyRadius: number = 0\n        TrackDist: number = 80.0\n        CollRadius: number = 22.0\n        CollHeight: number = 25.0\n        PickSphere: number = 50.0\n        CanBeDriven: boolean = true\n        CrossWater: boolean = true\n        UseWaterTeleporter: boolean = true\n        ClassAsLarge: boolean = true\n        CarryVehicles: boolean = true\n        CostCrystal: number = 4\n        EngineSound: string = 'SND_Catamaran'\n        ShowHealthBar: boolean = true\n    }\n\n    LargeHeli = new class LargeHeliStats extends BaseConfig {\n        Levels: number = 3\n        RouteSpeed: number[] = [0.30, 0.40, 0.50]\n        TrackDist: number = 80.0\n        CollRadius: number = 0.0\n        CollHeight: number = 0.0\n        PickSphere: number = 20.0\n        ShowHealthBar: boolean = true\n        EngineSound: string = 'SND_HeliEngine'\n    }\n\n    LargeMLP = new class LargeMLPStats extends BaseConfig { // [Carry][Scan][Speed][Drill]    (No carry or speed) (Doesn't have drills, just lasers)\n        Levels: number = 8\n        RouteSpeed: number[] = [0.40, 0.40, 0.40, 0.40, 0.40, 0.40, 0.40, 0.40]\n        SurveyRadius: number[] = [0, 0, 0, 0, 5, 5, 5, 5]\n        TrackDist: number = 80.0\n        CollRadius: number = 20.0\n        CollHeight: number = 24.0\n        PickSphere: number = 47.0\n        CrossLand: boolean = true\n        UseBigTeleporter: boolean = true\n        Tracker: boolean = true\n        CanDoubleSelect: boolean = true\n        CostCrystal: number = 4\n        CanBeDriven: boolean = true\n        InvisibleDriver: boolean = true\n        UpgradeCostOre: number[] = [0, 5, 0, 25]\n        UpgradeCostStuds: number[] = [0, 1, 0, 5]\n        ShowHealthBar: boolean = true\n        EngineSound: string = 'SND_LargeEngine'\n    }\n\n    Barracks = new class BarracksStats extends BuildingEntityStats {\n        Levels: number = 3\n        TrackDist: number = 50.0\n        CollHeight: number = 23.0\n        CollRadius: number = 15.0\n        PickSphere: number = 30.0\n        CostOre: number = 15\n        CostRefinedOre: number = 3\n        CostCrystal: number = 3\n        SnaxULike: boolean = true\n        TrainDriver: boolean[] = [true, true, true]\n        CrystalDrain: number[] = [1, 1, 1]\n        DamageCausesCallToArms: boolean = true\n        OxygenCoef: number = 10.0\n        EngineSound: string = 'SND_BuildingHum'\n        ShowHealthBar: boolean = true\n    }\n\n    Powerstation = new class PowerstationStats extends BuildingEntityStats {\n        Levels: number = 2\n        TrackDist: number = 80.0\n        ProcessCrystal: boolean = true\n        CollHeight: number = 31.0\n        CollRadius: number = 15.0\n        PickSphere: number = 32.0\n        CostOre: number = 12\n        CostRefinedOre: number = 3\n        CostCrystal: number = 2\n        PowerBuilding: boolean = true\n        DamageCausesCallToArms: boolean = true\n        EngineSound: string = 'SND_PowerBuildingHum'\n        ShowHealthBar: boolean = true\n    }\n\n    OreRefinery = new class OreRefineryStats extends BuildingEntityStats {\n        Levels: number = 4\n        TrackDist: number = 60.0\n        ProcessOre: boolean = true\n        CollHeight: number = 16.0\n        CollRadius: number = 15.0\n        PickSphere: number = 30.0\n        CostOre: number = 20\n        CostRefinedOre: number = 4\n        CostCrystal: number = 3\n        CrystalDrain: number[] = [1, 1, 1, 1]\n        DamageCausesCallToArms: boolean = true\n        MaxCarry: number[] = [5, 4, 3, 2]\n        EngineSound: string = 'SND_BuildingHum'\n        ShowHealthBar: boolean = true\n    }\n\n    TeleportPad = new class TeleportPadStats extends BuildingEntityStats {\n        Levels: number = 3\n        TrackDist: number = 60.0\n        SmallTeleporter: boolean = true\n        ManTeleporter: boolean = true\n        CollHeight: number = 20.0\n        CollRadius: number = 15.0\n        PickSphere: number = 30.0\n        CostOre: number = 8\n        CostRefinedOre: number = 2\n        CrystalDrain: number[] = [1, 1, 1]\n        DamageCausesCallToArms: boolean = true\n        TrainPilot: boolean[] = [true, true, true]\n        EngineSound: string = 'SND_BuildingHum'\n        ShowHealthBar: boolean = true\n    }\n\n    TeleportBIG = new class TeleportBIGStats extends BuildingEntityStats {\n        Levels: number = 2\n        TrackDist: number = 50.0\n        BigTeleporter: boolean = true\n        CollHeight: number = 17.0\n        CollRadius: number = 15.0\n        PickSphere: number = 30.0\n        CostOre: number = 20\n        CostRefinedOre: number = 4\n        CostCrystal: number = 2\n        CrystalDrain: number[] = [1, 1]\n        DamageCausesCallToArms: boolean = true\n        EngineSound: string = 'SND_BuildingHum'\n        ShowHealthBar: boolean = true\n    }\n\n    Docks = new class DocksStats extends BuildingEntityStats {\n        Levels: number = 1\n        TrackDist: number = 60.0\n        CollHeight: number = 20.0\n        CollRadius: number = 15.0\n        PickSphere: number = 30.0\n        CostOre: number = 8\n        CostRefinedOre: number = 2\n        CostCrystal: number = 1\n        WaterEntrances: number = 1\n        WaterTeleporter: boolean = true\n        CrystalDrain: number = 1\n        DamageCausesCallToArms: boolean = true\n        TrainSailor: boolean = true\n        EngineSound: string = 'SND_BuildingHum'\n        ShowHealthBar: boolean = true\n    }\n\n    Toolstation = new class ToolstationStats extends BuildingEntityStats {\n        Levels: number = 3\n        TrackDist: number = 50.0\n        ManTeleporter: boolean = true\n        CollHeight: number = 16.0\n        CollRadius: number = 15.0\n        PickSphere: number = 30.0\n        ToolStore: boolean = true\n        StoreObjects: boolean = true\n        SelfPowered: boolean = true\n        DamageCausesCallToArms: boolean = true\n        TrainDynamite: boolean[] = [false, false, true]\n        FunctionCoef: number[] = [1.0, 1.0, 1.0] // Function here is how long it takes to upgrade a minfigure\n        ShowHealthBar: boolean = true\n    }\n\n    GunStation = new class GunStationStats extends BuildingEntityStats {\n        Levels: number = 2\n        TrackDist: number = 60.0\n        CollHeight: number = 33.0\n        CollRadius: number = 15.0\n        PickSphere: number = 30.0\n        CostOre: number = 15\n        CostRefinedOre: number = 3\n        CostCrystal: number = 1\n        Tracker: boolean = true\n        CanDoubleSelect: boolean = true\n        CrystalDrain: number[] = [1, 1]\n        DamageCausesCallToArms: boolean = true\n        FunctionCoef: number[] = [1.0, 0.5] // How much of a crystal it drains every time it fires...\n        EngineSound: string = 'SND_BuildingHum'\n        ShowHealthBar: boolean = true\n    }\n\n    Geodome = new class GeodomeStats extends BuildingEntityStats {\n        Levels: number = 3\n        TrackDist: number = 50.0\n        CollHeight: number = 20.0\n        CollRadius: number = 15.0\n        PickSphere: number = 30.0\n        CostOre: number = 15\n        CostRefinedOre: number = 3\n        CostCrystal: number = 3\n        SurveyRadius: number[] = [6, 8, 12]\n        CrystalDrain: number[] = [1, 1, 1]\n        DamageCausesCallToArms: boolean = true\n        TrainScanner: boolean[] = [true, true, true]\n        EngineSound: string = 'SND_BuildingHum'\n        ShowHealthBar: boolean = true\n    }\n\n    Upgrade = new class UpgradeStats extends BuildingEntityStats {\n        Levels: number = 2\n        TrackDist: number = 80.0\n        CollHeight: number = 40.0\n        CollRadius: number = 15.0\n        PickSphere: number = 32.0\n        CostOre: number = 20\n        CostRefinedOre: number = 4\n        CostCrystal: number = 3\n        UpgradeBuilding: boolean = true\n        CrystalDrain: number[] = [1, 1]\n        DamageCausesCallToArms: boolean = true\n        FunctionCoef: number[] = [0.8, 1.6] // Function is speed of upgrade animation.\n        TrainRepair: boolean[] = [true, true]\n        EngineSound: string = 'SND_BuildingHum'\n        ShowHealthBar: boolean = true\n    }\n\n    PowerCrystal = new class PowerCrystalStats extends BaseConfig {\n        Levels: number = 1\n        TrackDist: number = 20.0\n        CollHeight: number = 2.0\n        PickSphere: number = 6.0\n    }\n\n    ProcessedOre = new class ProcessedOreStats extends BaseConfig {\n        Levels: number = 1\n        TrackDist: number = 20.0\n        CollHeight: number = 2.0\n        PickSphere: number = 8.0\n    }\n\n    Ore = new class OreStats extends BaseConfig {\n        Levels: number = 1\n        TrackDist: number = 20.0\n        CollHeight: number = 2.0\n        PickSphere: number = 6.0\n    }\n\n    Boulder = new class BoulderStats extends BaseConfig {\n        Levels: number = 1\n        CollRadius: number = 2.0\n    }\n\n    Pusher = new class PusherStats extends BaseConfig {\n        Levels: number = 1\n        CollRadius: number = 1.0\n    }\n\n    Freezer = new class FreezerStats extends BaseConfig {\n        Levels: number = 1\n        CollRadius: number = 1.0\n    }\n\n    LaserShot = new class LaserShotStats extends BaseConfig {\n        Levels: number = 1\n        ColRadius: number = 1.0\n    }\n\n    ElectricFence = new class ElectricFenceStats extends BaseConfig {\n        Levels: number = 1\n        TrackDist: number = 50.0\n        CollRadius: number = 5.0\n        CollHeight: number = 18.0\n        PickSphere: number = 20.0\n        DamageCausesCallToArms: boolean = true\n    }\n\n    Path = new class PathStats extends BaseConfig {\n        Levels: number = 1\n        CostOre: number = 2\n        CostRefinedOre: number = 1\n    }\n\n    constructor(cfgObj: any) {\n        super()\n        BaseConfig.setFromCfg(this, cfgObj)\n    }\n\n    assignValue(objKey, lCfgKeyName, cfgValue): boolean {\n        if (objKey.toLowerCase() === lCfgKeyName) {\n            BaseConfig.setFromCfg(this[objKey], cfgValue)\n            return true\n        }\n    }\n\n}\n\n","import ResourceWorker from 'worker-loader!./wadworker/Resources'\nimport { RepeatWrapping, Texture } from 'three'\nimport { AnimationEntityType } from '../scene/model/anim/AnimationEntityType'\nimport { InitLoadingMessage } from './wadworker/InitLoadingMessage'\nimport { createContext, createDummyImgData } from '../core/ImageHelper'\nimport { iGet } from './wadworker/WadUtil'\nimport { getFilename } from '../core/Util'\nimport { AnimEntityLoader } from './AnimEntityLoader'\nimport { BitmapFont } from '../core/BitmapFont'\nimport { WorkerMessage, WorkerMessageType } from './wadworker/WorkerMessage'\nimport { GameStatsCfg } from '../cfg/GameStatsCfg'\n\nexport class ResourceManager {\n\n    static worker: ResourceWorker = new ResourceWorker()\n    static configuration: any = {}\n    static resourceByName: {} = {}\n    static fontCache = {}\n    static stats: GameStatsCfg\n\n    static startLoadingFromCache() {\n        return this.startLoading(null)\n    }\n\n    static startLoadingFromUrl(wad0Url: string, wad1Url: string) {\n        return this.startLoading(new InitLoadingMessage(wad0Url, wad1Url))\n    }\n\n    private static startLoading(msg: InitLoadingMessage) {\n        this.worker.onmessage = (event) => {\n            const msg: WorkerMessage = event.data\n            if (msg.type === WorkerMessageType.ASSET) {\n                this.resourceByName[msg.assetName.toLowerCase()] = msg.assetObj\n                this.onAssetLoaded()\n            } else if (msg.type === WorkerMessageType.MSG) {\n                this.onMessage(msg.text)\n            } else if (msg.type === WorkerMessageType.CFG) {\n                this.configuration = msg.cfg\n                this.stats = new GameStatsCfg(this.cfg('Stats'))\n                this.onInitialLoad(msg.totalResources)\n            } else if (msg.type === WorkerMessageType.CACHE_MISS) {\n                this.onCacheMissed()\n            } else if (msg.type === WorkerMessageType.DONE) {\n                console.log('Loading of about ' + msg.totalResources + ' assets complete! Total load time: ' + msg.loadingTimeSeconds + ' seconds.')\n                this.onLoadDone()\n            }\n        }\n        this.worker.postMessage(msg)\n    }\n\n    static onMessage: (msg: string) => any = (msg: string) => {\n        console.log(msg)\n    }\n\n    static onCacheMissed: () => any = () => {\n        console.log('Worker missed cache')\n    }\n\n    static onInitialLoad: (totalResources: number) => any = () => {\n        console.log('Initial loading done.')\n    }\n\n    static onAssetLoaded: () => any = () => {\n    }\n\n    static onLoadDone: () => any = () => {\n    }\n\n    static cfg(...keys: string[]): any {\n        return iGet(ResourceManager.configuration, ...keys)\n    }\n\n    static filterTextureSequenceNames(basename: string): string[] {\n        const lBasename = basename.toLowerCase()\n        const result = Object.keys(this.resourceByName).filter((name) => name.startsWith(lBasename))\n        if (result.length > 0) {\n            return result\n        } else if (!lBasename.startsWith('world/shared/')) {\n            return ResourceManager.filterTextureSequenceNames('world/shared/' + getFilename(basename))\n        } else {\n            console.warn('Texture sequence not found: ' + basename)\n            return null\n        }\n    }\n\n    static getResource(resourceName: string): any {\n        const lName = resourceName ? resourceName.toString().toLowerCase() : null\n        if (lName && this.resourceByName.hasOwnProperty(lName)) {\n            return this.resourceByName[lName]\n        }\n        return null\n    }\n\n    static getImageData(imageName): ImageData {\n        if (!imageName || imageName.length === 0) {\n            throw 'imageName must not be undefined, null or empty - was ' + imageName\n        }\n        const lImageName = imageName.toLowerCase()\n        let imgData = this.getResource(lImageName)\n        if (!imgData) {\n            console.error('Image \\'' + imageName + '\\' unknown! Using placeholder image instead')\n            ResourceManager.resourceByName[lImageName] = createDummyImgData(64, 64)\n        }\n        return ResourceManager.resourceByName[lImageName]\n    }\n\n    static getImage(imageName: string): HTMLCanvasElement {\n        const imgData = this.getImageData(imageName)\n        const context: CanvasRenderingContext2D = createContext(imgData.width, imgData.height)\n        context.putImageData(imgData, 0, 0)\n        return context.canvas\n    }\n\n    static getImageOrNull(imageName: string): HTMLCanvasElement | null {\n        if (!imageName) return null\n        return this.getImage(imageName)\n    }\n\n    static getTexture(textureName): Texture {\n        if (!textureName || textureName.length === 0) {\n            throw 'textureName must not be undefined, null or empty - was ' + textureName\n        }\n        const lTextureName = textureName.toLowerCase()\n        const lSharedTextureName = 'world/shared/' + getFilename(lTextureName)\n        let imgData = this.getResource(lTextureName) || this.getResource(lSharedTextureName)\n        if (!imgData) {\n            console.warn('Texture \\'' + textureName + '\\' (' + lTextureName + ', ' + lSharedTextureName + ') unknown! Using placeholder texture instead')\n            ResourceManager.resourceByName[lTextureName] = imgData = createDummyImgData(64, 64)\n        }\n        const texture = new Texture(imgData, Texture.DEFAULT_MAPPING, RepeatWrapping, RepeatWrapping)\n        texture.needsUpdate = true\n        return texture\n    }\n\n    static getMap(name: string) {\n        return name ? this.getResource(name) : null\n    }\n\n    static getAnimationEntityType(aeFilename: string): AnimationEntityType {\n        let cfgRoot = this.getResource(aeFilename)\n        if (!cfgRoot) throw 'Could not get animation entity type for: ' + aeFilename\n        return AnimEntityLoader.loadModels(aeFilename, cfgRoot)\n    }\n\n    static getBitmapFont(name: string): BitmapFont {\n        const fontImageData = this.getResource(name)\n        if (!fontImageData) throw 'Could not load font image data for: ' + name\n        ResourceManager.fontCache[name] = ResourceManager.fontCache[name] || new BitmapFont(fontImageData)\n        return ResourceManager.fontCache[name]\n    }\n\n    static getDefaultFont() {\n        return ResourceManager.getBitmapFont('Interface/Fonts/Font5_Hi.bmp')\n    }\n}\n","import { SPRITE_RESOLUTION_HEIGHT, SPRITE_RESOLUTION_WIDTH } from '../main'\nimport { ResourceManager } from '../resource/ResourceManager'\nimport { KEY_EVENT, POINTER_EVENT } from '../event/EventTypeEnum'\n\nexport class ScreenLayer {\n\n    canvas: HTMLCanvasElement\n    context: CanvasRenderingContext2D\n    onRedraw: (context: CanvasRenderingContext2D) => any\n    active: boolean = true\n\n    constructor(alpha: boolean = false, withContext: boolean = true) {\n        this.canvas = document.createElement('canvas')\n        if (!alpha) this.canvas.style.background = '#f0f'\n        if (withContext) this.context = this.canvas.getContext('2d', {alpha: alpha})\n        this.hide()\n    }\n\n    reset() {\n    }\n\n    setZIndex(zIndex: number) {\n        this.canvas.style.zIndex = String(zIndex)\n    }\n\n    static compareZ(layerA: ScreenLayer, layerB: ScreenLayer) {\n        let aIndex = layerA?.canvas?.style?.zIndex || 0\n        const bIndex = layerB?.canvas?.style?.zIndex || 0\n        return aIndex === bIndex ? 0 : aIndex > bIndex ? -1 : 1\n    }\n\n    resize(width, height) {\n        this.canvas.width = width\n        this.canvas.height = height\n    }\n\n    redraw() {\n        const callback = this.onRedraw\n        if (this.isActive() && callback) {\n            const context = this.context\n            requestAnimationFrame(() => callback(context))\n        }\n    }\n\n    show() {\n        this.reset()\n        this.active = true\n        this.canvas.style.visibility = 'visible'\n        this.redraw()\n    }\n\n    hide() {\n        this.active = false\n        this.canvas.style.visibility = 'hidden'\n    }\n\n    isActive() {\n        return this.active\n    }\n\n    toCanvasCoords(windowX: number, windowY: number) {\n        const clientRect = this.canvas.getBoundingClientRect()\n        return [windowX - clientRect.left, windowY - clientRect.top]\n    }\n\n    handlePointerEvent(eventEnum: POINTER_EVENT, event: PointerEvent): boolean {\n        return false\n    }\n\n    handleKeyEvent(eventEnum: KEY_EVENT, event: KeyboardEvent): boolean {\n        return false\n    }\n\n    handleWheelEvent(event: WheelEvent): boolean {\n        return false\n    }\n\n}\n\nexport class ScaledLayer extends ScreenLayer {\n\n    fixedWidth: number\n    fixedHeight: number\n\n    constructor() {\n        super(true)\n        this.fixedWidth = SPRITE_RESOLUTION_WIDTH\n        this.fixedHeight = SPRITE_RESOLUTION_HEIGHT\n    }\n\n    toScaledCoords(windowX: number, windowY: number) {\n        const [cx, cy] = this.toCanvasCoords(windowX, windowY)\n        return [cx / this.scaleX(), cy / this.scaleY()]\n    }\n\n    resize(width, height) {\n        super.resize(width, height)\n        this.context.scale(this.scaleX(), this.scaleY())\n    }\n\n    scaleX() {\n        return this.canvas.width / this.fixedWidth\n    }\n\n    scaleY() {\n        return this.canvas.height / this.fixedHeight\n    }\n\n}\n\nexport class CursorLayer extends ScaledLayer {\n\n    curUrl\n    cursorName: string = 'Aclosed'\n\n    show() {\n        super.show()\n        this.createCursor()\n    }\n\n    hide() {\n        super.hide()\n        this.canvas.style.cursor = null\n    }\n\n    createCursor() {\n        if (this.curUrl) URL.revokeObjectURL(this.curUrl)\n        const curImg = ResourceManager.getImage('Interface/Pointers/' + this.cursorName + '.bmp')\n        this.curUrl = curImg.toDataURL()\n        // Chrome limits cursor size to 32x32 anyway...\n        // const context: CanvasRenderingContext2D = createContext(curImg.width * this.scaleX(), curImg.height * this.scaleY());\n        // context.scale(this.scaleX(), this.scaleY());\n        // context.drawImage(curImg, 0, 0);\n        // this.curUrl = context.canvas.toDataURL();\n        this.canvas.style.cursor = 'url(' + this.curUrl + '), auto'\n    }\n\n    resize(width, height) {\n        super.resize(width, height)\n        if (this.isActive()) this.createCursor()\n    }\n\n}\n","import { ScreenLayer } from '../screen/ScreenLayer'\nimport { BaseScreen } from '../screen/BaseScreen'\nimport { KEY_EVENT, POINTER_EVENT } from './EventTypeEnum'\n\nexport class EventManager {\n\n    constructor(screen: BaseScreen) {\n        screen.gameCanvasContainer.addEventListener('contextmenu', (event: MouseEvent) => {\n            if (screen.isInRect(event)) event.preventDefault()\n        })\n        new Map<string, POINTER_EVENT>([\n            ['pointermove', POINTER_EVENT.MOVE],\n            ['pointerdown', POINTER_EVENT.DOWN],\n            ['pointerup', POINTER_EVENT.UP],\n        ]).forEach((eventEnum, eventType) => {\n            screen.gameCanvasContainer.addEventListener(eventType, (event: PointerEvent) => {\n                if (!screen.isInRect(event)) return\n                event.preventDefault()\n                // all event attibutes used by controls: clientX, clientY, deltaY, keyCode, touches, pointerType, button, ctrlKey, metaKey, shiftKey\n                const nonBubblingClone = new PointerEvent(event.type, {\n                    bubbles: false, // disable bubbling otherwise we'll trigger this same event handler again\n                    clientX: event.clientX,\n                    clientY: event.clientY,\n                    pointerType: event.pointerType,\n                    button: event.button,\n                    ctrlKey: event.ctrlKey,\n                    metaKey: event.metaKey,\n                    shiftKey: event.shiftKey,\n                })\n                screen.layers.filter(l => l.isActive())\n                    .sort((a, b) => ScreenLayer.compareZ(a, b))\n                    .some(l => l.handlePointerEvent(eventEnum, nonBubblingClone))\n            })\n        })\n        new Map<string, KEY_EVENT>([\n            ['keydown', KEY_EVENT.DOWN],\n            ['keyup', KEY_EVENT.UP],\n        ]).forEach((eventEnum, eventType) => {\n            screen.gameCanvasContainer.addEventListener(eventType, (event: KeyboardEvent) => {\n                // event.preventDefault(); // otherwise page reload with F5 stops working (may be intended in future)\n                screen.layers.filter(l => l.isActive())\n                    .sort((a, b) => ScreenLayer.compareZ(a, b))\n                    .some(l => l.handleKeyEvent(eventEnum, event))\n            })\n        })\n        screen.gameCanvasContainer.addEventListener('wheel', (event: WheelEvent) => {\n            if (!screen.isInRect(event)) return\n            // all event attibutes used by controls: clientX, clientY, deltaY, keyCode, touches, pointerType, button, ctrlKey, metaKey, shiftKey\n            const nonBubblingClone = new WheelEvent(event.type, {\n                bubbles: false, // disable bubbling otherwise we'll trigger this same event handler again\n                clientX: event.clientX,\n                clientY: event.clientY,\n                deltaX: event.deltaX,\n                deltaY: event.deltaY,\n                deltaZ: event.deltaZ,\n                button: event.button,\n                ctrlKey: event.ctrlKey,\n                metaKey: event.metaKey,\n                shiftKey: event.shiftKey,\n            })\n            screen.layers.filter(l => l.isActive())\n                .sort((a, b) => ScreenLayer.compareZ(a, b))\n                .some(l => l.handleWheelEvent(nonBubblingClone))\n        })\n    }\n\n}\n","import { CursorLayer, ScreenLayer } from './ScreenLayer'\nimport { EventManager } from '../event/EventManager'\n\nexport class BaseScreen {\n\n    gameCanvasContainer: HTMLElement\n    eventMgr: EventManager\n    layers: ScreenLayer[] = []\n    width: number = 800\n    height: number = 600\n    ratio: number = 800 / 600\n    cursorLayer: CursorLayer\n\n    constructor() {\n        this.gameCanvasContainer = document.getElementById('game-canvas-container')\n        this.gameCanvasContainer.focus()\n        this.eventMgr = new EventManager(this)\n        if (!this.gameCanvasContainer) throw 'Fatal error: game canvas container not found!'\n        window.addEventListener('resize', () => this.onWindowResize())\n        this.cursorLayer = this.addLayer(new CursorLayer(), 1000)\n        this.onWindowResize()\n    }\n\n    addLayer<T extends ScreenLayer>(layer: T, zIndex: number = 0): T {\n        layer.resize(this.width, this.height)\n        layer.setZIndex(zIndex)\n        this.layers.push(layer)\n        this.gameCanvasContainer.appendChild(layer.canvas)\n        return layer\n    }\n\n    redraw() {\n        this.layers.forEach((layer) => layer.redraw())\n    }\n\n    show() {\n        this.layers.forEach((layer) => layer.show())\n        this.redraw()\n    }\n\n    hide() {\n        this.layers.forEach((layer) => layer.hide())\n    }\n\n    onWindowResize() {\n        const maxWidth = this.gameCanvasContainer.offsetWidth, maxHeight = this.gameCanvasContainer.offsetHeight\n        const idealHeight = Math.round(maxWidth / this.ratio)\n        if (idealHeight > maxHeight) {\n            this.resize(Math.round(maxHeight * this.ratio), maxHeight)\n        } else {\n            this.resize(maxWidth, idealHeight)\n        }\n    }\n\n    resize(width: number, height: number) {\n        this.width = width\n        this.height = height\n        this.layers.forEach((layer) => layer.resize(width, height))\n        this.redraw()\n    }\n\n    isInRect(event: MouseEvent | WheelEvent) {\n        if (this.layers.length < 1) return false\n        const firstLayer = this.layers[0] // all layers have same state and size\n        if (!firstLayer.isActive() && !firstLayer.canvas) return false\n        const rect = firstLayer.canvas.getBoundingClientRect()\n        const clientX = event.clientX, clientY = event.clientY\n        return clientX >= rect.left && clientX < rect.right && clientY >= rect.top && clientY < rect.bottom\n    }\n\n}\n","import { BaseScreen } from './BaseScreen'\nimport { ResourceManager } from '../resource/ResourceManager'\nimport { ScaledLayer } from './ScreenLayer'\n\nexport class LoadingScreen extends BaseScreen {\n\n    layer: ScaledLayer\n    assetIndex: number = 0\n\n    constructor() {\n        super()\n        this.layer = this.addLayer(new ScaledLayer())\n    }\n\n    show() {\n        this.layers.forEach((layer) => {\n            if (layer !== this.cursorLayer) layer.show()\n        })\n        this.setLoadingMessage('Loading...')\n    }\n\n    setLoadingMessage(text) {\n        this.layer.onRedraw = (context) => {\n            // clear the screen to black\n            context.fillStyle = 'black'\n            context.fillRect(0, 0, this.layer.fixedWidth, this.layer.fixedHeight)\n            // draw the loading title\n            context.font = '24px Arial'\n            context.fillStyle = 'white'\n            context.fillText('Loading Rock Raiders', 20, this.layer.fixedHeight - 50)\n            // hard-code the first loading message\n            context.font = '18px Arial'\n            context.fillStyle = 'white'\n            context.fillText(text, 20, this.layer.fixedHeight - 20)\n        }\n        this.redraw()\n    }\n\n    enableGraphicMode(totalResources: number) {\n        const imgBackground = ResourceManager.getImage(ResourceManager.cfg('Main', 'LoadScreen'))\n        const imgProgress = ResourceManager.getImage(ResourceManager.cfg('Main', 'ProgressBar'))\n        const imgLoading = ResourceManager.getDefaultFont().createTextImage(ResourceManager.cfg('Main', 'LoadingText'))\n        this.layer.onRedraw = (context => {\n            context.drawImage(imgBackground, 0, 0)\n            const loadingBarWidth = 353 * (this.assetIndex < totalResources ? Math.round(this.assetIndex / totalResources) : 1)\n            context.drawImage(imgProgress, 142, 450, loadingBarWidth, 9)\n            context.drawImage(imgLoading, Math.round(320 - imgLoading.width / 2), Math.round(456 - imgLoading.height / 2))\n        })\n        this.cursorLayer.show()\n        this.redraw()\n    }\n\n    increaseLoadingState() {\n        this.assetIndex++\n        this.redraw()\n    }\n\n}\n","export class MainMenuBaseItem {\n\n    x: number = 0\n    y: number = 0\n    width: number = 0\n    height: number = 0\n    zIndex: number = 100\n    scrollAffected = false\n    needsRedraw: boolean = false\n    hover: boolean = false\n    pressed: boolean = false\n    actionName: string = ''\n    targetIndex: number = 0\n\n    static compareZ(left: MainMenuBaseItem, right: MainMenuBaseItem) {\n        return left.zIndex === right.zIndex ? 0 : left.zIndex > right.zIndex ? -1 : 1\n    }\n\n    checkHover(sx: number, sy: number): boolean {\n        const hover = sx >= this.x && sx < this.x + this.width && sy >= this.y && sy < this.y + this.height\n        if (this.hover !== hover) {\n            this.hover = hover\n            this.needsRedraw = true\n            this.onHoverChange()\n        }\n        if (!this.hover) this.pressed = false\n        return this.hover\n    }\n\n    onHoverChange() {\n    }\n\n    checkSetPressed() {\n        if (!this.hover) return\n        if (!this.pressed) this.needsRedraw = true\n        this.pressed = true\n    }\n\n    setReleased() {\n        if (this.pressed) this.needsRedraw = true\n        this.pressed = false\n    }\n\n    draw(context: CanvasRenderingContext2D) {\n        this.needsRedraw = false\n    }\n\n}\n","import { MainMenuLayer } from './MainMenuLayer'\nimport { MainMenuBaseItem } from './MainMenuBaseItem'\nimport { MenuLabelItemCfg } from '../cfg/MenuLabelItemCfg'\n\nexport class MainMenuLabelButton extends MainMenuBaseItem {\n\n    labelImgLo = null\n    labelImgHi = null\n\n    constructor(layer: MainMenuLayer, cfg: MenuLabelItemCfg) {\n        super()\n        this.labelImgLo = layer.loFont.createTextImage(cfg.label)\n        this.labelImgHi = layer.hiFont.createTextImage(cfg.label)\n        this.width = Math.max(this.labelImgLo.width, this.labelImgHi.width)\n        this.height = Math.max(this.labelImgLo.height, this.labelImgHi.height)\n        this.x = layer.cfg.autoCenter ? (layer.fixedWidth - this.width) / 2 : layer.cfg.position[0] + cfg.x\n        this.y = layer.cfg.position[1] + cfg.y\n        this.actionName = cfg.actionName\n        if (this.actionName === 'Next') this.targetIndex = Number(cfg.target.substring('menu'.length)) - 1\n    }\n\n    draw(context: CanvasRenderingContext2D) {\n        super.draw(context)\n        const img = this.hover && !this.pressed ? this.labelImgHi : this.labelImgLo\n        context.drawImage(img, this.x, this.y)\n    }\n\n}\n","import { MainMenuLayer } from './MainMenuLayer'\nimport { MainMenuBaseItem } from './MainMenuBaseItem'\nimport { ResourceManager } from '../resource/ResourceManager'\nimport { MenuLabelItemCfg } from '../cfg/MenuLabelItemCfg'\n\nexport class MainMenuIconButton extends MainMenuBaseItem {\n\n    imgNormal = null\n    imgHover = null\n    imgPressed = null\n    tooltip = ''\n\n    constructor(layer: MainMenuLayer, cfg: MenuLabelItemCfg) {\n        super()\n        this.imgNormal = ResourceManager.getImage(cfg.imgNormal)\n        this.imgHover = ResourceManager.getImage(cfg.imgHover)\n        this.imgPressed = ResourceManager.getImage(cfg.imgPressed)\n        this.tooltip = (cfg.tooltip || '').replace(/_/g, ' ')\n        this.width = Math.max(this.imgNormal.width, this.imgHover.width, this.imgPressed.width)\n        this.height = Math.max(this.imgNormal.height, this.imgHover.height, this.imgPressed.height)\n        this.x = layer.cfg.autoCenter ? (layer.fixedWidth - this.width) / 2 : layer.cfg.position[0] + cfg.x\n        this.y = layer.cfg.position[1] + cfg.y\n        this.actionName = cfg.actionName\n        if (this.actionName === 'Next') this.targetIndex = Number(cfg.target.substring('menu'.length)) - 1\n    }\n\n    draw(context: CanvasRenderingContext2D) {\n        super.draw(context)\n        let img = this.imgNormal\n        if (this.hover) img = this.imgHover\n        if (this.pressed) img = this.imgPressed\n        context.drawImage(img, this.x, this.y)\n    }\n\n}\n","import { ResourceManager } from '../resource/ResourceManager'\nimport { MainMenuLabelButton } from './MainMenuLabelButton'\nimport { ScaledLayer } from '../screen/ScreenLayer'\nimport { MenuEntryCfg } from '../cfg/MenuEntryCfg'\nimport { BitmapFont } from '../core/BitmapFont'\nimport { MOUSE_BUTTON, POINTER_EVENT } from '../event/EventTypeEnum'\nimport { MainMenuScreen } from '../screen/MainMenuScreen'\nimport { MainMenuIconButton } from './MainMenuIconButton'\nimport { MainMenuBaseItem } from './MainMenuBaseItem'\nimport { MainMenuLevelButton } from './MainMenuLevelButton'\nimport { clearIntervalSafe } from '../core/Util'\nimport { NATIVE_FRAMERATE } from '../main'\n\nexport class MainMenuLayer extends ScaledLayer {\n\n    screen: MainMenuScreen\n    cfg: MenuEntryCfg\n    loFont: BitmapFont\n    hiFont: BitmapFont\n    menuImage: HTMLCanvasElement\n    titleImage: HTMLCanvasElement\n    items: MainMenuBaseItem[] = []\n    scrollY: number = 0\n    scrollSpeedY: number = 0\n    scrollInterval = null\n\n    constructor(screen: MainMenuScreen, menuCfg: MenuEntryCfg) {\n        super()\n        this.screen = screen\n        this.cfg = menuCfg\n        this.loFont = menuCfg.loFont ? ResourceManager.getBitmapFont(menuCfg.loFont) : null\n        this.hiFont = menuCfg.hiFont ? ResourceManager.getBitmapFont(menuCfg.hiFont) : null\n        this.menuImage = menuCfg.menuImage ? ResourceManager.getImage(menuCfg.menuImage) : null\n        this.titleImage = this.loFont.createTextImage(menuCfg.fullName)\n\n        menuCfg.itemsLabel.forEach((item) => {\n            if (item.label) {\n                this.items.push(new MainMenuLabelButton(this, item))\n            } else {\n                this.items.push(new MainMenuIconButton(this, item))\n            }\n        })\n\n        this.items.sort((a, b) => MainMenuBaseItem.compareZ(a, b))\n\n        this.onRedraw = (context) => {\n            context.drawImage(this.menuImage, 0, -this.scrollY)\n            if (menuCfg.displayTitle) context.drawImage(this.titleImage, (this.fixedWidth - this.titleImage.width) / 2, this.cfg.position[1])\n            this.items.forEach((item, index) => (this.items[this.items.length - 1 - index]).draw(context))\n        }\n    }\n\n    reset() {\n        super.reset()\n        this.scrollY = 0\n        this.scrollSpeedY = 0\n    }\n\n    show() {\n        super.show()\n        const that = this\n        this.scrollInterval = setInterval(() => {\n            if (that.scrollSpeedY === 0) return\n            that.setScrollY(that.scrollSpeedY)\n        }, 1000 / NATIVE_FRAMERATE)\n    }\n\n    hide() {\n        this.scrollInterval = clearIntervalSafe(this.scrollInterval)\n        super.hide()\n    }\n\n    handlePointerEvent(eventEnum: POINTER_EVENT, event: PointerEvent): boolean {\n        if (eventEnum === POINTER_EVENT.MOVE) {\n            const [sx, sy] = this.toScaledCoords(event.clientX, event.clientY)\n            let hovered = false\n            this.items.forEach((item) => {\n                if (!hovered) {\n                    const absY = sy + (item.scrollAffected ? this.scrollY : 0)\n                    hovered = item.checkHover(sx, absY)\n                } else {\n                    if (item.hover) item.needsRedraw = true\n                    item.hover = false\n                    item.setReleased()\n                }\n            })\n            if (this.cfg.canScroll) {\n                const scrollAreaHeight = 100\n                if (sy < scrollAreaHeight) {\n                    this.setScrollSpeedY(-(scrollAreaHeight - sy))\n                } else if (sy > this.fixedHeight - scrollAreaHeight) {\n                    this.setScrollSpeedY(sy - (this.fixedHeight - scrollAreaHeight))\n                } else {\n                    this.setScrollSpeedY(0)\n                }\n            }\n        } else if (eventEnum === POINTER_EVENT.DOWN) {\n            if (event.button === MOUSE_BUTTON.MAIN) {\n                this.items.forEach((item) => item.checkSetPressed())\n            }\n        } else if (eventEnum === POINTER_EVENT.UP) {\n            if (event.button === MOUSE_BUTTON.MAIN) {\n                this.items.forEach((item) => {\n                    if (item.pressed) {\n                        item.setReleased()\n                        if (item.actionName.toLowerCase() === 'next') {\n                            this.screen.showMainMenu(item.targetIndex)\n                        } else if (item.actionName.toLowerCase() === 'selectlevel') {\n                            this.screen.selectLevel((item as MainMenuLevelButton).levelKey)\n                        } else if (item.actionName) {\n                            console.warn('not implemented: ' + item.actionName + ' - ' + item.targetIndex)\n                        }\n                    }\n                })\n            }\n        }\n        if (this.needsRedraw()) this.redraw()\n        return false\n    }\n\n    private setScrollSpeedY(deltaY: number) {\n        this.scrollSpeedY = Math.sign(deltaY) * Math.pow(Math.round(deltaY / 20), 2)\n    }\n\n    handleWheelEvent(event: WheelEvent): boolean {\n        if (!this.cfg.canScroll) return false\n        this.setScrollY(event.deltaY)\n        return true\n    }\n\n    private setScrollY(deltaY: number) {\n        const scrollYBefore = this.scrollY\n        this.scrollY = Math.min(Math.max(this.scrollY + deltaY, 0), this.menuImage.height - this.fixedHeight)\n        if (scrollYBefore !== this.scrollY) this.redraw()\n    }\n\n    needsRedraw(): boolean {\n        return this.items.some((item) => item.needsRedraw)\n    }\n\n}\n","import { MainMenuLayer } from './MainMenuLayer'\nimport { MainMenuBaseItem } from './MainMenuBaseItem'\nimport { LevelEntryCfg } from '../cfg/LevelsCfg'\nimport { ResourceManager } from '../resource/ResourceManager'\n\nexport class MainMenuLevelButton extends MainMenuBaseItem {\n\n    layer: MainMenuLayer\n    imgActive = null\n    imgInactive = null\n    imgCross = null\n    unlocked: boolean = false\n    levelKey: string = ''\n\n    constructor(layer: MainMenuLayer, levelKey: string, levelCfg: LevelEntryCfg) {\n        super()\n        this.layer = layer\n        this.actionName = 'selectlevel'\n        this.levelKey = levelKey\n        this.x = levelCfg.frontEndX\n        this.y = levelCfg.frontEndY\n        this.zIndex = 10\n        this.scrollAffected = true\n        const [imgActive, imgInactive, imgCross] = levelCfg.menuBMP\n        this.imgActive = ResourceManager.getImage(imgActive)\n        this.imgInactive = ResourceManager.getImage(imgInactive)\n        this.imgCross = ResourceManager.getImage(imgCross)\n        this.width = Math.max(this.imgActive.width, this.imgInactive.width, this.imgCross.width)\n        this.height = Math.max(this.imgActive.height, this.imgInactive.height, this.imgCross.height)\n        this.unlocked = levelCfg.frontEndOpen\n        this.unlocked = true // TODO don't unlock everything by default\n    }\n\n    draw(context: CanvasRenderingContext2D) {\n        super.draw(context)\n        let img = this.imgCross\n        if (this.unlocked) img = this.hover ? this.imgActive : this.imgInactive\n        context.drawImage(img, this.x, this.y - this.layer.scrollY)\n    }\n\n}\n","import { MainMenuBaseItem } from './MainMenuBaseItem'\nimport { createContext } from '../core/ImageHelper'\n\nexport class MainMenuPanel extends MainMenuBaseItem {\n\n    context: CanvasRenderingContext2D\n\n    constructor(imgData: ImageData, area: { x: number, y: number, w: number, h: number }) {\n        super()\n        this.zIndex = 50\n        this.context = createContext(imgData.width, imgData.height)\n        this.context.putImageData(imgData, 0, 0)\n        this.x = area.x\n        this.y = area.y\n        this.width = area.w\n        this.height = area.h\n    }\n\n    checkHover(sx: number, sy: number): boolean {\n        const inRect = sx >= this.x && sx < this.x + this.width && sy >= this.y && sy < this.y + this.height\n        const hover = inRect && this.context.getImageData(sx, sy, 1, 1).data[3] > 0\n        if (this.hover !== hover) this.needsRedraw = true\n        this.hover = hover\n        return this.hover\n    }\n\n    draw(context: CanvasRenderingContext2D) {\n        super.draw(context)\n        context.drawImage(this.context.canvas, this.x, this.y, this.width, this.height)\n    }\n\n}\n","import { MainMenuBaseItem } from './MainMenuBaseItem'\nimport { BitmapFont } from '../core/BitmapFont'\n\nexport class MainMenuWindow extends MainMenuBaseItem {\n\n    font: BitmapFont\n    imgFirstLine = null\n    imgSecondLine = null\n\n    constructor(font: BitmapFont, area: { x: number, y: number, w: number, h: number }) {\n        super()\n        this.font = font\n        this.x = area.x\n        this.y = area.y\n        this.width = area.w\n        this.height = area.h\n    }\n\n    setFirstLine(text: string) {\n        this.imgFirstLine = !!text ? this.font.createTextImage(text) : null\n    }\n\n    setSecondLine(text: string) {\n        this.imgSecondLine = !!text ? this.font.createTextImage(text) : null\n    }\n\n    draw(context: CanvasRenderingContext2D) {\n        super.draw(context)\n        const cx = this.x + this.width / 2, cy = this.y + this.height / 2\n        if (this.imgFirstLine) context.drawImage(this.imgFirstLine, cx - this.imgFirstLine.width / 2, cy - this.imgFirstLine.height)\n        if (this.imgSecondLine) context.drawImage(this.imgSecondLine, cx - this.imgSecondLine.width / 2, cy)\n    }\n\n}\n","import { MainMenuLayer } from './MainMenuLayer'\nimport { LevelEntryCfg, LevelsCfg } from '../cfg/LevelsCfg'\nimport { ResourceManager } from '../resource/ResourceManager'\nimport { MainMenuLevelButton } from './MainMenuLevelButton'\nimport { MainMenuScreen } from '../screen/MainMenuScreen'\nimport { MenuEntryCfg } from '../cfg/MenuEntryCfg'\nimport { iGet } from '../core/Util'\nimport { MainMenuPanel } from './MainMenuPanel'\nimport { MainMenuBaseItem } from './MainMenuBaseItem'\nimport { MainMenuWindow } from './MainMenuWindow'\n\nexport class LevelSelectLayer extends MainMenuLayer {\n\n    constructor(screen: MainMenuScreen, menuCfg: MenuEntryCfg, modeLevel: boolean) {\n        super(screen, menuCfg)\n        const levelsCfg: LevelsCfg = ResourceManager.getResource('Levels')\n        const levelTextCfg = new LevelTextCfg()\n        this.items.push(new MainMenuPanel(levelTextCfg.panelImgData, levelTextCfg.panelPos))\n        const levelTextWindow = new MainMenuWindow(ResourceManager.getDefaultFont(), levelTextCfg.window)\n        levelTextWindow.setFirstLine(modeLevel ? levelTextCfg.level : levelTextCfg.tutorial)\n        this.items.push(levelTextWindow)\n        Object.keys(levelsCfg.levelsByName).forEach((levelKey) => {\n            const level: LevelEntryCfg = levelsCfg.levelsByName[levelKey]\n            const levelButton = new MainMenuLevelButton(this, levelKey, level)\n            levelButton.onHoverChange = () => levelTextWindow.setSecondLine(levelButton.hover ? level.fullName : '')\n            this.items.push(levelButton)\n        })\n        this.items.sort((a, b) => MainMenuBaseItem.compareZ(a, b))\n    }\n\n}\n\nclass LevelTextCfg {\n\n    window = {x: 0, y: 0, w: 0, h: 0}\n    panelImgData: ImageData\n    panelPos = {x: 0, y: 0, w: 0, h: 0}\n    level: string = ''\n    tutorial: string = ''\n\n    constructor() {\n        const cfg = ResourceManager.cfg('Menu', 'LevelText')\n        const winCfg = iGet(cfg, 'Window')\n        this.window = {x: winCfg[0], y: winCfg[1], w: winCfg[2], h: winCfg[3]}\n        const panelCfg = iGet(cfg, 'Panel')\n        this.panelImgData = ResourceManager.getImageData(panelCfg[0])\n        this.panelPos = {x: panelCfg[1], y: panelCfg[2], w: panelCfg[3], h: panelCfg[4]}\n        this.level = iGet(cfg, 'Level').join(',').replace(/_/g, ' ') // TODO improve cfg handling, remove join\n        this.tutorial = iGet(cfg, 'Tutorial').join(',').replace(/_/g, ' ') // TODO improve cfg handling, remove join\n    }\n\n}\n","import { BaseScreen } from './BaseScreen'\nimport { ResourceManager } from '../resource/ResourceManager'\nimport { MenuCfg } from '../cfg/MenuCfg'\nimport { MainMenuLayer } from '../menu/MainMenuLayer'\nimport { LevelSelectLayer } from '../menu/LevelSelectLayer'\n\nexport class MainMenuScreen extends BaseScreen {\n\n    onLevelSelected: (levelName: string) => void = null\n    menus: MainMenuLayer[] = []\n\n    constructor() {\n        super()\n        const mainMenuFullCfg = ResourceManager.getResource('MainMenuFull') as MenuCfg\n        mainMenuFullCfg.menus.forEach((menuCfg) => {\n            let layer\n            if (menuCfg.title === 'Levels') {\n                layer = new LevelSelectLayer(this, menuCfg, true)\n            } else if (menuCfg.title === 'Tutorials') {\n                layer = new LevelSelectLayer(this, menuCfg, false)\n            } else {\n                layer = new MainMenuLayer(this, menuCfg)\n            }\n            this.menus.push(layer)\n            this.addLayer(layer)\n        })\n    }\n\n    showMainMenu(index: number = 0) {\n        this.hide()\n        this.menus[index].show()\n        this.cursorLayer.show()\n    }\n\n    showLevelSelection() {\n        this.showMainMenu(1)\n    }\n\n    selectLevel(levelName) {\n        this.hide()\n        this.onLevelSelected(levelName)\n    }\n\n}\n","// javascript-astar 0.4.1 (converted to typescript by Scarabol)\n// http://github.com/bgrins/javascript-astar\n// Freely distributable under the MIT License.\n// Implements the astar search algorithm in javascript using a Binary Heap.\n// Includes Binary Heap (with modifications) from Marijn Haverbeke.\n// http://eloquentjavascript.net/appendix2.html\n\nfunction pathTo(node) {\n    let curr = node\n    const path = []\n    while (curr.parent) {\n        path.unshift(curr)\n        curr = curr.parent\n    }\n    return path\n}\n\nfunction getHeap() {\n    return new BinaryHeap(function (node) {\n        return node.f\n    })\n}\n\nexport const astar = {\n\n    /**\n     * Perform an A* Search on a graph given a start and end node.\n     * @param {Graph} graph\n     * @param {GridNode} start\n     * @param {GridNode} end\n     * @param {Object} [options]\n     * @param {boolean} [options.closest] Specifies whether to return the\n     path to the closest node if the target is unreachable.\n     * @param {Function} [options.heuristic] Heuristic function (see\n     *          astar.heuristics).\n     */\n    search(graph: Graph, start: GridNode, end: GridNode, options = null): GridNode[] {\n        graph.cleanDirty()\n        options = options || {}\n        const heuristic = options.heuristic || astar.heuristics.manhattan\n        const closest = options.closest || false\n\n        const openHeap = getHeap()\n        let closestNode = start  // set the start node to be the closest if required\n\n        start.h = heuristic(start, end)\n        graph.markDirty(start)\n\n        openHeap.push(start)\n\n        while (openHeap.size() > 0) {\n\n            // Grab the lowest f(x) to process next.  Heap keeps this sorted for us.\n            const currentNode = openHeap.pop()\n\n            // End case -- result has been found, return the traced path.\n            if (currentNode === end) {\n                return pathTo(currentNode)\n            }\n\n            // Normal case -- move currentNode from open to closed, process each of its neighbors.\n            currentNode.closed = true\n\n            // Find all neighbors for the current node.\n            const neighbors = graph.neighbors(currentNode)\n\n            let i = 0\n            const il = neighbors.length\n            for (; i < il; ++i) {\n                const neighbor = neighbors[i]\n\n                if (neighbor.closed || neighbor.isWall()) {\n                    // Not a valid node to process, skip to next neighbor.\n                    continue\n                }\n\n                // The g score is the shortest distance from start to current node.\n                // We need to check if the path we have arrived at this neighbor is the shortest one we have seen yet.\n                const gScore = currentNode.g + neighbor.getCost(currentNode)\n                const beenVisited = neighbor.visited\n\n                if (!beenVisited || gScore < neighbor.g) {\n\n                    // Found an optimal (so far) path to this node.  Take score for node to see how good it is.\n                    neighbor.visited = true\n                    neighbor.parent = currentNode\n                    neighbor.h = neighbor.h || heuristic(neighbor, end)\n                    neighbor.g = gScore\n                    neighbor.f = neighbor.g + neighbor.h\n                    graph.markDirty(neighbor)\n                    if (closest) {\n                        // If the neighbour is closer than the current closestNode or if it's equally close but has\n                        // a cheaper path than the current closest node then it becomes the closest node\n                        if (neighbor.h < closestNode.h || (neighbor.h === closestNode.h && neighbor.g < closestNode.g)) {\n                            closestNode = neighbor\n                        }\n                    }\n\n                    if (!beenVisited) {\n                        // Pushing to heap will put it in proper place based on the 'f' value.\n                        openHeap.push(neighbor)\n                    } else {\n                        // Already seen the node, but since it has been rescored we need to reorder it in the heap\n                        openHeap.rescoreElement(neighbor)\n                    }\n                }\n            }\n        }\n\n        if (closest) {\n            return pathTo(closestNode)\n        }\n\n        // No result was found - empty array signifies failure to find path.\n        return []\n    },\n\n    // See list of heuristics: http://theory.stanford.edu/~amitp/GameProgramming/Heuristics.html\n    heuristics: {\n        manhattan(pos0, pos1) {\n            const d1 = Math.abs(pos1.x - pos0.x)\n            const d2 = Math.abs(pos1.y - pos0.y)\n            return d1 + d2\n        },\n\n        diagonal(pos0, pos1) {\n            const D = 1\n            const D2 = Math.sqrt(2)\n            const d1 = Math.abs(pos1.x - pos0.x)\n            const d2 = Math.abs(pos1.y - pos0.y)\n            return (D * (d1 + d2)) + ((D2 - (2 * D)) * Math.min(d1, d2))\n        },\n    },\n\n    cleanNode(node) {\n        node.f = 0\n        node.g = 0\n        node.h = 0\n        node.visited = false\n        node.closed = false\n        node.parent = null\n    },\n}\n\nexport class Graph {\n\n    readonly nodes: GridNode[] = []\n    readonly diagonal: boolean\n    readonly grid: GridNode[][] = []\n    dirtyNodes: GridNode[] = []\n\n    /**\n     * A graph memory structure\n     * @param {Array} gridIn 2D array of input weights\n     * @param {Object} [options]\n     * @param {boolean} [options.diagonal] Specifies whether diagonal moves are allowed\n     */\n    constructor(gridIn: number[][], options = null) {\n        options = options || {}\n        this.diagonal = !!options.diagonal\n        for (let x = 0; x < gridIn.length; x++) {\n            this.grid[x] = []\n\n            let y = 0\n            const row = gridIn[x]\n            for (; y < row.length; y++) {\n                const node = new GridNode(x, y, row[y])\n                this.grid[x][y] = node\n                this.nodes.push(node)\n            }\n        }\n        this.init()\n    }\n\n    init() {\n        this.dirtyNodes = []\n        for (let i = 0; i < this.nodes.length; i++) {\n            astar.cleanNode(this.nodes[i])\n        }\n    }\n\n    cleanDirty() {\n        for (let i = 0; i < this.dirtyNodes.length; i++) {\n            astar.cleanNode(this.dirtyNodes[i])\n        }\n        this.dirtyNodes = []\n    }\n\n    markDirty(node) {\n        this.dirtyNodes.push(node)\n    }\n\n    neighbors(node: GridNode) {\n        const ret: GridNode[] = []\n        const x = node.x\n        const y = node.y\n        const grid = this.grid\n\n        // West\n        if (grid[x - 1] && grid[x - 1][y]) {\n            ret.push(grid[x - 1][y])\n        }\n\n        // East\n        if (grid[x + 1] && grid[x + 1][y]) {\n            ret.push(grid[x + 1][y])\n        }\n\n        // South\n        if (grid[x] && grid[x][y - 1]) {\n            ret.push(grid[x][y - 1])\n        }\n\n        // North\n        if (grid[x] && grid[x][y + 1]) {\n            ret.push(grid[x][y + 1])\n        }\n\n        if (this.diagonal) {\n            // Southwest\n            if (grid[x - 1] && grid[x - 1][y - 1]) {\n                ret.push(grid[x - 1][y - 1])\n            }\n\n            // Southeast\n            if (grid[x + 1] && grid[x + 1][y - 1]) {\n                ret.push(grid[x + 1][y - 1])\n            }\n\n            // Northwest\n            if (grid[x - 1] && grid[x - 1][y + 1]) {\n                ret.push(grid[x - 1][y + 1])\n            }\n\n            // Northeast\n            if (grid[x + 1] && grid[x + 1][y + 1]) {\n                ret.push(grid[x + 1][y + 1])\n            }\n        }\n\n        return ret\n    }\n\n    toString() {\n        const graphString = []\n        const nodes = this.grid\n        for (let x = 0; x < nodes.length; x++) {\n            const rowDebug = []\n            const row = nodes[x]\n            for (let y = 0; y < row.length; y++) {\n                rowDebug.push(row[y].weight)\n            }\n            graphString.push(rowDebug.join(' '))\n        }\n        return graphString.join('\\n')\n    }\n}\n\nclass GridNode {\n\n    x: number\n    y: number\n    weight: number\n    h: number\n    closed: boolean\n    visited: boolean\n    g: number\n    parent: GridNode\n    f: number\n\n    constructor(x, y, weight) {\n        this.x = x\n        this.y = y\n        this.weight = weight\n    }\n\n    toString() {\n        return '[' + this.x + ' ' + this.y + ']'\n    }\n\n    getCost(fromNeighbor: GridNode) {\n        // Take diagonal weight into consideration.\n        if (fromNeighbor && fromNeighbor.x != this.x && fromNeighbor.y != this.y) {\n            return this.weight * 1.41421\n        }\n        return this.weight\n    }\n\n    isWall() {\n        return this.weight === 0\n    }\n}\n\nclass BinaryHeap {\n\n    content = []\n    scoreFunction\n\n    constructor(scoreFunction) {\n        this.content = []\n        this.scoreFunction = scoreFunction\n    }\n\n    push(element) {\n        // Add the new element to the end of the array.\n        this.content.push(element)\n\n        // Allow it to sink down.\n        this.sinkDown(this.content.length - 1)\n    }\n\n    pop() {\n        // Store the first element so we can return it later.\n        const result = this.content[0]\n        // Get the element at the end of the array.\n        const end = this.content.pop()\n        // If there are any elements left, put the end element at the\n        // start, and let it bubble up.\n        if (this.content.length > 0) {\n            this.content[0] = end\n            this.bubbleUp(0)\n        }\n        return result\n    }\n\n    remove(node) {\n        const i = this.content.indexOf(node)\n\n        // When it is found, the process seen in 'pop' is repeated\n        // to fill up the hole.\n        const end = this.content.pop()\n\n        if (i !== this.content.length - 1) {\n            this.content[i] = end\n\n            if (this.scoreFunction(end) < this.scoreFunction(node)) {\n                this.sinkDown(i)\n            } else {\n                this.bubbleUp(i)\n            }\n        }\n    }\n\n    size() {\n        return this.content.length\n    }\n\n    rescoreElement(node) {\n        this.sinkDown(this.content.indexOf(node))\n    }\n\n    sinkDown(n) {\n        // Fetch the element that has to be sunk.\n        const element = this.content[n]\n\n        // When at 0, an element can not sink any further.\n        while (n > 0) {\n\n            // Compute the parent element's index, and fetch it.\n            const parentN = ((n + 1) >> 1) - 1\n            const parent = this.content[parentN]\n            // Swap the elements if the parent is greater.\n            if (this.scoreFunction(element) < this.scoreFunction(parent)) {\n                this.content[parentN] = element\n                this.content[n] = parent\n                // Update 'n' to continue at the new position.\n                n = parentN\n            }\n            // Found a parent that is less, no need to sink any further.\n            else {\n                break\n            }\n        }\n    }\n\n    bubbleUp(n) {\n        // Look up the target element and its score.\n        const length = this.content.length\n        const element = this.content[n]\n        const elemScore = this.scoreFunction(element)\n\n        while (true) {\n            // Compute the indices of the child elements.\n            const child2N = (n + 1) << 1\n            const child1N = child2N - 1\n            // This is used to store the new position of the element, if any.\n            let swap = null\n            let child1Score\n            // If the first child exists (is inside the array)...\n            if (child1N < length) {\n                // Look it up and compute its score.\n                const child1 = this.content[child1N]\n                child1Score = this.scoreFunction(child1)\n\n                // If the score is less than our element's, we need to swap.\n                if (child1Score < elemScore) {\n                    swap = child1N\n                }\n            }\n\n            // Do the same checks for the other child.\n            if (child2N < length) {\n                const child2 = this.content[child2N]\n                const child2Score = this.scoreFunction(child2)\n                if (child2Score < (swap === null ? elemScore : child1Score)) {\n                    swap = child2N\n                }\n            }\n\n            // If the element needs to be moved, swap it, and continue.\n            if (swap !== null) {\n                this.content[n] = this.content[swap]\n                this.content[swap] = element\n                n = swap\n            }\n            // Otherwise, we are done.\n            else {\n                break\n            }\n        }\n    }\n}\n","import { Surface } from './model/map/Surface'\nimport { Terrain } from './model/map/Terrain'\nimport { ResourceManager } from '../resource/ResourceManager'\nimport { SurfaceType } from './model/map/SurfaceType'\nimport { WorldManager } from './WorldManager'\nimport { TILESIZE } from '../main'\nimport { LevelEntryCfg } from '../cfg/LevelsCfg'\nimport { Graph } from './model/map/astar'\n\nexport class TerrainLoader {\n\n    static loadTerrain(levelConf: LevelEntryCfg, worldMgr: WorldManager): Terrain {\n        const tileSize = levelConf.blockSize\n        if (tileSize !== TILESIZE) console.error('Unexpected tile size in level configuration: ' + tileSize)\n        const terrain = new Terrain(worldMgr)\n\n        const themeName = levelConf.textureSet[1]\n        terrain.textureSet = ResourceManager.cfg('Textures', themeName)\n        // console.log(terrain.textureSet);\n\n        const terrainMap = ResourceManager.getMap(levelConf.terrainMap)\n        terrain.width = terrainMap.width\n        terrain.height = terrainMap.height\n        const pathMap = ResourceManager.getMap(levelConf.pathMap)?.level\n        const surfaceMap = ResourceManager.getMap(levelConf.surfaceMap)?.level\n        const predugMap = ResourceManager.getMap(levelConf.predugMap)?.level\n        const cryOreMap = ResourceManager.getMap(levelConf.cryOreMap)?.level\n        const fallinMap = ResourceManager.getMap(levelConf.fallinMap)?.level\n        const erodeMap = ResourceManager.getMap(levelConf.erodeMap)?.level\n\n        // maps parsed from WAD are row-wise saved, which means y (row) comes first and x (column) second\n        for (let r = 0; r < terrainMap.level.length; r++) {\n            for (let c = 0; c < (terrainMap.level)[r].length; c++) {\n                (terrain.surfaces)[c] = (terrain.surfaces)[c] || []\n                const surfaceTypeNum = (terrainMap.level)[r][c]\n                let surfaceType = SurfaceType.getByNum(surfaceTypeNum)\n                const predugLevel = predugMap[r][c]\n                if (predugLevel === PredugMap.CAVERN_EXPOSED) {\n                    if (surfaceType === SurfaceType.GROUND || surfaceType === SurfaceType.DIRT) {\n                        surfaceType = SurfaceType.GROUND\n                    } else if (surfaceType !== SurfaceType.WATER && surfaceType !== SurfaceType.LAVA) {\n                        console.warn('Unexpected cavern surface type: ' + surfaceType.name)\n                    }\n                } else if (predugLevel === PredugMap.SLUG_HOLE_EXPOSED || predugLevel === PredugMap.SLUG_HOLE_HIDDEN) {\n                    surfaceType = SurfaceType.SLUG_HOLE\n                } else if (predugLevel !== PredugMap.WALL && predugLevel !== PredugMap.CAVERN_HIDDEN) {\n                    console.warn('Unexpected predug level: ' + predugLevel)\n                }\n                // give the path map the highest priority, if it exists\n                const pathMapLevel = pathMap && surfaceType.floor ? pathMap[r][c] : PathMap.NONE\n                if (pathMapLevel === PathMap.RUBBLE) {\n                    surfaceType = SurfaceType.RUBBLE4\n                } else if (pathMapLevel === PathMap.POWER_PATH) {\n                    surfaceType = SurfaceType.POWER_PATH\n                } else if (pathMapLevel !== PathMap.NONE) {\n                    console.warn('Unexpected path map level: ' + pathMapLevel)\n                }\n\n                const surface = new Surface(terrain, surfaceType, c, r, surfaceMap[r][c])\n                if (cryOreMap) {\n                    const currentCryOre = cryOreMap[r][c]\n                    if (currentCryOre % 2 === 1) {\n                        surface.containedCrystals = (currentCryOre + 1) / 2\n                    } else {\n                        surface.containedOres = currentCryOre / 2\n                    }\n                }\n\n                (terrain.surfaces)[c].push(surface)\n            }\n        }\n\n        // exlpore predug surfaces\n        terrain.surfaces.forEach(c => c.forEach(s => {\n            if (predugMap[s.y][s.x] === PredugMap.CAVERN_EXPOSED || predugMap[s.y][s.x] === PredugMap.SLUG_HOLE_EXPOSED) { // map are rows (y) first, columns (x) second\n                for (let x = s.x - 1; x <= s.x + 1; x++) {\n                    for (let y = s.y - 1; y <= s.y + 1; y++) {\n                        terrain.getSurfaceOrNull(x, y).discovered = true\n                    }\n                }\n            }\n        }))\n\n        // create hidden caverns\n        terrain.surfaces.forEach(c => c.forEach(s => {\n            const surface = terrain.getSurfaceOrNull(s.x, s.y)\n            if (predugMap[s.y][s.x] === PredugMap.CAVERN_HIDDEN && !surface.discovered) {\n                surface.surfaceType = SurfaceType.GROUND\n            }\n        }))\n\n        terrain.graphWalk = new Graph(terrain.surfaces.map(c => c.map(s => s.getGraphWalkWeight())))\n\n        // crumble unsupported walls\n        terrain.surfaces.forEach((c) => c.forEach((s) => {\n            if (!s.isSupported()) s.collapse()\n        }))\n\n        terrain.updateSurfaceMeshes(true)\n\n        if (fallinMap) {\n            for (let x = 0; x < terrain.width; x++) {\n                for (let y = 0; y < terrain.height; y++) {\n                    terrain.getSurface(x, y).setFallinLevel(fallinMap[y][x]) // rows (y) before columns (x) used in maps\n                }\n            }\n        }\n\n        if (erodeMap) { // TODO implement lava erosion\n            console.warn('Lucky you! Lava erosion not yet implemented')\n        }\n\n        return terrain\n    }\n\n}\n\nenum PathMap {\n\n    NONE = 0,\n    RUBBLE = 1,\n    POWER_PATH = 2,\n\n}\n\nenum PredugMap {\n\n    WALL = 0,\n    CAVERN_EXPOSED = 1,\n    CAVERN_HIDDEN = 2,\n    SLUG_HOLE_EXPOSED = 3,\n    SLUG_HOLE_HIDDEN = 4,\n}\n","import { Vector2 } from 'three'\nimport { PathTarget } from '../PathTarget'\n\nexport class TerrainPath {\n\n    target: PathTarget = null\n    locations: Vector2[] = []\n    lengthSq: number = 0\n\n    constructor(target: PathTarget, locations: Vector2[] | Vector2) {\n        this.target = target\n        this.locations = Array.isArray(locations) ? locations : [locations]\n        for (let c = 0; c < this.locations.length - 1; c++) {\n            const start = this.locations[c]\n            const end = this.locations[c + 1]\n            this.lengthSq += start.distanceToSquared(end)\n        }\n    }\n\n    addLocation(location: Vector2): TerrainPath {\n        this.locations.push(location)\n        if (this.locations.length > 1) {\n            this.lengthSq += this.locations[this.locations.length - 2].distanceToSquared(location)\n        }\n        return this\n    }\n\n    get targetPosition(): Vector2 {\n        return this.locations[this.locations.length - 1] || null\n    }\n\n    get firstLocation(): Vector2 {\n        return this.locations[0] || null\n    }\n\n}\n","import { Group, Vector2, Vector3 } from 'three'\nimport { Surface } from './Surface'\nimport { WorldManager } from '../../WorldManager'\nimport { SurfaceType } from './SurfaceType'\nimport { TILESIZE } from '../../../main'\nimport { EventBus } from '../../../event/EventBus'\nimport { EntityAddedEvent, EntityType } from '../../../event/WorldEvents'\nimport { BuildingEntity } from '../BuildingEntity'\nimport { astar, Graph } from './astar'\nimport { TerrainPath } from './TerrainPath'\nimport { PathTarget } from '../PathTarget'\nimport { EventKey } from '../../../event/EventKeyEnum'\n\nexport class Terrain {\n\n    worldMgr: WorldManager\n    textureSet: any = {}\n    width: number = 0\n    height: number = 0\n    surfaces: Surface[][] = []\n    floorGroup: Group = new Group()\n    roofGroup: Group = new Group()\n    graphWalk: Graph = null\n    cachedPaths = new Map<string, TerrainPath>()\n\n    constructor(worldMgr: WorldManager) {\n        this.worldMgr = worldMgr\n        this.floorGroup.scale.set(TILESIZE, TILESIZE, TILESIZE)\n        this.roofGroup.visible = false // keep roof hidden unless switched to other camera\n        EventBus.registerEventListener(EventKey.ENTITY_ADDED, (event: EntityAddedEvent) => {\n            if (event.type !== EntityType.BUILDING) return;\n            (event.entity as BuildingEntity).surfaces.forEach((bSurf) => {\n                for (let x = -1; x <= 1; x++) {\n                    for (let y = -1; y <= 1; y++) {\n                        this.getSurface(bSurf.x + x, bSurf.y + y).updateTexture()\n                    }\n                }\n            })\n        })\n    }\n\n    getSurfaceFromWorld(worldPosition: Vector3): Surface | null {\n        return this.getSurfaceFromWorldXZ(worldPosition.x, worldPosition.z)\n    }\n\n    getSurfaceFromWorld2D(worldPosition: Vector2): Surface | null {\n        return this.getSurfaceFromWorldXZ(worldPosition.x, worldPosition.y)\n    }\n\n    getSurfaceFromWorldXZ(worldX: number, worldZ: number): Surface | null {\n        return this.getSurface(worldX / TILESIZE, worldZ / TILESIZE)\n    }\n\n    getSurface(x, y): Surface {\n        x = Math.floor(x)\n        y = Math.floor(y)\n        return this.getSurfaceOrNull(x, y) || new Surface(this, SurfaceType.SOLID_ROCK, x, y, 0)\n    }\n\n    getSurfaceOrNull(x, y): Surface | null {\n        if (x >= 0 && x < this.width && y >= 0 && y < this.height) {\n            return this.surfaces[x][y]\n        } else {\n            return null\n        }\n    }\n\n    updateSurfaceMeshes(force: boolean = false) {\n        this.surfaces.forEach((r) => r.forEach((s) => s.updateMesh(force)))\n        this.floorGroup.updateWorldMatrix(true, true) // otherwise ray intersection is not working before rendering\n        this.resetGraphWalk()\n    }\n\n    resetGraphWalk() {\n        this.graphWalk.init()\n        this.cachedPaths.clear()\n        console.log('Cached paths cleared')\n    }\n\n    findPath(start: Vector2, target: PathTarget): TerrainPath {\n        const end = target.targetLocation\n        const startSurface = this.getSurfaceFromWorldXZ(start.x, start.y)\n        const endSurface = this.getSurfaceFromWorldXZ(end.x, end.y)\n        if (startSurface.x === endSurface.x && startSurface.y === endSurface.y) {\n            return new TerrainPath(target, end)\n        }\n        const cacheIdentifier = startSurface.x + '/' + startSurface.y + ' -> ' + endSurface.x + '/' + endSurface.y\n        const cachedPath = this.cachedPaths.get(cacheIdentifier)\n        if (cachedPath) {\n            return cachedPath.addLocation(end)\n        } else {\n            return this.searchPath(startSurface, endSurface, target, cacheIdentifier)\n        }\n    }\n\n    private searchPath(startSurface: Surface, endSurface: Surface, target: PathTarget, cacheIdentifier: string): TerrainPath {\n        const startNode = this.graphWalk.grid[startSurface.x][startSurface.y]\n        const endNode = this.graphWalk.grid[endSurface.x][endSurface.y]\n        const worldPath = astar.search(this.graphWalk, startNode, endNode).map(p => this.getSurface(p.x, p.y).getCenterWorld2D())\n        if (worldPath.length < 1) return null // no path found\n        // replace last surface center with actual target position\n        worldPath.pop()\n        worldPath.push(target.targetLocation)\n        this.cachedPaths.set(cacheIdentifier, new TerrainPath(target, worldPath.slice(0, -1))) // cache shallow copy to avoid interference\n        return new TerrainPath(target, worldPath)\n    }\n\n    findFallInOrigin(x: number, y: number): [number, number] {\n        const leftSurface = this.getSurface(x - 1, y)\n        if (leftSurface.isReinforcable()) return [leftSurface.x, leftSurface.y]\n        const topSurface = this.getSurface(x, y - 1)\n        if (topSurface.isReinforcable()) return [topSurface.x, topSurface.y]\n        const rightSurface = this.getSurface(x + 1, y)\n        if (rightSurface.isReinforcable()) return [rightSurface.x, rightSurface.y]\n        const bottomSurface = this.getSurface(x, y + 1)\n        if (bottomSurface.isReinforcable()) return [bottomSurface.x, bottomSurface.y]\n        const leftSurface2 = this.getSurface(x - 1, y)\n        if (leftSurface2.isDigable()) return [leftSurface2.x, leftSurface2.y]\n        const topSurface2 = this.getSurface(x, y - 1)\n        if (topSurface2.isDigable()) return [topSurface2.x, topSurface2.y]\n        const rightSurface2 = this.getSurface(x + 1, y)\n        if (rightSurface2.isDigable()) return [rightSurface2.x, rightSurface2.y]\n        const bottomSurface2 = this.getSurface(x, y + 1)\n        if (bottomSurface2.isDigable()) return [bottomSurface2.x, bottomSurface2.y]\n        return null\n    }\n\n    findFallInTarget(x: number, y: number): [number, number] {\n        const leftSurface = this.getSurface(x - 1, y)\n        if (leftSurface.isWalkable()) return [leftSurface.x, leftSurface.y]\n        const topSurface = this.getSurface(x, y - 1)\n        if (topSurface.isWalkable()) return [topSurface.x, topSurface.y]\n        const rightSurface = this.getSurface(x + 1, y)\n        if (rightSurface.isWalkable()) return [rightSurface.x, rightSurface.y]\n        const bottomSurface = this.getSurface(x, y + 1)\n        if (bottomSurface.isWalkable()) return [bottomSurface.x, bottomSurface.y]\n        return null\n    }\n\n    dispose() {\n        this.surfaces.forEach(c => c.forEach(s => s.dispose()))\n    }\n}\n","import { Vector3 } from 'three'\n\nexport class EntityStep {\n\n    vec: Vector3 = null\n    targetReached: boolean = false\n\n    constructor(dx: number, dy: number, dz: number) {\n        this.vec = new Vector3(dx, dy, dz)\n    }\n\n}\n","export enum MoveState {\n\n    MOVED,\n    TARGET_REACHED,\n    TARGET_UNREACHABLE,\n\n}\n","import { AnimEntity } from './anim/AnimEntity'\nimport { Vector2, Vector3 } from 'three'\nimport { AnimationEntityType } from './anim/AnimationEntityType'\nimport { MovableEntityStats } from '../../cfg/MovableEntityStats'\nimport { EntityStep } from './EntityStep'\nimport { MoveState } from './MoveState'\nimport { JOB_ACTION_RANGE } from '../../main'\nimport { TerrainPath } from './map/TerrainPath'\nimport { PathTarget } from './PathTarget'\nimport { AnimEntityActivity } from './activities/AnimEntityActivity'\n\nexport abstract class MovableEntity extends AnimEntity {\n\n    currentPath: TerrainPath = null\n\n    constructor(entityType: AnimationEntityType) {\n        super(entityType)\n    }\n\n    abstract get stats(): MovableEntityStats\n\n    getPosition(): Vector3 {\n        return new Vector3(this.group.position.x, this.group.position.y, this.group.position.z)\n    }\n\n    getPosition2D(): Vector2 {\n        return new Vector2(this.group.position.x, this.group.position.z)\n    }\n\n    getSpeed(): number {\n        return this.stats.RouteSpeed[this.level] * (this.animation?.transcoef || 1) * (this.isOnPath() ? this.stats.PathCoef : 1)\n    }\n\n    moveToClosestTarget(target: PathTarget[]): MoveState {\n        if (!this.currentPath || !target.some((t) => t.targetLocation.equals(this.currentPath.target.targetLocation))) {\n            const paths = target.map((t) => this.findPathToTarget(t))\n                .sort((l, r) => l.lengthSq - r.lengthSq)\n            this.currentPath = paths.length > 0 ? paths[0] : null\n            if (!this.currentPath) return MoveState.TARGET_UNREACHABLE\n        }\n        const nextLocation = this.currentPath.firstLocation\n        this.group.lookAt(new Vector3(nextLocation.x, this.group.position.y, nextLocation.y))\n        const step = this.determineStep()\n        if (step.targetReached || this.currentPath.target.isInArea(this.getPosition2D())) {\n            return MoveState.TARGET_REACHED\n        } else {\n            this.group.position.add(step.vec)\n            this.changeActivity(this.getRouteActivity()) // only change when actually moving\n            return MoveState.MOVED\n        }\n    }\n\n    abstract getRouteActivity(): AnimEntityActivity\n\n    findPathToTarget(target: PathTarget): TerrainPath {\n        return new TerrainPath(target, target.targetLocation)\n    }\n\n    determineStep(): EntityStep {\n        const step = this.getEntityStep(this.currentPath.firstLocation)\n        const entitySpeed = this.getSpeed() // TODO use average speed between current and target position\n        const stepLengthSq = step.vec.lengthSq()\n        if (stepLengthSq > entitySpeed * entitySpeed && stepLengthSq > JOB_ACTION_RANGE * JOB_ACTION_RANGE) {\n            step.vec.setLength(entitySpeed)\n        } else if (this.currentPath.locations.length > 1) {\n            this.currentPath.locations.shift()\n            return this.determineStep()\n        } else {\n            step.targetReached = true\n        }\n        return step\n    }\n\n    getEntityStep(target: Vector2): EntityStep {\n        return new EntityStep(target.x - this.group.position.x, this.determinePosY(target.x, target.y) - this.determinePosY(this.group.position.x, this.group.position.z), target.y - this.group.position.z)\n    }\n\n    determinePosY(x: number, z: number) {\n        return this.worldMgr.getFloorHeight(x, z)\n    }\n\n    isOnRubble() {\n        return this.worldMgr.sceneManager.terrain.getSurfaceFromWorld(this.group.position).hasRubble()\n    }\n\n    isOnPath(): boolean {\n        return this.worldMgr.sceneManager.terrain.getSurfaceFromWorld(this.group.position).isPath()\n    }\n\n}\n","import { MovableEntity } from './MovableEntity'\nimport { Selectable, SelectionType } from '../../game/model/Selectable'\nimport { ResourceManager } from '../../resource/ResourceManager'\nimport { Job } from '../../game/model/job/Job'\nimport { Vector3 } from 'three'\nimport { NATIVE_FRAMERATE } from '../../main'\nimport { clearIntervalSafe } from '../../core/Util'\nimport { Carryable } from './collect/Carryable'\nimport { SelectionEvent } from '../../event/LocalEvents'\nimport { RaiderSkill } from './RaiderSkill'\nimport { RaiderTool } from './RaiderTool'\nimport { PathTarget } from './PathTarget'\n\nexport abstract class FulfillerEntity extends MovableEntity implements Selectable {\n\n    selectionType: SelectionType\n    selected: boolean\n    workInterval = null\n    job: Job = null\n    followUpJob: Job = null\n    carries: Carryable = null\n    jobWorkplaces: PathTarget[] = []\n\n    protected constructor(selectionType: SelectionType, aeFilename: string) {\n        super(ResourceManager.getAnimationEntityType(aeFilename))\n        this.selectionType = selectionType\n        this.group.userData = {'selectable': this}\n        this.workInterval = setInterval(this.work.bind(this), 1000 / NATIVE_FRAMERATE) // TODO do not use interval, make work trigger itself (with timeout/interval) until work is done\n    }\n\n    resetWorkInterval() {\n        this.workInterval = clearIntervalSafe(this.workInterval)\n    }\n\n    abstract work()\n\n    dropItem() {\n        if (!this.carries) return\n        this.carryJoint?.remove(this.carries.group)\n        this.carries.group.position.copy(this.group.position)\n        this.carryJoint?.getWorldPosition(this.carries.group.position)\n        this.carries.group.position.y = this.worldMgr.getFloorHeight(this.carries.group.position.x, this.carries.group.position.z)\n        this.carries = null\n    }\n\n    pickupItem(item: Carryable) {\n        this.carries = item\n        if (this.carryJoint) this.carryJoint.add(this.carries.group)\n        this.carries.group.position.set(0, 0, 0)\n    }\n\n    setJob(job: Job, followUpJob: Job = null) {\n        if (this.job !== job) this.stopJob()\n        this.job = job\n        if (this.job) this.job.assign(this)\n        this.followUpJob = followUpJob\n        if (this.followUpJob) this.followUpJob.assign(this)\n        this.jobWorkplaces = this.job.getWorkplaces()\n    }\n\n    stopJob() {\n        this.dropItem()\n        if (!this.job) return\n        this.job.unassign(this)\n        if (this.followUpJob) this.followUpJob.unassign(this)\n        this.job = null\n        this.followUpJob = null\n        this.jobWorkplaces = []\n        this.changeActivity()\n    }\n\n    abstract hasTool(tool: RaiderTool)\n\n    abstract hasSkill(skill: RaiderSkill)\n\n    getSelectionType(): SelectionType {\n        return this.selectionType\n    }\n\n    deselect() {\n        this.selectionFrame.visible = false\n        this.selected = false\n    }\n\n    abstract select(): SelectionEvent;\n\n    abstract getSelectionCenter(): Vector3;\n\n}\n","export class RaiderTool {\n\n    static DRILL = new RaiderTool('drill')\n    static HAMMER = new RaiderTool('hammer')\n    static SHOVEL = new RaiderTool('shovel')\n    static SPANNER = new RaiderTool('spanner')\n    static FREEZERGUN = new RaiderTool('freezergun')\n    static LASER = new RaiderTool('laser')\n    static PUSHERGUN = new RaiderTool('pushergun')\n    static BIRDSCARER = new RaiderTool('birdscarer')\n\n    name: string\n\n    constructor(name: string) {\n        this.name = name\n    }\n\n}\n","import { SelectionType } from '../../game/model/Selectable'\nimport { EventBus } from '../../event/EventBus'\nimport { RaiderSelected, SelectionEvent } from '../../event/LocalEvents'\nimport { FulfillerEntity } from './FulfillerEntity'\nimport { GameState } from '../../game/model/GameState'\nimport { MathUtils, Vector2, Vector3 } from 'three'\nimport { EntityAddedEvent, EntityType, OreFoundEvent, RaiderTrained } from '../../event/WorldEvents'\nimport { CrystalFoundEvent, RaiderDiscoveredEvent } from '../../event/WorldLocationEvent'\nimport { BaseActivity } from './activities/BaseActivity'\nimport { RaiderActivity } from './activities/RaiderActivity'\nimport { DynamiteJob } from '../../game/model/job/surface/DynamiteJob'\nimport { DrillJob } from '../../game/model/job/surface/DrillJob'\nimport { ClearRubbleJob } from '../../game/model/job/surface/ClearRubbleJob'\nimport { SurfaceType } from './map/SurfaceType'\nimport { getRandom, getRandomInclusive } from '../../core/Util'\nimport { Crystal } from './collect/Crystal'\nimport { Ore } from './collect/Ore'\nimport { CollectJob } from '../../game/model/job/CollectJob'\nimport { TrainJob } from '../../game/model/job/TrainJob'\nimport { GetToolJob } from '../../game/model/job/GetToolJob'\nimport { ResourceManager } from '../../resource/ResourceManager'\nimport { RaiderTool } from './RaiderTool'\nimport { RaiderSkill } from './RaiderSkill'\nimport { MoveState } from './MoveState'\nimport { JobType } from '../../game/model/job/JobType'\nimport { TerrainPath } from './map/TerrainPath'\nimport { PathTarget } from './PathTarget'\nimport { CollectPathTarget } from './CollectionTarget'\nimport degToRad = MathUtils.degToRad\n\nexport class Raider extends FulfillerEntity {\n\n    tools: RaiderTool[] = []\n    skills: RaiderSkill[] = []\n    slipped: boolean = false\n\n    constructor() {\n        super(SelectionType.PILOT, 'mini-figures/pilot/pilot.ae')\n        this.tools = [RaiderTool.DRILL]\n        this.skills = []\n        this.pickSphereRadius = this.stats.PickSphere / 2\n    }\n\n    get stats() {\n        return ResourceManager.stats.Pilot\n    }\n\n    findPathToTarget(target: PathTarget): TerrainPath {\n        return this.worldMgr.sceneManager.terrain.findPath(this.getPosition2D(), target)\n    }\n\n    onDiscover() {\n        super.onDiscover()\n        GameState.raidersUndiscovered.remove(this)\n        GameState.raiders.push(this)\n        EventBus.publishEvent(new EntityAddedEvent(EntityType.RAIDER, this))\n        EventBus.publishEvent(new RaiderDiscoveredEvent(this.getPosition()))\n    }\n\n    select(): SelectionEvent {\n        this.selectionFrame.visible = !this.slipped\n        if (this.selected || this.slipped) return null\n        this.selected = true\n        this.changeActivity()\n        return new RaiderSelected(this)\n    }\n\n    getSelectionCenter(): Vector3 {\n        return this.pickSphere ? new Vector3().copy(this.pickSphere.position).applyMatrix4(this.group.matrixWorld) : null\n    }\n\n    isDriving(): boolean {\n        return false // TODO implement vehicles\n    }\n\n    getRouteActivity(): BaseActivity {\n        if (this.isOnRubble()) {\n            return !!this.carries ? RaiderActivity.CarryRubble : RaiderActivity.routeRubble\n        } else {\n            return !!this.carries ? RaiderActivity.Carry : RaiderActivity.Route\n        }\n    }\n\n    moveToClosestTarget(target: PathTarget[]): MoveState {\n        const result = super.moveToClosestTarget(target)\n        if (result === MoveState.MOVED) {\n            GameState.getNearbySpiders(this).some((spider) => {\n                if (this.group.position.distanceToSquared(spider.group.position) < this.radiusSq + spider.radiusSq) {\n                    this.slip()\n                    spider.onDeath()\n                    return true\n                }\n            })\n        } else if (result === MoveState.TARGET_UNREACHABLE) {\n            console.log('Entity could not move to job target, stopping job')\n            this.stopJob()\n        }\n        return result\n    }\n\n    slip() {\n        if (getRandomInclusive(0, 100) < 10) this.stopJob()\n        this.dropItem()\n        this.slipped = true\n        this.changeActivity(RaiderActivity.Slip, () => {\n            this.slipped = false\n        })\n    }\n\n    moveToClosestWorkplace(): boolean {\n        return this.moveToClosestTarget(this.jobWorkplaces) === MoveState.TARGET_REACHED\n    }\n\n    work() {\n        if (!this.job || this.selected || this.slipped) return\n        if (this.job.type === JobType.DRILL) {\n            const surfJob = this.job as DrillJob\n            if (this.moveToClosestWorkplace()) {\n                let drillTimeMs = null\n                if (surfJob.surface.surfaceType === SurfaceType.HARD_ROCK) {\n                    drillTimeMs = this.stats.HardDrillTime[this.level] * 1000\n                } else if (surfJob.surface.surfaceType === SurfaceType.LOOSE_ROCK) {\n                    drillTimeMs = this.stats.LooseDrillTime[this.level] * 1000\n                } else if (surfJob.surface.surfaceType === SurfaceType.DIRT) {\n                    drillTimeMs = this.stats.SoilDrillTime[this.level] * 1000\n                } else if (surfJob.surface.surfaceType === SurfaceType.ORE_SEAM ||\n                    surfJob.surface.surfaceType === SurfaceType.CRYSTAL_SEAM) {\n                    drillTimeMs = this.stats.SeamDrillTime[this.level] * 1000\n                }\n                if (drillTimeMs === 0) console.warn('According to cfg this entity cannot drill this material')\n                const focusPoint = surfJob.surface.getCenterWorld()\n                focusPoint.y = this.group.position.y\n                this.group.lookAt(focusPoint)\n                this.changeActivity(RaiderActivity.Drill, () => {\n                    if (surfJob.surface.seamLevel > 0) {\n                        surfJob.surface.seamLevel--\n                        const vec = new Vector2().copy(this.getPosition2D()).sub(surfJob.surface.getCenterWorld2D())\n                            .multiplyScalar(0.3 + getRandom(3) / 10)\n                            .rotateAround(new Vector2(0, 0), degToRad(-10 + getRandom(20)))\n                            .add(this.getPosition2D())\n                        if (surfJob.surface.surfaceType === SurfaceType.CRYSTAL_SEAM) {\n                            const crystal = this.worldMgr.addCollectable(new Crystal(), vec)\n                            EventBus.publishEvent(new CrystalFoundEvent(crystal.getPosition()))\n                        } else if (surfJob.surface.surfaceType === SurfaceType.ORE_SEAM) {\n                            this.worldMgr.addCollectable(new Ore(), vec)\n                            EventBus.publishEvent(new OreFoundEvent())\n                        }\n                        this.changeActivity()\n                    } else {\n                        this.completeJob()\n                    }\n                }, drillTimeMs)\n            }\n        } else if (this.job.type === JobType.CLEAR_RUBBLE) {\n            const surfJob = this.job as ClearRubbleJob\n            if (this.moveToClosestWorkplace()) {\n                this.changeActivity(RaiderActivity.Clear, () => {\n                    this.changeActivity()\n                    this.job.onJobComplete()\n                    this.jobWorkplaces = this.job.getWorkplaces()\n                    if (!surfJob.surface.hasRubble()) this.stopJob()\n                })\n            }\n        } else if (this.job.type === JobType.REINFORCE) {\n            if (this.moveToClosestWorkplace()) {\n                this.changeActivity(RaiderActivity.Reinforce, () => {\n                    this.completeJob()\n                }, 2700)\n            }\n        } else if (this.job.type === JobType.BLOW) {\n            const bj = this.job as DynamiteJob\n            if (this.carries !== bj.dynamite) {\n                this.dropItem()\n                if (this.moveToClosestWorkplace()) {\n                    this.changeActivity(RaiderActivity.Collect, () => {\n                        this.pickupItem(bj.dynamite)\n                    })\n                }\n            } else if (this.moveToClosestTarget(bj.surface.getDigPositions().map((p) => new PathTarget(p)))) {\n                this.changeActivity(RaiderActivity.Place, () => {\n                    this.completeJob()\n                })\n            }\n        } else if (this.job.type === JobType.COLLECT) {\n            const collectJob = this.job as CollectJob\n            const collectJobItem = collectJob.item\n            if (this.carries !== collectJobItem) {\n                this.dropItem()\n                if (this.moveToClosestWorkplace()) {\n                    this.changeActivity(RaiderActivity.Collect, () => {\n                        this.pickupItem(collectJobItem)\n                    })\n                }\n            } else {\n                const moveResult = this.moveToClosestTarget(collectJobItem.getCarryTargets())\n                collectJobItem.setTargetSite((this.currentPath?.target as CollectPathTarget)?.site)\n                if (moveResult) {\n                    const collectPathTarget = this.currentPath.target as CollectPathTarget\n                    if (collectPathTarget.canGatherItem()) {\n                        const dropAction = collectPathTarget.getDropAction()\n                        this.changeActivity(dropAction, () => {\n                            this.completeJob()\n                            collectPathTarget.gatherItem(collectJobItem)\n                        })\n                    } else {\n                        this.changeActivity()\n                    }\n                }\n            }\n        } else if (this.job.type === JobType.MOVE) {\n            if (this.moveToClosestWorkplace()) {\n                this.changeActivity(this.getDefaultActivity(), () => {\n                    this.completeJob()\n                })\n            }\n        } else if (this.job.type === JobType.TRAIN) {\n            const trainJob = this.job as TrainJob\n            if (this.moveToClosestWorkplace()) {\n                this.changeActivity(RaiderActivity.Train, () => {\n                    this.skills.push(trainJob.skill)\n                    EventBus.publishEvent(new RaiderTrained(this, trainJob.skill))\n                    this.completeJob()\n                }, 10000) // XXX adjust training time\n            }\n        } else if (this.job.type === JobType.GET_TOOL) {\n            if (this.moveToClosestWorkplace()) {\n                this.tools.push((this.job as GetToolJob).tool)\n                this.completeJob()\n            }\n        } else if (this.job.type === JobType.EAT) {\n            this.changeActivity(RaiderActivity.Eat, () => {\n                // TODO implement endurance fill eat level\n                this.completeJob()\n            })\n        } else if (this.job.type === JobType.COMPLETE_POWER_PATH) {\n            if (this.moveToClosestWorkplace()) {\n                this.changeActivity(RaiderActivity.Clear, () => {\n                    this.completeJob()\n                })\n            }\n        }\n    }\n\n    private completeJob() {\n        this.dropItem()\n        this.job.onJobComplete()\n        if (this.job) this.job.unassign(this)\n        this.job = this.followUpJob\n        this.followUpJob = null\n        this.jobWorkplaces = this.job?.getWorkplaces() || []\n        this.changeActivity()\n    }\n\n    getDefaultActivity(): BaseActivity {\n        return this.carries ? RaiderActivity.CarryStand : super.getDefaultActivity()\n    }\n\n    beamUp() {\n        this.stopJob()\n        super.beamUp()\n    }\n\n    removeFromScene() {\n        super.removeFromScene()\n        GameState.raiders.remove(this)\n    }\n\n    hasTool(tool: RaiderTool) {\n        return this.tools.indexOf(tool) !== -1\n    }\n\n    hasSkill(skill: RaiderSkill) {\n        return this.skills.indexOf(skill) !== -1\n    }\n\n}\n","import { EventBus } from '../../event/EventBus'\nimport { BuildingSelected, EntityDeselected, SelectionEvent } from '../../event/LocalEvents'\nimport { Building } from '../../game/model/entity/building/Building'\nimport { AnimEntity } from './anim/AnimEntity'\nimport { Selectable, SelectionType } from '../../game/model/Selectable'\nimport { ResourceManager } from '../../resource/ResourceManager'\nimport { Matrix4, Vector2, Vector3 } from 'three'\nimport { GameState } from '../../game/model/GameState'\nimport { BuildingUpgraded, EntityAddedEvent, EntityType, MaterialAmountChanged } from '../../event/WorldEvents'\nimport { Surface } from './map/Surface'\nimport { CollectableEntity, CollectableType } from './collect/CollectableEntity'\nimport { BuildingActivity } from './activities/BuildingActivity'\nimport { BuildingEntityStats } from '../../cfg/BuildingEntityStats'\nimport { Ore } from './collect/Ore'\nimport { Crystal } from './collect/Crystal'\nimport { SurfaceType } from './map/SurfaceType'\nimport { AnimEntityActivity } from './activities/AnimEntityActivity'\nimport { EventKey } from '../../event/EventKeyEnum'\n\nexport class BuildingEntity extends AnimEntity implements Selectable {\n\n    type: Building\n    selected: boolean\n    powerSwitch: boolean = true\n    spawning: boolean = false\n    surfaces: Surface[] = []\n    upgradeCostOre: number = 0\n    upgradeCostBrick: number = 0\n    crystalsInUse: number = 0\n    inBeam: boolean = false\n\n    constructor(buildingType: Building) {\n        super(ResourceManager.getAnimationEntityType(buildingType.aeFile))\n        this.type = buildingType\n        this.group.applyMatrix4(new Matrix4().makeScale(-1, 1, 1))\n        this.group.userData = {'selectable': this}\n        this.pickSphereRadius = this.stats.PickSphere / 2\n        this.upgradeCostOre = ResourceManager.cfg('Main', 'BuildingUpgradeCostOre')\n        this.upgradeCostBrick = ResourceManager.cfg('Main', 'BuildingUpgradeCostStuds')\n        EventBus.registerEventListener(EventKey.MATERIAL_AMOUNT_CHANGED, (event: MaterialAmountChanged) => {\n            if (event.collectableType === CollectableType.CRYSTAL && this.powerSwitch && this.crystalsInUse < 1) {\n                this.turnOnPower()\n            }\n        })\n    }\n\n    get stats(): BuildingEntityStats {\n        return BuildingEntityStats.getByType(this.type)\n    }\n\n    getSelectionType(): SelectionType {\n        return SelectionType.BUILDING\n    }\n\n    select(): SelectionEvent {\n        if (this.inBeam) return null\n        this.selectionFrame.visible = true\n        if (!this.selected) {\n            this.selected = true\n            return new BuildingSelected(this)\n        }\n        return null\n    }\n\n    deselect() {\n        this.selectionFrame.visible = false\n        this.selected = false\n    }\n\n    getSelectionCenter(): Vector3 {\n        return this.pickSphere ? new Vector3().copy(this.pickSphere.position).applyMatrix4(this.group.matrixWorld) : null\n    }\n\n    getPickSphereCenter() {\n        const pickSphereCenter = this.getPosition()\n        pickSphereCenter.y += this.pickSphereRadius / 2\n        return pickSphereCenter\n    }\n\n    getDropPosition2D(): Vector2 {\n        if (this.getToolJoint) {\n            const worldPos = new Vector3()\n            this.getToolJoint.getWorldPosition(worldPos)\n            return new Vector2(worldPos.x, worldPos.z)\n        } else if (this.depositJoint) {\n            const worldPos = new Vector3()\n            this.depositJoint.getWorldPosition(worldPos)\n            return new Vector2(worldPos.x, worldPos.z)\n        } else {\n            return this.getPosition2D()\n        }\n    }\n\n    getDropPosition(): Vector3 {\n        const dropPos2D = this.getDropPosition2D()\n        return new Vector3(dropPos2D.x, this.worldMgr.getFloorHeight(dropPos2D.x, dropPos2D.y), dropPos2D.y)\n    }\n\n    isPowered(): boolean {\n        return this.powerSwitch && (this.stats.SelfPowered || this.stats.PowerBuilding || this.crystalsInUse > 0)\n    }\n\n    onDiscover() {\n        super.onDiscover()\n        GameState.buildingsUndiscovered.remove(this)\n        GameState.buildings.push(this)\n        EventBus.publishEvent(new EntityAddedEvent(EntityType.BUILDING, this))\n    }\n\n    hasMaxLevel(): boolean {\n        return this.level >= this.stats.Levels - 1\n    }\n\n    upgrade() {\n        if (!this.canUpgrade()) return\n        if (GameState.numBrick >= this.upgradeCostBrick) {\n            GameState.numBrick -= this.upgradeCostBrick\n            EventBus.publishEvent(new MaterialAmountChanged(CollectableType.BRICK))\n        } else {\n            GameState.numOre -= this.upgradeCostOre\n            EventBus.publishEvent(new MaterialAmountChanged(CollectableType.ORE))\n        }\n        this.level++\n        EventBus.publishEvent(new EntityDeselected())\n        EventBus.publishEvent(new BuildingUpgraded(this))\n        // TODO add sparkly upgrade animation\n    }\n\n    getDefaultActivity() {\n        return !this.isPowered() && this.type !== Building.GUNSTATION ? BuildingActivity.Unpowered : AnimEntityActivity.Stand\n    }\n\n    beamUp() {\n        GameState.usedCrystals -= this.crystalsInUse\n        this.crystalsInUse = 0\n        this.inBeam = true\n        for (let c = 0; c < this.stats.CostOre; c++) {\n            this.worldMgr.addCollectable(new Ore(), this.surfaces[0].getRandomPosition())\n        }\n        for (let c = 0; c < this.stats.CostCrystal; c++) {\n            this.worldMgr.addCollectable(new Crystal(), this.surfaces[0].getRandomPosition())\n        }\n        this.surfaces.forEach((s) => {\n            s.surfaceType = SurfaceType.GROUND\n            s.setBuilding(null)\n            s.updateTexture()\n            s.neighbors.forEach((n) => n.updateTexture())\n        })\n        super.beamUp()\n    }\n\n    removeFromScene() {\n        super.removeFromScene()\n        GameState.buildings.remove(this)\n    }\n\n    canUpgrade() {\n        return !this.hasMaxLevel() && (GameState.numOre >= this.upgradeCostOre || GameState.numBrick >= this.upgradeCostBrick)\n    }\n\n    spawnMaterials(materials: CollectableEntity[]) {\n        materials.forEach((m) => this.worldMgr.addCollectable(m, this.getDropPosition2D()))\n    }\n\n    turnOnPower() {\n        if (this.crystalsInUse > 0 || GameState.usedCrystals >= GameState.numCrystal) return\n        this.crystalsInUse = 1\n        GameState.usedCrystals += this.crystalsInUse\n        this.surfaces.forEach((s) => s.setHasPower(true, true))\n        this.changeActivity()\n    }\n\n    turnOffPower() {\n        if (this.crystalsInUse < 1) return\n        GameState.usedCrystals -= this.crystalsInUse\n        this.crystalsInUse = 0\n        this.surfaces.forEach((s) => s.setHasPower(false, false))\n        this.changeActivity()\n    }\n\n}\n","import { AnimEntityActivity } from './AnimEntityActivity'\n\nexport class MonsterActivity extends AnimEntityActivity {\n\n    static Route = new MonsterActivity('Activity_Route')\n\n}\n","import { MovableEntity } from '../../../../scene/model/MovableEntity'\nimport { PathTarget } from '../../../../scene/model/PathTarget'\nimport { clearTimeoutSafe } from '../../../../core/Util'\nimport { MonsterActivity } from '../../../../scene/model/activities/MonsterActivity'\n\nexport abstract class Monster extends MovableEntity {\n\n    moveTimeout: NodeJS.Timeout\n    target: PathTarget = null\n\n    onLevelEnd() {\n        this.moveTimeout = clearTimeoutSafe(this.moveTimeout)\n        this.removeFromScene()\n    }\n\n    getRouteActivity(): MonsterActivity {\n        return MonsterActivity.Route\n    }\n\n}\n","import { Monster } from './Monster'\nimport { ResourceManager } from '../../../../resource/ResourceManager'\nimport { Vector2 } from 'three'\nimport { NATIVE_FRAMERATE, TILESIZE } from '../../../../main'\nimport { getRandom, getRandomInclusive } from '../../../../core/Util'\nimport { SurfaceType } from '../../../../scene/model/map/SurfaceType'\nimport { GameState } from '../../GameState'\nimport { MoveState } from '../../../../scene/model/MoveState'\nimport { PathTarget } from '../../../../scene/model/PathTarget'\n\nexport class SmallSpider extends Monster {\n\n    constructor() {\n        super(ResourceManager.getAnimationEntityType('Creatures/SpiderSB/SpiderSB.ae'))\n    }\n\n    get stats() {\n        return ResourceManager.stats.SmallSpider\n    }\n\n    startMoving() {\n        SmallSpider.onMove(this)\n    }\n\n    private static onMove(spider: SmallSpider) {\n        const prevSurface = spider.getCurrentSurface()\n        if (spider.target && spider.moveToClosestTarget([spider.target]) === MoveState.MOVED) {\n            const nextSurface = spider.getCurrentSurface()\n            if (prevSurface !== nextSurface) {\n                (GameState.spidersBySurface.get(prevSurface) || []).remove(spider)\n                GameState.spidersBySurface.getOrUpdate(nextSurface, () => []).push(spider)\n            }\n            if (!spider.worldMgr.sceneManager.terrain.getSurfaceFromWorld(spider.getPosition()).surfaceType.floor) {\n                spider.onDeath()\n            } else {\n                spider.moveTimeout = setTimeout(() => SmallSpider.onMove(spider), 1000 / NATIVE_FRAMERATE)\n            }\n        } else {\n            spider.changeActivity()\n            spider.moveTimeout = setTimeout(() => {\n                spider.target = spider.findTarget()\n                SmallSpider.onMove(spider)\n            }, 1000 + getRandom(9000))\n        }\n    }\n\n    private findTarget(): PathTarget {\n        const terrain = this.worldMgr.sceneManager.terrain\n        const currentCenter = terrain.getSurfaceFromWorld(this.getPosition()).getCenterWorld()\n        for (let c = 0; c < 20; c++) {\n            const targetX = getRandomInclusive(currentCenter.x - (TILESIZE + TILESIZE / 2), currentCenter.x + TILESIZE + TILESIZE / 2)\n            const targetZ = getRandomInclusive(currentCenter.z - TILESIZE / 2, currentCenter.z + TILESIZE / 2)\n            const surfaceType = terrain.getSurfaceFromWorldXZ(targetX, targetZ).surfaceType\n            if (surfaceType !== SurfaceType.WATER && surfaceType !== SurfaceType.LAVA) { // TODO evaluate CrossLand, CrossLava, CrossWater from stats\n                return new PathTarget(new Vector2(targetX, targetZ))\n            }\n        }\n        console.warn('Could not find a solid target')\n        return null\n    }\n\n    onDeath() {\n        this.onLevelEnd()\n        GameState.spiders.remove(this);\n        (GameState.spidersBySurface.get(this.getCurrentSurface()) || []).remove(this)\n    }\n\n}\n","import { Monster } from './Monster'\nimport { ResourceManager } from '../../../../resource/ResourceManager'\nimport { Vector2 } from 'three'\nimport { NATIVE_FRAMERATE, TILESIZE } from '../../../../main'\nimport { getRandomInclusive } from '../../../../core/Util'\nimport { GameState } from '../../GameState'\nimport { MoveState } from '../../../../scene/model/MoveState'\nimport { PathTarget } from '../../../../scene/model/PathTarget'\n\nexport class Bat extends Monster {\n\n    constructor() {\n        super(ResourceManager.getAnimationEntityType('Creatures/bat/bat.ae'))\n    }\n\n    get stats() {\n        return ResourceManager.stats.Bat\n    }\n\n    startRandomMove() {\n        Bat.onMove(this)\n    }\n\n    private static onMove(bat: Bat) {\n        if (!bat.target || bat.moveToClosestTarget([bat.target]) === MoveState.TARGET_REACHED) {\n            bat.target = bat.findTarget()\n        }\n        bat.moveTimeout = setTimeout(() => Bat.onMove(bat), 1000 / NATIVE_FRAMERATE)\n    }\n\n    determinePosY(x: number, z: number) {\n        return this.worldMgr.getFloorHeight(x, z) + TILESIZE / 2\n    }\n\n    private findTarget(): PathTarget { // TODO move to nearby drilling noise, explosions or sonic blasters\n        const terrain = this.worldMgr.sceneManager.terrain\n        const currentCenter = terrain.getSurfaceFromWorld(this.getPosition()).getCenterWorld()\n        for (let c = 0; c < 20; c++) {\n            const targetX = getRandomInclusive(currentCenter.x - (TILESIZE + TILESIZE / 2), currentCenter.x + TILESIZE + TILESIZE / 2)\n            const targetZ = getRandomInclusive(currentCenter.z - TILESIZE / 2, currentCenter.z + TILESIZE / 2)\n            if (terrain.getSurfaceFromWorldXZ(targetX, targetZ).surfaceType.floor) { // TODO evaluate CrossLand, CrossLava, CrossWater from stats\n                return new PathTarget(new Vector2(targetX, targetZ))\n            }\n        }\n        console.warn('Could not find a solid target')\n        return null\n    }\n\n    onDeath() {\n        this.onLevelEnd()\n        GameState.bats.remove(this)\n    }\n\n}\n","import { ResourceManager } from '../resource/ResourceManager'\nimport { TILESIZE } from '../main'\nimport { MathUtils, Vector2, Vector3 } from 'three'\nimport { Raider } from './model/Raider'\nimport { GameState } from '../game/model/GameState'\nimport { Building } from '../game/model/entity/building/Building'\nimport { BuildingEntity } from './model/BuildingEntity'\nimport { SurfaceType } from './model/map/SurfaceType'\nimport { Crystal } from './model/collect/Crystal'\nimport { WorldManager } from './WorldManager'\nimport { EventBus } from '../event/EventBus'\nimport { EntityAddedEvent, EntityType } from '../event/WorldEvents'\nimport { SmallSpider } from '../game/model/entity/monster/SmallSpider'\nimport { Bat } from '../game/model/entity/monster/Bat'\nimport degToRad = MathUtils.degToRad\n\nexport class ObjectListLoader {\n\n    static loadObjectList(worldMgr: WorldManager, objectListConf) {\n        Object.values(objectListConf).forEach((olObject: any) => {\n            const lTypeName = olObject.type ? olObject.type.toLowerCase() : olObject.type\n            // all object positions are off by half a tile, because 0/0 is the top left corner of first tile\n            const worldX = (olObject.xPos - 1) * TILESIZE\n            const worldZ = (olObject.yPos - 1) * TILESIZE\n            const terrainY = worldMgr.getTerrainHeight(worldX, worldZ)\n            const buildingType: string = ResourceManager.cfg('BuildingTypes', olObject.type)\n            const radHeading = degToRad(olObject.heading)\n            if (lTypeName === 'TVCamera'.toLowerCase()) {\n                const offset = new Vector3(5 * TILESIZE, 0, 0).applyAxisAngle(new Vector3(0, 1, 0), radHeading - Math.PI / 16).add(new Vector3(worldX, terrainY, worldZ - TILESIZE / 2))\n                worldMgr.sceneManager.camera.position.copy(offset)\n                worldMgr.sceneManager.camera.position.y = 4.5 * TILESIZE\n                worldMgr.sceneManager.controls.target.copy(new Vector3(worldX, terrainY, worldZ - TILESIZE / 2))\n                worldMgr.sceneManager.controls.update()\n                worldMgr.setTorchPosition(new Vector2(worldX, worldZ - TILESIZE / 2))\n            } else if (lTypeName === 'Pilot'.toLowerCase()) {\n                const raider = new Raider()\n                raider.worldMgr = worldMgr\n                raider.changeActivity()\n                raider.createPickSphere()\n                raider.group.position.set(worldX, terrainY, worldZ)\n                raider.group.rotateOnAxis(new Vector3(0, 1, 0), radHeading - Math.PI / 2)\n                raider.group.visible = worldMgr.sceneManager.terrain.getSurfaceFromWorld(raider.group.position).discovered\n                if (raider.group.visible) {\n                    GameState.raiders.push(raider)\n                    EventBus.publishEvent(new EntityAddedEvent(EntityType.RAIDER, raider))\n                } else {\n                    GameState.raidersUndiscovered.push(raider)\n                }\n                worldMgr.sceneManager.scene.add(raider.group)\n            } else if (buildingType) {\n                const building = Building.getByName(buildingType)\n                const entity = new BuildingEntity(building)\n                entity.worldMgr = worldMgr\n                entity.changeActivity()\n                entity.createPickSphere()\n                entity.group.position.set(worldX, worldMgr.getFloorHeight(worldX, worldZ), worldZ)\n                entity.group.rotateOnAxis(new Vector3(0, 1, 0), -radHeading - Math.PI)\n                entity.group.visible = worldMgr.sceneManager.terrain.getSurfaceFromWorld(entity.group.position).discovered\n                if (entity.group.visible) {\n                    GameState.buildings.push(entity)\n                    EventBus.publishEvent(new EntityAddedEvent(EntityType.BUILDING, entity))\n                } else {\n                    GameState.buildingsUndiscovered.push(entity)\n                }\n                // TODO rotate building with normal vector of surface\n                worldMgr.sceneManager.scene.add(entity.group)\n                const primaryPathSurface = worldMgr.sceneManager.terrain.getSurfaceFromWorld(entity.group.position)\n                primaryPathSurface.setBuilding(entity)\n                primaryPathSurface.surfaceType = SurfaceType.POWER_PATH_BUILDING\n                primaryPathSurface.updateTexture()\n                entity.surfaces.push(primaryPathSurface)\n                if (building.secondaryBuildingPart) {\n                    const secondaryOffset = new Vector3(TILESIZE * building.secondaryBuildingPart.x, 0, TILESIZE * building.secondaryBuildingPart.y)\n                        .applyAxisAngle(new Vector3(0, 1, 0), -radHeading).add(entity.group.position)\n                    const secondarySurface = worldMgr.sceneManager.terrain.getSurfaceFromWorld(secondaryOffset)\n                    secondarySurface.setBuilding(entity)\n                    secondarySurface.surfaceType = SurfaceType.POWER_PATH_BUILDING\n                    secondarySurface.updateTexture()\n                    entity.surfaces.push(secondarySurface)\n                }\n                if (building.hasPrimaryPowerPath) {\n                    const pathOffset = new Vector3(0, 0, -TILESIZE).applyAxisAngle(new Vector3(0, 1, 0), radHeading)\n                    pathOffset.add(entity.group.position)\n                    const pathSurface = worldMgr.sceneManager.terrain.getSurfaceFromWorld(pathOffset)\n                    if (building === Building.GEODOME) pathSurface.building = entity\n                    pathSurface.surfaceType = SurfaceType.POWER_PATH_BUILDING\n                    pathSurface.updateTexture()\n                    entity.surfaces.push(pathSurface)\n                }\n                if (building === Building.POWER_STATION || entity.surfaces.some((s) => s.neighbors.some((n) => n.hasPower))) {\n                    entity.turnOnPower()\n                }\n            } else if (lTypeName === 'PowerCrystal'.toLowerCase()) {\n                worldMgr.addCollectable(new Crystal(), new Vector2(worldX, worldZ))\n            } else if (lTypeName === 'SmallSpider'.toLowerCase()) {\n                const spider = new SmallSpider()\n                spider.worldMgr = worldMgr\n                spider.changeActivity()\n                spider.group.position.set(worldX, terrainY, worldZ)\n                const currentSurface = spider.getCurrentSurface()\n                spider.group.visible = currentSurface.discovered\n                worldMgr.sceneManager.scene.add(spider.group)\n                GameState.spiders.push(spider)\n                GameState.spidersBySurface.getOrUpdate(currentSurface, () => []).push(spider)\n                spider.startMoving()\n            } else if (lTypeName === 'Bat'.toLowerCase()) {\n                const bat = new Bat()\n                bat.worldMgr = worldMgr\n                bat.changeActivity()\n                bat.group.position.set(worldX, bat.determinePosY(worldX, worldZ), worldZ)\n                bat.group.visible = worldMgr.sceneManager.terrain.getSurfaceFromWorld(bat.group.position).discovered\n                worldMgr.sceneManager.scene.add(bat.group)\n                GameState.bats.push(bat)\n                bat.startRandomMove()\n            } else {\n                // TODO implement remaining object types\n                console.warn('Object type ' + olObject.type + ' not yet implemented')\n            }\n        })\n        // update path textures when all buildings are added\n        GameState.buildings.forEach((b) => b.surfaces.forEach((bSurf) => {\n            for (let x = -1; x <= 1; x++) {\n                for (let y = -1; y <= 1; y++) {\n                    worldMgr.sceneManager.terrain.getSurface(bSurf.x + x, bSurf.y + y).updateTexture()\n                }\n            }\n        }))\n    }\n\n}\n","import { PublicJob } from '../Job'\nimport { RaiderTool } from '../../../../scene/model/RaiderTool'\nimport { RaiderSkill } from '../../../../scene/model/RaiderSkill'\nimport { JobType } from '../JobType'\nimport { FulfillerEntity } from '../../../../scene/model/FulfillerEntity'\nimport { Surface } from '../../../../scene/model/map/Surface'\n\nexport abstract class SurfaceJob extends PublicJob {\n\n    surface: Surface = null\n    color: number = 0xffffff\n    colorPriority: number = 0\n    requiredTool: RaiderTool = null\n    requiredSkill: RaiderSkill = null\n\n    protected constructor(type: JobType, surface: Surface) {\n        super(type)\n        this.surface = surface\n    }\n\n    isQualified(fulfiller: FulfillerEntity) {\n        return (!this.requiredTool || fulfiller.hasTool(this.requiredTool))\n            && (!this.requiredSkill || fulfiller.hasSkill(this.requiredSkill))\n    }\n\n    isQualifiedWithTool(fulfiller: FulfillerEntity): RaiderTool {\n        return this.requiredTool\n    }\n\n    isQualifiedWithTraining(fulfiller: FulfillerEntity): RaiderSkill {\n        return this.requiredSkill\n    }\n\n}\n","import { Dynamite } from '../../../../scene/model/collect/Dynamite'\nimport { Surface } from '../../../../scene/model/map/Surface'\nimport { PathTarget } from '../../../../scene/model/PathTarget'\nimport { SurfaceJob } from './SurfaceJob'\nimport { JobType } from '../JobType'\nimport { RaiderSkill } from '../../../../scene/model/RaiderSkill'\nimport { PriorityIdentifier } from '../PriorityIdentifier'\n\nexport class DynamiteJob extends SurfaceJob {\n\n    dynamite: Dynamite\n\n    constructor(surface: Surface, dynamite: Dynamite) {\n        super(JobType.BLOW, surface)\n        this.dynamite = dynamite\n        this.color = 0xa06060\n        this.colorPriority = 2\n        this.requiredSkill = RaiderSkill.DEMOLITION\n    }\n\n    getWorkplaces(): PathTarget[] {\n        return [new PathTarget(this.dynamite.getPosition2D())]\n    }\n\n    onJobComplete() {\n        super.onJobComplete()\n        this.dynamite.ignite()\n    }\n\n    getPriorityIdentifier(): PriorityIdentifier {\n        return PriorityIdentifier.aiPriorityDestruction\n    }\n\n}\n","/** Function documentation mostly copied from the following URLs\n *\n * https://kb.rockraidersunited.com/User:Jessietail/NERPs_reference\n * https://web.archive.org/web/20131206122442/http://rru-stuff.org/nerpfuncs.html\n * https://kb.rockraidersunited.com/NERPs_documentation#Labels\n *\n */\nimport { GameResultState, GameState } from '../game/model/GameState'\nimport { Building } from '../game/model/entity/building/Building'\nimport { clearIntervalSafe } from './Util'\n\nexport class NerpRunner {\n\n    debug = false\n    onLevelComplete: () => any = null\n    nerpInterval: NodeJS.Timeout = null\n\n    registers = new Array(8).fill(0)\n    timers = new Array(4).fill(0)\n    scriptLines = [] // contains humand readable script strings\n    statements = [] // contains parsed statements for execution\n    macrosByName = {}\n    labelsByName = {}\n    halted = false\n    programCounter = 0\n    messages = []\n    // more state variables and switches\n    messagePermit = null\n\n    constructor(debug = false) {\n        this.debug = debug\n    }\n\n    startExecution() {\n        const that = this\n        this.nerpInterval = setInterval(() => {\n            that.execute()\n        }, 2000)\n    }\n\n    pauseExecution() {\n        this.nerpInterval = clearIntervalSafe(this.nerpInterval)\n    }\n\n    /**\n     * Internally used to validate and parse a register number.\n     * @param register\n     * @return {number}\n     */\n    checkRegister(register) {\n        const num = parseInt(register)\n        if (isNaN(num) || num < 0 || num > this.registers.length) throw new Error('Invalid register (' + register + ') provided')\n        return num\n    }\n\n    /**\n     * Internally used to validate and parse a value before setting or adding it with a register.\n     * @param value\n     * @return {number}\n     */\n    checkRegisterValue(value) {\n        const num = parseInt(value)\n        if (isNaN(num)) throw new Error('Invalid register value (' + value + ') provided')\n        return num\n    }\n\n    /**\n     * Gets the value currently stored in the given register, internally used to handle all registers with one method.\n     * @param register the register to read\n     * @return {number} returns the value currently stored in the register\n     */\n    getR(register) {\n        register = this.checkRegister(register)\n        return this.registers[register]\n    }\n\n    /**\n     * Sets the given value for the given register, internally used to handle all registers with one method.\n     * @param register the register to set\n     * @param value the value to set for the given register\n     */\n    setR(register, value) {\n        register = this.checkRegister(register)\n        value = this.checkRegisterValue(value)\n        this.registers[register] = value\n    }\n\n    /**\n     * Adds the given value to the given register, internally used to handle all registers with one method.\n     * @param register the register to add to\n     * @param value the value to add to the given register\n     */\n    addR(register, value) {\n        register = this.checkRegister(register)\n        value = this.checkRegisterValue(value)\n        this.registers[register] += value\n    }\n\n    /**\n     * Set the respective timer to the given numerical value. Units are in milliseconds.\n     * @param timer\n     * @param value\n     */\n    setTimer(timer, value) {\n        const num = parseInt(value)\n        if (isNaN(num)) throw new Error('Can\\'t set timer to NaN value: ' + value)\n        this.timers[timer] = new Date().getTime() + num\n    }\n\n    /**\n     * Gets the value of the respective timer. Units are in milliseconds.\n     * @param timer\n     * @return {number}\n     */\n    getTimer(timer) {\n        return new Date().getTime() - this.timers[timer]\n    }\n\n    /**\n     * End the level successfully and show the score screen.\n     */\n    setLevelCompleted() {\n        this.halted = true\n        GameState.resultState = GameResultState.COMPLETE\n        this.onLevelComplete()\n    }\n\n    /**\n     * End the level as failure and show the score screen.\n     */\n    setLevelFail() {\n        this.halted = true\n        GameState.resultState = GameResultState.FAILED\n        this.onLevelComplete()\n    }\n\n    /**\n     * Sets tutorial flags\n     * @param value a bitmask to set flags with\n     */\n    setTutorialFlags(value) {\n        // TODO implement tutorial flags\n        // seems like value must be interpreted bitwise and sets a certain flag on each bit\n        // seen so far:\n        // 0 = 0x00 allow any click anywhere anytime\n        // 3 = 0x11 disallow invalid clicks\n        // 4095 = 0x111111111111 set all flags? (seen in Tutorial01 level)\n    }\n\n    /**\n     * This is used to make messages come up/not come up.\n     * @param messagesAllowed\n     */\n    setMessagePermit(messagesAllowed) {\n        this.messagePermit = !messagesAllowed\n    }\n\n    setBuildingsUpgradeLevel(typeName, level) {\n        GameState.buildings.forEach(b => {\n            if (b.type === typeName) b.level = level\n        })\n    }\n\n    setToolStoreLevel(level) {\n        this.setBuildingsUpgradeLevel(Building.TOOLSTATION, level)\n    }\n\n    setTeleportPadLevel(level) {\n        this.setBuildingsUpgradeLevel(Building.TELEPORT_PAD, level)\n    }\n\n    setPowerStationLevel(level) {\n        this.setBuildingsUpgradeLevel(Building.POWER_STATION, level)\n    }\n\n    setBarracksLevel(level) {\n        this.setBuildingsUpgradeLevel(Building.BARRACKS, level)\n    }\n\n    /**\n     * Gets the number of tool stores currently built. NOT the total ever built.\n     * @return {number}\n     */\n    getToolStoresBuilt() {\n        return GameState.getBuildingsByType(Building.TOOLSTATION).length\n    }\n\n    /**\n     * Gets the number of minifigures on the level. TODO it is NOT tested if this ignores minifigures in hidden caverns\n     * @return {number}\n     */\n    getMinifiguresOnLevel() {\n        return GameState.raiders.length\n    }\n\n    /**\n     * Gets the number of crystals currently stored.\n     * @return {number}\n     */\n    getCrystalsCurrentlyStored() {\n        return GameState.numCrystal\n    }\n\n    getObjectiveSwitch() {\n        // TODO implement this\n        return 0\n    }\n\n    setMessageTimerValues(arg1, arg2, arg3) {\n        // TODO implement this\n    }\n\n    getMessageTimer() {\n        return 0 // TODO return remaining amount of time needed to fully play WAV message\n    }\n\n    cameraUnlock() {\n        // TODO implement this\n    }\n\n    setMessage(messageNumber, arrowDisabled) {\n        if (!this.messagePermit) {\n            return\n        }\n        const msg = this.messages[messageNumber]\n        // TODO show message to user\n        console.log(msg.txt)\n        // msg.snd resides in sounds/streamed/ which is currently not loaded :(\n    }\n\n    setCameraGotoTutorial(arg1) {\n        // TODO implement this\n    }\n\n    getTutorialBlockIsGround(arg1) {\n        // TODO implement this\n        return 0\n    }\n\n    getTutorialBlockIsPath(arg1) {\n        // TODO implement this\n        return 0\n    }\n\n    getUnitAtBlock(arg1) {\n        // TODO implement this\n        return 0\n    }\n\n    getOxygenLevel() {\n        // TODO implement this\n        return 100\n    }\n\n    getObjectiveShowing() {\n        // TODO implement this\n        return false\n    }\n\n    addPoweredCrystals() {\n        // TODO implement this\n    }\n\n    disallowAll() {\n        // TODO implement this\n    }\n\n    getPoweredPowerStationsBuilt() {\n        return GameState.getBuildingsByType(Building.POWER_STATION).length\n    }\n\n    getPoweredBarracksBuilt() {\n        return GameState.getBuildingsByType(Building.BARRACKS).length\n    }\n\n    getRecordObjectAtTutorial() {\n        // TODO implement this\n    }\n\n    getHiddenObjectsFound() {\n        // TODO implement this\n        return 0\n    }\n\n    callMethod(methodName, methodArgs) {\n        if (methodName === 'Stop') {\n            throw 'Stop'\n        } else if (methodName === 'TRUE') {\n            return true\n        } else if (methodName === 'FALSE') {\n            return false\n        }\n        const setRegisterMatch = methodName.match(/^SetR([0-7])$/)\n        if (setRegisterMatch) {\n            return this.setR(setRegisterMatch[1], methodArgs[0])\n        }\n        const addRegisterMatch = methodName.match(/^AddR([0-7])$/)\n        if (addRegisterMatch) {\n            return this.addR(addRegisterMatch[1], methodArgs[0])\n        }\n        const getRegisterMatch = methodName.match(/^GetR([0-7])$/)\n        if (getRegisterMatch) {\n            return this.getR(getRegisterMatch[1])\n        }\n        const setTimerMatch = methodName.match(/^SetTimer([0-3])$/)\n        if (setTimerMatch) {\n            return this.setTimer(setTimerMatch[1], methodArgs[0])\n        }\n        const getTimerMatch = methodName.match(/^GetTimer([0-3])$/)\n        if (getTimerMatch) {\n            return this.getTimer(getTimerMatch[1])\n        }\n        const lMethodName = methodName.toLowerCase()\n        for (const memberName in this) {\n            // noinspection JSUnfilteredForInLoop\n            if (memberName.toLowerCase() === lMethodName) {\n                // @ts-ignore\n                // noinspection JSUnfilteredForInLoop\n                return this[memberName].apply(this, methodArgs)\n            }\n        }\n        throw new Error('Undefined method: ' + methodName)\n    }\n\n    conditional(left, right) {\n        const conditionResult = this.executeStatement(left)\n        if (this.debug) {\n            console.log('Condition evaluated to ' + conditionResult)\n        }\n        if (conditionResult) {\n            this.executeStatement(right)\n        }\n    }\n\n    executeStatement(expression) {\n        if (expression.invoke) {\n            const argValues = expression.invoke !== 'conditional' ? expression.args.map(e => this.executeStatement(e)) : expression.args\n            const result = this.callMethod(expression.invoke, argValues)\n            if (result !== undefined && this.debug) {\n                console.log('Method returned: ' + result)\n            }\n            return result\n        } else if (expression.comparator) {\n            const left = this.executeStatement(expression.left)\n            const right = this.executeStatement(expression.right)\n            if (expression.comparator === '=') {\n                return left === right\n            } else if (expression.comparator === '!=') {\n                return left !== right\n            } else if (expression.comparator === '<') {\n                return left < right\n            } else if (expression.comparator === '>') {\n                return left > right\n            } else {\n                console.log(expression)\n                throw new Error('Unknown comparator: ' + expression.comparator)\n            }\n        } else if (!isNaN(expression)) { // just a number\n            return expression\n        } else if (expression.jump) {\n            this.programCounter = this.labelsByName[expression.jump]\n            if (this.programCounter === undefined) {\n                throw new Error('Label \\'' + expression.jump + '\\' is unknown!')\n            }\n            if (this.debug) {\n                console.log('Jumping to label \\'' + expression.jump + '\\' in line ' + this.programCounter)\n            }\n        } else {\n            console.log(expression)\n            throw new Error('Unknown expression in line ' + this.programCounter + ': ' + expression)\n        }\n    }\n\n    execute(debug = false) {\n        this.debug = debug\n        if (this.halted) return\n        try {\n            if (this.debug) {\n                console.log('Executing following script\\n' + this.scriptLines.join('\\n'))\n                console.log('Registers: ' + this.registers)\n            }\n            for (this.programCounter = 0; this.programCounter < this.statements.length; this.programCounter++) {\n                const statement = this.statements[this.programCounter]\n                if (this.debug) {\n                    console.log(this.programCounter + ': ' + this.scriptLines[this.programCounter])\n                    console.log(statement)\n                }\n                if (!statement.label) { // do nothing for label markers\n                    this.executeStatement(statement)\n                }\n            }\n        } catch (e) {\n            if (e === 'Stop') {\n                return\n            }\n            console.error(e)\n            console.error('FATAL ERROR! Script execution failed! You can NOT win anymore!')\n            this.halted = true\n            debugger;\n        }\n    }\n\n}\n","import { NerpRunner } from './NerpRunner'\nimport { ResourceManager } from '../resource/ResourceManager'\n\nexport class NerpParser {\n\n    static parse(nerpScript: string): NerpRunner {\n        const nerpRunner = new NerpRunner()\n        const lines = nerpScript.split('\\n').map(l => l\n            .split('//')[0].trim() // before comment starts\n            .split(';')[0].trim() // before preprocessor comment starts\n            .replace(/_/g, '') // some preprocessor macros use this prefix\n            .replace(/\\bTRUE \\? /, '') // some weird requirement of the original language\n            .replace(/[{}]/g, ''), // duplicate limit for macros using labels too\n        )\n        for (let c = 0; c < lines.length; c++) {\n            const line = lines[c]\n            if (line.length < 1) {\n                continue // ignore empty lines, but important for macro closure\n            }\n            if (line.startsWith('#include ')) { // include other nerp scripts/headers\n                const includeName = line.replace(/^#include /, '').trim().slice(1, -1)\n                if (includeName === 'nerpdef.h') {\n                    // trivial default header file, is applied by search and replace above\n                    // see https://github.com/jgrip/legorr/blob/master/nerpdef.h\n                    continue\n                }\n                const includedRunner = NerpParser.parse(ResourceManager.getResource('Levels/' + includeName))\n                if (!includedRunner || !includedRunner.scriptLines || includedRunner.scriptLines.length < 1) {\n                    throw 'Can\\'t include unknown nerp script: ' + line\n                }\n                nerpRunner.scriptLines = nerpRunner.scriptLines.concat(includedRunner.scriptLines)\n                // copy macros from included file to current file\n                nerpRunner.macrosByName = Object.assign({}, nerpRunner.macrosByName, includedRunner.macrosByName)\n            } else if (line.startsWith('#define ')) { // parse C++ preprocessor macro\n                const firstLine = line.replace(/^#define /, '').split(' ')\n                const macroLines = [firstLine.splice(1).join(' ').replace(/\\\\$/, '').trim()]\n                let mLine = line\n                let append = false\n                while (mLine.endsWith('\\\\') && c < lines.length - 1) {\n                    c++\n                    mLine = lines[c].trim()\n                    const macroLine = mLine.replace(/\\\\$/, '').trim()\n                    if (macroLine.length > 0) {\n                        if (append) {\n                            append = false\n                            macroLines[macroLines.length - 1] += macroLine\n                        } else {\n                            macroLines.push(macroLine)\n                        }\n                    }\n                    if (mLine.match(/:\\\\$/)) {\n                        append = true\n                    }\n                }\n                const macroCall = firstLine[0].split('(')\n                nerpRunner.macrosByName[macroCall[0]] = {\n                    args: macroCall[1].replace(/\\)$/, '').split(','),\n                    lines: macroLines,\n                }\n            } else {\n                nerpRunner.scriptLines = nerpRunner.scriptLines.concat(this.replaceMacros(nerpRunner.macrosByName, line))\n            }\n        }\n        // somewhat precompile the script and create syntax tree\n        // must be done in separate block to make sure the script is complete and we can refer/rely on line numbers for label jumps\n        for (let c = 0; c < nerpRunner.scriptLines.length; c++) {\n            const line = nerpRunner.scriptLines[c]\n            nerpRunner.statements[c] = line.replace(/\\(\\)/g, '') // now the macros are applied and obsolete empty \"()\" can be removed\n                .split(' ? ')\n            const labelMatch = line.match(/(\\S+):/)\n            if (nerpRunner.statements[c].length === 2) { // line contains condition (primary operator)\n                nerpRunner.statements[c] = {\n                    invoke: 'conditional',\n                    args: [this.preProcess(nerpRunner.statements[c][0]), this.preProcess(nerpRunner.statements[c][1])],\n                }\n            } else if (labelMatch) { // keep label line number for later usage\n                const labelName = labelMatch[1].toLowerCase()\n                nerpRunner.labelsByName[labelName] = c\n                nerpRunner.statements[c] = {label: labelName}\n            } else if (nerpRunner.statements[c].length === 1) { // just a call\n                nerpRunner.statements[c] = this.preProcess(nerpRunner.statements[c][0])\n            } else { // lines contains more than 1 condition statement\n                throw 'Can\\'t deal with line: ' + line\n            }\n        }\n        return nerpRunner\n    }\n\n    static replaceMacros(macrosByName, line): string[] {\n        // check if this line contains a macro\n        const split = line.split('(') // not a very stable check though...\n        const macro = macrosByName[split[0]]\n        if (macro) {\n            const argValues = split.splice(1).join('(').slice(0, -1).split(',')\n            if (argValues.length !== macro.args.length) {\n                throw 'Invalid number of args provided for macro in line ' + line\n            }\n            const macroLines = []\n            macro.lines.forEach((line) => {\n                for (let c = 0; c < argValues.length; c++) {\n                    line = line.replace(new RegExp('\\\\b' + macro.args[c] + '\\\\b'), argValues[c])\n                }\n                macroLines.push(...(this.replaceMacros(macrosByName, line)))\n            })\n            return macroLines\n        } else {\n            return [line]\n        }\n    }\n\n    static preProcess(expression) {\n        expression = expression.trim().replace(/^_/, '') // remove whitespace and leading underscore\n        const number = parseInt(expression)\n        if (!isNaN(number)) {\n            return number\n        }\n        const opSplit = expression.split(/ (=) | (!=) | (>) | (<) /).filter(e => e !== undefined)\n        const brackets = expression.match(/^(.+)\\((.+)\\)$/)\n        const spaceSplit = expression.split(' ')\n        const labelMatch = expression.match(/([^:]+):$/)\n        const jumpMatch = expression.match(/^:([^:]+)$/)\n        if (opSplit.length === 3) { // expression contains secondary operator\n            return {left: this.preProcess(opSplit[0]), comparator: opSplit[1], right: this.preProcess(opSplit[2])}\n        } else if (brackets) {\n            const args = brackets[2].split(',').map(a => this.preProcess(a))\n            return {invoke: brackets[1], args: args}\n        } else if (spaceSplit.length > 1) { // space split must be the very last since most expressions contain space\n            const args = spaceSplit.length === 2 ? [this.preProcess(spaceSplit[1])] : spaceSplit.splice(1).map(a => this.preProcess(a))\n            return {invoke: spaceSplit[0], args: args}\n        } else if (labelMatch) { // label definition\n            return {label: labelMatch[1]}\n        } else if (jumpMatch) { // jump to label\n            return {jump: jumpMatch[1].toLowerCase()}\n        } else { // function call without args\n            if (expression.match(/[ =?><!]/)) {\n                throw 'Invalid expression given, parsing must have failed before somewhere'\n            }\n            return {invoke: expression, args: []}\n        }\n    }\n\n}\n","import { LevelPrioritiesEntryConfig } from '../../../cfg/LevelsCfg'\nimport { PublicJob } from './Job'\nimport { PriorityIdentifier } from './PriorityIdentifier'\n\nexport class PriorityList {\n\n    levelDefault: PriorityEntry[] = []\n    current: PriorityEntry[] = []\n\n    constructor(priorities: LevelPrioritiesEntryConfig[]) {\n        this.levelDefault = priorities\n        this.reset()\n    }\n\n    toggle(index: number) {\n        this.current[index].enabled = !this.current[index].enabled\n    }\n\n    upOne(index: number) {\n        const tmp = this.current[index]\n        this.current[index] = this.current[index + 1]\n        this.current[index + 1] = tmp\n    }\n\n    reset() {\n        this.current = this.levelDefault.map(entry => new PriorityEntry(entry)) // use deep copy to avoid interference\n    }\n\n    pushToTop(index: number) {\n        const element = this.current[index]\n        for (let c = index; c > 0; c--) {\n            this.current[c] = this.current[c - 1]\n        }\n        this.current[0] = element\n    }\n\n    getPriority(job: PublicJob) {\n        let priority = 0\n        this.current.some((j, index) => {\n            if (j.key === job.getPriorityIdentifier()) {\n                priority = index\n                return true\n            }\n        })\n        return priority\n    }\n\n}\n\nexport class PriorityEntry {\n\n    key: PriorityIdentifier\n    enabled: boolean\n\n    constructor(levelPriorityEntry: LevelPrioritiesEntryConfig) {\n        this.key = levelPriorityEntry.key\n        this.enabled = levelPriorityEntry.enabled\n    }\n\n}\n","import { Vector2 } from 'three'\nimport { Job } from './Job'\nimport { JobType } from './JobType'\nimport { PathTarget } from '../../../scene/model/PathTarget'\n\nexport class MoveJob extends Job {\n\n    target: PathTarget[]\n\n    constructor(target: Vector2) {\n        super(JobType.MOVE)\n        this.target = [new PathTarget(target)]\n    }\n\n    getWorkplaces(): PathTarget[] {\n        return this.target\n    }\n\n}\n","import { SceneManager } from './SceneManager'\nimport { TerrainLoader } from './TerrainLoader'\nimport { ResourceManager } from '../resource/ResourceManager'\nimport { Color, MathUtils, Raycaster, Vector2, Vector3 } from 'three'\nimport { clearIntervalSafe, getRandom } from '../core/Util'\nimport { EventBus } from '../event/EventBus'\nimport { EntityAddedEvent, EntityType, JobCreateEvent, RaiderRequested, SpawnDynamiteEvent } from '../event/WorldEvents'\nimport { Raider } from './model/Raider'\nimport { GameState } from '../game/model/GameState'\nimport { Building } from '../game/model/entity/building/Building'\nimport { CollectableEntity } from './model/collect/CollectableEntity'\nimport { CHECK_SPANW_RAIDER_TIMER, TILESIZE, UPDATE_OXYGEN_TIMER } from '../main'\nimport { ObjectListLoader } from './ObjectListLoader'\nimport { Dynamite } from './model/collect/Dynamite'\nimport { DynamiteJob } from '../game/model/job/surface/DynamiteJob'\nimport { NerpParser } from '../core/NerpParser'\nimport { NerpRunner } from '../core/NerpRunner'\nimport { GameScreen } from '../screen/GameScreen'\nimport { LevelEntryCfg } from '../cfg/LevelsCfg'\nimport { PriorityList } from '../game/model/job/PriorityList'\nimport { MoveJob } from '../game/model/job/MoveJob'\nimport { RaiderActivity } from './model/activities/RaiderActivity'\nimport { EventKey } from '../event/EventKeyEnum'\nimport { CollectJob } from '../game/model/job/CollectJob'\nimport { AirLevelChanged } from '../event/LocalEvents'\nimport degToRad = MathUtils.degToRad\n\nexport class WorldManager {\n\n    sceneManager: SceneManager = null\n    spawnRaiderInterval = null\n    nerpRunner: NerpRunner = null\n    oxygenUpdateInterval = null\n\n    constructor(canvas: HTMLCanvasElement) {\n        this.sceneManager = new SceneManager(canvas)\n        EventBus.registerEventListener(EventKey.DESELECTED_ENTITY, () => GameState.selectEntities([]))\n        EventBus.registerEventListener(EventKey.RAIDER_REQUESTED, () => {\n            if (GameState.requestedRaiders > 0 && !this.spawnRaiderInterval) {\n                this.spawnRaiderInterval = setInterval(this.checkSpawnRaiders.bind(this), CHECK_SPANW_RAIDER_TIMER)\n            }\n        })\n        EventBus.registerEventListener(EventKey.SPAWN_DYNAMITE, (event: SpawnDynamiteEvent) => {\n            const targetBuilding = GameState.getClosestBuildingByType(event.surface.getCenterWorld(), Building.TOOLSTATION)\n            if (!targetBuilding) throw 'Could not find toolstation to spawn dynamite'\n            const pos = targetBuilding.getDropPosition()\n            const dynamite = new Dynamite()\n            dynamite.targetSurface = event.surface\n            dynamite.worldMgr = this\n            dynamite.group.position.copy(pos)\n            this.sceneManager.scene.add(dynamite.group)\n            EventBus.publishEvent(new JobCreateEvent(new DynamiteJob(event.surface, dynamite)))\n        })\n        EventBus.registerEventListener(EventKey.CAVERN_DISCOVERED, () => {\n            GameState.discoveredCaverns++\n        })\n        this.oxygenUpdateInterval = setInterval(this.updateOxygen.bind(this), UPDATE_OXYGEN_TIMER)\n    }\n\n    setup(levelConf: LevelEntryCfg, gameScreen: GameScreen) {\n        GameState.levelFullName = levelConf.fullName\n        GameState.totalCaverns = levelConf.reward?.quota?.caverns || 0\n        GameState.rewardConfig = levelConf.reward\n        GameState.priorityList = new PriorityList(levelConf.priorities)\n        GameState.oxygenRate = levelConf.oxygenRate\n\n        const ambientRgb = ResourceManager.cfg('Main', 'AmbientRGB') || [10, 10, 10]\n        const maxAmbRgb = Math.min(255, Math.max(0, ...ambientRgb))\n        const normalizedRgb = ambientRgb.map(v => v / (maxAmbRgb ? maxAmbRgb : 1))\n        const ambientColor = new Color(normalizedRgb[0], normalizedRgb[1], normalizedRgb[2])\n        this.sceneManager.setupScene(ambientColor)\n\n        // create terrain mesh and add it to the scene\n        this.sceneManager.terrain = TerrainLoader.loadTerrain(levelConf, this)\n        this.sceneManager.scene.add(this.sceneManager.terrain.floorGroup)\n\n        // load in non-space objects next\n        const objectListConf = ResourceManager.getResource(levelConf.oListFile)\n        ObjectListLoader.loadObjectList(this, objectListConf)\n\n        // load nerp script\n        this.nerpRunner = NerpParser.parse(ResourceManager.getResource(levelConf.nerpFile))\n        this.nerpRunner.messages.push(...(ResourceManager.getResource(levelConf.nerpMessageFile)))\n        this.nerpRunner.onLevelComplete = () => gameScreen.onLevelEnd()\n\n        // gather level start details for game result score calculation\n        GameState.totalDiggables = this.sceneManager.terrain.surfaces.filter((r) => r.forEach((s) => s.isDigable())).length\n        GameState.totalCrystals = 0\n        this.sceneManager.terrain.surfaces.forEach((r) => r.forEach((s) => GameState.totalCrystals += s.containedCrystals))\n        GameState.totalOres = 0\n        this.sceneManager.terrain.surfaces.forEach((r) => r.forEach((s) => GameState.totalOres += s.containedOres))\n    }\n\n    start() {\n        this.sceneManager.startScene()\n        this.nerpRunner?.startExecution()\n        GameState.levelStartTime = Date.now()\n    }\n\n    stop() {\n        GameState.levelStopTime = Date.now()\n        this.nerpRunner?.pauseExecution()\n        this.spawnRaiderInterval = clearIntervalSafe(this.spawnRaiderInterval)\n        GameState.spiders.forEach((m) => m.onLevelEnd())\n        GameState.bats.forEach((b) => b.onLevelEnd())\n        GameState.remainingDiggables = 0\n        this.sceneManager?.terrain?.surfaces?.forEach((r) => r.forEach((s) => GameState.remainingDiggables += s.isDigable() ? 1 : 0))\n        this.sceneManager.disposeScene()\n    }\n\n    resize(width: number, height: number) {\n        if (this.sceneManager) this.sceneManager.renderer.setSize(width, height)\n    }\n\n    getTerrainIntersectionPoint(rx: number, ry: number): Vector3 {\n        if (!this.sceneManager.terrain) return null\n        const raycaster = new Raycaster()\n        raycaster.setFromCamera({x: rx, y: ry}, this.sceneManager.camera)\n        const intersects = raycaster.intersectObjects(this.sceneManager.terrain.floorGroup.children)\n        return intersects.length > 0 ? intersects[0].point : null\n    }\n\n    setTorchPosition(position: Vector2) {\n        this.sceneManager.cursorTorchlight.position.x = position.x\n        this.sceneManager.cursorTorchlight.position.y = this.getFloorHeight(position.x, position.y) + 2 * TILESIZE\n        this.sceneManager.cursorTorchlight.position.z = position.y\n    }\n\n    getFloorHeight(worldX: number, worldZ: number): number {\n        const surface = this.sceneManager.terrain.getSurfaceFromWorldXZ(worldX, worldZ)\n        if (!surface) return 0\n        return surface.getFloorHeight(worldX, worldZ)\n    }\n\n    getTerrainHeight(worldX: number, worldZ: number): number {\n        const raycaster = new Raycaster(new Vector3(Number(worldX), 3 * TILESIZE, Number(worldZ)), new Vector3(0, -1, 0))\n        const intersect = raycaster.intersectObject(this.sceneManager.terrain.floorGroup, true)\n        if (intersect.length > 0) {\n            return intersect[0].point.y\n        } else {\n            console.warn('could not determine terrain height for ' + worldX + '/' + worldZ)\n            return 0\n        }\n    }\n\n    addCollectable(collectable: CollectableEntity, world: Vector2) {\n        collectable.worldMgr = this\n        collectable.group.position.set(world.x, this.getFloorHeight(world.x, world.y), world.y)\n        collectable.group.visible = this.sceneManager.terrain.getSurfaceFromWorld(collectable.group.position).discovered\n        this.sceneManager.scene.add(collectable.group)\n        if (collectable.group.visible) {\n            GameState.collectables.push(collectable)\n            EventBus.publishEvent(new JobCreateEvent(new CollectJob(collectable)))\n        } else {\n            GameState.collectablesUndiscovered.push(collectable)\n        }\n        return collectable\n    }\n\n    checkSpawnRaiders() {\n        if (GameState.requestedRaiders < 1) {\n            this.spawnRaiderInterval = clearIntervalSafe(this.spawnRaiderInterval)\n            return\n        }\n        if (GameState.raiders.length >= GameState.getMaxRaiders()) return\n        const spawnBuildings = GameState.getBuildingsByType(Building.TOOLSTATION, Building.TELEPORT_PAD).filter((b) => !b.spawning)\n        for (let c = 0; c < spawnBuildings.length && GameState.requestedRaiders > 0; c++) {\n            GameState.requestedRaiders--\n            EventBus.publishEvent(new RaiderRequested())\n            const station = spawnBuildings[c]\n            station.spawning = true\n            const raider = new Raider()\n            raider.worldMgr = this\n            raider.changeActivity(RaiderActivity.TeleportIn, () => {\n                station.spawning = false\n                raider.changeActivity()\n                raider.createPickSphere()\n                const walkOutPos = station.getPosition2D().add(new Vector2(0, TILESIZE * 3 / 4 + getRandom(TILESIZE / 2))\n                    .rotateAround(new Vector2(0, 0), station.getHeading() + degToRad(-10 + getRandom(20))))\n                raider.setJob(new MoveJob(walkOutPos))\n                GameState.raiders.push(raider)\n                EventBus.publishEvent(new EntityAddedEvent(EntityType.RAIDER, raider))\n            })\n            raider.group.position.copy(station.group.position).add(new Vector3(0, 0, TILESIZE / 2).applyEuler(station.group.rotation))\n            raider.group.rotation.copy(station.group.rotation)\n            this.sceneManager.scene.add(raider.group)\n        }\n    }\n\n    updateOxygen() {\n        const sum = GameState.raiders.map((r) => r.stats.OxygenCoef).reduce((l, r) => l + r, 0) +\n            GameState.buildings.map((b) => b.stats.OxygenCoef).reduce((l, r) => l + r, 0)\n        const rateMultiplier = 0.001\n        const valuePerSecond = 1 / 25\n        const msToSeconds = 0.001\n        const diff = sum * GameState.oxygenRate * rateMultiplier * valuePerSecond * UPDATE_OXYGEN_TIMER * msToSeconds / 10\n        if (diff) {\n            GameState.airlevel = Math.min(1, Math.max(0, GameState.airlevel + diff))\n            EventBus.publishEvent(new AirLevelChanged())\n        }\n    }\n\n}\n","import { ScreenLayer } from '../../screen/ScreenLayer'\nimport { MOUSE_BUTTON, POINTER_EVENT } from '../../event/EventTypeEnum'\nimport { WorldManager } from '../../scene/WorldManager'\nimport { GameState } from '../model/GameState'\n\nexport class SelectionLayer extends ScreenLayer {\n\n    worldManager: WorldManager\n    selectStart: { x: number, y: number } = null\n\n    constructor() {\n        super(true)\n    }\n\n    reset() {\n        super.reset()\n        this.selectStart = null\n    }\n\n    setWorldManager(worldManager: WorldManager) {\n        this.worldManager = worldManager\n    }\n\n    handlePointerEvent(eventEnum: POINTER_EVENT, event: PointerEvent): boolean {\n        if (GameState.buildModeSelection) return\n        const [cx, cy] = this.toCanvasCoords(event.clientX, event.clientY)\n        if (eventEnum === POINTER_EVENT.DOWN) {\n            if (event.button === MOUSE_BUTTON.MAIN) return this.startSelection(cx, cy)\n        } else if (eventEnum === POINTER_EVENT.MOVE) {\n            return this.changeSelection(cx, cy)\n        } else if (eventEnum === POINTER_EVENT.UP) {\n            if (event.button === MOUSE_BUTTON.MAIN) return this.selectEntities(cx, cy)\n        }\n        return false\n    }\n\n    startSelection(screenX: number, screenY: number) {\n        this.selectStart = {x: screenX, y: screenY}\n        return true\n    }\n\n    changeSelection(screenX: number, screenY: number) {\n        if (!this.selectStart) return false // selection was not started on this layer\n        this.context.clearRect(0, 0, this.canvas.width, this.canvas.height)\n        this.context.strokeStyle = 'rgba(128, 192, 192, 0.5)'\n        this.context.lineWidth = 2\n        this.context.strokeRect(this.selectStart.x, this.selectStart.y, screenX - this.selectStart.x, screenY - this.selectStart.y)\n        return true\n    }\n\n    selectEntities(screenX: number, screenY: number) {\n        if (!this.selectStart) return false // selection was not started on this layer\n        this.context.clearRect(0, 0, this.canvas.width, this.canvas.height)\n        const r1x = (this.selectStart.x / this.canvas.width) * 2 - 1\n        const r1y = -(this.selectStart.y / this.canvas.height) * 2 + 1\n        const r2x = (screenX / this.canvas.width) * 2 - 1\n        const r2y = -(screenY / this.canvas.height) * 2 + 1\n        if (Math.abs(screenX - this.selectStart.x) < 5 && Math.abs(screenY - this.selectStart.y) < 5) {\n            const x = (this.selectStart.x + screenX) / this.canvas.width - 1\n            const y = -(this.selectStart.y + screenY) / this.canvas.height + 1\n            this.worldManager.sceneManager.selectEntitiesByRay(x, y)\n        } else {\n            this.worldManager.sceneManager.selectEntitiesInFrustum(r1x, r1y, r2x, r2y)\n        }\n        this.selectStart = null\n        return true\n    }\n\n}\n","import { SurfaceJob } from './SurfaceJob'\nimport { JobType } from '../JobType'\nimport { Surface } from '../../../../scene/model/map/Surface'\nimport { PathTarget } from '../../../../scene/model/PathTarget'\nimport { RaiderTool } from '../../../../scene/model/RaiderTool'\nimport { PriorityIdentifier } from '../PriorityIdentifier'\n\nexport class DrillJob extends SurfaceJob {\n\n    constructor(surface: Surface) {\n        super(JobType.DRILL, surface)\n        this.color = 0xa0a0a0\n        this.requiredTool = RaiderTool.DRILL\n        this.surface = surface\n    }\n\n    getWorkplaces(): PathTarget[] {\n        return this.surface.getDigPositions().map((p) => new PathTarget(p))\n    }\n\n    onJobComplete() {\n        super.onJobComplete()\n        this.surface.collapse()\n    }\n\n    getPriorityIdentifier(): PriorityIdentifier {\n        return PriorityIdentifier.aiPriorityDestruction\n    }\n\n}\n","import { SurfaceJob } from './SurfaceJob'\nimport { JobType } from '../JobType'\nimport { PathTarget } from '../../../../scene/model/PathTarget'\nimport { RaiderTool } from '../../../../scene/model/RaiderTool'\nimport { PriorityIdentifier } from '../PriorityIdentifier'\nimport { Surface } from '../../../../scene/model/map/Surface'\n\nexport class ClearRubbleJob extends SurfaceJob {\n\n    constructor(surface: Surface) {\n        super(JobType.CLEAR_RUBBLE, surface)\n        this.requiredTool = RaiderTool.SHOVEL\n        this.surface = surface\n    }\n\n    getWorkplaces(): PathTarget[] {\n        const rubblePositions = this.surface.rubblePositions\n        return rubblePositions.length > 0 ? [new PathTarget(rubblePositions[0])] : [] // use first (no need to optimize)\n    }\n\n    onJobComplete() {\n        super.onJobComplete()\n        this.surface.reduceRubble()\n    }\n\n    getPriorityIdentifier(): PriorityIdentifier {\n        return PriorityIdentifier.aiPriorityClearing\n    }\n\n}\n","import { CollectableEntity } from '../../../../scene/model/collect/CollectableEntity'\nimport { Surface } from '../../../../scene/model/map/Surface'\nimport { SurfaceType } from '../../../../scene/model/map/SurfaceType'\nimport { PriorityIdentifier } from '../PriorityIdentifier'\nimport { JobType } from '../JobType'\nimport { PathTarget } from '../../../../scene/model/PathTarget'\nimport { SurfaceJob } from './SurfaceJob'\nimport { RaiderTool } from '../../../../scene/model/RaiderTool'\n\nexport class CompletePowerPathJob extends SurfaceJob {\n\n    placedItems: CollectableEntity[]\n    workplaces: PathTarget[]\n\n    constructor(surface: Surface, placedItems: CollectableEntity[]) {\n        super(JobType.COMPLETE_POWER_PATH, surface)\n        this.requiredTool = RaiderTool.SHOVEL\n        this.surface = surface\n        this.placedItems = placedItems\n        this.workplaces = [new PathTarget(surface.getRandomPosition())]\n    }\n\n    onJobComplete() {\n        super.onJobComplete()\n        this.placedItems.forEach((placed) => placed.removeFromScene())\n        this.surface.surfaceType = SurfaceType.POWER_PATH\n        this.surface.updateTexture()\n        this.surface.neighbors.forEach((s) => s.updateTexture())\n    }\n\n    getPriorityIdentifier(): PriorityIdentifier {\n        return PriorityIdentifier.aiPriorityConstruction\n    }\n\n    getWorkplaces(): PathTarget[] {\n        return this.workplaces\n    }\n\n}\n","import { Vector2, Vector3 } from 'three'\nimport { Surface } from './map/Surface'\nimport { CollectableEntity, CollectableType } from './collect/CollectableEntity'\nimport { EventBus } from '../../event/EventBus'\nimport { EntityAddedEvent, EntityType, JobCreateEvent } from '../../event/WorldEvents'\nimport { CompletePowerPathJob } from '../../game/model/job/surface/CompletePowerPathJob'\nimport { GameState } from '../../game/model/GameState'\nimport { Building } from '../../game/model/entity/building/Building'\nimport { BuildingEntity } from './BuildingEntity'\nimport { BuildingActivity } from './activities/BuildingActivity'\n\nexport class BuildingSite {\n\n    building: Building\n    heading: number = 0\n    surfaces: Surface[] = []\n    neededByType = {}\n    assignedByType = {}\n    onSiteByType = {}\n    complete: boolean = false\n\n    constructor(building: Building) {\n        this.building = building\n    }\n\n    getRandomDropPosition(): Vector2 {\n        return this.surfaces[0].getRandomPosition() // TODO use \"primary\" surface\n    }\n\n    needs(collectableType: CollectableType): boolean {\n        const needed = this.neededByType[collectableType] || 0\n        const assigned = (this.assignedByType[collectableType] || []).length\n        return needed > assigned\n    }\n\n    assign(item: CollectableEntity) {\n        const collectableType = item.getCollectableType()\n        this.assignedByType[collectableType] = this.assignedByType[collectableType] || []\n        this.assignedByType[collectableType].push(item)\n    }\n\n    unAssign(item: CollectableEntity) {\n        const collectableType = item.getCollectableType()\n        this.assignedByType[collectableType] = (this.assignedByType[collectableType] || [])\n        this.assignedByType[collectableType].splice(this.assignedByType[collectableType].indexOf(item), 1)\n    }\n\n    addItem(item: CollectableEntity) {\n        const collectableType = item.getCollectableType()\n        const needed = this.neededByType[collectableType] || 0\n        this.onSiteByType[collectableType] = this.onSiteByType[collectableType] || []\n        if (this.onSiteByType[collectableType].length < needed) {\n            item.worldMgr.sceneManager.scene.add(item.group)\n            this.onSiteByType[collectableType].push(item)\n            this.checkComplete()\n        } else {\n            item.resetTarget()\n        }\n    }\n\n    checkComplete() {\n        if (this.complete) return\n        let complete = true\n        Object.keys(this.neededByType).some((neededType) => {\n            const needed = this.neededByType[neededType] || 0\n            const onSite = (this.onSiteByType[neededType] || []).length\n            if (onSite < needed) {\n                complete = false\n                return true\n            }\n        })\n        if (complete) {\n            this.complete = complete\n            GameState.buildingSites.remove(this)\n            const items = []\n            Object.keys(this.onSiteByType).forEach((collectableType) => items.push(...this.onSiteByType[collectableType]))\n            if (!this.building) {\n                EventBus.publishEvent(new JobCreateEvent(new CompletePowerPathJob(this.surfaces[0], items)))\n            } else {\n                // FIXME remove all barriers with 'teleport' activity\n                const primarySurface = this.surfaces[0]\n                const entity = new BuildingEntity(this.building)\n                entity.worldMgr = primarySurface.terrain.worldMgr // FIXME refactor this\n                entity.changeActivity(BuildingActivity.Teleport, () => {\n                    entity.createPickSphere()\n                    GameState.buildings.push(entity)\n                    EventBus.publishEvent(new EntityAddedEvent(EntityType.BUILDING, entity))\n                })\n                const world = primarySurface.getCenterWorld()\n                entity.group.position.set(world.x, entity.worldMgr.getFloorHeight(world.x, world.z), world.z)\n                entity.group.rotateOnAxis(new Vector3(0, 1, 0), this.heading - Math.PI / 2) // TODO y offset?\n                // TODO rotate building with normal vector of surface\n                entity.group.visible = entity.worldMgr.sceneManager.terrain.getSurfaceFromWorld(entity.group.position).discovered\n                entity.worldMgr.sceneManager.scene.add(entity.group)\n                // FIXME handle surfaces below\n                // FIXME turn on power\n                // TODO implement building spawning\n                console.log('Building site is complete')\n            }\n        }\n    }\n\n}\n","import { ScreenLayer } from '../../screen/ScreenLayer'\nimport { WorldManager } from '../../scene/WorldManager'\nimport { SelectionType } from '../model/Selectable'\nimport { GameState } from '../model/GameState'\nimport { Raider } from '../../scene/model/Raider'\nimport { EventBus } from '../../event/EventBus'\nimport { JobCreateEvent } from '../../event/WorldEvents'\nimport { Surface } from '../../scene/model/map/Surface'\nimport { CancelBuildMode, EntityDeselected } from '../../event/LocalEvents'\nimport { FulfillerEntity } from '../../scene/model/FulfillerEntity'\nimport { SurfaceJob } from '../model/job/surface/SurfaceJob'\nimport { KEY_EVENT, MOUSE_BUTTON, POINTER_EVENT } from '../../event/EventTypeEnum'\nimport { DEV_MODE } from '../../main'\nimport { MoveJob } from '../model/job/MoveJob'\nimport { Vector2 } from 'three'\nimport { DrillJob } from '../model/job/surface/DrillJob'\nimport { ClearRubbleJob } from '../model/job/surface/ClearRubbleJob'\nimport { SurfaceType } from '../../scene/model/map/SurfaceType'\nimport { CollectableEntity, CollectableType } from '../../scene/model/collect/CollectableEntity'\nimport { BuildingSite } from '../../scene/model/BuildingSite'\nimport { Building } from '../model/entity/building/Building'\nimport { BuildingEntityStats } from '../../cfg/BuildingEntityStats'\nimport { Barrier, BarrierPathTarget } from '../../scene/model/collect/Barrier'\n\nexport class GameLayer extends ScreenLayer {\n\n    private worldMgr: WorldManager\n    private rightDown: { x: number, y: number } = {x: 0, y: 0}\n\n    constructor() {\n        super(false, false)\n    }\n\n    reset() {\n        super.reset()\n        this.rightDown = {x: 0, y: 0}\n    }\n\n    setWorldManager(worldMgr: WorldManager) {\n        this.worldMgr = worldMgr\n    }\n\n    handlePointerEvent(eventEnum: POINTER_EVENT, event: PointerEvent): boolean {\n        if (eventEnum === POINTER_EVENT.MOVE) {\n            const intersectionPoint = this.getTerrainPositionFromEvent(event)\n            if (intersectionPoint) this.worldMgr.setTorchPosition(intersectionPoint)\n            if (this.worldMgr.sceneManager.buildMarker.updateAllMarker(this.worldMgr.sceneManager.terrain, intersectionPoint)) {\n                this.worldMgr.sceneManager.buildMarker.resetColor()\n            } else {\n                this.worldMgr.sceneManager.buildMarker.markAsInvalid()\n            }\n        } else if (eventEnum === POINTER_EVENT.UP) {\n            if (event.button === MOUSE_BUTTON.MAIN) {\n                if (GameState.buildModeSelection && this.worldMgr.sceneManager.buildMarker.lastCheck) {\n                    this.worldMgr.sceneManager.buildMarker.visibleSurfaces.forEach((s) => {\n                        s.surfaceType = SurfaceType.POWER_PATH_BUILDING\n                        s.updateTexture()\n                    })\n                    const barrierLocations = this.worldMgr.sceneManager.buildMarker.barrierLocations\n                    const stats = BuildingEntityStats.getByType(GameState.buildModeSelection)\n                    const neededCrystals = stats?.CostCrystal || 0\n                    const neededOre = stats?.CostOre || 0\n                    const site = new BuildingSite(GameState.buildModeSelection)\n                    site.heading = this.worldMgr.sceneManager.buildMarker.heading\n                    site.surfaces.push(...this.worldMgr.sceneManager.buildMarker.visibleSurfaces)\n                    site.neededByType[CollectableType.BARRIER] = barrierLocations.length\n                    site.neededByType[CollectableType.CRYSTAL] = neededCrystals\n                    site.neededByType[CollectableType.ORE] = neededOre\n                    GameState.buildingSites.push(site)\n                    const closestToolstation = GameState.getClosestBuildingByType(this.worldMgr.sceneManager.buildMarker.primarySurface.getCenterWorld(), Building.TOOLSTATION)\n                    if (closestToolstation) {\n                        closestToolstation.spawnMaterials(barrierLocations.map((t) => {\n                            const barrier = GameState.dropMaterial(CollectableType.BARRIER, 1)[0] as any as Barrier // FIXME refactor this\n                            barrier.targets = [new BarrierPathTarget(t, site)]\n                            return barrier\n                        }) as any[] as CollectableEntity[]) // FIXME refactor this\n                        closestToolstation.spawnMaterials(GameState.dropMaterial(CollectableType.CRYSTAL, neededCrystals))\n                        closestToolstation.spawnMaterials(GameState.dropMaterial(CollectableType.ORE, neededOre))\n                    }\n                    EventBus.publishEvent(new EntityDeselected())\n                    EventBus.publishEvent(new CancelBuildMode())\n                }\n            } else if (event.button === MOUSE_BUTTON.SECONDARY) {\n                const downUpDistance = Math.abs(event.x - this.rightDown.x) + Math.abs(event.y - this.rightDown.y)\n                if (downUpDistance < 3 && (GameState.selectionType === SelectionType.PILOT || GameState.selectionType === SelectionType.GROUP)) {\n                    // TODO check for collectable entity first\n                    const intersectionPoint = this.getTerrainPositionFromEvent(event)\n                    if (intersectionPoint) {\n                        const surface = this.worldMgr.sceneManager.terrain.getSurfaceFromWorldXZ(intersectionPoint.x, intersectionPoint.y)\n                        if (surface) {\n                            if (surface.isDrillable()) {\n                                this.createSurfaceJob(new DrillJob(surface), surface, intersectionPoint)\n                            } else if (surface.hasRubble()) {\n                                this.createSurfaceJob(new ClearRubbleJob(surface), surface, intersectionPoint)\n                            } else if (surface.isWalkable()) {\n                                GameState.selectedEntities.forEach((raider: Raider) => raider.setJob(new MoveJob(intersectionPoint)))\n                                if (GameState.selectedEntities.length > 0) EventBus.publishEvent(new EntityDeselected())\n                            }\n                        }\n                    }\n                } else {\n                    GameState.buildModeSelection = null\n                    this.worldMgr.sceneManager.buildMarker.hideAllMarker()\n                }\n            }\n        } else if (eventEnum === POINTER_EVENT.DOWN) {\n            if (event.button === MOUSE_BUTTON.SECONDARY) {\n                this.rightDown.x = event.x\n                this.rightDown.y = event.y\n            }\n        }\n        this.canvas.dispatchEvent(event)\n        return true\n    }\n\n    handleKeyEvent(eventEnum: KEY_EVENT, event: KeyboardEvent): boolean {\n        if (DEV_MODE && eventEnum === KEY_EVENT.UP) {\n            if (GameState.selectionType === SelectionType.SURFACE) {\n                GameState.selectedEntities.forEach((s: Surface) => {\n                    if (event.key === 'c') {\n                        if (!s.surfaceType.floor) s.collapse()\n                    } else if (event.key === 'f') {\n                        const t = s.terrain.findFallInTarget(s.x, s.y)\n                        if (!s.surfaceType.floor) s.createFallin(t[0], t[1])\n                    }\n                })\n                EventBus.publishEvent(new EntityDeselected())\n                return true\n            }\n        }\n        return false\n    }\n\n    createSurfaceJob(surfJob: SurfaceJob, surface: Surface, intersectionPoint: Vector2) {\n        GameState.selectedEntities.forEach((e: FulfillerEntity) => {\n            if (surfJob.isQualified(e)) {\n                e.setJob(surfJob)\n            } else if (surface.isWalkable()) {\n                e.setJob(new MoveJob(intersectionPoint))\n            }\n        })\n        EventBus.publishEvent(new JobCreateEvent(surfJob))\n        surface.updateJobColor()\n        if (GameState.selectedEntities.length > 0) EventBus.publishEvent(new EntityDeselected())\n    }\n\n    getTerrainPositionFromEvent(event): Vector2 {\n        const [cx, cy] = this.toCanvasCoords(event.clientX, event.clientY)\n        const rx = (cx / this.canvas.width) * 2 - 1\n        const ry = -(cy / this.canvas.height) * 2 + 1\n        const intersectionPoint = this.worldMgr.getTerrainIntersectionPoint(rx, ry)\n        return intersectionPoint ? new Vector2(intersectionPoint.x, intersectionPoint.z) : null\n    }\n\n    handleWheelEvent(event: WheelEvent): boolean {\n        this.canvas.dispatchEvent(event)\n        return true\n    }\n\n}\n","export class BaseElement {\n\n    parent: BaseElement = null\n    x: number = 0\n    y: number = 0\n    relX: number = 0\n    relY: number = 0\n    width: number = 0\n    height: number = 0\n    children: BaseElement[] = []\n    hidden: boolean = false\n    disabled: boolean = false\n    hover: boolean = false\n    pressed: boolean = false\n\n    constructor(parent: BaseElement = null) {\n        this.parent = parent\n    }\n\n    reset() {\n        this.hidden = false\n        this.disabled = false\n        this.hover = false\n        this.pressed = false\n        this.children.forEach((c) => c.reset())\n    }\n\n    addChild<T extends BaseElement>(child: T): T {\n        child.parent = this\n        this.children.push(child)\n        child.updatePosition()\n        return child\n    }\n\n    onRedraw(context: CanvasRenderingContext2D) {\n        if (this.hidden) return\n        this.children.forEach((child) => child.onRedraw(context))\n        this.children.forEach((child) => child.drawHover(context))\n        this.children.forEach((child) => child.drawTooltip(context))\n    }\n\n    drawHover(context: CanvasRenderingContext2D) {\n    }\n\n    drawTooltip(context: CanvasRenderingContext2D) {\n    }\n\n    onClick() {\n    }\n\n    isInactive(): boolean {\n        for (let parent = this.parent; !!parent; parent = parent.parent) if (parent.isInactive()) return true\n        return this.hidden || this.disabled\n    }\n\n    hide() {\n        this.hidden = true\n        this.children.forEach((child) => child.hide())\n    }\n\n    show() {\n        this.hidden = false\n        this.children.forEach((child) => child.show())\n    }\n\n    updatePosition() {\n        this.x = this.parent ? this.parent.x + this.relX : this.relX\n        this.y = this.parent ? this.parent.y + this.relY : this.relY\n        this.children.forEach((child) => child.updatePosition())\n    }\n\n    isInRect(cx, cy) {\n        return cx >= this.x && cy >= this.y && cx < this.x + this.width && cy < this.y + this.height\n    }\n\n    checkHover(cx, cy): boolean {\n        if (this.isInactive()) return false\n        const inRect = this.isInRect(cx, cy)\n        let stateChanged = this.hover !== inRect\n        this.hover = inRect\n        this.pressed = this.pressed && this.hover\n        // TODO start tooltip timeout (if not already started)\n        this.children.forEach((child) => stateChanged = child.checkHover(cx, cy) || stateChanged)\n        return stateChanged\n    }\n\n    checkClick(cx, cy): boolean {\n        if (this.isInactive()) return false\n        const inRect = this.isInRect(cx, cy)\n        let stateChanged = this.pressed !== inRect\n        this.pressed = inRect\n        this.children.forEach((child) => stateChanged = child.checkClick(cx, cy) || stateChanged)\n        return stateChanged\n    }\n\n    checkRelease(cx, cy): boolean {\n        if (this.isInactive()) return false\n        const inRect = this.isInRect(cx, cy)\n        if (inRect && this.pressed) this.onClick()\n        let stateChanged = false\n        this.children.forEach((child) => stateChanged = child.checkRelease(cx, cy) || stateChanged)\n        stateChanged = this.pressed || stateChanged\n        this.pressed = false\n        return stateChanged\n    }\n\n    release(): boolean {\n        let stateChanged = this.pressed || this.hover\n        this.pressed = false\n        this.hover = false\n        this.children.forEach((child) => stateChanged = child.release() || stateChanged)\n        return stateChanged\n    }\n\n    notifyRedraw() {\n        if (this.parent) this.parent.notifyRedraw()\n    }\n\n}\n","import { ResourceManager } from '../../../resource/ResourceManager'\nimport { BaseElement } from './BaseElement'\nimport { NATIVE_FRAMERATE, PANEL_ANIMATION_MULTIPLIER } from '../../../main'\nimport { PanelCfg } from '../../../cfg/PanelsCfg'\nimport { clearTimeoutSafe } from '../../../core/Util'\n\nexport class Panel extends BaseElement {\n\n    img: HTMLCanvasElement = null\n    xOut: number = 0\n    yOut: number = 0\n    xIn: number = 0\n    yIn: number = 0\n    animationTimeout = null\n    movedIn: boolean = true // xIn, yIn is the collapsed position out of screen\n\n    constructor(panelCfg?: PanelCfg) {\n        super()\n        if (panelCfg) {\n            this.img = ResourceManager.getImage(panelCfg.filename)\n            this.xOut = panelCfg.xOut\n            this.yOut = panelCfg.yOut\n            this.xIn = panelCfg.xIn\n            this.yIn = panelCfg.yIn\n            this.relX = this.xIn\n            this.relY = this.yIn\n        }\n    }\n\n    reset() {\n        super.reset()\n        this.animationTimeout = clearTimeoutSafe(this.animationTimeout)\n        this.relX = this.xIn\n        this.relY = this.yIn\n        this.movedIn = true\n        this.updatePosition()\n    }\n\n    isInactive(): boolean {\n        return this.animationTimeout || super.isInactive()\n    }\n\n    setMovedIn(movedIn: boolean, onDone: () => any = null) {\n        if (this.movedIn !== movedIn) {\n            this.toggleState(onDone)\n        } else if (onDone) {\n            onDone()\n        }\n    }\n\n    toggleState(onDone: () => any = null) {\n        this.animationTimeout = clearTimeoutSafe(this.animationTimeout)\n        if (this.movedIn) {\n            this.movedIn = false\n            this.updateAnimation(this.xOut, this.yOut, PANEL_ANIMATION_MULTIPLIER, onDone)\n        } else {\n            this.movedIn = true\n            this.updateAnimation(this.xIn, this.yIn, PANEL_ANIMATION_MULTIPLIER, onDone)\n        }\n    }\n\n    protected updateAnimation(targetX: number, targetY: number, speed: number, onDone: () => any) {\n        const diffX = targetX - this.relX\n        const diffY = targetY - this.relY\n        if (Math.abs(diffX) <= speed && Math.abs(diffY) <= speed) {\n            this.relX = targetX\n            this.relY = targetY\n            this.animationTimeout = null\n            if (onDone) onDone()\n        } else {\n            this.relX += Math.round(Math.sign(diffX) * Math.sqrt(Math.abs(diffX)) * speed)\n            this.relY += Math.round(Math.sign(diffY) * Math.sqrt(Math.abs(diffY)) * speed)\n            const panel = this\n            this.animationTimeout = setTimeout(() => panel.updateAnimation(targetX, targetY, speed, onDone), 1000 / NATIVE_FRAMERATE)\n        }\n        this.updatePosition()\n        this.notifyRedraw()\n    }\n\n    onRedraw(context: CanvasRenderingContext2D) {\n        if (this.hidden) return\n        if (this.img) context.drawImage(this.img, this.x, this.y)\n        super.onRedraw(context)\n    }\n\n}\n\n","import { ResourceManager } from '../../../resource/ResourceManager'\nimport { BaseElement } from './BaseElement'\nimport { ButtonCfg } from '../../../cfg/ButtonsCfg'\n\nexport class Button extends BaseElement {\n\n    buttonType: string = null\n    imgNormal: HTMLCanvasElement = null\n    imgHover: HTMLCanvasElement = null\n    imgPressed: HTMLCanvasElement = null\n    imgDisabled: HTMLCanvasElement = null\n    tooltip: string = null\n\n    constructor(parent: BaseElement, btnCfg: ButtonCfg) {\n        super(parent)\n        this.buttonType = btnCfg.buttonType\n        this.imgNormal = ResourceManager.getImageOrNull(btnCfg.normalFile)\n        this.imgHover = ResourceManager.getImageOrNull(btnCfg.highlightFile)\n        this.imgPressed = ResourceManager.getImageOrNull(btnCfg.pressedFile)\n        this.imgDisabled = ResourceManager.getImageOrNull(btnCfg.disabledFile)\n        this.relX = btnCfg.relX\n        this.relY = btnCfg.relY\n        this.width = btnCfg.width || this.imgNormal?.width || this.imgPressed?.width\n        this.height = btnCfg.height || this.imgNormal?.height || this.imgPressed?.height\n        this.tooltip = btnCfg.tooltip?.replace(/_/g, ' ') // TODO refactor cfg handling\n        this.updatePosition()\n    }\n\n    onClick() {\n        console.log('button pressed: ' + this.buttonType)\n    }\n\n    checkHover(cx, cy): boolean {\n        const stateChanged = super.checkHover(cx, cy)\n        if (stateChanged) this.notifyRedraw()\n        return stateChanged\n    }\n\n    checkClick(cx, cy): boolean {\n        const stateChanged = super.checkClick(cx, cy)\n        if (stateChanged) this.notifyRedraw()\n        return stateChanged\n    }\n\n    checkRelease(cx, cy): boolean {\n        const stateChanged = super.checkRelease(cx, cy)\n        if (stateChanged) this.notifyRedraw()\n        return stateChanged\n    }\n\n    release(): boolean {\n        const stateChanged = super.release()\n        if (stateChanged) this.notifyRedraw()\n        return stateChanged\n    }\n\n    onRedraw(context: CanvasRenderingContext2D) {\n        if (this.hidden) return\n        let img = this.imgNormal\n        if (this.disabled) {\n            img = this.imgDisabled || this.imgPressed || this.imgNormal\n        } else if (this.pressed) {\n            img = this.imgPressed || this.imgNormal\n        } else if (this.hover) {\n            img = this.imgHover || this.imgNormal\n        }\n        if (img) context.drawImage(img, this.x, this.y)\n        super.onRedraw(context)\n    }\n\n}\n\n","import { BaseElement } from '../base/BaseElement'\nimport { ButtonCfg } from '../../../cfg/ButtonsCfg'\n\nexport class SideBarLabel extends BaseElement {\n\n    tooltip: string\n    label: string\n\n    constructor(parent: BaseElement, btnCfg: ButtonCfg, label: string) {\n        super(parent)\n        this.relX = btnCfg.relX\n        this.relY = btnCfg.relY\n        this.width = btnCfg.width\n        this.height = btnCfg.height\n        this.tooltip = btnCfg.tooltip\n        this.label = label\n        this.updatePosition()\n    }\n\n    onRedraw(context: CanvasRenderingContext2D) {\n        if (this.hidden) return\n        context.textAlign = 'center'\n        context.font = 'bold 10px Arial'\n        context.fillStyle = '#fff'\n        context.fillText(this.label, this.x + this.width / 2, this.y + this.height - 2)\n        super.onRedraw(context)\n    }\n\n}\n\n","import { GameState } from '../../model/GameState'\nimport { ResourceManager } from '../../../resource/ResourceManager'\nimport { Panel } from '../base/Panel'\nimport { EventBus } from '../../../event/EventBus'\nimport { MaterialAmountChanged } from '../../../event/WorldEvents'\nimport { CollectableType } from '../../../scene/model/collect/CollectableEntity'\nimport { PanelCfg } from '../../../cfg/PanelsCfg'\nimport { BaseConfig } from '../../../cfg/BaseConfig'\nimport { ButtonCfg } from '../../../cfg/ButtonsCfg'\nimport { SideBarLabel } from './SideBarLabel'\nimport { EventKey } from '../../../event/EventKeyEnum'\n\nexport class PanelCrystalSideBar extends Panel {\n\n    labelOre: SideBarLabel\n    labelCrystal: SideBarLabel\n    imgNoCrystal: HTMLCanvasElement\n    imgSmallCrystal: HTMLCanvasElement\n    imgUsedCrystal: HTMLCanvasElement\n    imgOre: HTMLCanvasElement\n\n    constructor(panelCfg: PanelCfg, buttonsCfg: ButtonCrystalSideBarCfg) {\n        super(panelCfg)\n        this.labelOre = this.addChild(new SideBarLabel(this, buttonsCfg.panelButtonCrystalSideBarOre, GameState.totalOre.toString()))\n        this.labelCrystal = this.addChild(new SideBarLabel(this, buttonsCfg.panelButtonCrystalSideBarCrystals, GameState.numCrystal.toString()))\n        this.imgNoCrystal = ResourceManager.getImage('Interface/RightPanel/NoSmallCrystal.bmp')\n        this.imgSmallCrystal = ResourceManager.getImage('Interface/RightPanel/SmallCrystal.bmp')\n        this.imgUsedCrystal = ResourceManager.getImage('Interface/RightPanel/UsedCrystal.bmp')\n        this.imgOre = ResourceManager.getImage('Interface/RightPanel/CrystalSideBar_Ore.bmp')\n        EventBus.registerEventListener(EventKey.MATERIAL_AMOUNT_CHANGED, (event: MaterialAmountChanged) => {\n            this.updateQuantities(event.collectableType)\n        })\n    }\n\n    updateQuantities(type: CollectableType) {\n        if (type === CollectableType.CRYSTAL || type === CollectableType.ORE || type === CollectableType.BRICK) {\n            this.notifyRedraw()\n        }\n    }\n\n    onRedraw(context: CanvasRenderingContext2D) {\n        this.labelOre.label = GameState.totalOre.toString()\n        this.labelCrystal.label = GameState.numCrystal.toString()\n        super.onRedraw(context)\n        // draw crystals\n        let curX = this.x + this.img.width - 8\n        let curY = this.y + this.img.height - 34\n        for (let c = 0; (GameState.neededCrystals < 1 || c < Math.max(GameState.neededCrystals, GameState.numCrystal)) && curY >= Math.max(this.imgNoCrystal.height, this.imgSmallCrystal.height, this.imgUsedCrystal.height); c++) {\n            let imgCrystal = this.imgNoCrystal\n            if (GameState.usedCrystals > c) {\n                imgCrystal = this.imgUsedCrystal\n            } else if (GameState.numCrystal > c) {\n                imgCrystal = this.imgSmallCrystal\n            }\n            curY -= imgCrystal.height\n            context.drawImage(imgCrystal, curX - imgCrystal.width / 2, curY)\n        }\n        // draw ores\n        curX = this.x + this.img.width - 21\n        curY = this.y + this.img.height - 42\n        for (let i = 0; i < GameState.numOre && curY >= this.imgOre.height; ++i) {\n            curY -= this.imgOre.height\n            context.drawImage(this.imgOre, curX - this.imgOre.width / 2, curY)\n        }\n    }\n\n}\n\nexport class ButtonCrystalSideBarCfg extends BaseConfig {\n\n    panelButtonCrystalSideBarOre: ButtonCfg = null\n    panelButtonCrystalSideBarCrystals: ButtonCfg = null\n\n    constructor(cfgObj: any) {\n        super()\n        BaseConfig.setFromCfg(this, cfgObj)\n    }\n\n    parseValue(lCfgKeyName: string, cfgValue: any): any {\n        return new ButtonCfg(cfgValue)\n    }\n\n}\n","import { BaseConfig } from '../../../cfg/BaseConfig'\nimport { ButtonCfg } from '../../../cfg/ButtonsCfg'\n\nexport class ButtonInfoDockCfg extends BaseConfig {\n\n    panelButtonInfoDockGoto: ButtonCfg = null\n    panelButtonInfoDockClose: ButtonCfg = null\n\n    constructor(cfgObj: any) {\n        super()\n        BaseConfig.setFromCfg(this, cfgObj)\n    }\n\n    parseValue(lCfgKeyName: string, cfgValue: any): any {\n        return new ButtonCfg(cfgValue)\n    }\n\n}\n","import { BaseConfig } from '../../../cfg/BaseConfig'\nimport { ButtonCfg } from '../../../cfg/ButtonsCfg'\n\nexport class ButtonPriorityListCfg extends BaseConfig {\n\n    panelButtonPriorityListDisable: ButtonCfg[] = []\n    panelButtonPriorityListUpOne: ButtonCfg[] = []\n    panelButtonPriorityListClose: ButtonCfg = null // not used in the game\n    panelButtonPriorityListReset: ButtonCfg = null\n\n    constructor(cfgObj: any) {\n        super()\n        BaseConfig.setFromCfg(this, cfgObj)\n    }\n\n    assignValue(objKey, lCfgKeyName, cfgValue): boolean {\n        if (lCfgKeyName.match(/panelButtonPriorityListDisable\\d+/i)) {\n            this.panelButtonPriorityListDisable.push(this.parseValue(lCfgKeyName, cfgValue))\n            return true\n        } else if (lCfgKeyName.match(/panelButtonPriorityListUpOne\\d+/i)) {\n            this.panelButtonPriorityListUpOne.push(this.parseValue(lCfgKeyName, cfgValue))\n            return true\n        } else {\n            return super.assignValue(objKey, lCfgKeyName, cfgValue)\n        }\n    }\n\n    parseValue(lCfgKeyName: string, cfgValue: any): any {\n        return new ButtonCfg(cfgValue)\n    }\n\n}\n","import { BaseConfig } from '../../../cfg/BaseConfig'\nimport { ButtonCfg } from '../../../cfg/ButtonsCfg'\n\nexport class ButtonTopCfg extends BaseConfig {\n\n    panelButtonTopPanelCallToArms: ButtonCfg = null\n    panelButtonTopPanelOptions: ButtonCfg = null\n    panelButtonTopPanelPriorities: ButtonCfg = null\n\n    constructor(cfgObj: any) {\n        super()\n        BaseConfig.setFromCfg(this, cfgObj)\n    }\n\n    parseValue(lCfgKeyName: string, cfgValue: any): any {\n        return new ButtonCfg(cfgValue)\n    }\n\n}\n","import { BaseConfig } from './BaseConfig'\nimport { ButtonRadarCfg } from '../game/gui/radar/RadarPanel'\nimport { ButtonCrystalSideBarCfg } from '../game/gui/sidebar/PanelCrystalSideBar'\nimport { ButtonInfoDockCfg } from '../game/gui/infodock/ButtonInfoDockCfg'\nimport { ButtonPriorityListCfg } from '../game/gui/toppanel/ButtonPriorityListCfg'\nimport { ButtonTopCfg } from '../game/gui/toppanel/ButtonTopCfg'\n\nexport class ButtonsCfg extends BaseConfig {\n\n    panelRadar: ButtonRadarCfg = null\n    panelCrystalSideBar: ButtonCrystalSideBarCfg = null\n    panelTopPanel: ButtonTopCfg = null\n    panelInformation: ButtonInformationCfg = null\n    panelPriorityList: ButtonPriorityListCfg = null\n    panelCameraControl: ButtonCameraControlCfg = null\n    panelInfoDock: ButtonInfoDockCfg = null\n    panelEncyclopedia: any = null // not used in the game\n\n    constructor(cfgObj: any) {\n        super()\n        BaseConfig.setFromCfg(this, cfgObj)\n    }\n\n    parseValue(lCfgKeyName: string, cfgValue: any): any {\n        const btnCfgValue = {}\n        cfgValue.forEach(arr => btnCfgValue[arr[0]] = arr)\n        if (lCfgKeyName === 'panelRadar'.toLowerCase()) {\n            return new ButtonRadarCfg(btnCfgValue)\n        } else if (lCfgKeyName === 'panelCrystalSideBar'.toLowerCase()) {\n            return new ButtonCrystalSideBarCfg(btnCfgValue)\n        } else if (lCfgKeyName === 'panelTopPanel'.toLowerCase()) {\n            return new ButtonTopCfg(btnCfgValue)\n        } else if (lCfgKeyName === 'panelInformation'.toLowerCase()) {\n            return new ButtonInformationCfg(btnCfgValue)\n        } else if (lCfgKeyName === 'panelPriorityList'.toLowerCase()) {\n            return new ButtonPriorityListCfg(btnCfgValue)\n        } else if (lCfgKeyName === 'panelCameraControl'.toLowerCase()) {\n            return new ButtonCameraControlCfg(btnCfgValue)\n        } else if (lCfgKeyName === 'panelInfoDock'.toLowerCase()) {\n            return new ButtonInfoDockCfg(btnCfgValue)\n        } else if (lCfgKeyName === 'panelEncyclopedia'.toLowerCase()) {\n            return null // not used in the game\n        } else {\n            return btnCfgValue\n        }\n    }\n\n}\n\nexport class ButtonInformationCfg extends BaseConfig {\n\n    panelButtonInformationToggle: ButtonCfg = null\n    panelButtonInformationFunction: ButtonCfg = null\n\n    constructor(cfgObj: any) {\n        super()\n        BaseConfig.setFromCfg(this, cfgObj)\n    }\n\n    parseValue(lCfgKeyName: string, cfgValue: any): any {\n        return new ButtonCfg(cfgValue)\n    }\n\n}\n\nexport class ButtonCameraControlCfg extends BaseConfig {\n\n    panelButtonCameraControlZoomIn: ButtonCfg = null\n    panelButtonCameraControlZoomOut: ButtonCfg = null\n    panelButtonCameraControlCycleBuildings: ButtonCfg = null\n    panelButtonCameraControlRotate: ButtonCfg = null\n\n    constructor(cfgObj: any) {\n        super()\n        BaseConfig.setFromCfg(this, cfgObj)\n    }\n\n    parseValue(lCfgKeyName: string, cfgValue: any): any {\n        return new ButtonCfg(cfgValue)\n    }\n\n}\n\nexport class BaseButtonCfg {\n\n    buttonType?: string = null\n    normalFile?: string = null\n    highlightFile?: string = null\n    pressedFile?: string = null\n    disabledFile?: string = null\n    relX?: number = 0\n    relY?: number = 0\n    width?: number = 0\n    height?: number = 0\n    tooltip?: string = null\n}\n\nexport class ButtonCfg extends BaseButtonCfg {\n\n    constructor(cfgValue: any) {\n        super()\n        if (cfgValue.length === 9) {\n            [this.buttonType, this.normalFile, this.highlightFile, this.pressedFile, this.relX, this.relY, this.width, this.height, this.tooltip] = cfgValue\n        } else {\n            throw 'Invalid number of arguments (' + cfgValue.length + ') given for button configuration expected 9 or 5'\n        }\n    }\n\n}\n\nexport class InfoButtonCfg extends BaseButtonCfg {\n\n    constructor(buttonImageFilename: string) {\n        super()\n        this.normalFile = buttonImageFilename\n        this.highlightFile = buttonImageFilename\n        this.pressedFile = buttonImageFilename\n        this.disabledFile = buttonImageFilename\n        this.relX = 0\n        this.relY = 0\n    }\n\n}\n","import { Button } from '../base/Button'\nimport { Panel } from '../base/Panel'\nimport { PanelCfg } from '../../../cfg/PanelsCfg'\nimport { ButtonCfg } from '../../../cfg/ButtonsCfg'\nimport { BaseConfig } from '../../../cfg/BaseConfig'\n\nexport class RadarPanel extends Panel {\n\n    fill: Panel\n    overlay: Panel\n    btnToggle: Button\n    btnMap: Button\n    btnTagged: Button\n\n    constructor(panelCfg: PanelCfg, panelFillCfg: PanelCfg, panelOverlayCfg: PanelCfg, buttonsCfg: ButtonRadarCfg) {\n        super(panelCfg)\n        this.fill = this.addChild(new Panel(panelFillCfg))\n        // fill cords given in abs, turn to rel (otherwise animation wont work)\n        this.fill.relX = this.relX - this.fill.relX\n        this.fill.relY = this.relY - this.fill.relY\n        this.overlay = this.addChild(new Panel(panelOverlayCfg))\n        // this.overlay.hide();\n        this.btnToggle = this.addChild(new Button(this, buttonsCfg.panelButtonRadarToggle))\n        this.btnToggle.onClick = () => this.toggleState()\n        this.btnMap = this.addChild(new Button(this, buttonsCfg.panelButtonRadarMapView))\n        this.btnMap.onClick = () => {\n            // this.fill.hide();\n            // this.overlay.hide();\n        }\n        this.btnTagged = this.addChild(new Button(this, buttonsCfg.panelButtonRadarTaggedObjectView))\n        this.btnTagged.onClick = () => {\n            // this.fill.show();\n            // this.overlay.show(); // TODO only show overlay, when entity selected\n        }\n    }\n\n}\n\nexport class ButtonRadarCfg extends BaseConfig {\n\n    panelButtonRadarToggle: ButtonCfg = null\n    panelButtonRadarTaggedObjectView: ButtonCfg = null\n    panelButtonRadarZoomIn: ButtonCfg = null\n    panelButtonRadarZoomOut: ButtonCfg = null\n    panelButtonRadarMapView: ButtonCfg = null\n\n    constructor(cfgObj: any) {\n        super()\n        BaseConfig.setFromCfg(this, cfgObj)\n    }\n\n    parseValue(lCfgKeyName: string, cfgValue: any): any {\n        return new ButtonCfg(cfgValue)\n    }\n\n}\n","import { TextInfoMessageEntryConfig } from './TextInfoMessageEntryConfig'\nimport { ResourceManager } from '../../../resource/ResourceManager'\nimport { BitmapFont } from '../../../core/BitmapFont'\n\nexport class TextInfoMessage {\n\n    infoImage\n    textImage\n\n    constructor(font: BitmapFont, infoMessageEntryConfig: TextInfoMessageEntryConfig, maxWidth: number) {\n        this.textImage = font.createTextImage(infoMessageEntryConfig.text, maxWidth)\n        this.infoImage = ResourceManager.getImageOrNull(infoMessageEntryConfig.imageFilename)\n    }\n\n}\n","import { ResourceManager } from '../../../resource/ResourceManager'\nimport { GameState } from '../../model/GameState'\nimport { Panel } from '../base/Panel'\nimport { PanelCfg } from '../../../cfg/PanelsCfg'\nimport { TextInfoMessageConfig } from './TextInfoMessageConfig'\nimport { EventBus } from '../../../event/EventBus'\nimport { TextInfoMessage } from './TextInfoMessage'\nimport { clearTimeoutSafe } from '../../../core/Util'\nimport { EventKey } from '../../../event/EventKeyEnum'\n\nexport class MessagePanel extends Panel {\n\n    imgAir: HTMLCanvasElement = null\n    currentMessage: TextInfoMessage = null\n    messageTimeout = null\n\n    msgSpaceToContinue: TextInfoMessage\n    msgAirSupplyLow: TextInfoMessage\n    msgAirSupplyRunningOut: TextInfoMessage\n    msgGameCompleted: TextInfoMessage\n    msgManTrained: TextInfoMessage\n    msgUnitUpgraded: TextInfoMessage\n\n    constructor(panelCfg: PanelCfg, textInfoMessageConfig: TextInfoMessageConfig) {\n        super(panelCfg)\n        this.relX = this.xOut = this.xIn = 42\n        this.relY = this.yOut = this.yIn = 409\n        this.imgAir = ResourceManager.getImage('Interface/Airmeter/msgpanel_air_juice.bmp')\n\n        const font = ResourceManager.getDefaultFont()\n        const crystalFound = new TextInfoMessage(font, textInfoMessageConfig.textCrystalFound, this.img.width)\n        EventBus.registerEventListener(EventKey.LOCATION_CRYSTAL_FOUND, () => this.setMessage(crystalFound))\n        this.msgSpaceToContinue = new TextInfoMessage(font, textInfoMessageConfig.textSpaceToContinue, this.img.width)\n        const cavernDiscovered = new TextInfoMessage(font, textInfoMessageConfig.textCavernDiscovered, this.img.width)\n        EventBus.registerEventListener(EventKey.CAVERN_DISCOVERED, () => this.setMessage(cavernDiscovered))\n        const oreFound = new TextInfoMessage(font, textInfoMessageConfig.textOreFound, this.img.width)\n        EventBus.registerEventListener(EventKey.ORE_FOUND, () => this.setMessage(oreFound))\n        this.msgAirSupplyLow = new TextInfoMessage(font, textInfoMessageConfig.textAirSupplyLow, this.img.width)\n        this.msgAirSupplyRunningOut = new TextInfoMessage(font, textInfoMessageConfig.textAirSupplyRunningOut, this.img.width)\n        this.msgGameCompleted = new TextInfoMessage(font, textInfoMessageConfig.textGameCompleted, this.img.width)\n        this.msgManTrained = new TextInfoMessage(font, textInfoMessageConfig.textManTrained, this.img.width)\n        EventBus.registerEventListener(EventKey.RAIDER_TRAINED, () => this.setMessage(this.msgManTrained))\n        this.msgUnitUpgraded = new TextInfoMessage(font, textInfoMessageConfig.textUnitUpgraded, this.img.width)\n        EventBus.registerEventListener(EventKey.AIR_LEVEL_CHANGED, () => this.notifyRedraw())\n    }\n\n    setMessage(textInfoMessage: TextInfoMessage, timeout: number = 3000) {\n        this.messageTimeout = clearTimeoutSafe(this.messageTimeout)\n        this.currentMessage = textInfoMessage\n        this.notifyRedraw()\n        if (timeout) {\n            const that = this\n            this.messageTimeout = setTimeout(() => {\n                that.currentMessage = null\n                that.notifyRedraw()\n            }, timeout)\n        }\n    }\n\n    unsetMessage(textInfoMessage: TextInfoMessage) {\n        if (this.currentMessage === textInfoMessage) {\n            this.currentMessage = null\n            this.notifyRedraw()\n        }\n    }\n\n    onRedraw(context: CanvasRenderingContext2D) {\n        super.onRedraw(context)\n        if (GameState.airlevel > 0) {\n            const width = Math.round(236 * Math.min(1, GameState.airlevel))\n            context.drawImage(this.imgAir, this.x + 85, this.y + 6, width, 8)\n        }\n        const textImage = this.currentMessage?.textImage\n        const infoImage = this.currentMessage?.infoImage\n        if (textImage) {\n            const txtX = this.x + (this.img.width - textImage.width - (infoImage ? infoImage.width : 0)) / 2\n            context.drawImage(textImage, txtX, this.y + 26)\n        }\n        if (infoImage) {\n            const infoX = this.x + this.img.width - infoImage.width\n            context.drawImage(infoImage, infoX, this.y + 16)\n        }\n    }\n\n}\n","import { BaseButtonCfg } from './ButtonsCfg'\n\nexport class IconPanelBackButtonCfg extends BaseButtonCfg {\n\n    constructor(cfgValue: any) {\n        super();\n        [this.width, this.height, this.highlightFile, this.pressedFile, this.tooltip] = cfgValue // Interface back button\n        this.relX = 4\n        this.relY = 14\n    }\n\n}\n","import { BaseButtonCfg } from './ButtonsCfg'\n\nexport class MenuItemCfg extends BaseButtonCfg {\n\n    tooltipSfx: string = null\n    tooltipDisabled: string = null\n    tooltipDisabledSfx: string = null\n    hotkey: string = null\n\n    constructor(cfgValue: any) {\n        super()\n        if (cfgValue.length === 4) {\n            [this.normalFile, this.disabledFile, this.pressedFile, this.hotkey] = cfgValue\n        } else if (cfgValue.length === 6) {\n            let tooltip, tooltipDisabled\n            [this.normalFile, this.disabledFile, this.pressedFile, tooltip, tooltipDisabled, this.hotkey] = cfgValue\n            if (tooltip) {\n                if (Array.isArray(tooltip)) {\n                    [this.tooltip, this.tooltipSfx] = tooltip\n                } else {\n                    this.tooltip = tooltip\n                }\n            }\n            if (tooltipDisabled) {\n                if (Array.isArray(tooltipDisabled)) {\n                    [this.tooltipDisabled, this.tooltipDisabledSfx] = tooltipDisabled\n                } else {\n                    this.tooltipDisabled = tooltipDisabled\n                }\n            }\n        }\n        this.tooltip?.replace(/_/g, ' ') // TODO refactor cfg handling\n        this.tooltipDisabled?.replace(/_/g, ' ') // TODO refactor cfg handling\n        this.width = 40\n        this.height = 40\n    }\n\n}\n","import { BaseElement } from '../base/BaseElement'\nimport { Button } from '../base/Button'\nimport { MenuItemCfg } from '../../../cfg/MenuItemCfg'\n\nexport class IconPanelButton extends Button {\n\n    tooltipSfx: string = null\n    tooltipDisabled: string = null\n    tooltipDisabledSfx: string = null\n    hotkey: string = null\n    isDisabled: () => boolean = () => this.disabled\n\n    constructor(parent: BaseElement, menuItemCfg: MenuItemCfg, itemKey: string, parentWidth: number, menuIndex: number) {\n        super(parent, menuItemCfg)\n        this.buttonType = itemKey\n        this.relX = parentWidth - 59\n        this.relY = 9 + this.height * menuIndex\n        this.tooltipSfx = menuItemCfg.tooltipSfx\n        this.tooltipDisabled = menuItemCfg.tooltipDisabled\n        this.tooltipDisabledSfx = menuItemCfg.tooltipDisabledSfx\n        this.hotkey = menuItemCfg.hotkey\n        this.disabled = true\n    }\n\n    reset() {\n        super.reset()\n        this.disabled = true\n        this.updateState(false)\n    }\n\n    onClick() {\n        console.log('menu item pressed: ' + this.buttonType)\n    }\n\n    updateState(autoRedraw: boolean = true) {\n        const targetState = !!this.isDisabled()\n        const stateChanged = this.disabled !== targetState\n        this.disabled = targetState\n        if (stateChanged && autoRedraw) this.notifyRedraw()\n        return stateChanged\n    }\n\n    drawHover(context: CanvasRenderingContext2D) {\n        super.drawHover(context)\n        if (!this.disabled && this.hover) {\n            context.strokeStyle = '#0f0'\n            context.lineWidth = 2\n            context.strokeRect(this.x - context.lineWidth / 2, this.y - context.lineWidth / 2, this.width + context.lineWidth - 1, this.height + context.lineWidth - 1)\n        }\n    }\n\n}\n","import { Panel } from '../base/Panel'\nimport { Button } from '../base/Button'\nimport { IconPanelBackButtonCfg } from '../../../cfg/IconPanelBackButtonCfg'\nimport { ResourceManager } from '../../../resource/ResourceManager'\nimport { MenuItemCfg } from '../../../cfg/MenuItemCfg'\nimport { IconPanelButton } from './IconPanelButton'\n\nexport class IconSubPanel extends Panel {\n\n    backBtn: Button = null\n    iconPanelButtons: IconPanelButton[] = []\n\n    constructor(numOfItems, onBackPanel: Panel = null) {\n        super()\n        if (onBackPanel) {\n            const backBtnCfg = new IconPanelBackButtonCfg(ResourceManager.cfg('InterfaceBackButton'))\n            this.backBtn = this.addChild(new Button(this, backBtnCfg))\n            this.backBtn.onClick = () => this.toggleState(() => onBackPanel.toggleState())\n        }\n        const frameImgCfg = ResourceManager.cfg('InterfaceSurroundImages', numOfItems.toString())\n        // noinspection JSUnusedLocalSymbols\n        const [imgName, val1, val2, val3, val4, imgNameWoBackName, woBack1, woBack2] = frameImgCfg\n        this.img = onBackPanel ? ResourceManager.getImage(imgName) : ResourceManager.getImage(imgNameWoBackName)\n        this.xOut = -this.img.width\n    }\n\n    addMenuItem(menuItemGroup: string, itemKey: string) {\n        const menuItemCfg = new MenuItemCfg(ResourceManager.cfg(menuItemGroup, itemKey))\n        const menuItem = this.addChild(new IconPanelButton(this, menuItemCfg, itemKey, this.img.width, this.iconPanelButtons.length))\n        this.iconPanelButtons.push(menuItem)\n        return menuItem\n    }\n\n    toggleState(onDone: () => any = null) {\n        super.toggleState(onDone)\n        if (!this.movedIn) this.iconPanelButtons.forEach((button) => button.updateState())\n    }\n\n}\n","import { IconSubPanel } from './IconSubPanel'\nimport { Panel } from '../base/Panel'\nimport { GameState } from '../../model/GameState'\nimport { Building } from '../../model/entity/building/Building'\nimport { EventBus } from '../../../event/EventBus'\nimport { CancelBuildMode } from '../../../event/LocalEvents'\n\nexport class BuildingPanel extends IconSubPanel {\n\n    constructor(onBackPanel: Panel) {\n        super(10, onBackPanel)\n        this.backBtn.onClick = () => {\n            EventBus.publishEvent(new CancelBuildMode())\n            this.toggleState(() => onBackPanel.toggleState())\n        }\n        this.addBuildMenuItem('InterfaceBuildImages', 'Toolstation', Building.TOOLSTATION)\n        this.addBuildMenuItem('InterfaceBuildImages', 'TeleportPad', Building.TELEPORT_PAD)\n        this.addBuildMenuItem('InterfaceBuildImages', 'Docks', Building.DOCKS)\n        this.addBuildMenuItem('InterfaceBuildImages', 'Powerstation', Building.POWER_STATION)\n        this.addBuildMenuItem('InterfaceBuildImages', 'Barracks', Building.BARRACKS)\n        this.addBuildMenuItem('InterfaceBuildImages', 'Upgrade', Building.UPGRADE)\n        this.addBuildMenuItem('InterfaceBuildImages', 'Geo-dome', Building.GEODOME)\n        this.addBuildMenuItem('InterfaceBuildImages', 'OreRefinery', Building.ORE_REFINERY)\n        this.addBuildMenuItem('InterfaceBuildImages', 'Gunstation', Building.GUNSTATION)\n        this.addBuildMenuItem('InterfaceBuildImages', 'TeleportBIG', Building.TELEPORT_BIG)\n    }\n\n    addBuildMenuItem(menuItemGroup: string, itemKey: string, building: Building) {\n        const item = this.addMenuItem(menuItemGroup, itemKey)\n        item.isDisabled = () => false // FIXME check Dependencies from config\n        item.onClick = () => GameState.buildModeSelection = building\n        return item\n    }\n\n}\n","import { Panel } from '../base/Panel'\nimport { IconSubPanel } from './IconSubPanel'\n\nexport class SmallVehiclePanel extends IconSubPanel {\n\n    constructor(onBackPanel: Panel) {\n        super(6, onBackPanel)\n        this.addMenuItem('InterfaceBuildImages', 'Hoverboard')\n        this.addMenuItem('InterfaceBuildImages', 'SmallDigger')\n        this.addMenuItem('InterfaceBuildImages', 'SmallTruck')\n        this.addMenuItem('InterfaceBuildImages', 'SmallCat')\n        this.addMenuItem('InterfaceBuildImages', 'SmallMLP')\n        this.addMenuItem('InterfaceBuildImages', 'SmallHeli')\n    }\n\n}\n","import { IconSubPanel } from './IconSubPanel'\nimport { Panel } from '../base/Panel'\n\nexport class LargeVehiclePanel extends IconSubPanel {\n\n    constructor(onBackPanel: Panel) {\n        super(5, onBackPanel)\n        this.addMenuItem('InterfaceBuildImages', 'BullDozer')\n        this.addMenuItem('InterfaceBuildImages', 'WalkerDigger')\n        this.addMenuItem('InterfaceBuildImages', 'LargeMLP')\n        this.addMenuItem('InterfaceBuildImages', 'LargeDigger')\n        this.addMenuItem('InterfaceBuildImages', 'LargeCat')\n    }\n\n}\n","import { IconSubPanel } from './IconSubPanel'\nimport { Panel } from '../base/Panel'\nimport { EventBus } from '../../../event/EventBus'\nimport { EntityDeselected } from '../../../event/LocalEvents'\n\nexport class SelectBasePanel extends IconSubPanel {\n\n    constructor(numOfItems, onBackPanel: Panel) {\n        super(numOfItems, onBackPanel)\n        this.backBtn.onClick = () => EventBus.publishEvent(new EntityDeselected())\n    }\n\n}\n","import { SurfaceJob } from './SurfaceJob'\nimport { JobType } from '../JobType'\nimport { PriorityIdentifier } from '../PriorityIdentifier'\nimport { RaiderTool } from '../../../../scene/model/RaiderTool'\nimport { PathTarget } from '../../../../scene/model/PathTarget'\nimport { Surface } from '../../../../scene/model/map/Surface'\n\nexport class ReinforceJob extends SurfaceJob {\n\n    constructor(surface: Surface) {\n        super(JobType.REINFORCE, surface)\n        this.color = 0x60a060\n        this.colorPriority = 1\n        this.requiredTool = RaiderTool.HAMMER\n    }\n\n    getWorkplaces(): PathTarget[] {\n        return this.surface.getDigPositions().map((p) => new PathTarget(p))\n    }\n\n    onJobComplete() {\n        super.onJobComplete()\n        this.surface.reinforce()\n    }\n\n    getPriorityIdentifier(): PriorityIdentifier {\n        return PriorityIdentifier.aiPriorityReinforce\n    }\n\n}\n","import { Panel } from '../base/Panel'\nimport { SelectBasePanel } from './SelectBasePanel'\nimport { GameState } from '../../model/GameState'\nimport { Surface } from '../../../scene/model/map/Surface'\nimport { SurfaceJob } from '../../model/job/surface/SurfaceJob'\nimport { EventBus } from '../../../event/EventBus'\nimport { JobCreateEvent, SpawnDynamiteEvent } from '../../../event/WorldEvents'\nimport { EntityDeselected } from '../../../event/LocalEvents'\nimport { IconPanelButton } from './IconPanelButton'\nimport { Building } from '../../model/entity/building/Building'\nimport { RaiderSkill } from '../../../scene/model/RaiderSkill'\nimport { EventKey } from '../../../event/EventKeyEnum'\nimport { JobType } from '../../model/job/JobType'\nimport { DrillJob } from '../../model/job/surface/DrillJob'\nimport { ReinforceJob } from '../../model/job/surface/ReinforceJob'\n\nexport class SelectWallPanel extends SelectBasePanel {\n\n    constructor(onBackPanel: Panel) {\n        super(4, onBackPanel)\n        const itemDrill = this.addWallMenuItem('Interface_MenuItem_Dig', JobType.DRILL, (s) => new DrillJob(s))\n        itemDrill.isDisabled = () => !(GameState.selectedSurface?.isDrillable()) &&\n            !(GameState.selectedSurface?.isDrillableHard()) // TODO implement vehicle check for drill hard skill\n        const itemReinforce = this.addWallMenuItem('Interface_MenuItem_Reinforce', JobType.REINFORCE, (s) => new ReinforceJob(s))\n        itemReinforce.isDisabled = () => !(GameState.selectedSurface?.isReinforcable())\n        const itemDynamite = this.addWallMenuItem('Interface_MenuItem_Dynamite', JobType.BLOW, null)\n        itemDynamite.isDisabled = () => !GameState.hasBuildingWithUpgrades(Building.TOOLSTATION, 2) &&\n            !GameState.raiders.some((r) => r.hasSkill(RaiderSkill.DEMOLITION))\n        const itemDeselect = this.addMenuItem('InterfaceImages', 'Interface_MenuItem_DeselectDig')\n        itemDeselect.isDisabled = () => false\n        itemDeselect.onClick = () => {\n            const selectedSurface = GameState.selectedEntities[0] as Surface\n            selectedSurface.cancelJobs()\n            EventBus.publishEvent(new EntityDeselected())\n        }\n        EventBus.registerEventListener(EventKey.SELECTED_SURFACE, () => {\n            itemDrill.updateState(false)\n            itemReinforce.updateState(false)\n            itemDynamite.updateState(false)\n            this.notifyRedraw()\n        })\n    }\n\n    addWallMenuItem(itemKey: string, jobType: JobType, createJob: (surface: Surface) => SurfaceJob): IconPanelButton {\n        const item = this.addMenuItem('InterfaceImages', itemKey)\n        item.onClick = () => {\n            const selectedSurface = GameState.selectedSurface\n            if (selectedSurface) {\n                if (jobType === JobType.BLOW) {\n                    EventBus.publishEvent(new SpawnDynamiteEvent(selectedSurface))\n                } else if (!selectedSurface.hasJobType(jobType)) {\n                    EventBus.publishEvent(new JobCreateEvent(createJob(selectedSurface)))\n                }\n                EventBus.publishEvent(new EntityDeselected())\n            }\n        }\n        return item\n    }\n\n}\n","import { CollectableEntity, CollectableType } from './CollectableEntity'\nimport { PriorityIdentifier } from '../../../game/model/job/PriorityIdentifier'\nimport { ResourceManager } from '../../../resource/ResourceManager'\nimport { SceneManager } from '../../SceneManager'\nimport { LWOLoader } from '../../../resource/LWOLoader'\nimport { CollectPathTarget } from '../CollectionTarget'\nimport { Building } from '../../../game/model/entity/building/Building'\nimport { Surface } from '../map/Surface'\nimport { GameState } from '../../../game/model/GameState'\n\nexport class ElectricFence extends CollectableEntity {\n\n    targetSurface: Surface\n\n    constructor(surface: Surface) {\n        super()\n        const resource = ResourceManager.getResource('Buildings/E-Fence/E-Fence4.lwo')\n        const mesh = SceneManager.registerMesh(new LWOLoader('Buildings/E-Fence/').parse(resource))\n        this.group.add(mesh)\n        this.targetSurface = surface\n    }\n\n    getCollectableType(): CollectableType {\n        return CollectableType.ELECTRIC_FENCE\n    }\n\n    getTargetBuildingTypes(): Building[] {\n        return [Building.TOOLSTATION]\n    }\n\n    getPriorityIdentifier(): PriorityIdentifier {\n        return PriorityIdentifier.aiPriorityConstruction\n    }\n\n    protected updateTargets(): CollectPathTarget[] {\n        if (this.targets.length < 1) {\n            if (this.targetSurface.canPlaceFence()) {\n                this.targets = [new CollectPathTarget(this.targetSurface.getCenterWorld2D(), null, null)]\n            } else {\n                this.targets = GameState.getBuildingsByType(...this.getTargetBuildingTypes())\n                    .map((b) => new CollectPathTarget(b.getDropPosition2D(), null, b))\n            }\n        } else if (!this.targetSurface.canPlaceFence() && !this.targets[0].building) {\n            this.targets = GameState.getBuildingsByType(...this.getTargetBuildingTypes())\n                .map((b) => new CollectPathTarget(b.getDropPosition2D(), null, b))\n        }\n        return this.targets\n    }\n\n    get stats() {\n        return null\n    }\n\n}\n","import { Panel } from '../base/Panel'\nimport { SelectBasePanel } from './SelectBasePanel'\nimport { GameState } from '../../model/GameState'\nimport { Surface } from '../../../scene/model/map/Surface'\nimport { SurfaceType } from '../../../scene/model/map/SurfaceType'\nimport { Building } from '../../model/entity/building/Building'\nimport { CollectableType } from '../../../scene/model/collect/CollectableEntity'\nimport { EventBus } from '../../../event/EventBus'\nimport { BuildingSite } from '../../../scene/model/BuildingSite'\nimport { EntityDeselected } from '../../../event/LocalEvents'\nimport { EventKey } from '../../../event/EventKeyEnum'\nimport { ElectricFence } from '../../../scene/model/collect/ElectricFence'\n\nexport class SelectFloorPanel extends SelectBasePanel {\n\n    constructor(onBackPanel: Panel) {\n        super(3, onBackPanel)\n        const pathItem = this.addMenuItem('InterfaceImages', 'Interface_MenuItem_LayPath')\n        pathItem.onClick = () => {\n            const selectedSurface = GameState.selectedEntities[0] as Surface\n            selectedSurface.surfaceType = SurfaceType.POWER_PATH_SITE\n            selectedSurface.updateTexture()\n            const targetBuilding = GameState.getClosestBuildingByType(selectedSurface.getCenterWorld(), Building.TOOLSTATION)\n            if (targetBuilding) targetBuilding.spawnMaterials(GameState.dropMaterial(CollectableType.ORE, 2))\n            const site = new BuildingSite(null)\n            site.surfaces.push(selectedSurface)\n            site.neededByType[CollectableType.ORE] = 2\n            GameState.buildingSites.push(site)\n            EventBus.publishEvent(new EntityDeselected())\n        }\n        pathItem.isDisabled = () => GameState.selectedSurface?.surfaceType !== SurfaceType.GROUND\n        const removeItem = this.addMenuItem('InterfaceImages', 'Interface_MenuItem_RemovePath')\n        removeItem.onClick = () => {\n            GameState.selectedSurface?.makeRubble(2)\n            EventBus.publishEvent(new EntityDeselected())\n        }\n        removeItem.isDisabled = () => GameState.selectedSurface?.surfaceType !== SurfaceType.POWER_PATH\n        const placeFenceItem = this.addMenuItem('InterfaceImages', 'Interface_MenuItem_PlaceFence')\n        placeFenceItem.isDisabled = () => {\n            return !GameState.hasOneBuildingOf(Building.POWER_STATION) || !GameState.selectedSurface?.canPlaceFence()\n        }\n        placeFenceItem.onClick = () => {\n            const selectedSurface = GameState.selectedSurface\n            if (selectedSurface) {\n                const toolstation = GameState.getClosestBuildingByType(selectedSurface.getCenterWorld(), Building.TOOLSTATION)\n                if (toolstation) {\n                    toolstation?.spawnMaterials([new ElectricFence(selectedSurface)])\n                }\n            }\n            EventBus.publishEvent(new EntityDeselected())\n        }\n        EventBus.registerEventListener(EventKey.SELECTED_SURFACE, () => {\n            pathItem.updateState()\n            removeItem.updateState()\n            placeFenceItem.updateState()\n        })\n    }\n\n}\n","import { Panel } from '../base/Panel'\nimport { SelectBasePanel } from './SelectBasePanel'\nimport { GameState } from '../../model/GameState'\nimport { EventBus } from '../../../event/EventBus'\nimport { JobCreateEvent } from '../../../event/WorldEvents'\nimport { EntityDeselected } from '../../../event/LocalEvents'\nimport { EventKey } from '../../../event/EventKeyEnum'\nimport { ClearRubbleJob } from '../../model/job/surface/ClearRubbleJob'\n\nexport class SelectRubblePanel extends SelectBasePanel {\n\n    constructor(onBackPanel: Panel) {\n        super(2, onBackPanel)\n        const clearRubbleItem = this.addMenuItem('InterfaceImages', 'Interface_MenuItem_ClearRubble')\n        clearRubbleItem.onClick = () => {\n            EventBus.publishEvent(new JobCreateEvent(new ClearRubbleJob(GameState.selectedSurface)))\n            EventBus.publishEvent(new EntityDeselected())\n        }\n        clearRubbleItem.isDisabled = () => !GameState.selectedSurface?.hasRubble()\n        this.addMenuItem('InterfaceImages', 'Interface_MenuItem_PlaceFence')\n        EventBus.registerEventListener(EventKey.SELECTED_SURFACE, () => clearRubbleItem.updateState())\n    }\n\n}\n","import { BaseElement } from '../base/BaseElement'\nimport { MenuItemCfg } from '../../../cfg/MenuItemCfg'\nimport { IconPanelButton } from './IconPanelButton'\nimport { ResourceManager } from '../../../resource/ResourceManager'\n\nexport class IconPanelToggleButton extends IconPanelButton {\n\n    toggleState: boolean = false\n    imgOnNormal: HTMLCanvasElement\n    imgOnHover: HTMLCanvasElement\n    imgOnPressed: HTMLCanvasElement\n    imgOnDisabled: HTMLCanvasElement\n\n    constructor(parent: BaseElement, menuItemOffCfg: MenuItemCfg, menuItemOnCfg: MenuItemCfg, parentWidth: number, menuIndex: number) {\n        super(parent, menuItemOffCfg, null, parentWidth, menuIndex)\n        this.imgOnNormal = ResourceManager.getImageOrNull(menuItemOnCfg.normalFile)\n        this.imgOnHover = ResourceManager.getImageOrNull(menuItemOnCfg.highlightFile)\n        this.imgOnPressed = ResourceManager.getImageOrNull(menuItemOnCfg.pressedFile)\n        this.imgOnDisabled = ResourceManager.getImageOrNull(menuItemOnCfg.disabledFile)\n    }\n\n    onClick() {\n        this.toggleState = !this.toggleState\n        this.onToggleStateChange()\n    }\n\n    onToggleStateChange() {\n    }\n\n    onRedraw(context: CanvasRenderingContext2D) {\n        if (this.hidden) return\n        let img = this.toggleState ? this.imgOnNormal : this.imgNormal\n        if (this.disabled) {\n            if (this.toggleState) {\n                img = this.imgOnDisabled || this.imgOnPressed || this.imgOnNormal\n            } else {\n                img = this.imgDisabled || this.imgPressed || this.imgNormal\n            }\n        } else if (this.pressed) {\n            if (this.toggleState) {\n                img = this.imgOnPressed || this.imgOnNormal\n            } else {\n                img = this.imgPressed || this.imgNormal\n            }\n        } else if (this.hover) {\n            if (this.toggleState) {\n                img = this.imgOnHover || this.imgOnNormal\n            } else {\n                img = this.imgHover || this.imgNormal\n            }\n        }\n        if (img) context.drawImage(img, this.x, this.y)\n        this.children.forEach((child) => child.onRedraw(context))\n        this.children.forEach((child) => child.drawHover(context))\n        this.children.forEach((child) => child.drawTooltip(context))\n    }\n\n}\n","import { Panel } from '../base/Panel'\nimport { SelectBasePanel } from './SelectBasePanel'\nimport { EventBus } from '../../../event/EventBus'\nimport { GameState } from '../../model/GameState'\nimport { EventKey } from '../../../event/EventKeyEnum'\nimport { MenuItemCfg } from '../../../cfg/MenuItemCfg'\nimport { ResourceManager } from '../../../resource/ResourceManager'\nimport { IconPanelToggleButton } from './IconPanelToggleButton'\n\nexport class SelectBuildingPanel extends SelectBasePanel {\n\n    constructor(onBackPanel: Panel) {\n        super(4, onBackPanel)\n        this.addMenuItem('InterfaceImages', 'Interface_MenuItem_Repair')\n\n        const menuItemOffCfg = new MenuItemCfg(ResourceManager.cfg('InterfaceImages', 'Interface_MenuItem_PowerOff'))\n        const menuItemOnCfg = new MenuItemCfg(ResourceManager.cfg('InterfaceImages', 'Interface_MenuItem_PowerOn'))\n        const powerSwitchItem = this.addChild(new IconPanelToggleButton(this, menuItemOffCfg, menuItemOnCfg, this.img.width, this.iconPanelButtons.length))\n        this.iconPanelButtons.push(powerSwitchItem)\n        powerSwitchItem.isDisabled = () => GameState.usedCrystals >= GameState.numCrystal || GameState.selectedBuilding?.stats?.SelfPowered || GameState.selectedBuilding?.stats?.PowerBuilding\n        powerSwitchItem.onToggleStateChange = () => {\n            if (powerSwitchItem.toggleState) {\n                GameState.selectedBuilding?.turnOffPower()\n            } else {\n                GameState.selectedBuilding?.turnOnPower()\n            }\n        }\n        const upgradeItem = this.addMenuItem('InterfaceImages', 'Interface_MenuItem_UpgradeBuilding')\n        upgradeItem.isDisabled = () => !GameState.selectedBuilding?.canUpgrade()\n        upgradeItem.onClick = () => GameState.selectedBuilding?.upgrade()\n        const deleteBuildingItem = this.addMenuItem('InterfaceImages', 'Interface_MenuItem_DeleteBuilding')\n        deleteBuildingItem.isDisabled = () => false\n        deleteBuildingItem.onClick = () => GameState.selectedBuilding?.beamUp()\n        EventBus.registerEventListener(EventKey.SELECTED_BUILDING, () => {\n            powerSwitchItem.updateState()\n            upgradeItem.updateState()\n        })\n        EventBus.registerEventListener(EventKey.MATERIAL_AMOUNT_CHANGED, () => {\n            powerSwitchItem.updateState()\n            upgradeItem.updateState()\n        })\n    }\n\n}\n","import { Job } from './Job'\nimport { JobType } from './JobType'\nimport { PathTarget } from '../../../scene/model/PathTarget'\n\nexport class EatJob extends Job {\n\n    constructor() {\n        super(JobType.EAT)\n    }\n\n    getWorkplaces(): PathTarget[] {\n        return []\n    }\n\n}\n","import { Panel } from '../base/Panel'\nimport { IconPanelButton } from './IconPanelButton'\nimport { SelectBasePanel } from './SelectBasePanel'\nimport { GameState } from '../../model/GameState'\nimport { EatJob } from '../../model/job/EatJob'\nimport { EventBus } from '../../../event/EventBus'\nimport { EntityDeselected } from '../../../event/LocalEvents'\n\nexport class SelectRaiderPanel extends SelectBasePanel {\n\n    getToolItem: IconPanelButton\n    trainItem: IconPanelButton\n\n    constructor(onBackPanel: Panel) {\n        super(10, onBackPanel)\n        const feedItem = this.addMenuItem('InterfaceImages', 'Interface_MenuItem_GoFeed')\n        feedItem.isDisabled = () => false\n        feedItem.onClick = () => {\n            GameState.selectedRaiders.forEach((r) => !r.isDriving() && r.setJob(new EatJob()))\n            EventBus.publishEvent(new EntityDeselected())\n        }\n        this.addMenuItem('InterfaceImages', 'Interface_MenuItem_UnLoadMinifigure')\n        this.addMenuItem('InterfaceImages', 'Interface_MenuItem_MinifigurePickUp')\n        this.getToolItem = this.addMenuItem('InterfaceImages', 'Interface_MenuItem_GetTool')\n        this.getToolItem.isDisabled = () => false\n        this.addMenuItem('InterfaceImages', 'Interface_MenuItem_DropBirdScarer')\n        this.addMenuItem('InterfaceImages', 'Interface_MenuItem_UpgradeMan')\n        this.trainItem = this.addMenuItem('InterfaceImages', 'Interface_MenuItem_TrainSkill')\n        this.trainItem.isDisabled = () => false\n        this.addMenuItem('InterfaceImages', 'Interface_MenuItem_GotoFirstPerson')\n        this.addMenuItem('InterfaceImages', 'Interface_MenuItem_GotoSecondPerson')\n        const deleteRaiderItem = this.addMenuItem('InterfaceImages', 'Interface_MenuItem_DeleteMan')\n        deleteRaiderItem.isDisabled = () => false\n        deleteRaiderItem.onClick = () => GameState.selectedRaiders.forEach((r) => r.beamUp())\n    }\n\n}\n","import { Panel } from '../base/Panel'\nimport { SelectBasePanel } from './SelectBasePanel'\n\nexport class SelectVehiclePanel extends SelectBasePanel {\n\n    constructor(onBackPanel: Panel) {\n        super(7, onBackPanel)\n    }\n\n}\n","import { Vector2 } from 'three'\n\nexport class Area {\n\n    x0: number = 0\n    y0: number = 0\n    x1: number = 0\n    y1: number = 0\n    center: Vector2 = null\n\n    constructor(x0: number, y0: number, x1: number, y1: number) {\n        this.x0 = x0\n        this.y0 = y0\n        this.x1 = x1\n        this.y1 = y1\n        this.center = new Vector2((this.x0 + this.x1) / 2, (this.y0 + this.y1) / 2)\n    }\n\n    getCenter(): Vector2 {\n        return this.center.clone()\n    }\n\n}\n","import { Job } from './Job'\nimport { RaiderSkill } from '../../../scene/model/RaiderSkill'\nimport { JobType } from './JobType'\nimport { PathTarget } from '../../../scene/model/PathTarget'\nimport { Surface } from '../../../scene/model/map/Surface'\nimport { Area } from '../../../core/Area'\nimport { JOB_ACTION_RANGE, TILESIZE } from '../../../main'\nimport { Vector2 } from 'three'\n\nexport class TrainJob extends Job {\n\n    workplaces: SurfacePathTarget[]\n    skill: RaiderSkill\n\n    constructor(surface: Surface, skill: RaiderSkill) {\n        super(JobType.TRAIN)\n        this.workplaces = [new SurfacePathTarget(surface)]\n        this.skill = skill\n    }\n\n    getWorkplaces(): SurfacePathTarget[] {\n        return this.workplaces\n    }\n\n}\n\nexport class SurfacePathTarget extends PathTarget {\n\n    targetArea: Area\n\n    constructor(surface: Surface) {\n        super(surface.getCenterWorld2D())\n        this.targetArea = new Area(surface.x * TILESIZE - JOB_ACTION_RANGE, surface.y * TILESIZE - JOB_ACTION_RANGE,\n            (surface.x + 1) * TILESIZE + JOB_ACTION_RANGE, (surface.y + 1) * TILESIZE + JOB_ACTION_RANGE)\n    }\n\n    isInArea(position: Vector2): boolean {\n        return position.x >= this.targetArea.x0 && position.x < this.targetArea.x1\n            && position.y >= this.targetArea.y0 && position.y < this.targetArea.y1\n    }\n\n}\n","import { IconSubPanel } from './IconSubPanel'\nimport { Panel } from '../base/Panel'\nimport { EventBus } from '../../../event/EventBus'\nimport { GameState } from '../../model/GameState'\nimport { Building } from '../../model/entity/building/Building'\nimport { TrainJob } from '../../model/job/TrainJob'\nimport { EntityDeselected } from '../../../event/LocalEvents'\nimport { RaiderSkill } from '../../../scene/model/RaiderSkill'\nimport { EventKey } from '../../../event/EventKeyEnum'\n\nexport class TrainRaiderPanel extends IconSubPanel {\n\n    constructor(onBackPanel: Panel) {\n        super(6, onBackPanel)\n        this.addMenuItem('InterfaceImages', 'Interface_MenuItem_TrainDriver')\n        this.addMenuItem('InterfaceImages', 'Interface_MenuItem_TrainEngineer')\n        this.addMenuItem('InterfaceImages', 'Interface_MenuItem_TrainGeologist')\n        this.addMenuItem('InterfaceImages', 'Interface_MenuItem_TrainPilot')\n        this.addMenuItem('InterfaceImages', 'Interface_MenuItem_TrainSailor')\n        const trainDynamite = this.addMenuItem('InterfaceImages', 'Interface_MenuItem_TrainDynamite')\n        trainDynamite.isDisabled = () => !GameState.getBuildingsByType(Building.TOOLSTATION).some((b) => b.stats.TrainDynamite[b.level]) ||\n            GameState.selectedRaiders.every((r) => r.hasSkill(RaiderSkill.DEMOLITION))\n        trainDynamite.onClick = () => {\n            GameState.getBuildingsByType(Building.TOOLSTATION).some((b) => {\n                if (b.stats.TrainDynamite[b.level]) {\n                    GameState.selectedRaiders.forEach((r) => !r.hasSkill(RaiderSkill.DEMOLITION) && r.setJob(new TrainJob(b.surfaces[0], RaiderSkill.DEMOLITION)))\n                    EventBus.publishEvent(new EntityDeselected())\n                    return true\n                }\n            })\n        }\n        EventBus.registerEventListener(EventKey.BUILDING_UPGRADED, () => trainDynamite.updateState())\n    }\n\n}\n","import { Job } from './Job'\nimport { Vector2 } from 'three'\nimport { RaiderTool } from '../../../scene/model/RaiderTool'\nimport { JobType } from './JobType'\nimport { PathTarget } from '../../../scene/model/PathTarget'\n\nexport class GetToolJob extends Job {\n\n    target: PathTarget[]\n    tool: RaiderTool\n\n    constructor(target: Vector2, tool: RaiderTool) {\n        super(JobType.GET_TOOL)\n        this.target = [new PathTarget(target)]\n        this.tool = tool\n    }\n\n    getWorkplaces(): PathTarget[] {\n        return this.target\n    }\n\n}\n","import { IconSubPanel } from './IconSubPanel'\nimport { Panel } from '../base/Panel'\nimport { GameState } from '../../model/GameState'\nimport { IconPanelButton } from './IconPanelButton'\nimport { Building } from '../../model/entity/building/Building'\nimport { GetToolJob } from '../../model/job/GetToolJob'\nimport { EventBus } from '../../../event/EventBus'\nimport { EntityDeselected } from '../../../event/LocalEvents'\nimport { RaiderTool } from '../../../scene/model/RaiderTool'\nimport { PathTarget } from '../../../scene/model/PathTarget'\n\nexport class GetToolPanel extends IconSubPanel {\n\n    constructor(onBackPanel: Panel) {\n        super(8, onBackPanel)\n        this.addGetToolItem('InterfaceImages', 'Interface_MenuItem_GetDrill', RaiderTool.DRILL)\n        this.addGetToolItem('InterfaceImages', 'Interface_MenuItem_GetSpade', RaiderTool.SHOVEL)\n        this.addGetToolItem('InterfaceImages', 'Interface_MenuItem_GetHammer', RaiderTool.HAMMER)\n        this.addGetToolItem('InterfaceImages', 'Interface_MenuItem_GetSpanner', RaiderTool.SPANNER)\n        this.addGetToolItem('InterfaceImages', 'Interface_MenuItem_GetFreezerGun', RaiderTool.FREEZERGUN)\n        this.addGetToolItem('InterfaceImages', 'Interface_MenuItem_GetLaser', RaiderTool.LASER)\n        this.addGetToolItem('InterfaceImages', 'Interface_MenuItem_GetPusherGun', RaiderTool.PUSHERGUN)\n        this.addGetToolItem('InterfaceImages', 'Interface_MenuItem_GetBirdScarer', RaiderTool.BIRDSCARER)\n    }\n\n    addGetToolItem(menuItemGroup: string, itemKey: string, tool: RaiderTool): IconPanelButton {\n        const menuItem = super.addMenuItem(menuItemGroup, itemKey)\n        menuItem.isDisabled = () => !GameState.hasOneBuildingOf(Building.TOOLSTATION) ||\n            GameState.selectedRaiders.every((r) => r.hasTool(tool))\n        menuItem.onClick = () => {\n            GameState.selectedRaiders.forEach((r) => {\n                if (!r.hasTool(tool)) {\n                    const pathToToolstation = GameState.getBuildingsByType(Building.TOOLSTATION)\n                        .map((b) => r.findPathToTarget(new PathTarget(b.getPosition2D())))\n                        .sort((l, r) => l.lengthSq - r.lengthSq)[0]\n                    if (pathToToolstation) {\n                        r.setJob(new GetToolJob(pathToToolstation.targetPosition, tool)) // TODO use precalculated path to toolstation\n                    }\n                }\n            })\n            EventBus.publishEvent(new EntityDeselected())\n        }\n        return menuItem\n    }\n\n}\n","import { BaseElement } from '../base/BaseElement'\nimport { GameState } from '../../model/GameState'\nimport { EventBus } from '../../../event/EventBus'\nimport { EventKey } from '../../../event/EventKeyEnum'\n\nexport class IconPanelButtonLabel extends BaseElement {\n\n    constructor(parent: BaseElement) {\n        super(parent)\n        this.relX = 4\n        this.relY = 11\n        EventBus.registerEventListener(EventKey.RAIDER_REQUESTED, () => this.notifyRedraw())\n    }\n\n    onRedraw(context: CanvasRenderingContext2D) {\n        if (this.hidden) return\n        const requestedRaiders = GameState.requestedRaiders\n        if (!requestedRaiders) return\n        context.textAlign = 'left'\n        context.font = 'bold 10px Arial'\n        context.fillStyle = this.disabled || (this.parent && this.parent.disabled) ? '#444' : '#fff'\n        context.fillText(requestedRaiders.toString(), this.x, this.y)\n        super.onRedraw(context)\n    }\n\n}\n","import { EventBus } from '../../../event/EventBus'\nimport { SurfaceChanged, SurfaceSelectedEvent } from '../../../event/LocalEvents'\nimport { EntityAddedEvent, EntityRemovedEvent, EntityType, RaiderRequested } from '../../../event/WorldEvents'\nimport { GameState } from '../../model/GameState'\nimport { Building } from '../../model/entity/building/Building'\nimport { BuildingPanel } from './BuildingPanel'\nimport { SmallVehiclePanel } from './SmallVehiclePanel'\nimport { LargeVehiclePanel } from './LargeVehiclePanel'\nimport { SelectWallPanel } from './SelectWallPanel'\nimport { SelectFloorPanel } from './SelectFloorPanel'\nimport { SelectRubblePanel } from './SelectRubblePanel'\nimport { SelectBuildingPanel } from './SelectBuildingPanel'\nimport { SelectRaiderPanel } from './SelectRaiderPanel'\nimport { SelectVehiclePanel } from './SelectVehiclePanel'\nimport { IconSubPanel } from './IconSubPanel'\nimport { Panel } from '../base/Panel'\nimport { TrainRaiderPanel } from './TrainRaiderPanel'\nimport { GetToolPanel } from './GetToolPanel'\nimport { IconPanelButtonLabel } from './IconPanelButtonLabel'\nimport { EventKey } from '../../../event/EventKeyEnum'\nimport { Surface } from '../../../scene/model/map/Surface'\nimport { MAX_RAIDER_REQUEST } from '../../../main'\n\nexport class MainPanel extends Panel {\n\n    subPanels: IconSubPanel[] = []\n    mainPanel: IconSubPanel // don't use root itself, since sub panel must be decoupled from (animated) main panel position\n    selectWallPanel: SelectWallPanel\n    selectFloorPanel: SelectFloorPanel\n    selectRubblePanel: SelectRubblePanel\n\n    constructor() {\n        super()\n        this.relX = this.xOut = 640 - 16\n        this.xIn = 640 + 95\n        this.relY = this.yOut = this.yIn = 9\n        this.movedIn = false\n        this.mainPanel = this.addSubPanel(new IconSubPanel(4))\n        this.mainPanel.relX = this.mainPanel.xOut\n        this.mainPanel.relY = this.mainPanel.yOut\n        this.mainPanel.movedIn = false\n\n        const buildingPanel = this.addSubPanel(new BuildingPanel(this.mainPanel))\n        const smallVehiclePanel = this.addSubPanel(new SmallVehiclePanel(this.mainPanel))\n        const largeVehiclePanel = this.addSubPanel(new LargeVehiclePanel(this.mainPanel))\n        this.selectWallPanel = this.addSubPanel(new SelectWallPanel(this.mainPanel))\n        this.selectFloorPanel = this.addSubPanel(new SelectFloorPanel(this.mainPanel))\n        this.selectRubblePanel = this.addSubPanel(new SelectRubblePanel(this.mainPanel))\n        const selectBuildingPanel = this.addSubPanel(new SelectBuildingPanel(this.mainPanel))\n        const selectRaiderPanel = this.addSubPanel(new SelectRaiderPanel(this.mainPanel))\n        const trainRaiderPanel = this.addSubPanel(new TrainRaiderPanel(selectRaiderPanel))\n        selectRaiderPanel.trainItem.onClick = () => selectRaiderPanel.toggleState(() => trainRaiderPanel.toggleState())\n        const getToolPanel = this.addSubPanel(new GetToolPanel(selectRaiderPanel))\n        selectRaiderPanel.getToolItem.onClick = () => selectRaiderPanel.toggleState(() => getToolPanel.toggleState())\n        const selectVehiclePanel = this.addSubPanel(new SelectVehiclePanel(this.mainPanel))\n        const teleportRaider = this.mainPanel.addMenuItem('InterfaceImages', 'Interface_MenuItem_TeleportMan')\n        teleportRaider.isDisabled = () => GameState.raiders.length >= GameState.getMaxRaiders() || GameState.requestedRaiders >= MAX_RAIDER_REQUEST ||\n            !GameState.hasOneBuildingOf(Building.TOOLSTATION, Building.TELEPORT_PAD)\n        teleportRaider.updateState()\n        EventBus.registerEventListener(EventKey.RAIDER_REQUESTED, () => teleportRaider.updateState())\n        EventBus.registerEventListener(EventKey.ENTITY_ADDED, (event: EntityAddedEvent) => {\n            // TODO add event inheritance by using event key prefix checking\n            if (event.type === EntityType.BUILDING || event.type === EntityType.RAIDER) teleportRaider.updateState()\n        })\n        EventBus.registerEventListener(EventKey.ENTITY_REMOVED, (event: EntityRemovedEvent) => {\n            // TODO add event inheritance by using event key prefix checking\n            if (event.type === EntityType.BUILDING || event.type === EntityType.RAIDER) teleportRaider.updateState()\n        })\n        teleportRaider.onClick = () => {\n            GameState.requestedRaiders++\n            EventBus.publishEvent(new RaiderRequested())\n        }\n        // TODO add decrease requested raider spawn option (needs right click for gui elements)\n        teleportRaider.addChild(new IconPanelButtonLabel(teleportRaider))\n        const buildingItem = this.mainPanel.addMenuItem('InterfaceImages', 'Interface_MenuItem_BuildBuilding')\n        buildingItem.isDisabled = () => false\n        buildingItem.onClick = () => this.mainPanel.toggleState(() => buildingPanel.toggleState())\n        const smallVehicleItem = this.mainPanel.addMenuItem('InterfaceImages', 'Interface_MenuItem_BuildSmallVehicle')\n        smallVehicleItem.isDisabled = () => false\n        smallVehicleItem.onClick = () => this.mainPanel.toggleState(() => smallVehiclePanel.toggleState())\n        const largeVehicleItem = this.mainPanel.addMenuItem('InterfaceImages', 'Interface_MenuItem_BuildLargeVehicle')\n        largeVehicleItem.isDisabled = () => false\n        largeVehicleItem.onClick = () => this.mainPanel.toggleState(() => largeVehiclePanel.toggleState())\n        EventBus.registerEventListener(EventKey.SELECTED_SURFACE, (event: SurfaceSelectedEvent) => {\n            this.onSelectedSurfaceChange(event.surface)\n        })\n        EventBus.registerEventListener(EventKey.SURFACE_CHANGED, (event: SurfaceChanged) => {\n            if (GameState.selectedSurface === event.surface) this.onSelectedSurfaceChange(event.surface)\n        })\n        EventBus.registerEventListener(EventKey.DESELECTED_ENTITY, () => this.selectSubPanel(this.mainPanel))\n        EventBus.registerEventListener(EventKey.SELECTED_BUILDING, () => this.selectSubPanel(selectBuildingPanel))\n        EventBus.registerEventListener(EventKey.SELECTED_RAIDER, () => this.selectSubPanel(selectRaiderPanel))\n        EventBus.registerEventListener(EventKey.SELECTED_VEHICLE, () => this.selectSubPanel(selectVehiclePanel))\n    }\n\n    reset() {\n        super.reset()\n        this.relX = this.xOut\n        this.relY = this.yOut\n        this.movedIn = false\n        this.updatePosition()\n        this.mainPanel.relX = this.mainPanel.xOut\n        this.mainPanel.relY = this.mainPanel.yOut\n        this.mainPanel.movedIn = false\n        this.mainPanel.updatePosition()\n    }\n\n    addSubPanel<T extends IconSubPanel>(childPanel: T): T {\n        this.addChild(childPanel)\n        this.subPanels.push(childPanel)\n        return childPanel\n    }\n\n    selectSubPanel(targetPanel: IconSubPanel) {\n        this.subPanels.forEach((subPanel) => subPanel !== targetPanel && subPanel.setMovedIn(true))\n        targetPanel.setMovedIn(false)\n    }\n\n    onSelectedSurfaceChange(surface: Surface) {\n        if (surface.surfaceType.floor) {\n            if (surface.hasRubble()) {\n                this.selectSubPanel(this.selectRubblePanel)\n            } else {\n                this.selectSubPanel(this.selectFloorPanel)\n            }\n        } else {\n            this.selectSubPanel(this.selectWallPanel)\n        }\n    }\n\n}\n","import { BaseElement } from './BaseElement'\nimport { ButtonCfg } from '../../../cfg/ButtonsCfg'\nimport { Button } from './Button'\n\nexport class ToggleButton extends Button {\n\n    toggleState: boolean = false\n\n    constructor(parent: BaseElement, btnCfg: ButtonCfg) {\n        super(parent, btnCfg)\n    }\n\n    checkHover(cx, cy): boolean {\n        if (this.isInactive()) return false\n        const inRect = this.isInRect(cx, cy)\n        let updated = this.hover !== inRect\n        this.hover = inRect\n        this.pressed = (this.pressed && this.hover) || this.toggleState\n        // TODO start tooltip timeout (if not already started)\n        this.children.forEach((child) => updated = child.checkHover(cx, cy) || updated)\n        if (updated) this.notifyRedraw()\n        return updated\n    }\n\n    checkClick(cx, cy): boolean {\n        if (this.isInactive()) return false\n        const isPressed = this.isInRect(cx, cy) || this.toggleState\n        let updated = this.pressed !== isPressed\n        this.pressed = isPressed\n        this.children.forEach((child) => updated = child.checkClick(cx, cy) || updated)\n        if (updated) this.notifyRedraw()\n        return updated\n    }\n\n    checkRelease(cx, cy): boolean {\n        if (this.isInactive()) return false\n        const inRect = this.isInRect(cx, cy)\n        let updated = inRect && this.pressed\n        if (updated) {\n            this.toggleState = !this.toggleState\n            this.onClick()\n            this.pressed = updated && this.toggleState\n            this.hover = inRect\n        }\n        this.children.forEach((child) => updated = child.checkRelease(cx, cy) || updated)\n        if (updated) this.notifyRedraw()\n        return updated\n    }\n\n    release(): boolean {\n        return false\n    }\n\n}\n\n","import { Button } from '../base/Button'\nimport { Panel } from '../base/Panel'\nimport { PanelCfg } from '../../../cfg/PanelsCfg'\nimport { ToggleButton } from '../base/ToggleButton'\nimport { ButtonTopCfg } from './ButtonTopCfg'\n\nexport class TopPanel extends Panel {\n\n    btnCallToArms: ToggleButton\n    btnOptions: Button\n    btnPriorities: ToggleButton\n\n    constructor(panelCfg: PanelCfg, buttonsCfg: ButtonTopCfg) {\n        super(panelCfg)\n        this.btnCallToArms = this.addChild(new ToggleButton(this, buttonsCfg.panelButtonTopPanelCallToArms))\n        this.btnOptions = this.addChild(new Button(this, buttonsCfg.panelButtonTopPanelOptions))\n        this.btnPriorities = this.addChild(new ToggleButton(this, buttonsCfg.panelButtonTopPanelPriorities))\n    }\n\n}\n\n","import { Button } from '../base/Button'\nimport { WorldEvent } from '../../../event/WorldEvents'\nimport { InfoMessagesEntryConfig } from './InfoMessagesEntryConfig'\nimport { InfoButtonCfg } from '../../../cfg/ButtonsCfg'\nimport { InfoDockPanel } from './InfoDockPanel'\nimport { EventBus } from '../../../event/EventBus'\nimport { WorldLocationEvent } from '../../../event/WorldLocationEvent'\nimport { NATIVE_FRAMERATE } from '../../../main'\nimport { clearTimeoutSafe } from '../../../core/Util'\nimport { EventKey } from '../../../event/EventKeyEnum'\n\nexport class InfoDockButton extends Button {\n\n    messages: WorldEvent[] = [] // newest message first\n    text: string = null\n    animationTimeout = null\n    animationSpeedX = 0.5\n    animationSpeedY = 1\n\n    constructor(parent: InfoDockPanel, infoMessagesEntryConfig: InfoMessagesEntryConfig, eventKey: EventKey) {\n        super(parent, new InfoButtonCfg(infoMessagesEntryConfig.buttonImageFilename))\n        this.text = infoMessagesEntryConfig.message\n        this.hidden = true\n\n        this.onClick = () => {\n            if (this.messages.length < 1) return\n            parent.buttonClicked(this)\n        }\n\n        EventBus.registerEventListener(eventKey, (event: WorldLocationEvent) => {\n            this.hidden = false\n            while (this.messages.length >= 9) this.messages.pop()\n            this.messages.unshift(event)\n            parent.showButton(this)\n        })\n    }\n\n    reset() {\n        super.reset()\n        this.animationTimeout = clearTimeoutSafe(this.animationTimeout)\n        this.text = null\n        this.hidden = true\n        this.messages = []\n    }\n\n    slideToTarget(targetX: number, targetY: number): Promise<void> {\n        return new Promise<void>((resolve) => this.updateAnimation(targetX, targetY, resolve))\n    }\n\n    private updateAnimation(targetX: number, targetY: number, onDone: () => any) { // TODO refactor: almost equal with code for Panel\n        const diffX = targetX - this.relX\n        const diffY = targetY - this.relY\n        if (Math.abs(diffX) <= this.animationSpeedX && Math.abs(diffY) <= this.animationSpeedY) {\n            this.relX = targetX\n            this.relY = targetY\n            this.animationTimeout = null\n            if (onDone) onDone()\n        } else {\n            this.relX += Math.round(Math.sign(diffX) * Math.sqrt(Math.abs(diffX)) * this.animationSpeedX)\n            this.relY += Math.round(Math.sign(diffY) * Math.sqrt(Math.abs(diffY)) * this.animationSpeedY)\n            const that = this\n            this.animationTimeout = setTimeout(() => that.updateAnimation(targetX, targetY, onDone), 1000 / NATIVE_FRAMERATE)\n        }\n        this.updatePosition()\n        this.notifyRedraw()\n    }\n\n    onRedraw(context: CanvasRenderingContext2D) {\n        super.onRedraw(context)\n        if (this.hidden) return\n        context.textAlign = 'left'\n        context.font = 'bold 10px Arial'\n        context.fillStyle = '#fff'\n        context.fillText(this.messages.length.toString(), this.x + 2, this.y + this.height / 2 + 2)\n    }\n\n}\n","import { Button } from '../base/Button'\nimport { Panel } from '../base/Panel'\nimport { PanelCfg } from '../../../cfg/PanelsCfg'\nimport { ButtonInfoDockCfg } from './ButtonInfoDockCfg'\nimport { InfoMessagesConfig } from './InfoMessagesConfig'\nimport { LandslideEvent } from '../../../event/WorldLocationEvent'\nimport { InfoDockButton } from './InfoDockButton'\nimport { InformationPanel } from './InformationPanel'\nimport { EventKey } from '../../../event/EventKeyEnum'\n\nexport class InfoDockPanel extends Panel {\n\n    stackButtons: InfoDockButton[] = []\n    informationPanel: InformationPanel = null\n\n    constructor(panelCfg: PanelCfg, buttonsCfg: ButtonInfoDockCfg, infoMessagesConfig: InfoMessagesConfig, informationPanel: InformationPanel) {\n        super(panelCfg)\n        this.informationPanel = informationPanel\n        this.addChild(new Button(this, buttonsCfg.panelButtonInfoDockGoto)).onClick = () => this.gotoLatestMessage()\n        this.addChild(new Button(this, buttonsCfg.panelButtonInfoDockClose)).onClick = () => this.dropLatestMessage()\n\n        this.addChild(new InfoDockButton(this, infoMessagesConfig.infoGenericDeath, EventKey.LOCATION_DEATH))\n        this.addChild(new InfoDockButton(this, infoMessagesConfig.infoGenericMonster, EventKey.LOCATION_MONSTER))\n        this.addChild(new InfoDockButton(this, infoMessagesConfig.infoCrystalFound, EventKey.LOCATION_CRYSTAL_FOUND))\n        this.addChild(new InfoDockButton(this, infoMessagesConfig.infoUnderAttack, EventKey.LOCATION_UNDER_ATTACK))\n        this.addChild(new InfoDockButton(this, infoMessagesConfig.infoLandslide, EventKey.LOCATION_LANDSLIDE))\n        this.addChild(new InfoDockButton(this, infoMessagesConfig.infoPowerDrain, EventKey.LOCATION_POWER_DRAIN))\n        this.addChild(new InfoDockButton(this, infoMessagesConfig.infoSlugEmerge, EventKey.LOCATION_SLUG_EMERGE))\n        this.addChild(new InfoDockButton(this, infoMessagesConfig.infoFoundMinifigure, EventKey.LOCATION_RAIDER_DISCOVERED))\n    }\n\n    reset() {\n        super.reset()\n        this.stackButtons = []\n    }\n\n    private gotoLatestMessage() {\n        if (this.stackButtons.length < 1) return\n        const btn = this.stackButtons[0]\n        if (btn.messages.length < 1) return\n        const msg = btn.messages[0] as LandslideEvent\n        console.log('TODO force move camera to: ' + msg.location.toArray()) // TODO force move camera\n    }\n\n    private dropLatestMessage() {\n        if (this.stackButtons.length < 1) return\n        const button = this.stackButtons[0]\n        if (button.messages.length < 1) return\n        button.messages.shift()\n        if (button.messages.length < 1) {\n            button.hidden = true\n            this.informationPanel.setMovedIn(true)\n            this.stackButtons.splice(this.stackButtons.indexOf(button), 1)\n            this.slideStackIntoPosition().then()\n        }\n        button.notifyRedraw()\n    }\n\n    showButton(button: InfoDockButton) {\n        if (this.stackButtons.includes(button)) {\n            button.notifyRedraw()\n        } else {\n            this.slideInButton(button)\n        }\n    }\n\n    private slideInButton(button: InfoDockButton) {\n        this.stackButtons.forEach(btn => btn.disabled = true)\n        const targetY = -this.stackButtons.map(b => b.height).reduce((prev, cur) => prev + cur, 0)\n        this.stackButtons.push(button)\n        button.relX = -button.width\n        button.relY = targetY - button.height\n        button.updatePosition()\n        button.slideToTarget(0, targetY).then(() => this.stackButtons.forEach(btn => btn.disabled = false))\n    }\n\n    buttonClicked(button: InfoDockButton) {\n        if (button !== this.stackButtons[0]) {\n            this.pushFirst(button)\n        } else {\n            this.informationPanel.setText(button.text)\n            this.informationPanel.toggleState()\n        }\n    }\n\n    private pushFirst(button: InfoDockButton) {\n        this.stackButtons.splice(this.stackButtons.indexOf(button), 1)\n        this.stackButtons.unshift(button)\n        this.slideStackIntoPosition().then(() => {\n            this.informationPanel.setText(button.text)\n            this.informationPanel.setMovedIn(false)\n        })\n    }\n\n    private slideStackIntoPosition() {\n        this.stackButtons.forEach(btn => btn.disabled = true)\n        let relY = 0\n        const promises = this.stackButtons.map(btn => {\n            const p = btn.slideToTarget(0, relY)\n            relY -= btn.height\n            return p\n        })\n        return new Promise<void>((resolve) => {\n            Promise.all(promises).then(() => {\n                this.stackButtons.forEach(btn => btn.disabled = false)\n                resolve()\n            })\n        })\n    }\n\n}\n\n","import { BaseConfig } from './BaseConfig'\n\nexport class PanelsCfg extends BaseConfig {\n\n    panelRadar: PanelCfg = null\n    panelRadarFill: PanelCfg = null\n    panelRadarOverlay: PanelCfg = null\n    panelMessages: PanelCfg = null\n    panelMessagesSide: PanelCfg = null\n    panelCrystalSideBar: PanelCfg = null\n    panelTopPanel: PanelCfg = null\n    panelInformation: PanelCfg = null\n    panelPriorityList: PanelCfg = null\n    panelCameraControl: PanelCfg = null\n    panelInfoDock: PanelCfg = null\n    panelEncyclopedia: PanelCfg = null\n\n    constructor(cfgObj: any) {\n        super()\n        BaseConfig.setFromCfg(this, cfgObj)\n    }\n\n    parseValue(lCfgKeyName: string, cfgValue: any): any {\n        return new PanelCfg(cfgValue)\n    }\n}\n\nexport class PanelCfg {\n\n    filename: string\n    xOut: number\n    yOut: number\n    xIn: number\n    yIn: number\n\n    constructor(cfgValue: any) {\n        [this.filename, this.xOut, this.yOut, this.xIn, this.yIn] = cfgValue\n    }\n\n}\n","import { Panel } from '../base/Panel'\nimport { PanelCfg } from '../../../cfg/PanelsCfg'\nimport { Button } from '../base/Button'\nimport { GameState } from '../../model/GameState'\nimport { ButtonPriorityListCfg } from './ButtonPriorityListCfg'\nimport { PriorityButtonsConfig } from './PriorityButtonsConfig'\nimport { PriorityPositionsEntry } from './PriorityPositionsEntry'\nimport { PriorityIdentifier } from '../../model/job/PriorityIdentifier'\nimport { PriorityEntry } from '../../model/job/PriorityList'\n\nexport class PriorityListPanel extends Panel {\n\n    prioPositions: PriorityPositionsEntry[] = []\n    prioByName: Map<PriorityIdentifier, Button> = new Map()\n\n    constructor(panelCfg: PanelCfg, buttonsCfg: ButtonPriorityListCfg, pos: PriorityPositionsEntry[], cfg: PriorityButtonsConfig) {\n        super(panelCfg)\n        buttonsCfg.panelButtonPriorityListDisable.forEach((buttonCfg, index) => {\n            this.addChild(new Button(this, buttonCfg)).onClick = () => {\n                GameState.priorityList.toggle(index)\n                this.setList(GameState.priorityList.current)\n            }\n        })\n        buttonsCfg.panelButtonPriorityListUpOne.forEach((buttonCfg, index) => {\n            this.addChild(new Button(this, buttonCfg)).onClick = () => {\n                GameState.priorityList.upOne(index)\n                this.setList(GameState.priorityList.current)\n            }\n        })\n        this.addChild(new Button(this, buttonsCfg.panelButtonPriorityListReset)).onClick = () => this.resetList()\n\n        this.prioPositions = pos\n        this.prioByName.set(PriorityIdentifier.aiPriorityTrain, this.addChild(new Button(this, cfg.aiPriorityTrain)))\n        this.prioByName.set(PriorityIdentifier.aiPriorityGetIn, this.addChild(new Button(this, cfg.aiPriorityGetIn)))\n        this.prioByName.set(PriorityIdentifier.aiPriorityCrystal, this.addChild(new Button(this, cfg.aiPriorityCrystal)))\n        this.prioByName.set(PriorityIdentifier.aiPriorityOre, this.addChild(new Button(this, cfg.aiPriorityOre)))\n        this.prioByName.set(PriorityIdentifier.aiPriorityRepair, this.addChild(new Button(this, cfg.aiPriorityRepair)))\n        this.prioByName.set(PriorityIdentifier.aiPriorityClearing, this.addChild(new Button(this, cfg.aiPriorityClearing)))\n        this.prioByName.set(PriorityIdentifier.aiPriorityDestruction, this.addChild(new Button(this, cfg.aiPriorityDestruction)))\n        this.prioByName.set(PriorityIdentifier.aiPriorityConstruction, this.addChild(new Button(this, cfg.aiPriorityConstruction)))\n        this.prioByName.set(PriorityIdentifier.aiPriorityReinforce, this.addChild(new Button(this, cfg.aiPriorityReinforce)))\n        this.prioByName.set(PriorityIdentifier.aiPriorityRecharge, this.addChild(new Button(this, cfg.aiPriorityRecharge)))\n    }\n\n    reset() {\n        super.reset()\n        this.resetList()\n    }\n\n    resetList() {\n        GameState.priorityList.reset()\n        this.setList(GameState.priorityList.current)\n    }\n\n    private setList(priorityList: PriorityEntry[]) {\n        this.prioByName.forEach((btn) => btn.hidden = true)\n        let index = 0\n        let updated = false\n        priorityList.forEach(cfg => {\n            const prioButton: Button = this.prioByName.get(cfg.key)\n            if (prioButton) {\n                updated = updated || prioButton.hidden || prioButton.disabled !== !cfg.enabled\n                prioButton.hidden = false\n                prioButton.disabled = !cfg.enabled\n                prioButton.relX = this.prioPositions[index].x\n                prioButton.relY = this.prioPositions[index].y\n                prioButton.updatePosition()\n                const btnIndex = index\n                prioButton.onClick = () => {\n                    GameState.priorityList.pushToTop(btnIndex)\n                    this.setList(GameState.priorityList.current)\n                }\n                index++\n            }\n        })\n        if (updated) this.notifyRedraw()\n    }\n\n}\n\n","export class InfoMessagesEntryConfig {\n\n    message: string = null\n    buttonImageFilename: string = null\n    sfx: string = null\n    timing: string = null\n    flag: string = null\n\n    constructor(cfgValue: any) {\n        [this.message, this.buttonImageFilename, this.sfx, this.timing, this.flag] = cfgValue\n        this.message = this.message.replace(/_/g, ' ')\n    }\n\n}\n","import { BaseConfig } from '../../../cfg/BaseConfig'\nimport { InfoMessagesEntryConfig } from './InfoMessagesEntryConfig'\n\nexport class InfoMessagesConfig extends BaseConfig {\n\n    infoGenericDeath: InfoMessagesEntryConfig = null\n    infoGenericMonster: InfoMessagesEntryConfig = null\n    infoCrystalFound: InfoMessagesEntryConfig = null\n    infoUnderAttack: InfoMessagesEntryConfig = null\n    infoLandslide: InfoMessagesEntryConfig = null\n    infoPowerDrain: InfoMessagesEntryConfig = null\n    infoSlugEmerge: InfoMessagesEntryConfig = null\n    infoFoundMinifigure: InfoMessagesEntryConfig = null\n\n    constructor(cfgObj: any) {\n        super()\n        BaseConfig.setFromCfg(this, cfgObj)\n    }\n\n    parseValue(lCfgKeyName: string, cfgValue: any): any {\n        return new InfoMessagesEntryConfig(cfgValue)\n    }\n\n}\n","import { Panel } from '../base/Panel'\nimport { PanelCfg } from '../../../cfg/PanelsCfg'\nimport { ResourceManager } from '../../../resource/ResourceManager'\nimport { BitmapFont } from '../../../core/BitmapFont'\n\nexport class InformationPanel extends Panel {\n\n    font: BitmapFont = null\n    textImage = null\n\n    constructor(panelCfg: PanelCfg) {\n        super(panelCfg)\n        this.font = ResourceManager.getDefaultFont()\n    }\n\n    setText(text?: string) {\n        this.textImage = text ? this.font.createTextImage(text, this.img.width - 80) : null\n        this.notifyRedraw()\n    }\n\n    onRedraw(context: CanvasRenderingContext2D) {\n        super.onRedraw(context)\n        if (this.textImage) context.drawImage(this.textImage, this.x + (this.img.width - this.textImage.width) / 2, this.y + 12)\n    }\n\n}\n","import { BaseConfig } from '../../../cfg/BaseConfig'\nimport { ButtonCfg } from '../../../cfg/ButtonsCfg'\n\nexport class PriorityButtonsConfig extends BaseConfig {\n\n    aiPriorityTrain: ButtonCfg = null\n    aiPriorityGetIn: ButtonCfg = null\n    aiPriorityCrystal: ButtonCfg = null\n    aiPriorityOre: ButtonCfg = null\n    aiPriorityRepair: ButtonCfg = null\n    aiPriorityClearing: ButtonCfg = null\n    aiPriorityDestruction: ButtonCfg = null\n    aiPriorityConstruction: ButtonCfg = null\n    aiPriorityReinforce: ButtonCfg = null\n    aiPriorityRecharge: ButtonCfg = null\n\n    constructor(cfgObj: any) {\n        super()\n        BaseConfig.setFromCfg(this, cfgObj)\n    }\n\n    parseValue(lCfgKeyName: string, cfgValue: any): ButtonCfg {\n        return {\n            buttonType: cfgValue[0],\n            normalFile: cfgValue[1],\n            highlightFile: cfgValue[1],\n            pressedFile: cfgValue[2],\n            disabledFile: cfgValue[3],\n        }\n    }\n\n}\n","export class PriorityPositionsEntry {\n\n    x: number\n    y: number\n\n    constructor(cfgValue: any) {\n        [this.x, this.y] = cfgValue\n    }\n\n}\n","export class TextInfoMessageEntryConfig {\n\n    text: string\n    imageFilename: string\n    sfxName: string\n\n    textImage\n    infoImage\n\n    constructor(cfgValue: any) {\n        [this.text, this.imageFilename, this.sfxName] = cfgValue\n    }\n\n}\n","import { BaseConfig } from '../../../cfg/BaseConfig'\nimport { TextInfoMessageEntryConfig } from './TextInfoMessageEntryConfig'\n\nexport class TextInfoMessageConfig extends BaseConfig {\n\n    textCrystalFound: TextInfoMessageEntryConfig = null\n    textSpaceToContinue: TextInfoMessageEntryConfig = null\n    textCavernDiscovered: TextInfoMessageEntryConfig = null\n    textOreFound: TextInfoMessageEntryConfig = null\n    textAirSupplyLow: TextInfoMessageEntryConfig = null\n    textAirSupplyRunningOut: TextInfoMessageEntryConfig = null\n    textGameCompleted: TextInfoMessageEntryConfig = null\n    textManTrained: TextInfoMessageEntryConfig = null\n    textUnitUpgraded: TextInfoMessageEntryConfig = null\n\n    constructor(cfgObj: any) {\n        super()\n        BaseConfig.setFromCfg(this, cfgObj)\n    }\n\n    parseValue(lCfgKeyName: string, cfgValue: any): any {\n        return new TextInfoMessageEntryConfig(cfgValue)\n    }\n\n}\n","import { ScaledLayer } from '../../screen/ScreenLayer'\nimport { Panel } from '../gui/base/Panel'\nimport { BaseElement } from '../gui/base/BaseElement'\nimport { MOUSE_BUTTON, POINTER_EVENT } from '../../event/EventTypeEnum'\n\nexport class GuiBaseLayer extends ScaledLayer {\n\n    rootElement: BaseElement = new BaseElement()\n    panels: Panel[] = []\n\n    constructor() {\n        super()\n        this.rootElement.notifyRedraw = () => this.redraw()\n        this.onRedraw = (context: CanvasRenderingContext2D) => {\n            context.clearRect(0, 0, context.canvas.width, context.canvas.height)\n            this.rootElement.onRedraw(context)\n        }\n    }\n\n    reset() {\n        super.reset()\n        this.panels.forEach((p) => p.reset())\n    }\n\n    addPanel<T extends Panel>(panel: T): T {\n        this.rootElement.addChild(panel)\n        this.panels.push(panel)\n        return panel\n    }\n\n    handlePointerEvent(eventEnum: POINTER_EVENT, event: PointerEvent): boolean {\n        const [cx, cy] = this.toCanvasCoords(event.clientX, event.clientY)\n        const [sx, sy] = this.toScaledCoords(event.clientX, event.clientY)\n        const hit = this.context && this.context.getImageData(cx, cy, 1, 1).data[3] > 0\n        if (hit) {\n            event.preventDefault()\n            if (eventEnum === POINTER_EVENT.MOVE) {\n                this.rootElement.checkHover(sx, sy)\n            } else if (eventEnum === POINTER_EVENT.DOWN) {\n                if (event.button === MOUSE_BUTTON.MAIN) this.rootElement.checkClick(sx, sy)\n            } else if (eventEnum === POINTER_EVENT.UP) {\n                if (event.button === MOUSE_BUTTON.MAIN) this.rootElement.checkRelease(sx, sy)\n            }\n        } else if (eventEnum === POINTER_EVENT.MOVE) {\n            this.rootElement.release()\n        }\n        return hit\n    }\n\n    handleWheelEvent(event: WheelEvent): boolean {\n        const [cx, cy] = this.toCanvasCoords(event.clientX, event.clientY)\n        return !this.context || this.context.getImageData(cx, cy, 1, 1).data[3] > 0\n    }\n\n}\n","import { ResourceManager } from '../../resource/ResourceManager'\nimport { Panel } from '../gui/base/Panel'\nimport { RadarPanel } from '../gui/radar/RadarPanel'\nimport { MessagePanel } from '../gui/messagepanel/MessagePanel'\nimport { PanelCrystalSideBar } from '../gui/sidebar/PanelCrystalSideBar'\nimport { MainPanel } from '../gui/main/MainPanel'\nimport { TopPanel } from '../gui/toppanel/TopPanel'\nimport { InfoDockPanel } from '../gui/infodock/InfoDockPanel'\nimport { PanelsCfg } from '../../cfg/PanelsCfg'\nimport { ButtonsCfg } from '../../cfg/ButtonsCfg'\nimport { PriorityListPanel } from '../gui/toppanel/PriorityListPanel'\nimport { InfoMessagesConfig } from '../gui/infodock/InfoMessagesConfig'\nimport { InformationPanel } from '../gui/infodock/InformationPanel'\nimport { PriorityButtonsConfig } from '../gui/toppanel/PriorityButtonsConfig'\nimport { PriorityPositionsEntry } from '../gui/toppanel/PriorityPositionsEntry'\nimport { TextInfoMessageConfig } from '../gui/messagepanel/TextInfoMessageConfig'\nimport { GuiBaseLayer } from './GuiBaseLayer'\n\nexport class GuiMainLayer extends GuiBaseLayer {\n\n    panelRadar: RadarPanel\n    panelMessages: MessagePanel\n    panelMessagesSide: Panel\n    panelCrystalSideBar: PanelCrystalSideBar\n    panelMain: MainPanel\n    panelTopPanel: TopPanel\n    panelInformation: InformationPanel\n    panelPriorityList: PriorityListPanel\n    panelCameraControl: Panel\n    panelInfoDock: InfoDockPanel\n    panelEncyclopedia: Panel\n    onOptionsShow: () => any = () => console.log('show options triggered')\n\n    constructor() {\n        super()\n        const panelsCfg = new PanelsCfg(ResourceManager.cfg('Panels640x480'))\n        const buttonsCfg = new ButtonsCfg(ResourceManager.cfg('Buttons640x480'))\n        // created in reverse order compared to cfg, earlier in cfg means higher z-value // TODO add some z layering at least to panels\n        this.panelEncyclopedia = this.addPanel(new Panel(panelsCfg.panelEncyclopedia))\n        this.panelInformation = this.addPanel(new InformationPanel(panelsCfg.panelInformation))\n        this.panelInfoDock = this.addPanel(new InfoDockPanel(panelsCfg.panelInfoDock, buttonsCfg.panelInfoDock, new InfoMessagesConfig(ResourceManager.cfg('InfoMessages')), this.panelInformation))\n        this.panelCameraControl = this.addPanel(new Panel(panelsCfg.panelCameraControl))\n        const priorityButtonsConfig = new PriorityButtonsConfig(ResourceManager.cfg('PriorityImages'))\n        const priorityPositionsConfig = Object.values(ResourceManager.cfg('PrioritiesImagePositions')).map(cfgValue => new PriorityPositionsEntry(cfgValue))\n        this.panelPriorityList = this.addPanel(new PriorityListPanel(panelsCfg.panelPriorityList, buttonsCfg.panelPriorityList, priorityPositionsConfig, priorityButtonsConfig))\n        this.panelTopPanel = this.addPanel(new TopPanel(panelsCfg.panelTopPanel, buttonsCfg.panelTopPanel))\n        this.panelMain = this.addPanel(new MainPanel())\n        this.panelCrystalSideBar = this.addPanel(new PanelCrystalSideBar(panelsCfg.panelCrystalSideBar, buttonsCfg.panelCrystalSideBar))\n        this.panelMessagesSide = this.addPanel(new Panel(panelsCfg.panelMessagesSide))\n        this.panelMessages = this.addPanel(new MessagePanel(panelsCfg.panelMessages, new TextInfoMessageConfig(ResourceManager.cfg('TextMessagesWithImages'))))\n        this.panelRadar = this.addPanel(new RadarPanel(panelsCfg.panelRadar, panelsCfg.panelRadarFill, panelsCfg.panelRadarOverlay, buttonsCfg.panelRadar))\n        // link panels\n        this.panelTopPanel.btnOptions.onClick = () => this.onOptionsShow()\n        this.panelTopPanel.btnPriorities.onClick = () => {\n            if (this.panelTopPanel.btnPriorities.toggleState) {\n                this.panelMain.setMovedIn(true, () => this.panelPriorityList.setMovedIn(false))\n            } else {\n                this.panelPriorityList.setMovedIn(true, () => this.panelMain.setMovedIn(false))\n            }\n        }\n    }\n\n}\n","import { EventBus } from '../event/EventBus'\nimport { JobCreateEvent, JobDeleteEvent } from '../event/WorldEvents'\nimport { PublicJob } from './model/job/Job'\nimport { GameState } from './model/GameState'\nimport { Vector2 } from 'three'\nimport { Raider } from '../scene/model/Raider'\nimport { WorldManager } from '../scene/WorldManager'\nimport { CHECK_CLEARRUBBLE_INTERVAL, JOB_SCHEDULE_INTERVAL } from '../main'\nimport { Building } from './model/entity/building/Building'\nimport { GetToolJob } from './model/job/GetToolJob'\nimport { TrainJob } from './model/job/TrainJob'\nimport { clearIntervalSafe } from '../core/Util'\nimport { RaiderSkill } from '../scene/model/RaiderSkill'\nimport { RaiderTool } from '../scene/model/RaiderTool'\nimport { JobState } from './model/job/JobState'\nimport { PathTarget } from '../scene/model/PathTarget'\nimport { EventKey } from '../event/EventKeyEnum'\nimport { JobType } from './model/job/JobType'\nimport { Surface } from '../scene/model/map/Surface'\nimport { ClearRubbleJob } from './model/job/surface/ClearRubbleJob'\n\nexport class Supervisor {\n\n    worldMgr: WorldManager\n    jobs: PublicJob[] = []\n    assignInterval = null\n    checkRubbleInterval = null\n\n    constructor(worldMgr: WorldManager) {\n        this.worldMgr = worldMgr\n        EventBus.registerEventListener(EventKey.JOB_CREATE, (event: JobCreateEvent) => {\n            this.jobs.push(event.job)\n        })\n        EventBus.registerEventListener(EventKey.JOB_DELETE, (event: JobDeleteEvent) => {\n            event.job.cancel()\n        })\n    }\n\n    start() {\n        stop()\n        this.assignInterval = setInterval(this.assignJobs.bind(this), JOB_SCHEDULE_INTERVAL)\n        this.checkRubbleInterval = setInterval(this.checkUnclearedRubble.bind(this), CHECK_CLEARRUBBLE_INTERVAL)\n    }\n\n    stop() {\n        this.assignInterval = clearIntervalSafe(this.assignInterval)\n        this.checkRubbleInterval = clearIntervalSafe(this.checkRubbleInterval)\n        GameState.raiders.forEach((r) => r.resetWorkInterval())\n        GameState.raidersUndiscovered.forEach((r) => r.resetWorkInterval())\n        GameState.vehicles.forEach((v) => v.resetWorkInterval())\n        GameState.vehiclesUndiscovered.forEach((v) => v.resetWorkInterval())\n    }\n\n    assignJobs() {\n        const availableJobs: PublicJob[] = []\n        this.jobs = this.jobs.filter((j) => {\n            const result = j.jobstate === JobState.OPEN\n            if (result && j.fulfiller.length < 1) availableJobs.push(j)\n            return result\n        })\n        availableJobs.sort((left, right) => {\n            return Math.sign(GameState.priorityList.getPriority(left) - GameState.priorityList.getPriority(right))\n        })\n        const unemployedRaider = GameState.raiders.filter((r) => !r.job)\n        availableJobs.forEach((job) => { // XXX better use estimated time to complete job as metric\n            let closestRaider: Raider = null\n            let closestRaiderIndex: number = null\n            let minDistance: number = null\n            let closestToolRaider: Raider = null\n            let closestToolRaiderIndex: number = null\n            let minToolDistance: number = null\n            let closestToolstationPosition: Vector2 = null\n            let closestNeededTool: RaiderTool = null\n            let closestTrainingRaider: Raider = null\n            let closestTrainingRaiderIndex: number = null\n            let minTrainingDistance: number = null\n            let closestTrainingArea: Surface = null\n            let closestNeededTraining: RaiderSkill = null\n            unemployedRaider.forEach((raider, index) => {\n                if (job.isQualified(raider)) {\n                    const pathToJob = job.getWorkplaces().map((b) => raider.findPathToTarget(b))\n                        .sort((l, r) => l.lengthSq - r.lengthSq)[0]\n                    if (pathToJob) {\n                        const dist = pathToJob.lengthSq // TODO use precalculated path to job\n                        if (minDistance === null || dist < minDistance) {\n                            closestRaider = raider\n                            closestRaiderIndex = index\n                            minDistance = dist\n                        }\n                    }\n                } else {\n                    const raiderPosition = raider.getPosition()\n                    const neededTool = job.isQualifiedWithTool(raider)\n                    if (neededTool) {\n                        const pathToToolstation = GameState.getBuildingsByType(Building.TOOLSTATION)\n                            .map((b) => raider.findPathToTarget(new PathTarget(b.getPosition2D())))\n                            .sort((l, r) => l.lengthSq - r.lengthSq)[0]\n                        if (pathToToolstation) {\n                            const dist = pathToToolstation.lengthSq\n                            if (minToolDistance === null || dist < minToolDistance) {\n                                closestToolRaider = raider\n                                closestToolRaiderIndex = index\n                                minToolDistance = dist\n                                closestToolstationPosition = pathToToolstation.targetPosition // TODO use precalculated path to toolstation\n                                closestNeededTool = neededTool\n                            }\n                        }\n                    } else {\n                        const neededTraining = job.isQualifiedWithTraining(raider)\n                        if (neededTraining) {\n                            const pathToTraining = GameState.getTrainingSites(raiderPosition, neededTraining)\n                                .map((site) => raider.findPathToTarget(new PathTarget(site.getPosition2D())))\n                                .sort((l, r) => l.lengthSq - r.lengthSq)[0]\n                            if (pathToTraining) {\n                                const dist = pathToTraining.lengthSq\n                                if (minTrainingDistance === null || dist < minTrainingDistance) {\n                                    closestTrainingRaider = raider\n                                    closestTrainingRaiderIndex = index\n                                    minTrainingDistance = dist\n                                    closestTrainingArea = raider.worldMgr.sceneManager.terrain.getSurfaceFromWorld2D(pathToTraining.targetPosition) // TODO use precalculated path to training\n                                    closestNeededTraining = neededTraining\n                                }\n                            }\n                        }\n                    }\n                }\n            })\n            if (closestRaider) {\n                closestRaider.setJob(job)\n                unemployedRaider.splice(closestRaiderIndex, 1)\n            } else if (closestToolRaider) {\n                closestToolRaider.setJob(new GetToolJob(closestToolstationPosition, closestNeededTool), job)\n                unemployedRaider.splice(closestToolRaiderIndex, 1)\n            } else if (closestTrainingRaider) {\n                closestTrainingRaider.setJob(new TrainJob(closestTrainingArea, closestNeededTraining), job)\n                unemployedRaider.splice(closestTrainingRaiderIndex, 1)\n            }\n        })\n    }\n\n    checkUnclearedRubble() {\n        GameState.raiders.forEach((raider) => {\n            if (raider.job) return\n            const startSurface = raider.worldMgr.sceneManager.terrain.getSurfaceFromWorld(raider.getPosition())\n            for (let rad = 0; rad < 10; rad++) {\n                for (let x = startSurface.x - rad; x <= startSurface.x + rad; x++) {\n                    for (let y = startSurface.y - rad; y <= startSurface.y + rad; y++) {\n                        const surface = raider.worldMgr.sceneManager.terrain.getSurfaceOrNull(x, y)\n                        if (!(surface?.hasRubble()) || !surface.discovered || surface.hasJobType(JobType.CLEAR_RUBBLE)) continue\n                        const surfJob = new ClearRubbleJob(surface)\n                        if (surfJob.isQualified(raider)) {\n                            raider.setJob(surfJob)\n                        } else {\n                            const neededTool = surfJob.isQualifiedWithTool(raider)\n                            if (neededTool) {\n                                const pathToToolstation = GameState.getBuildingsByType(Building.TOOLSTATION)\n                                    .map((b) => raider.findPathToTarget(new PathTarget(b.getPosition2D())))\n                                    .sort((l, r) => l.lengthSq - r.lengthSq)[0]\n                                if (pathToToolstation) {\n                                    raider.setJob(new GetToolJob(pathToToolstation.targetPosition, neededTool), surfJob) // TODO use precalculated path to toolstation\n                                }\n                            } else {\n                                continue\n                            }\n                        }\n                        EventBus.publishEvent(new JobCreateEvent(surfJob))\n                        surface.updateJobColor()\n                    }\n                }\n            }\n        })\n    }\n\n}\n","import { Panel } from '../base/Panel'\nimport { ResourceManager } from '../../../resource/ResourceManager'\nimport { Button } from '../base/Button'\nimport { BriefingPanelCfg } from '../../../cfg/BriefingPanelCfg'\nimport { MessagePanel } from '../messagepanel/MessagePanel'\nimport { ObjectiveImageCfg } from '../../../cfg/ObjectiveImageCfg'\n\nexport class BriefingPanel extends Panel {\n\n    messagePanel: MessagePanel\n    cfg: BriefingPanelCfg = null\n    imgTitle: HTMLCanvasElement = null\n    titleRelX: number = 0\n    titleRelY: number = 0\n    btnNext: Button = null\n    btnBack: Button = null\n    imgBack: HTMLCanvasElement = null\n    imgParagraph: HTMLCanvasElement[] = []\n    paragraph: number = 0\n\n    constructor(cfg: BriefingPanelCfg) {\n        super()\n        this.cfg = cfg\n        this.imgTitle = cfg.titleFont.createTextImage(cfg.title)\n        this.titleRelX = cfg.titleWindow.x + (cfg.titleWindow.w - this.imgTitle.width) / 2\n        this.titleRelY = cfg.titleWindow.y\n        this.btnNext = this.addChild(new Button(this, cfg.nextButtonCfg))\n        this.btnNext.onClick = () => this.nextParagraph()\n        this.btnBack = this.addChild(new Button(this, cfg.backButtonCfg))\n        this.btnBack.onClick = () => this.prevParagraph()\n        this.hidden = true\n    }\n\n    reset() {\n        super.reset()\n        this.hidden = true\n        this.setParagraph(0)\n    }\n\n    setup(objectiveText: string, objectiveBackImgCfg: ObjectiveImageCfg) {\n        this.imgBack = ResourceManager.getImageOrNull(objectiveBackImgCfg.filename)\n        this.relX = objectiveBackImgCfg.x\n        this.relY = objectiveBackImgCfg.y\n        this.width = this.imgBack.width\n        this.height = this.imgBack.height\n        this.updatePosition()\n        this.imgParagraph = objectiveText.split('\\\\a').map(txt => this.cfg.textFont.createTextImage(txt, this.cfg.textWindow.w, false))\n    }\n\n    setParagraph(paragraph: number) {\n        if (paragraph < 0) return\n        if (paragraph > this.imgParagraph.length - 1) {\n            this.hide()\n            this.notifyRedraw()\n            return\n        }\n        this.paragraph = paragraph\n        this.btnNext.hidden = this.paragraph >= this.imgParagraph.length - 1\n        this.btnBack.hidden = this.paragraph < 1\n        this.notifyRedraw()\n    }\n\n    nextParagraph() {\n        this.setParagraph(this.paragraph + 1)\n    }\n\n    prevParagraph() {\n        this.setParagraph(this.paragraph - 1)\n    }\n\n    show() {\n        super.show()\n        this.setParagraph(0)\n        this.btnNext.hidden = this.paragraph >= this.imgParagraph.length - 1\n        this.btnBack.hidden = this.paragraph < 1\n        this.messagePanel?.setMessage(this.messagePanel.msgSpaceToContinue, 0)\n    }\n\n    hide() {\n        super.hide()\n        this.messagePanel?.unsetMessage(this.messagePanel.msgSpaceToContinue)\n    }\n\n    onRedraw(context: CanvasRenderingContext2D) {\n        if (this.hidden) return\n        if (this.imgBack) context.drawImage(this.imgBack, this.x, this.y)\n        if (this.imgTitle) context.drawImage(this.imgTitle, this.x + this.titleRelX, this.y + this.titleRelY)\n        if (this.imgParagraph && this.imgParagraph[this.paragraph]) context.drawImage(this.imgParagraph[this.paragraph], this.x + this.cfg.textWindow.x, this.y + this.cfg.textWindow.y)\n        super.onRedraw(context)\n    }\n\n}\n","import { BaseElement } from '../base/BaseElement'\nimport { MenuCycleItemCfg } from '../../../cfg/MenuCycleItemCfg'\nimport { MenuLayer } from './MenuLayer'\n\nexport class MenuCycleItem extends BaseElement {\n\n    imgTextNormal: HTMLCanvasElement\n    imgTextHover: HTMLCanvasElement\n    imgLabelOnNormal: HTMLCanvasElement // TODO only toggle state with clicks on label\n    imgLabelOffNormal: HTMLCanvasElement // TODO use button?\n    imgLabelOnHover: HTMLCanvasElement\n    imgLabelOffHover: HTMLCanvasElement\n\n    labelX: number = 0\n    state: boolean = false\n\n    constructor(parent: MenuLayer, itemCfg: MenuCycleItemCfg) {\n        super(parent)\n        this.relX = itemCfg.x\n        this.relY = itemCfg.y\n        this.labelX = itemCfg.width\n        this.imgTextNormal = parent.loFont.createTextImage(itemCfg.description)\n        this.imgTextHover = parent.hiFont.createTextImage(itemCfg.description)\n        this.imgLabelOffNormal = parent.loFont.createTextImage(itemCfg.labelOff)\n        this.imgLabelOffHover = parent.hiFont.createTextImage(itemCfg.labelOff)\n        this.imgLabelOnNormal = parent.loFont.createTextImage(itemCfg.labelOn)\n        this.imgLabelOnHover = parent.hiFont.createTextImage(itemCfg.labelOn)\n        this.width = itemCfg.width + Math.max(this.imgLabelOnHover.width, this.imgLabelOffHover.width)\n        this.height = this.imgTextNormal.height\n    }\n\n    onClick() {\n        this.state = !this.state\n        console.log('TODO: cycle item clicked; state: ' + this.state)\n    }\n\n    checkHover(cx, cy): boolean {\n        const stateChanged = super.checkHover(cx, cy)\n        if (stateChanged) this.notifyRedraw()\n        return stateChanged\n    }\n\n    checkClick(cx, cy): boolean {\n        const stateChanged = super.checkClick(cx, cy)\n        if (stateChanged) this.notifyRedraw()\n        return stateChanged\n    }\n\n    checkRelease(cx, cy): boolean {\n        const stateChanged = super.checkRelease(cx, cy)\n        if (stateChanged) this.notifyRedraw()\n        return stateChanged\n    }\n\n    release(): boolean {\n        const stateChanged = super.release()\n        if (stateChanged) this.notifyRedraw()\n        return stateChanged\n    }\n\n    onRedraw(context: CanvasRenderingContext2D) {\n        if (this.hidden) return\n        let img = this.imgTextNormal\n        let imgLabel = this.state ? this.imgLabelOnNormal : this.imgLabelOffNormal\n        if (this.hover) {\n            img = this.imgTextHover\n            imgLabel = this.state ? this.imgLabelOnHover : this.imgLabelOffHover\n        }\n        context.drawImage(img, this.x, this.y)\n        context.drawImage(imgLabel, this.x + this.labelX, this.y)\n        super.onRedraw(context)\n    }\n\n}\n","import { BaseElement } from '../base/BaseElement'\nimport { MenuSliderItemCfg } from '../../../cfg/MenuSliderItemCfg'\nimport { ResourceManager } from '../../../resource/ResourceManager'\nimport { Button } from '../base/Button'\nimport { BaseButtonCfg } from '../../../cfg/ButtonsCfg'\nimport { MenuLayer } from './MenuLayer'\n\nexport class MenuSliderItem extends BaseElement {\n\n    imgTextNormal: HTMLCanvasElement\n    imgTextHover: HTMLCanvasElement\n    imgLeft: HTMLCanvasElement\n    imgNormal: HTMLCanvasElement\n    imgHover: HTMLCanvasElement\n    imgRight: HTMLCanvasElement\n    sliderX: number = 0\n    min: number = 0\n    max: number = 1\n    value: number = 0\n    onValueChanged: (value: number) => any = (value) => console.log('value changed to: ' + value)\n\n    constructor(parent: MenuLayer, itemCfg: MenuSliderItemCfg) {\n        super(parent)\n        this.relX = itemCfg.x\n        this.relY = itemCfg.y\n        this.sliderX = itemCfg.width\n        this.imgLeft = ResourceManager.getImage(itemCfg.imgLeft)\n        this.imgNormal = ResourceManager.getImage(itemCfg.imgOff)\n        this.imgHover = ResourceManager.getImage(itemCfg.imgOn)\n        this.imgRight = ResourceManager.getImage(itemCfg.imgRight)\n        const leftBtn = this.addChild(new Button(this, new BaseButtonCfg()))\n        leftBtn.imgNormal = ResourceManager.getImage(itemCfg.btnLeftNormal)\n        leftBtn.imgHover = ResourceManager.getImage(itemCfg.btnLeftHover)\n        leftBtn.relX = this.sliderX - this.imgLeft.width - leftBtn.imgHover.width\n        leftBtn.width = leftBtn.imgHover.width\n        leftBtn.height = leftBtn.imgHover.height\n        leftBtn.updatePosition()\n        leftBtn.onClick = () => {\n            if (this.value > this.min) {\n                this.value--\n                this.onValueChanged(this.value)\n            }\n        }\n        const rightBtn = this.addChild(new Button(this, new BaseButtonCfg()))\n        rightBtn.imgNormal = ResourceManager.getImage(itemCfg.btnRightNormal)\n        rightBtn.imgHover = ResourceManager.getImage(itemCfg.btnRightHover)\n        rightBtn.relX = this.sliderX + this.imgNormal.width + this.imgRight.width * 2\n        rightBtn.width = rightBtn.imgHover.width\n        rightBtn.height = rightBtn.imgHover.height\n        rightBtn.updatePosition()\n        rightBtn.onClick = () => {\n            if (this.value < this.max) {\n                this.value++\n                this.onValueChanged(this.value)\n            }\n        }\n        this.width = itemCfg.width + leftBtn.imgHover.width + this.imgLeft.width + this.imgNormal.width + this.imgRight.width * 2 + rightBtn.imgHover.width\n        this.min = itemCfg.min\n        this.max = itemCfg.max || 1\n        this.value = this.min // TODO set default value\n        this.imgTextNormal = parent.loFont.createTextImage(itemCfg.description)\n        this.imgTextHover = parent.hiFont.createTextImage(itemCfg.description)\n        this.height = this.imgTextNormal.height\n    }\n\n    checkHover(cx, cy): boolean {\n        const stateChanged = super.checkHover(cx, cy)\n        if (stateChanged) this.notifyRedraw()\n        return stateChanged\n    }\n\n    onRedraw(context: CanvasRenderingContext2D) {\n        if (this.hidden) return\n        let img = this.imgTextNormal\n        if (this.hover) {\n            img = this.imgTextHover\n        }\n        context.drawImage(img, this.x, this.y)\n        let posX = this.x + this.sliderX\n        context.drawImage(this.imgLeft, posX, this.y)\n        context.drawImage(this.imgNormal, posX, this.y)\n        const dw = Math.round(this.value / this.max * this.imgHover.width)\n        context.drawImage(this.imgHover, 0, 0, dw, this.imgHover.height, posX, this.y, dw, this.imgHover.height)\n        posX += this.imgNormal.width\n        context.drawImage(this.imgRight, posX, this.y)\n        super.onRedraw(context)\n    }\n\n}\n","import { BaseElement } from '../base/BaseElement'\nimport { MenuLayer } from './MenuLayer'\nimport { MenuLabelItemCfg } from '../../../cfg/MenuLabelItemCfg'\n\nexport class MenuLabelItem extends BaseElement {\n\n    target: string\n    loImg: HTMLCanvasElement\n    hiImg: HTMLCanvasElement\n\n    constructor(parent: MenuLayer, itemCfg: MenuLabelItemCfg, autoCenter: boolean) {\n        super(parent)\n        this.target = itemCfg.target\n        this.loImg = parent.loFont.createTextImage(itemCfg.label)\n        this.hiImg = parent.hiFont.createTextImage(itemCfg.label)\n        this.width = this.loImg.width\n        this.height = this.loImg.height\n        this.relX = autoCenter ? -parent.relX + (parent.menuImage.width - this.width) / 2 : itemCfg.x\n        this.relY = itemCfg.y\n    }\n\n    checkHover(cx, cy): boolean {\n        const stateChanged = super.checkHover(cx, cy)\n        if (stateChanged) this.notifyRedraw()\n        return stateChanged\n    }\n\n    checkClick(cx, cy): boolean {\n        const stateChanged = super.checkClick(cx, cy)\n        if (stateChanged) this.notifyRedraw()\n        return stateChanged\n    }\n\n    checkRelease(cx, cy): boolean {\n        const stateChanged = super.checkRelease(cx, cy)\n        if (stateChanged) this.notifyRedraw()\n        return stateChanged\n    }\n\n    release(): boolean {\n        const stateChanged = super.release()\n        if (stateChanged) this.notifyRedraw()\n        return stateChanged\n    }\n\n    onRedraw(context: CanvasRenderingContext2D) {\n        if (this.hidden) return\n        if (this.hover) {\n            context.drawImage(this.hiImg, this.x, this.y)\n        } else {\n            context.drawImage(this.loImg, this.x, this.y)\n        }\n        super.onRedraw(context)\n    }\n\n}\n","import { MenuEntryCfg } from '../../../cfg/MenuEntryCfg'\nimport { ResourceManager } from '../../../resource/ResourceManager'\nimport { BaseElement } from '../base/BaseElement'\nimport { MenuCycleItem } from './MenuCycleItem'\nimport { MenuSliderItem } from './MenuSliderItem'\nimport { MenuLabelItem } from './MenuLabelItem'\nimport { BitmapFont } from '../../../core/BitmapFont'\n\nexport class MenuLayer extends BaseElement {\n\n    menuImage: HTMLCanvasElement\n    titleImage: HTMLCanvasElement\n    loFont: BitmapFont\n    hiFont: BitmapFont\n    itemsTrigger: MenuLabelItem[] = []\n    itemsNext: MenuLabelItem[] = []\n\n    constructor(parent: BaseElement, menuCfg: MenuEntryCfg) {\n        super(parent)\n        this.relX = menuCfg.position[0]\n        this.relY = menuCfg.position[1]\n        this.menuImage = ResourceManager.getImageOrNull(menuCfg.menuImage[0]) // menuImage has 4 parameter here\n        this.titleImage = ResourceManager.getBitmapFont(menuCfg.menuFont).createTextImage(menuCfg.fullName)\n        this.loFont = ResourceManager.getBitmapFont(menuCfg.loFont)\n        this.hiFont = ResourceManager.getBitmapFont(menuCfg.hiFont)\n        menuCfg.itemsLabel.forEach((itemCfg) => {\n            const item = this.addChild(new MenuLabelItem(this, itemCfg, menuCfg.autoCenter))\n            if (itemCfg.actionName.toLowerCase() === 'trigger') {\n                this.itemsTrigger.push(item)\n            } else {\n                this.itemsNext.push(item)\n            }\n        })\n        menuCfg.itemsCycle.forEach((itemCfg) => this.addChild(new MenuCycleItem(this, itemCfg)))\n        menuCfg.itemsSlider.forEach((itemCfg) => this.addChild(new MenuSliderItem(this, itemCfg)))\n        this.hidden = true\n    }\n\n    reset() {\n        super.reset()\n        this.hidden = true\n    }\n\n    onRedraw(context: CanvasRenderingContext2D) {\n        if (this.hidden) return\n        context.drawImage(this.menuImage, (this.parent.width - this.menuImage.width) / 2, (this.parent.height - this.menuImage.height) / 2)\n        context.drawImage(this.titleImage, (this.parent.width - this.titleImage.width) / 2, this.y)\n        super.onRedraw(context)\n    }\n\n}\n","import { Panel } from '../base/Panel'\nimport { MenuLayer } from './MenuLayer'\nimport { MenuCfg } from '../../../cfg/MenuCfg'\nimport { ScaledLayer } from '../../../screen/ScreenLayer'\n\nexport class MenuBasePanel extends Panel {\n\n    layersByKey: Map<string, MenuLayer> = new Map()\n\n    constructor(layer: ScaledLayer, cfg: MenuCfg) {\n        super()\n        this.width = layer.fixedWidth\n        this.height = layer.fixedHeight\n        this.hidden = true\n        cfg.menus.forEach((menuCfg, index) => this.layersByKey.set('menu' + (index + 1), this.addChild(new MenuLayer(this, menuCfg))))\n        const pausePanel = this\n        this.layersByKey.forEach((layer) => layer.itemsNext.forEach((item) => item.onClick = () => pausePanel.selectLayer(item.target)))\n    }\n\n    reset() {\n        super.reset()\n        this.hidden = true\n    }\n\n    show() {\n        this.hidden = false\n        this.selectLayer('menu1')\n    }\n\n    hide() {\n        super.hide()\n        this.notifyRedraw()\n    }\n\n    selectLayer(key: string) {\n        const layer = this.layersByKey.get(key.toLowerCase())\n        this.layersByKey.forEach(l => l !== layer && l.hide())\n        layer.show()\n        this.notifyRedraw()\n    }\n\n}\n","import { MenuCfg } from '../../../cfg/MenuCfg'\nimport { MenuBasePanel } from './MenuBasePanel'\nimport { ScaledLayer } from '../../../screen/ScreenLayer'\n\nexport class OptionsPanel extends MenuBasePanel {\n\n    onRepeatBriefing: () => any = () => console.log('repeat mission briefing')\n\n    constructor(layer: ScaledLayer, cfg: MenuCfg) {\n        super(layer, cfg)\n        const panel = this\n        this.layersByKey.get('menu1').itemsTrigger[0].onClick = () => panel.onRepeatBriefing()\n        this.layersByKey.get('menu1').itemsTrigger[1].onClick = () => panel.hide()\n    }\n\n}\n","import { MenuCfg } from '../../../cfg/MenuCfg'\nimport { ScaledLayer } from '../../../screen/ScreenLayer'\nimport { MenuBasePanel } from './MenuBasePanel'\n\nexport class PausePanel extends MenuBasePanel {\n\n    onRepeatBriefing: () => any = () => console.log('repeat mission briefing')\n    onAbortGame: () => any = () => console.log('abort mission')\n    onRestartGame: () => any = () => console.log('restart mission')\n\n    constructor(layer: ScaledLayer, cfg: MenuCfg) {\n        super(layer, cfg)\n        const pausePanel = this\n        this.layersByKey.get('menu1').itemsTrigger[0].onClick = () => pausePanel.hide() // Pause\n        this.layersByKey.get('menu2').itemsTrigger[0].onClick = () => pausePanel.onRepeatBriefing() // Options\n        this.layersByKey.get('menu3').itemsTrigger[0].onClick = () => pausePanel.onAbortGame() // Quit\n        this.layersByKey.get('menu4').itemsTrigger[0].onClick = () => pausePanel.onRestartGame() // Restart\n    }\n\n}\n","export class Rect {\n\n    x: number = 0\n    y: number = 0\n    w: number = 0\n    h: number = 0\n\n    constructor(arr: number[]) {\n        [this.x, this.y, this.w, this.h] = arr\n    }\n\n}\n","import { BaseConfig } from './BaseConfig'\nimport { Rect } from '../core/Rect'\n\nexport class DialogCfg extends BaseConfig {\n\n    image: string = null\n    titleWindow: Rect = null\n    textWindow: Rect = null\n    okWindow: Rect = null\n    cancelWindow: Rect = null\n    contrastOverlay: string = null // not used in the game\n\n    constructor(cfgObj: any) {\n        super()\n        BaseConfig.setFromCfg(this, cfgObj)\n    }\n\n    parseValue(lCfgKeyName: string, cfgValue: any): any {\n        if (lCfgKeyName.endsWith('window')) {\n            return new Rect(cfgValue)\n        }\n        return super.parseValue(lCfgKeyName, cfgValue)\n    }\n\n}\n","import { PanelCfg } from './PanelsCfg'\nimport { ResourceManager } from '../resource/ResourceManager'\nimport { BitmapFont } from '../core/BitmapFont'\nimport { DialogCfg } from './DialogCfg'\nimport { Rect } from '../core/Rect'\nimport { ButtonCfg } from './ButtonsCfg'\n\nexport class BriefingPanelCfg extends PanelCfg {\n\n    // XXX find config values for this class\n\n    titleFont: BitmapFont\n    title: string\n    titleWindow: Rect\n    textFont: BitmapFont\n    textWindow: Rect\n    nextButtonCfg: ButtonCfg\n    backButtonCfg: ButtonCfg\n\n    constructor() {\n        super([])\n        this.titleFont = ResourceManager.getBitmapFont('Interface/Fonts/MbriefFont2.bmp')\n        this.title = ResourceManager.cfg('Main', 'MissionBriefingText')\n        const dialogCfg = new DialogCfg(ResourceManager.cfg('Dialog'))\n        this.titleWindow = dialogCfg.titleWindow\n        this.textFont = ResourceManager.getBitmapFont('Interface/Fonts/MbriefFont.bmp')\n        this.textWindow = dialogCfg.textWindow\n        this.nextButtonCfg = {\n            buttonType: 'Next briefing paragraph',\n            relX: 394,\n            relY: 214,\n            normalFile: ResourceManager.cfg('Main', 'NextButton640x480'),\n        }\n        this.backButtonCfg = {\n            buttonType: 'Previous briefing paragraph',\n            relX: 54,\n            relY: 214,\n            normalFile: ResourceManager.cfg('Main', 'BackArrow'),\n        }\n    }\n\n}\n","import { BriefingPanel } from '../gui/briefing/BriefingPanel'\nimport { OptionsPanel } from '../gui/overlay/OptionsPanel'\nimport { PausePanel } from '../gui/overlay/PausePanel'\nimport { ResourceManager } from '../../resource/ResourceManager'\nimport { MenuCfg } from '../../cfg/MenuCfg'\nimport { BriefingPanelCfg } from '../../cfg/BriefingPanelCfg'\nimport { KEY_EVENT, POINTER_EVENT } from '../../event/EventTypeEnum'\nimport { Panel } from '../gui/base/Panel'\nimport { GuiBaseLayer } from './GuiBaseLayer'\nimport { ObjectiveImageCfg } from '../../cfg/ObjectiveImageCfg'\nimport { DEV_MODE } from '../../main'\n\nexport class OverlayLayer extends GuiBaseLayer {\n\n    panelBriefing: BriefingPanel\n    panelOptions: OptionsPanel\n    panelPause: PausePanel\n\n    constructor() {\n        super()\n        this.panelPause = this.addPanel(new PausePanel(this, ResourceManager.getResource('PausedMenu') as MenuCfg))\n        this.panelOptions = this.addPanel(new OptionsPanel(this, ResourceManager.getResource('OptionsMenu') as MenuCfg))\n        this.panelBriefing = this.addPanel(new BriefingPanel(new BriefingPanelCfg()))\n        // link items\n        this.panelPause.onRepeatBriefing = () => this.setActivePanel(this.panelBriefing)\n        this.panelOptions.onRepeatBriefing = () => this.setActivePanel(this.panelBriefing)\n    }\n\n    setActivePanel(panel: Panel) {\n        this.panels.forEach(p => p !== panel && p.hide())\n        panel.show()\n        this.redraw()\n    }\n\n    setup(objectiveText: string, objectiveBackImgCfg: ObjectiveImageCfg) {\n        this.panelBriefing.setup(objectiveText, objectiveBackImgCfg)\n        if (!DEV_MODE) this.setActivePanel(this.panelBriefing)\n    }\n\n    handlePointerEvent(eventEnum: POINTER_EVENT, event: PointerEvent): boolean {\n        if (this.panels.every(p => p.hidden)) return false\n        return super.handlePointerEvent(eventEnum, event) || this.isActive() // catch em all\n    }\n\n    handleKeyEvent(eventEnum: KEY_EVENT, event: KeyboardEvent): boolean {\n        let result = false\n        const lEventKey = event.key.toLowerCase()\n        if (eventEnum === KEY_EVENT.UP) {\n            if (lEventKey === 'escape') {\n                if (this.panelBriefing.hidden && this.panelOptions.hidden) {\n                    if (this.panelPause.hidden) {\n                        // TODO actually pause the game\n                        this.setActivePanel(this.panelPause)\n                    } else {\n                        // TODO actually unpause the game\n                        this.panelPause.hide()\n                    }\n                    result = true\n                }\n            } else if (lEventKey === ' ') { // space\n                if (!this.panelBriefing.hidden) {\n                    this.panelBriefing.nextParagraph()\n                    result = true\n                }\n            }\n        }\n        return result\n    }\n\n}\n","import { BaseScreen } from './BaseScreen'\nimport { WorldManager } from '../scene/WorldManager'\nimport { SelectionLayer } from '../game/layer/SelectionLayer'\nimport { GameLayer } from '../game/layer/GameLayer'\nimport { GuiMainLayer } from '../game/layer/GuiMainLayer'\nimport { Supervisor } from '../game/Supervisor'\nimport { LevelEntryCfg } from '../cfg/LevelsCfg'\nimport { ResourceManager } from '../resource/ResourceManager'\nimport { iGet } from '../core/Util'\nimport { LevelObjectiveTextEntry } from '../resource/wadworker/ObjectiveTextParser'\nimport { OverlayLayer } from '../game/layer/OverlayLayer'\nimport { GameState } from '../game/model/GameState'\n\nexport class GameScreen extends BaseScreen {\n\n    onLevelEnd: () => void\n    gameLayer: GameLayer\n    selectionLayer: SelectionLayer\n    guiLayer: GuiMainLayer\n    overlayLayer: OverlayLayer\n    worldManager: WorldManager\n    jobSupervisor: Supervisor\n    levelName: string\n    levelConf: LevelEntryCfg\n\n    constructor() {\n        super()\n        this.gameLayer = this.addLayer(new GameLayer(), 0)\n        this.selectionLayer = this.addLayer(new SelectionLayer(), 10)\n        this.guiLayer = this.addLayer(new GuiMainLayer(), 20)\n        this.overlayLayer = this.addLayer(new OverlayLayer(), 30)\n        this.worldManager = new WorldManager(this.gameLayer.canvas)\n        this.gameLayer.setWorldManager(this.worldManager)\n        this.selectionLayer.setWorldManager(this.worldManager)\n        this.jobSupervisor = new Supervisor(this.worldManager)\n        // link layer\n        this.guiLayer.onOptionsShow = () => this.overlayLayer.panelOptions.show()\n        this.overlayLayer.panelBriefing.messagePanel = this.guiLayer.panelMessages\n        this.overlayLayer.panelPause.onAbortGame = () => this.onLevelEnd && this.onLevelEnd()\n        this.overlayLayer.panelPause.onRestartGame = () => this.restartLevel()\n    }\n\n    startLevel(levelName) {\n        this.levelName = levelName\n        this.levelConf = ResourceManager.getResource('Levels').levelsByName[this.levelName]\n        if (!this.levelConf) throw 'Could not find level configuration for \"' + this.levelName + '\"'\n        this.setupAndStartLevel()\n    }\n\n    restartLevel() {\n        this.hide()\n        GameState.reset()\n        this.setupAndStartLevel()\n    }\n\n    private setupAndStartLevel() {\n        console.log('Starting level ' + this.levelName + ' - ' + this.levelConf.fullName)\n        this.worldManager.setup(this.levelConf, this)\n        const objectiveText: LevelObjectiveTextEntry = iGet(ResourceManager.getResource(this.levelConf.objectiveText), this.levelName)\n        this.guiLayer.reset()\n        this.overlayLayer.setup(objectiveText.objective, this.levelConf.objectiveImage640x480)\n        this.show()\n    }\n\n    show() {\n        super.show()\n        this.worldManager.start()\n        this.jobSupervisor.start()\n    }\n\n    hide() {\n        this.worldManager.stop()\n        this.jobSupervisor.stop()\n        super.hide()\n    }\n\n    resize(width: number, height: number) {\n        super.resize(width, height)\n        if (this.worldManager) this.worldManager.resize(width, height)\n    }\n\n}\n","import { ResourceManager } from '../resource/ResourceManager'\nimport { MainMenuBaseItem } from './MainMenuBaseItem'\n\nexport class RewardScreenButton extends MainMenuBaseItem {\n\n    imgNormal: HTMLCanvasElement\n    imgHover: HTMLCanvasElement\n    imgPressed: HTMLCanvasElement\n    imgDisabled: HTMLCanvasElement\n    disabled: boolean = false\n    visible: boolean = true\n\n    constructor(conf: any) {\n        super()\n        let imgNormalFilepath, imgHoverFilepath, imgPressedFilepath, imgDisabledFilepath;\n        [imgNormalFilepath, imgHoverFilepath, imgPressedFilepath, imgDisabledFilepath, this.x, this.y] = conf\n        this.imgNormal = ResourceManager.getImage(imgNormalFilepath)\n        this.imgHover = ResourceManager.getImage(imgHoverFilepath)\n        this.imgPressed = ResourceManager.getImage(imgPressedFilepath)\n        this.imgDisabled = ResourceManager.getImage(imgDisabledFilepath)\n        this.width = this.imgNormal.width\n        this.height = this.imgNormal.height\n    }\n\n    draw(context: CanvasRenderingContext2D) {\n        super.draw(context)\n        if (!this.visible) return\n        let img = this.imgNormal\n        if (this.disabled) {\n            img = this.imgDisabled\n        } else if (this.pressed) {\n            img = this.imgPressed\n        } else if (this.hover) {\n            img = this.imgHover\n        }\n        context.drawImage(img, this.x, this.y)\n    }\n\n}\n","import { BaseScreen } from './BaseScreen'\nimport { ResourceManager } from '../resource/ResourceManager'\nimport { ScaledLayer } from './ScreenLayer'\nimport { RewardCfg } from '../cfg/RewardCfg'\nimport { GameResultState, GameState } from '../game/model/GameState'\nimport { BitmapFont } from '../core/BitmapFont'\nimport { RewardScreenButton } from '../menu/RewardScreenButton'\nimport { MOUSE_BUTTON, POINTER_EVENT } from '../event/EventTypeEnum'\nimport { clearTimeoutSafe } from '../core/Util'\n\nexport class RewardScreen extends BaseScreen {\n\n    onAdvance: () => void\n    cfg: RewardCfg = null\n    titleFont: BitmapFont\n    resultsLayer: ScaledLayer\n    descriptionTextLayer: ScaledLayer\n    btnLayer: ScaledLayer\n    resultIndex: number = 0\n    resultLastIndex: number = 0\n    images: { img: HTMLCanvasElement, x: number, y: number }[] = []\n    boxes: { img: HTMLCanvasElement, x: number, y: number }[] = []\n    fonts = {}\n    texts: HTMLCanvasElement[] = []\n    uncoverTimeout = null\n    btnSave: RewardScreenButton\n    btnAdvance: RewardScreenButton\n\n    constructor() {\n        super()\n        this.cfg = ResourceManager.getResource('Reward')\n        this.titleFont = ResourceManager.getBitmapFont(this.cfg.titleFont)\n        const backgroundImg = ResourceManager.getImage(this.cfg.wallpaper)\n        const backgroundLayer = this.addLayer(new ScaledLayer())\n        backgroundLayer.onRedraw = (context) => context.drawImage(backgroundImg, 0, 0)\n        this.cfg.images.forEach((img) => {\n            this.images.push({img: ResourceManager.getImage(img.filePath), x: img.x, y: img.y})\n        })\n        this.cfg.boxImages.forEach((img) => {\n            this.boxes.push({img: ResourceManager.getImage(img.filePath), x: img.x, y: img.y})\n        })\n        Object.keys(this.cfg.fonts).forEach((fontKey, index) => {\n            const font = ResourceManager.getBitmapFont(this.cfg.fonts[fontKey])\n            this.fonts[fontKey.toLowerCase()] = font\n            const txt = this.cfg.texts[index]\n            const labelFont = index < 9 ? font : ResourceManager.getBitmapFont(this.cfg.backFont)\n            this.texts.push(labelFont.createTextImage(txt.text))\n        })\n        this.resultsLayer = this.addLayer(new ScaledLayer())\n        this.resultsLayer.handlePointerEvent = ((eventType) => {\n            if (eventType === POINTER_EVENT.UP) {\n                this.uncoverTimeout = clearTimeoutSafe(this.uncoverTimeout)\n                this.uncoverTimeout = null\n                this.resultIndex = this.resultLastIndex\n                this.btnSave.visible = true\n                this.btnAdvance.visible = true\n                this.redraw()\n                return true\n            }\n            return false\n        })\n        this.descriptionTextLayer = this.addLayer(new ScaledLayer(), 20)\n        this.btnLayer = this.addLayer(new ScaledLayer(), 50)\n        this.btnSave = new RewardScreenButton(this.cfg.saveButton)\n        this.btnSave.disabled = true\n        this.btnAdvance = new RewardScreenButton(this.cfg.advanceButton)\n        this.btnLayer.handlePointerEvent = ((eventType, event) => {\n            if (eventType === POINTER_EVENT.MOVE) {\n                const [sx, sy] = this.btnLayer.toScaledCoords(event.clientX, event.clientY)\n                this.btnSave.checkHover(sx, sy)\n                this.btnAdvance.checkHover(sx, sy)\n            } else if (eventType === POINTER_EVENT.DOWN) {\n                if (event.button === MOUSE_BUTTON.MAIN) {\n                    this.btnSave.checkSetPressed()\n                    this.btnAdvance.checkSetPressed()\n                }\n            } else if (eventType === POINTER_EVENT.UP) {\n                if (event.button === MOUSE_BUTTON.MAIN) {\n                    if (this.btnSave.pressed) {\n                        this.btnSave.setReleased()\n                        // TODO switch to save screen\n                    } else if (this.btnAdvance.pressed) {\n                        this.btnAdvance.setReleased()\n                        this.hide()\n                        this.onAdvance()\n                    }\n                }\n            }\n            if (this.btnSave.needsRedraw || this.btnAdvance.needsRedraw) this.redraw()\n            return false\n        })\n        this.btnLayer.onRedraw = (context) => {\n            this.btnSave.draw(context)\n            this.btnAdvance.draw(context)\n        }\n    }\n\n    show() {\n        this.resultIndex = 0\n        this.btnSave.visible = false\n        this.btnAdvance.visible = false\n        this.uncoverResult()\n        const levelFullNameImg = this.titleFont.createTextImage(GameState.levelFullName)\n        let resultText = this.cfg.quitText\n        this.resultLastIndex = this.images.length - 2\n        if (GameState.resultState === GameResultState.COMPLETE) {\n            resultText = this.cfg.completeText\n            this.resultLastIndex = this.images.length - 1\n        } else if (GameState.resultState === GameResultState.FAILED) {\n            resultText = this.cfg.failedText\n        }\n        const resultValues = []\n        resultValues.push(this.fonts['crystals'].createTextImage(this.percentString(GameState.numCrystal, GameState.neededCrystals)))\n        resultValues.push(this.fonts['ore'].createTextImage(this.percentString(GameState.numOre, GameState.totalOres)))\n        resultValues.push(this.fonts['diggable'].createTextImage(this.percentString(GameState.remainingDiggables, GameState.totalDiggables, true)))\n        resultValues.push(this.fonts['constructions'].createTextImage(GameState.buildings.length.toString()))\n        resultValues.push(this.fonts['caverns'].createTextImage(this.percentString(GameState.discoveredCaverns, GameState.totalCaverns)))\n        resultValues.push(this.fonts['figures'].createTextImage(this.percentString(GameState.raiders.length, GameState.getMaxRaiders())))\n        resultValues.push(this.fonts['rockmonsters'].createTextImage(this.percentString(0))) // TODO show defence report, is either 0% or 100%\n        resultValues.push(this.fonts['oxygen'].createTextImage(this.percentString(GameState.airlevel)))\n        resultValues.push(this.fonts['timer'].createTextImage(this.timeString(GameState.gameTimeSeconds)))\n        resultValues.push(this.fonts['score'].createTextImage(this.percentString(GameState.score)))\n        const gameResultTextImg = this.titleFont.createTextImage(resultText)\n        this.resultsLayer.onRedraw = (context) => {\n            context.clearRect(0, 0, this.resultsLayer.fixedWidth, this.resultsLayer.fixedHeight)\n            for (let c = 0; c <= this.resultIndex; c++) {\n                const img = this.images[c]\n                if (img) context.drawImage(img.img, img.x, img.y)\n            }\n            for (let c = 0; c <= this.resultIndex; c++) {\n                const box = this.boxes[c]\n                if (box) context.drawImage(box.img, box.x, box.y)\n            }\n            for (let c = 0; c <= this.resultIndex; c++) {\n                const txt = this.cfg.texts[c]\n                const text = resultValues[c]\n                if (text) context.drawImage(text, txt.x - text.width / 2, txt.y)\n            }\n            context.drawImage(levelFullNameImg, this.resultsLayer.fixedWidth / 2 - levelFullNameImg.width / 2, this.cfg.vertSpacing - levelFullNameImg.height / 2)\n            context.drawImage(gameResultTextImg, this.resultsLayer.fixedWidth / 2 - gameResultTextImg.width / 2, this.cfg.vertSpacing + levelFullNameImg.height / 2)\n        }\n        this.descriptionTextLayer.onRedraw = (context) => {\n            const descriptionTextImg = this.texts[this.resultIndex]\n            context.clearRect(0, this.cfg.textPos[1], this.descriptionTextLayer.fixedWidth, this.descriptionTextLayer.fixedHeight - this.cfg.textPos[1])\n            const tx = this.resultIndex !== this.images.length - 1 ? this.cfg.textPos[0] : 305\n            const ty = this.resultIndex !== this.images.length - 1 ? this.cfg.textPos[1] : 195\n            context.drawImage(descriptionTextImg, tx - descriptionTextImg.width / 2, ty)\n        }\n        super.show()\n    }\n\n    percentString(actual, max = 1, lessIsMore: boolean = false) {\n        if (max === 0) max = 1\n        let value = Math.round(Math.max(Math.min(actual / max, 1), 0) * 100)\n        if (lessIsMore) value = 100 - value\n        return value.toString() + '%'\n    }\n\n    padLeft(value: string, padding = '0', length = 2) {\n        while (value.length < length) value = padding + value\n        return value\n    }\n\n    timeString(seconds: number) {\n        const ss = this.padLeft((seconds % 60).toString())\n        const minutes = Math.floor(seconds / 60)\n        const mm = this.padLeft(((minutes % 60).toString()))\n        const hh = this.padLeft((Math.floor(minutes / 60).toString()))\n        return hh + ':' + mm + ':' + ss\n    }\n\n    uncoverResult() {\n        this.uncoverTimeout = setTimeout(() => {\n            this.uncoverTimeout = null\n            this.resultIndex++\n            if (this.resultIndex < this.resultLastIndex) {\n                this.uncoverResult()\n            } else {\n                this.btnSave.visible = true\n                this.btnAdvance.visible = true\n            }\n            this.redraw()\n        }, this.cfg.timer * 1000)\n    }\n\n}\n","import { ResourceManager } from './resource/ResourceManager'\nimport { LoadingScreen } from './screen/LoadingScreen'\nimport { MainMenuScreen } from './screen/MainMenuScreen'\nimport { GameScreen } from './screen/GameScreen'\nimport { RewardScreen } from './screen/RewardScreen'\nimport { GameState } from './game/model/GameState'\nimport { WadFileSelectionModal } from '../site/modal/WadFileSelectionModal'\n\n// define constants\n\nexport const DEV_MODE = process.env.WEBPACK_MODE === 'development'\nif (DEV_MODE) console.warn('DEV MODE ACTIVE')\n\nexport const JOB_SCHEDULE_INTERVAL = 1000 // milliseconds\nexport const CHECK_CLEARRUBBLE_INTERVAL = 5000 // milliseconds\nexport const JOB_ACTION_RANGE = 5\nexport const CHECK_SPANW_RAIDER_TIMER = 1000 // milliseconds\nexport const MAX_RAIDER_BASE = 12\nexport const MAX_RAIDER_REQUEST = 9\nexport const ADDITIONAL_RAIDER_PER_SUPPORT = 10\nexport const UPDATE_OXYGEN_TIMER = 5000 // milliseconds\n\nexport const PANEL_ANIMATION_MULTIPLIER = 3\nexport const HEIGHT_MULTIPLER = 0.1\nexport const SEQUENCE_TEXTURE_FRAMERATE = 5\n\n// native constants (do not change)\n\nexport const SPRITE_RESOLUTION_WIDTH = 640\nexport const SPRITE_RESOLUTION_HEIGHT = 480\nexport const TILESIZE = 40\nexport const NATIVE_FRAMERATE = 30\n\n// setup and link all components\n\nconst loadingScreen = new LoadingScreen()\nconst wadfileSelectModal = new WadFileSelectionModal('game-container')\n\nwadfileSelectModal.onStart = (wad0Url, wad1Url) => {\n    ResourceManager.startLoadingFromUrl(wad0Url, wad1Url)\n}\nResourceManager.onMessage = (msg: string) => {\n    loadingScreen.setLoadingMessage(msg)\n}\nResourceManager.onCacheMissed = () => {\n    wadfileSelectModal.show()\n}\nResourceManager.onInitialLoad = (totalResources: number) => {\n    wadfileSelectModal.hide()\n    loadingScreen.enableGraphicMode(totalResources)\n}\nResourceManager.onAssetLoaded = () => {\n    loadingScreen.increaseLoadingState()\n}\nResourceManager.onLoadDone = () => {\n    // complete setup\n    const mainMenuScreen = new MainMenuScreen()\n    const gameScreen = new GameScreen()\n    const rewardScreen = new RewardScreen()\n\n    mainMenuScreen.onLevelSelected = (levelName) => {\n        try {\n            gameScreen.startLevel(levelName)\n        } catch (e) {\n            console.error('Could not load level: ' + levelName, e)\n            gameScreen.hide()\n            mainMenuScreen.showLevelSelection()\n        }\n    }\n    gameScreen.onLevelEnd = () => {\n        gameScreen.hide()\n        rewardScreen.show()\n    }\n    rewardScreen.onAdvance = () => {\n        GameState.reset()\n        mainMenuScreen.showLevelSelection()\n    }\n\n    // setup complete\n    loadingScreen.hide()\n    const params = new URLSearchParams(window.location.search)\n    const entry = params.get('entry')\n    if (DEV_MODE && entry) {\n        GameState.numOre = Number(params.get('numOre')) || 0\n        GameState.numCrystal = Number(params.get('numCrystal')) || 0\n        if (entry === 'level') mainMenuScreen.showLevelSelection()\n        else if (entry === 'reward') rewardScreen.show()\n        else if (entry) mainMenuScreen.selectLevel(entry)\n    } else {\n        mainMenuScreen.showMainMenu()\n    }\n}\n\n// start the game engine with loading resources\n\nloadingScreen.show()\nResourceManager.startLoadingFromCache()\n"],"sourceRoot":""}