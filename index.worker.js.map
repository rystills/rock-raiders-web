{"version":3,"sources":["webpack://rock-raiders-web/./src/resource/wadworker/EncodingHelper.js","webpack://rock-raiders-web/./src/resource/wadworker/CfgFileParser.ts","webpack://rock-raiders-web/./src/resource/wadworker/WadFile.ts","webpack://rock-raiders-web/./src/resource/wadworker/WadUtil.ts","webpack://rock-raiders-web/./src/resource/wadworker/RonFile.ts","webpack://rock-raiders-web/./src/resource/wadworker/AlphaBitmapDecoder.ts","webpack://rock-raiders-web/./src/game/model/job/PriorityIdentifier.ts","webpack://rock-raiders-web/./src/cfg/BaseConfig.ts","webpack://rock-raiders-web/./src/cfg/MenuLabelItemCfg.ts","webpack://rock-raiders-web/./src/cfg/MenuSliderItemCfg.ts","webpack://rock-raiders-web/./src/cfg/MenuCycleItemCfg.ts","webpack://rock-raiders-web/./src/cfg/MenuEntryCfg.ts","webpack://rock-raiders-web/./src/cfg/MenuCfg.ts","webpack://rock-raiders-web/./src/cfg/ConfigColor.ts","webpack://rock-raiders-web/./src/cfg/ObjectiveImageCfg.ts","webpack://rock-raiders-web/./src/core/Util.ts","webpack://rock-raiders-web/./src/resource/wadworker/ObjectiveTextParser.ts","webpack://rock-raiders-web/./src/cfg/LevelsCfg.ts","webpack://rock-raiders-web/./src/cfg/RewardCfg.ts","webpack://rock-raiders-web/./src/resource/wadworker/WorkerMessage.ts","webpack://rock-raiders-web/./src/resource/wadworker/WadLoader.ts","webpack://rock-raiders-web/./src/resource/wadworker/Resources.ts"],"names":["encodeChar","c","parse","buffer","result","ancestry","activeObject","isComment","keyVal","key","value","seek","length","charCode","charStr","String","fromCharCode","pop","push","parsed","CfgFileParser","parseValue","hasOwnProperty","stack","obj","Object","keys","forEach","val","Array","isArray","sub","values","levelConf","replace","splitShrink","sep","split","filter","map","num","Number","isNaN","lVal","toString","toLowerCase","includes","call","this","entryIndexByName","Map","fLength","fStart","parseWadFile","data","debug","dataView","DataView","Int8Array","pos","apply","slice","console","log","numberOfEntries","getInt32","bufferStart","i","set","getEntryData","entryName","Uint8Array","getEntryBuffer","getEntryText","TextDecoder","decode","index","get","filterEntryNames","regexStr","regex","RegExp","entry","match","getPath","url","strUrl","startsWith","substring","lastInd","lastIndexOf","getFilename","iGet","keyname","HeaderTypes","content","lines","l","indDoubleSlash","indexOf","indComment","trim","v","root","RonFile","parseObj","start","lv","PriorityIdentifier","toRGBA","bufferView","byteOffset","byteLength","bottomUp","flag","Error","locRed","locGreen","locBlue","locAlpha","parseHeader","parseRGBA","fileSize","readUInt32LE","reserved1","getUint16","reserved2","offset","headerSize","width","height","planes","bitPP","compression","rawSize","hr","vr","colors","importantColors","maskAlpha","maskRed","maskGreen","maskBlue","BITMAP_INFO_HEADER","BITMAP_V2_INFO_HEADER","BITMAP_V3_INFO_HEADER","BITMAP_V4_HEADER","BITMAP_V5_HEADER","len","palette","blue","green","red","quad","maskRedR","maskGreenR","maskBlueR","maskAlphaR","shiftedMaskRedL","shiftedMaskGreenL","shiftedMaskBlueL","shiftedMaskAlphaL","coloShift","shiftRed","x","shiftGreen","shiftBlue","shiftAlpha","bit1","bit4","bit8","bit16","bit24","bit32","lastLine","xLen","Math","ceil","mode","padding","scanImage","line","b","location","rgb","fill","lowNibble","a","y","setPixelData","first4","last4","loc","px","processPixel","getUint32","rgbIndex","decoder","BmpDecoder","Uint8ClampedArray","ImageData","setFromCfg","config","cfgObj","cfgKey","lCfgKeyName","some","objKey","assignValue","warn","cfgValue","currentValue","currentIsArray","parsedValue","parsedIsArray","actionName","label","target","join","imgNormal","imgHover","imgPressed","tooltip","description","min","max","imgOff","imgOn","imgLeft","imgRight","btnRightNormal","btnLeftNormal","btnRightHover","btnLeftHover","two","labelOff","labelOn","fullName","title","position","menuFont","loFont","hiFont","itemCount","menuImage","autoCenter","displayTitle","overlays","playRandom","itemsLabel","itemsSlider","itemsCycle","anchored","canScroll","BaseConfig","lActionName","MenuLabelItemCfg","MenuSliderItemCfg","MenuCycleItemCfg","menuCount","menus","MenuEntryCfg","r","g","filename","prototype","remove","element","splice","getOrUpdate","updateCallback","undefined","PARSING_STATE","levelsByName","levelKey","LevelEntryCfg","endGameAvi1","endGameAvi2","allowRename","recallOLObjects","generateSpiders","video","disableEndTeleport","disableStartTeleport","emergeTimeOut","boulderAnimation","noMultiSelect","noAutoEat","disableToolTipSound","blockSize","digDepth","roughLevel","roofHeight","useRoof","selBoxHeight","fpRotLightRGB","fogColourRGB","highFogColourRGB","fogRate","fallinMultiplier","numberOfLandSlidesTillCaveIn","noFallins","oxygenRate","surfaceMap","predugMap","terrainMap","emergeMap","erodeMap","fallinMap","blockPointersMap","cryOreMap","pathMap","noGather","textureSet","rockFallStyle","emergeCreature","safeCaverns","seeThroughWalls","oListFile","ptlFile","nerpFile","nerpMessageFile","objectiveText","objectiveImage640x480","erodeTriggerTime","erodeErodeTime","erodeLockTime","nextLevel","levelLinks","frontEndX","frontEndY","frontEndOpen","priorities","reward","menuBMP","endsWith","ConfigColor","name","LevelPrioritiesEntryConfig","LevelRewardConfig","ObjectiveImageCfg","enabled","enable","modifier","importance","quota","LevelRewardImportanceConfig","LevelRewardQuotaConfig","crystals","timer","caverns","constructions","oxygen","figures","display","wallpaper","images","texts","boxImages","fonts","flics","scrollSpeed","centreText","vertSpacing","backFont","font","titleFont","saveButton","advanceButton","completeText","failedText","quitText","textPos","imgConf","RewardImageCfg","RewardTextCfg","RewardFontsCfg","filePath","text","ore","diggable","rockMonsters","score","parseObjectiveTextFile","txtFileContent","state","DROP","currentLevel","code","char","LevelObjectiveTextEntry","KEY","lLine","OBJECTIVE","FAILURE","COMPLETION","CRYSTAL_FAILURE","charCodeAt","objective","failure","completion","crystalFailure","WorkerMessageType","wad0File","wad1File","assetIndex","totalResources","assetsFromCfgByName","onMessage","msg","onInitialLoad","onAssetLoaded","onLoadDone","loadingTimeSeconds","loadWadImageAsset","callback","AlphaBitmapDecoder","loadWadTexture","imgData","isTranslucentTexture","n","isAlphaTexture","alpha","loadAlphaImageAsset","loadFontImageAsset","loadNerpAsset","loadNerpMsg","parseNerpMsgFile","msg1","m1","txt","snd","wadFile","txt0Match","txt1Match","sndMatch","numericNameToNumber","digits","one","three","four","five","six","seven","eight","nine","tens","twenty","thirty","forty","number","ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen","digitName","loadObjectiveTexts","txtContent","ObjectiveTextParser","loadMapAsset","level","row","loadObjectListAsset","objectList","currentObject","objectStartMatch","drivingMatch","driving","parseFloat","loadWavAsset","path","error","loadLWOFile","lwoFilepath","lwoContent","e","registerAllAssets","mainConf","addAssetFolder","addMenuWithAssets","addAsset","addAlphaImageFolder","levelsCfg","LevelsCfg","bmpName","addTextureFolder","buildingTypes","bType","bName","aeFile","addAnimatedEntity","addLWSFile","rewardCfg","RewardCfg","imgPath","img","cfgRoot","polyType","cfgPoly","activities","activity","act","file","lwsFilepath","extractLwoFiles","lwoFile","objLine","folderPath","assetPath","menuImageAlpha","menuCfg","MenuCfg","method","optional","bind","loadAssetsParallel","promises","that","asset","Promise","resolve","assetObj","all","then","Date","getTime","startTime","toFixed","startWithCachedFiles","onCacheMiss","_onerror","openLocalCache","objectStore","request1","onerror","onsuccess","prop","WadFile","request2","startLoadingProcess","loadWadFiles","wad0Url","wad1Url","loadWadFile","wadFiles","put","fetch","response","ok","arrayBuffer","catch","onopen","request","indexedDB","open","onupgradeneeded","db","objectStoreNames","contains","deleteObjectStore","createObjectStore","transaction","cfg","size","type","createTextMessage","MSG","createCfgLoaded","CFG","createAssetLoaded","assetName","ASSET","createLoadDone","DONE","resourceWorker","self","postMessage","assetMessage","addEventListener","event","wadLoader","WadLoader","WorkerMessage","wad0FileUrl","wad1FileUrl","CACHE_MISS"],"mappings":"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","file":"index.worker.js","sourcesContent":["export const encodeChar = []\n\nfor (let c = 0; c < 256; c++) {\n    encodeChar[c] = c\n}\nencodeChar[130] = 0x00E4 // ä\nencodeChar[142] = 0x00C4 // Ä\nencodeChar[162] = 0x00F6 // ö\nencodeChar[167] = 0x00DC // Ü\nencodeChar[171] = 0x00FC // ü\nencodeChar[195] = 0x00DF // ß\n","import { encodeChar } from './EncodingHelper'\n\nexport class CfgFileParser {\n\n    static parse(buffer): any {\n        const result = {}\n        const ancestry = []\n        let activeObject = result\n        let isComment = false\n        let keyVal = 0 // 0 = looking for key, 1 = inside key, 1 = looking for value, 2 = inside value\n        let key = ''\n        let value = ''\n        // debug output is a bad idea here, buffer size is about 232.611 characters and has 6781 lines\n        for (let seek = 0; seek < buffer.length; seek++) {\n            let charCode = buffer[seek]\n            if (charCode === 123 && key === 'FullName') { // dirty workaround but in the original file { (123) was used instead of Ä (142)\n                charCode = 142\n            }\n            let charStr = String.fromCharCode(encodeChar[charCode])\n            if (charStr === ';' || charStr === '/') { // someone used // as a marker for a comment\n                isComment = true\n            } else if (charCode === 10 || charCode === 13) {\n                isComment = false\n            }\n            if (!isComment) {\n                if (charCode > 32) { // not a whitespace\n                    if (keyVal === 0) { // looking for key\n                        if (charStr === '}') {\n                            activeObject = ancestry.pop()\n                        } else {\n                            keyVal++\n                            key = charStr\n                        }\n                    } else if (keyVal === 1) { // inside key\n                        key += charStr\n                    } else if (keyVal === 2) { // looking for value\n                        if (charStr === '{') { // start of a new object key is identifier\n                            ancestry.push(activeObject)\n                            activeObject = {}\n                            ancestry[ancestry.length - 1][key] = activeObject\n                            keyVal = 0 // start looking for a key again\n                        } else {\n                            keyVal++\n                            value = charStr\n                        }\n                    } else if (keyVal === 3) { // inside value\n                        value += charStr\n                    }\n                } else { // some whitespace\n                    if (keyVal === 1) {\n                        keyVal++\n                    } else if (keyVal === 3) {\n                        keyVal = 0\n                        const parsed = CfgFileParser.parseValue(value)\n                        if (activeObject.hasOwnProperty(key)) {\n                            activeObject[key].push(parsed)\n                        } else {\n                            activeObject[key] = [parsed]\n                        }\n                    }\n                }\n            }\n        }\n\n        const stack = [result]\n        while (stack.length > 0) {\n            const obj = stack.pop()\n            Object.keys(obj).forEach((key) => {\n                const val = obj[key]\n                if (Array.isArray(val)) {\n                    if (val.length === 1) {\n                        obj[key] = val[0]\n                    } else {\n                        val.forEach((sub) => stack.push(sub))\n                    }\n                } else if (Object.keys(val).length > 1) {\n                    stack.push(val)\n                }\n            })\n        }\n\n        // apply some patches here\n        Object.values(result['Lego*']['Levels']).forEach((levelConf) => {\n            if (levelConf['CryoreMap']) {\n                levelConf['CryOreMap'] = levelConf['CryoreMap']  // typos... typos everywhere\n                delete levelConf['CryoreMap']\n            }\n            if (levelConf['CryOreMap']) {\n                levelConf['CryOreMap'] = levelConf['CryOreMap'].replace('Cryo_', 'Cror_')\n            }\n            if (levelConf['PredugMap']) {\n                levelConf['PreDugMap'] = levelConf['PredugMap']\n                delete levelConf['PredugMap']\n            }\n        })\n\n        return result['Lego*']\n    }\n\n    static parseValue(val) {\n        function splitShrink(sep) {\n            val = val.split(sep).filter(val => val !== '').map(val => CfgFileParser.parseValue(val))\n            if (val.length === 0) {\n                val = ''\n            } else if (val.length === 1) {\n                val = val[0]\n            }\n        }\n\n        const num = Number(val)\n        if (isNaN(num)) {\n            val = val.toString().replace(/\\\\/g, '/')\n            const lVal = val.toLowerCase()\n            if (lVal === 'true') return true\n            if (lVal === 'false') return false\n            if (lVal === 'null') return ''\n            if (val.includes(':')) {\n                splitShrink.call(this, ':')\n            } else if (val.includes(',')) { // TODO improve cfg handling: what about strings\n                splitShrink.call(this, ',')\n            } else if (val.includes('|')) {\n                splitShrink.call(this, '|')\n            }\n            return val\n        } else {\n            return num\n        }\n    }\n\n}\n","import { encodeChar } from './EncodingHelper'\n\n/**\n * Handles the extraction of single files from a bigger WAD data blob\n */\nexport class WadFile {\n\n    buffer: Int8Array = null\n    entryIndexByName: Map<string, number> = new Map()\n    fLength: number[] = []\n    fStart: number[] = []\n\n    /**\n     * Validate and parse the given data object as binary blob of a WAD file\n     * @param data binary blob\n     * @param debug enable/disable debug output while parsing\n     */\n    parseWadFile(data, debug = false) {\n        const dataView = new DataView(data)\n        this.buffer = new Int8Array(data)\n        let pos = 0\n        if (String.fromCharCode.apply(null, this.buffer.slice(pos, 4)) !== 'WWAD') {\n            throw 'Invalid WAD0 file provided'\n        }\n        if (debug) {\n            console.log('WAD0 file seems legit')\n        }\n        pos = 4\n        const numberOfEntries = dataView.getInt32(pos, true)\n        if (debug) {\n            console.log(numberOfEntries)\n        }\n        pos = 8\n\n        let bufferStart = pos\n        for (let i = 0; i < numberOfEntries; pos++) {\n            if (this.buffer[pos] === 0) {\n                this.entryIndexByName.set(String.fromCharCode.apply(null, this.buffer.slice(bufferStart, pos)).replace(/\\\\/g, '/').toLowerCase(), i)\n                bufferStart = pos + 1\n                i++\n            }\n        }\n\n        if (debug) {\n            console.log(this.entryIndexByName)\n        }\n\n        for (let i = 0; i < numberOfEntries; pos++) {\n            if (this.buffer[pos] === 0) {\n                bufferStart = pos + 1\n                i++\n            }\n        }\n\n        if (debug) {\n            console.log('Offset after absolute original names is ' + pos)\n        }\n\n        for (let i = 0; i < numberOfEntries; i++) {\n            this.fLength[i] = dataView.getInt32(pos + 8, true)\n            this.fStart[i] = dataView.getInt32(pos + 12, true)\n            pos += 16\n        }\n\n        if (debug) {\n            console.log(this.fLength)\n            console.log(this.fStart)\n        }\n    }\n\n    /**\n     * Returns the entries content extracted by name from the managed WAD file\n     * @param entryName Entry name to be extracted\n     * @returns {Uint8Array} Returns the content as Uint8Array\n     */\n    getEntryData(entryName): Uint8Array {\n        return new Uint8Array(this.getEntryBuffer(entryName))\n    }\n\n    /**\n     * Returns the entries content as text extracted by name from the managed WAD file\n     * @param entryName Entry name to be extracted\n     * @returns {string} Returns the content as String\n     */\n    getEntryText(entryName): string {\n        return new TextDecoder().decode(this.getEntryBuffer(entryName).map(c => encodeChar[c]))\n    }\n\n    /**\n     * Returns the entries content by name extracted from the managed WAD file\n     * @param entryName Entry name to be extracted\n     * @returns {Int8Array} Returns the content as buffer slice\n     */\n    getEntryBuffer(entryName): Int8Array {\n        const index = this.entryIndexByName.get(entryName.toLowerCase())\n        if (index === undefined || index === null) {\n            throw 'Entry \\'' + entryName + '\\' not found in WAD file'\n        }\n        return this.buffer.slice(this.fStart[index], this.fStart[index] + this.fLength[index])\n    }\n\n    filterEntryNames(regexStr) {\n        const regex = new RegExp(regexStr.toLowerCase())\n        const result = []\n        this.entryIndexByName.forEach((index, entry) => {\n            if (entry.match(regex)) result.push(entry)\n        })\n        return result\n    }\n\n}\n","export function getPath(url: string): string {\n    if (!url) return url\n    let strUrl = url.toString().replace(/\\\\/g, '/')\n    if (strUrl.startsWith('/')) strUrl = strUrl.substring(1)\n    const lastInd = strUrl.lastIndexOf('/')\n    strUrl = strUrl.substring(0, lastInd + 1)\n    if (strUrl.startsWith('/')) strUrl = strUrl.substring(1)\n    return strUrl\n}\n\nexport function getFilename(url: string): string {\n    if (!url) return url\n    let strUrl = url.toString().replace(/\\\\/g, '/')\n    if (strUrl.startsWith('/')) strUrl = strUrl.substring(1)\n    const lastInd = strUrl.lastIndexOf('/')\n    return strUrl.substring(lastInd + 1)\n}\n\nexport function iGet(obj, ...keys: string[]): any {\n    keys.forEach((keyname) => {\n        obj = Object.keys(obj)\n            .filter((key) => key.toLowerCase() === keyname.toLowerCase())\n            .map((key) => obj[key])\n        obj = obj ? obj[0] : obj\n    })\n    return obj\n}\n","// The RockRaidersObjectNotation (RON) format is related to JSON\n\nexport class RonFile {\n\n    static parse(content: string) {\n        const lines: string[][] = content.replace(/\\r\\n/g, '\\n').replace(/\\r/g, '\\n') // normalize newlines\n            .replace(/\\t/g, ' ') // tabs to spaces\n            .split('\\n')\n            .map((l) => { // strip comments from each line\n                const indDoubleSlash = l.indexOf('//')\n                if (indDoubleSlash > -1) l = l.substring(0, indDoubleSlash)\n                const indComment = l.indexOf(';')\n                if (indComment > -1) l = l.substring(0, indComment)\n                return l\n            })\n            .map((l) => { // remove whitespace at start/end of lines\n                l = l.trim()\n                return l\n            })\n            .filter(l => l !== '') // filter empty lines\n            .map((v) => v.split(' ').filter(v => v !== ''))\n        const root = {}\n        RonFile.parseObj(root, lines, 0)\n        return root\n    }\n\n    static parseObj(obj: {}, lines: string[][], start): number {\n        for (let c = start; c < lines.length; c++) {\n            const [name, val] = lines[c]\n            const key = name.toLowerCase()\n            if (val === '{') {\n                obj[key] = {}\n                c = this.parseObj(obj[key], lines, c + 1)\n            } else if (key === '}') {\n                return c\n            } else {\n                // parse values\n                let value: any = val.split(':').filter(v => v !== '') // there is key::value\n                    .map(v => v.split(',').map(v => v.split('|').map(v => this.parseValue(v))))\n                while (value.length === 1) value = value[0] // replace arrays with only one value\n                obj[key] = value\n            }\n        }\n        return lines.length\n    }\n\n    static parseValue(value: string) {\n        const num = Number(value)\n        const lv = value.toLowerCase()\n        if (!isNaN(num)) {\n            return num\n        } else if (lv === 'false') {\n            return false\n        } else if (lv === 'true') {\n            return true\n        } else {\n            return value\n        }\n    }\n\n}\n","/**\n * Source: https://github.com/wokwi/bmp-ts\n */\n\nenum HeaderTypes {\n    BITMAP_INFO_HEADER = 40,\n    BITMAP_V2_INFO_HEADER = 52,\n    BITMAP_V3_INFO_HEADER = 56,\n    BITMAP_V4_HEADER = 108,\n    BITMAP_V5_HEADER = 124\n}\n\n// We have these:\n//\n// const sample = 0101 0101 0101 0101\n// const mask   = 0111 1100 0000 0000\n// 256        === 0000 0001 0000 0000\n//\n// We want to take the sample and turn it into an 8-bit value.\n//\n// 1. We extract the last bit of the mask:\n//\n// 0000 0100 0000 0000\n//       ^\n//\n// Like so:\n//\n// const a = ~mask =    1000 0011 1111 1111\n// const b = a + 1 =    1000 0100 0000 0000\n// const c = b & mask = 0000 0100 0000 0000\n//\n// 2. We shift it to the right and extract the bit before the first:\n//\n// 0000 0000 0010 0000\n//             ^\n//\n// Like so:\n//\n// const d = mask / c = 0000 0000 0001 1111\n// const e = mask + 1 = 0000 0000 0010 0000\n//\n// 3. We apply the mask and the two values above to a sample:\n//\n// const f = sample & mask = 0101 0100 0000 0000\n// const g = f / c =         0000 0000 0001 0101\n// const h = 256 / e =       0000 0000 0000 0100\n// const i = g * h =         0000 0000 1010 1000\n//                                     ^^^^ ^\n//\n// Voila, we have extracted a sample and \"stretched\" it to 8 bits. For samples\n// which are already 8-bit, h === 1 and g === i.\n\nfunction maskColor(\n    maskRed: number,\n    maskGreen: number,\n    maskBlue: number,\n    maskAlpha: number,\n) {\n    const maskRedR = (~maskRed + 1) & maskRed\n    const maskGreenR = (~maskGreen + 1) & maskGreen\n    const maskBlueR = (~maskBlue + 1) & maskBlue\n    const maskAlphaR = (~maskAlpha + 1) & maskAlpha\n\n    const shiftedMaskRedL = maskRed / maskRedR + 1\n    const shiftedMaskGreenL = maskGreen / maskGreenR + 1\n    const shiftedMaskBlueL = maskBlue / maskBlueR + 1\n    const shiftedMaskAlphaL = maskAlpha / maskAlphaR + 1\n\n    return {\n        shiftRed: (x: number) =>\n            (((x & maskRed) / maskRedR) * 0x100) / shiftedMaskRedL,\n        shiftGreen: (x: number) =>\n            (((x & maskGreen) / maskGreenR) * 0x100) / shiftedMaskGreenL,\n        shiftBlue: (x: number) =>\n            (((x & maskBlue) / maskBlueR) * 0x100) / shiftedMaskBlueL,\n        shiftAlpha:\n            maskAlpha !== 0\n                ? (x: number) =>\n                (((x & maskAlpha) / maskAlphaR) * 0x100) / shiftedMaskAlphaL\n                : () => 255,\n    }\n}\n\nconst enum Compression {\n    NONE = 0,\n    BI_RLE8 = 1,\n    BI_RLE4 = 2,\n    BI_BIT_FIELDS = 3,\n    BI_ALPHA_BIT_FIELDS = 6\n}\n\ntype BitsPerPixel = 1 | 4 | 8 | 16 | 24 | 32;\n\ninterface IColor {\n    red: number;\n    green: number;\n    blue: number;\n    quad: number;\n}\n\ninterface IDecoderOptions {\n    toRGBA?: boolean;\n}\n\ninterface IImage {\n    width: number;\n    height: number;\n    bitPP: BitsPerPixel;\n    data: Uint8Array;\n    reserved1?: number;\n    reserved2?: number;\n    hr?: number;\n    vr?: number;\n    colors?: number;\n    importantColors?: number;\n    palette?: IColor[];\n}\n\ninterface IBitmapImage extends IImage {\n    flag: string;\n    fileSize: number;\n    offset: number;\n    headerSize: number;\n    planes?: number;\n    compression?: Compression;\n    rawSize: number;\n}\n\ntype IColorProcessor = (x: number, line: number) => void;\n\nclass BmpDecoder implements IBitmapImage {\n    // Header\n    public flag: string\n    public fileSize!: number\n    public reserved1!: number\n    public reserved2!: number\n    public offset!: number\n    public headerSize!: number\n    public width!: number\n    public height!: number\n    public planes!: number\n    public bitPP!: BitsPerPixel\n    public compression?: Compression\n    public rawSize!: number\n    public hr!: number\n    public vr!: number\n    public colors!: number\n    public importantColors!: number\n    public palette!: IColor[]\n    public data!: Uint8Array\n\n    private maskRed!: number\n    private maskGreen!: number\n    private maskBlue!: number\n    private maskAlpha!: number\n\n    private readonly toRGBA: boolean\n\n    private pos: number\n    private bottomUp: boolean\n    private readonly buffer: Uint8Array\n    private readonly bufferView: DataView\n\n    private readonly locRed: number\n    private readonly locGreen: number\n    private readonly locBlue: number\n    private readonly locAlpha: number\n\n    private shiftRed!: (x: number) => number\n    private shiftGreen!: (x: number) => number\n    private shiftBlue!: (x: number) => number\n    private shiftAlpha!: (x: number) => number\n\n    constructor(\n        buffer: Uint8Array,\n        {toRGBA}: IDecoderOptions = {toRGBA: false},\n    ) {\n        this.buffer = buffer\n        this.bufferView = new DataView(\n            buffer.buffer,\n            buffer.byteOffset,\n            buffer.byteLength,\n        )\n        this.toRGBA = !!toRGBA\n        this.bottomUp = true\n        this.flag = String.fromCharCode(this.buffer[0]) + String.fromCharCode(this.buffer[1])\n        this.pos = 2\n\n        if (this.flag !== 'BM') {\n            throw new Error('Invalid BMP File')\n        }\n\n        this.locRed = this.toRGBA ? 0 : 3\n        this.locGreen = this.toRGBA ? 1 : 2\n        this.locBlue = this.toRGBA ? 2 : 1\n        this.locAlpha = this.toRGBA ? 3 : 0\n\n        this.parseHeader()\n        this.parseRGBA()\n    }\n\n    private parseHeader() {\n        this.fileSize = this.readUInt32LE()\n\n        this.reserved1 = this.bufferView.getUint16(this.pos, true)\n        this.pos += 2\n        this.reserved2 = this.bufferView.getUint16(this.pos, true)\n        this.pos += 2\n\n        this.offset = this.readUInt32LE()\n\n        // End of BITMAP_FILE_HEADER\n        this.headerSize = this.readUInt32LE()\n\n        if (!(this.headerSize in HeaderTypes)) {\n            throw new Error(`Unsupported BMP header size ${this.headerSize}`)\n        }\n\n        this.width = this.readUInt32LE()\n        this.height = this.readUInt32LE()\n\n        this.planes = this.bufferView.getUint16(this.pos, true)\n        this.pos += 2\n        this.bitPP = this.bufferView.getUint16(this.pos, true) as BitsPerPixel\n        this.pos += 2\n\n        this.compression = this.readUInt32LE()\n        this.rawSize = this.readUInt32LE()\n        this.hr = this.readUInt32LE()\n        this.vr = this.readUInt32LE()\n        this.colors = this.readUInt32LE()\n        this.importantColors = this.readUInt32LE()\n\n        // De facto defaults\n\n        if (this.bitPP === 32) {\n            this.maskAlpha = 0\n            this.maskRed = 0x00ff0000\n            this.maskGreen = 0x0000ff00\n            this.maskBlue = 0x000000ff\n        } else if (this.bitPP === 16) {\n            this.maskAlpha = 0\n            this.maskRed = 0x7c00\n            this.maskGreen = 0x03e0\n            this.maskBlue = 0x001f\n        }\n\n        // End of BITMAP_INFO_HEADER\n\n        if (\n            this.headerSize > HeaderTypes.BITMAP_INFO_HEADER ||\n            this.compression === Compression.BI_BIT_FIELDS ||\n            this.compression === Compression.BI_ALPHA_BIT_FIELDS\n        ) {\n            this.maskRed = this.readUInt32LE()\n            this.maskGreen = this.readUInt32LE()\n            this.maskBlue = this.readUInt32LE()\n        }\n\n        // End of BITMAP_V2_INFO_HEADER\n\n        if (\n            this.headerSize > HeaderTypes.BITMAP_V2_INFO_HEADER ||\n            this.compression === Compression.BI_ALPHA_BIT_FIELDS\n        ) {\n            this.maskAlpha = this.readUInt32LE()\n        }\n\n        // End of BITMAP_V3_INFO_HEADER\n\n        if (this.headerSize > HeaderTypes.BITMAP_V3_INFO_HEADER) {\n            this.pos +=\n                HeaderTypes.BITMAP_V4_HEADER - HeaderTypes.BITMAP_V3_INFO_HEADER\n        }\n\n        // End of BITMAP_V4_HEADER\n\n        if (this.headerSize > HeaderTypes.BITMAP_V4_HEADER) {\n            this.pos += HeaderTypes.BITMAP_V5_HEADER - HeaderTypes.BITMAP_V4_HEADER\n        }\n\n        // End of BITMAP_V5_HEADER\n\n        if (this.bitPP <= 8 || this.colors > 0) {\n            const len = this.colors === 0 ? 1 << this.bitPP : this.colors\n            this.palette = new Array(len)\n\n            for (let i = 0; i < len; i++) {\n                const blue = this.buffer[this.pos++]\n                const green = this.buffer[this.pos++]\n                const red = this.buffer[this.pos++]\n                const quad = this.buffer[this.pos++]\n\n                this.palette[i] = {\n                    red,\n                    green,\n                    blue,\n                    quad,\n                }\n            }\n        }\n\n        // End of color table\n\n        // Can the height ever be negative?\n        if (this.height < 0) {\n            this.height *= -1\n            this.bottomUp = false\n        }\n\n        const coloShift = maskColor(\n            this.maskRed,\n            this.maskGreen,\n            this.maskBlue,\n            this.maskAlpha,\n        )\n\n        this.shiftRed = coloShift.shiftRed\n        this.shiftGreen = coloShift.shiftGreen\n        this.shiftBlue = coloShift.shiftBlue\n        this.shiftAlpha = coloShift.shiftAlpha\n    }\n\n    private parseRGBA() {\n        this.data = new Uint8Array(this.width * this.height * 4)\n\n        switch (this.bitPP) {\n            case 1:\n                this.bit1()\n                break\n            case 4:\n                this.bit4()\n                break\n            case 8:\n                this.bit8()\n                break\n            case 16:\n                this.bit16()\n                break\n            case 24:\n                this.bit24()\n                break\n            default:\n                this.bit32()\n        }\n    }\n\n    private bit1() {\n        const xLen = Math.ceil(this.width / 8)\n        const mode = xLen % 4\n        const padding = mode !== 0 ? 4 - mode : 0\n\n        let lastLine: number | undefined\n\n        this.scanImage(padding, xLen, (x, line) => {\n            if (line !== lastLine) {\n                lastLine = line\n            }\n\n            const b = this.buffer[this.pos++]\n            const location = line * this.width * 4 + x * 8 * 4\n\n            for (let i = 0; i < 8; i++) {\n                if (x * 8 + i < this.width) {\n                    const rgb = this.palette[(b >> (7 - i)) & 0x1]\n\n                    this.data[location + i * this.locAlpha] = 0\n                    this.data[location + i * 4 + this.locBlue] = rgb.blue\n                    this.data[location + i * 4 + this.locGreen] = rgb.green\n                    this.data[location + i * 4 + this.locRed] = rgb.red\n                } else {\n                    break\n                }\n            }\n        })\n    }\n\n    private bit4() {\n        if (this.compression === Compression.BI_RLE4) {\n            this.data.fill(0)\n\n            let lowNibble = false //for all count of pixel\n            let lines = this.bottomUp ? this.height - 1 : 0\n            let location = 0\n\n            while (location < this.data.length) {\n                const a = this.buffer[this.pos++]\n                const b = this.buffer[this.pos++]\n\n                //absolute mode\n                if (a === 0) {\n                    if (b === 0) {\n                        //line end\n                        lines += this.bottomUp ? -1 : 1\n                        location = lines * this.width * 4\n                        lowNibble = false\n\n                        continue\n                    }\n\n                    if (b === 1) {\n                        // image end\n                        break\n                    }\n\n                    if (b === 2) {\n                        // offset x, y\n                        const x = this.buffer[this.pos++]\n                        const y = this.buffer[this.pos++]\n\n                        lines += this.bottomUp ? -y : y\n                        location += y * this.width * 4 + x * 4\n                    } else {\n                        let c = this.buffer[this.pos++]\n\n                        for (let i = 0; i < b; i++) {\n                            location = this.setPixelData(\n                                location,\n                                lowNibble ? c & 0x0f : (c & 0xf0) >> 4,\n                            )\n\n                            if (i & 1 && i + 1 < b) {\n                                c = this.buffer[this.pos++]\n                            }\n\n                            lowNibble = !lowNibble\n                        }\n\n                        if ((((b + 1) >> 1) & 1) === 1) {\n                            this.pos++\n                        }\n                    }\n                } else {\n                    //encoded mode\n                    for (let i = 0; i < a; i++) {\n                        location = this.setPixelData(\n                            location,\n                            lowNibble ? b & 0x0f : (b & 0xf0) >> 4,\n                        )\n                        lowNibble = !lowNibble\n                    }\n                }\n            }\n        } else {\n            const xLen = Math.ceil(this.width / 2)\n            const mode = xLen % 4\n            const padding = mode !== 0 ? 4 - mode : 0\n\n            this.scanImage(padding, xLen, (x, line) => {\n                const b = this.buffer[this.pos++]\n                const location = line * this.width * 4 + x * 2 * 4\n\n                const first4 = b >> 4\n                let rgb = this.palette[first4]\n\n                this.data[location] = 0\n                this.data[location + 1] = rgb.blue\n                this.data[location + 2] = rgb.green\n                this.data[location + 3] = rgb.red\n\n                if (x * 2 + 1 >= this.width) {\n                    // throw new Error('Something');\n                    return false\n                }\n\n                const last4 = b & 0x0f\n                rgb = this.palette[last4]\n\n                this.data[location + 4] = 0\n                this.data[location + 4 + 1] = rgb.blue\n                this.data[location + 4 + 2] = rgb.green\n                this.data[location + 4 + 3] = rgb.red\n            })\n        }\n    }\n\n    private bit8() {\n        if (this.compression === Compression.BI_RLE8) {\n            this.data.fill(0)\n\n            let lines = this.bottomUp ? this.height - 1 : 0\n            let location = 0\n\n            while (location < this.data.length) {\n                const a = this.buffer[this.pos++]\n                const b = this.buffer[this.pos++]\n\n                //absolute mode\n                if (a === 0) {\n                    if (b === 0) {\n                        //line end\n                        lines += this.bottomUp ? -1 : 1\n                        location = lines * this.width * 4\n                        continue\n                    }\n\n                    if (b === 1) {\n                        //image end\n                        break\n                    }\n\n                    if (b === 2) {\n                        //offset x,y\n                        const x = this.buffer[this.pos++]\n                        const y = this.buffer[this.pos++]\n\n                        lines += this.bottomUp ? -y : y\n                        location += y * this.width * 4 + x * 4\n                    } else {\n                        for (let i = 0; i < b; i++) {\n                            const c = this.buffer[this.pos++]\n                            location = this.setPixelData(location, c)\n                        }\n\n                        // @ts-ignore\n                        const shouldIncrement = b & (1 === 1)\n                        if (shouldIncrement) {\n                            this.pos++\n                        }\n                    }\n                } else {\n                    //encoded mode\n                    for (let i = 0; i < a; i++) {\n                        location = this.setPixelData(location, b)\n                    }\n                }\n            }\n        } else {\n            const mode = this.width % 4\n            const padding = mode !== 0 ? 4 - mode : 0\n\n            this.scanImage(padding, this.width, (x, line) => {\n                const b = this.buffer[this.pos++]\n                const location = line * this.width * 4 + x * 4\n\n                if (b < this.palette.length) {\n                    const rgb = this.palette[b]\n\n                    this.data[location] = 0\n                    this.data[location + 1] = rgb.blue\n                    this.data[location + 2] = rgb.green\n                    this.data[location + 3] = rgb.red\n                } else {\n                    this.data[location] = 0\n                    this.data[location + 1] = 0xff\n                    this.data[location + 2] = 0xff\n                    this.data[location + 3] = 0xff\n                }\n            })\n        }\n    }\n\n    private bit16() {\n        const padding = (this.width % 2) * 2\n\n        this.scanImage(padding, this.width, (x, line) => {\n            const loc = line * this.width * 4 + x * 4\n            const px = this.bufferView.getUint16(this.pos, true)\n            this.pos += 2\n\n            this.data[loc + this.locRed] = this.shiftRed(px)\n            this.data[loc + this.locGreen] = this.shiftGreen(px)\n            this.data[loc + this.locBlue] = this.shiftBlue(px)\n            this.data[loc + this.locAlpha] = this.shiftAlpha(px)\n        })\n    }\n\n    private bit24() {\n        const padding = this.width % 4\n\n        this.scanImage(padding, this.width, (x, line) => {\n            const loc = line * this.width * 4 + x * 4\n            const blue = this.buffer[this.pos++]\n            const green = this.buffer[this.pos++]\n            const red = this.buffer[this.pos++]\n\n            this.data[loc + this.locRed] = red\n            this.data[loc + this.locGreen] = green\n            this.data[loc + this.locBlue] = blue\n            this.data[loc + this.locAlpha] = 0\n        })\n    }\n\n    private bit32() {\n        this.scanImage(0, this.width, (x, line) => {\n            const loc = line * this.width * 4 + x * 4\n            const px = this.readUInt32LE()\n\n            this.data[loc + this.locRed] = this.shiftRed(px)\n            this.data[loc + this.locGreen] = this.shiftGreen(px)\n            this.data[loc + this.locBlue] = this.shiftBlue(px)\n            this.data[loc + this.locAlpha] = this.shiftAlpha(px)\n        })\n    }\n\n    private scanImage(\n        padding = 0,\n        width = this.width,\n        processPixel: IColorProcessor,\n    ) {\n        for (let y = this.height - 1; y >= 0; y--) {\n            const line = this.bottomUp ? y : this.height - 1 - y\n\n            for (let x = 0; x < width; x++) {\n                processPixel.call(this, x, line)\n            }\n\n            this.pos += padding\n        }\n    }\n\n    private readUInt32LE() {\n        const value = this.bufferView.getUint32(this.pos, true)\n        this.pos += 4\n        return value\n    }\n\n    private setPixelData(location: number, rgbIndex: number) {\n        const {blue, green, red} = this.palette[rgbIndex]\n\n        this.data[location + this.locAlpha] = 0\n        this.data[location + 1 + this.locBlue] = blue\n        this.data[location + 2 + this.locGreen] = green\n        this.data[location + 3 + this.locRed] = red\n\n        return location + 4\n    }\n}\n\nexport class AlphaBitmapDecoder {\n\n    static parse(buffer: Uint8Array): ImageData {\n        const decoder = new BmpDecoder(buffer) // returns data in ABGR order and alpha set 0\n        const data = new Uint8ClampedArray(decoder.data.length)\n        for (let c = 0; c < decoder.data.length; c += 4) {\n            data[c] = decoder.data[c + 3] // red\n            data[c + 1] = decoder.data[c + 2] // green\n            data[c + 2] = decoder.data[c + 1] // blue\n            data[c + 3] = 255 - decoder.data[c] // alpha\n        }\n        return new ImageData(data, decoder.width, decoder.height)\n    }\n\n}\n","export enum PriorityIdentifier {\n\n    aiPriorityTrain,\n    aiPriorityGetIn,\n    aiPriorityCrystal,\n    aiPriorityOre,\n    aiPriorityRepair,\n    aiPriorityClearing,\n    aiPriorityDestruction,\n    aiPriorityConstruction,\n    aiPriorityReinforce,\n    aiPriorityRecharge,\n\n}\n","export class BaseConfig {\n\n    static setFromCfg(config: BaseConfig, cfgObj: any) {\n        Object.keys(cfgObj).forEach((cfgKey) => {\n            const lCfgKeyName = (cfgKey.startsWith('!') ? cfgKey.substring(1) : cfgKey)\n                .toLowerCase()\n                .replace(/_/g, '') // Activity_Stand\n                .replace(/-/g, '') // Geo-dome\n            const found = Object.keys(config).some((objKey) => {\n                return config.assignValue(objKey, lCfgKeyName, cfgObj[cfgKey])\n            })\n            if (!found) {\n                console.warn('cfg key does not exist: ' + cfgKey)\n            }\n        })\n        return config\n    }\n\n    assignValue(objKey, lCfgKeyName, cfgValue): boolean {\n        if (objKey.toLowerCase() === lCfgKeyName) {\n            const currentValue = this[objKey]\n            const currentIsArray = Array.isArray(currentValue)\n            let parsedValue = this.parseValue(lCfgKeyName, cfgValue)\n            const parsedIsArray = Array.isArray(parsedValue)\n            if (currentValue && currentIsArray !== parsedIsArray) {\n                if (currentIsArray) {\n                    parsedValue = [parsedValue]\n                    // } else {\n                    //     console.warn('Array overwrite conflict for key ' + objKey + ' with existing value (' + currentValue + ') and new value (' + parsedValue + ')')\n                }\n            }\n            this[objKey] = parsedValue\n            return true\n        }\n    }\n\n    parseValue(lCfgKeyName: string, cfgValue: any): any {\n        return cfgValue\n    }\n\n}\n","export class MenuLabelItemCfg {\n\n    actionName: string\n    x: number\n    y: number\n    label: string\n    imgNormal: string\n    imgHover: string\n    imgPressed: string\n    tooltip: string\n    target: string\n    flag: string // usage unclear\n\n    constructor(cfgObj: any) {\n        if (cfgObj.length === 5 || cfgObj.length === 6) {\n            [this.actionName, this.x, this.y, this.label, this.target, this.flag] = cfgObj\n            this.label = Array.isArray(this.label) ? this.label.join(',') : this.label // TODO improve cfg handling, remove join\n            this.label = this.label.replace(/_/g, ' ')\n        } else if (cfgObj.length === 8) {\n            [this.actionName, this.x, this.y, this.imgNormal, this.imgHover, this.imgPressed, this.tooltip, this.target] = cfgObj\n        } else {\n            console.warn('Unexpected cfg object length: ' + cfgObj.length)\n            console.log(cfgObj)\n        }\n    }\n\n}\n","export class MenuSliderItemCfg {\n\n    actionName: string\n    x: number\n    y: number\n    width: number\n    height: number\n    description: string\n    min: number\n    max: number\n    imgOff: string\n    imgOn: string\n    imgLeft: string\n    imgRight: string\n    btnLeftNormal: string\n    btnRightNormal: string\n    btnLeftHover: string\n    btnRightHover: string\n\n    constructor(cfgObj: any) {\n        [this.actionName, this.x, this.y, this.width, this.height, this.description, this.min, this.max, this.imgOff, this.imgOn,\n            this.imgLeft, this.imgRight, this.btnRightNormal, this.btnLeftNormal, this.btnRightHover, this.btnLeftHover] = cfgObj\n    }\n\n}\n","export class MenuCycleItemCfg {\n\n    actionName: string\n    x: number\n    y: number\n    width: number\n    height: number\n    description: string\n    two: number // usage unclear\n    labelOff: string\n    labelOn: string\n\n    constructor(cfgObj: any) {\n        [this.actionName, this.x, this.y, this.width, this.height, this.description, this.two, this.labelOff, this.labelOn] = cfgObj\n        this.description = this.description.replace(/_/g, ' ')\n    }\n\n}\n","import { BaseConfig } from './BaseConfig'\nimport { MenuLabelItemCfg } from './MenuLabelItemCfg'\nimport { MenuSliderItemCfg } from './MenuSliderItemCfg'\nimport { MenuCycleItemCfg } from './MenuCycleItemCfg'\n\nexport class MenuEntryCfg extends BaseConfig {\n\n    fullName: string = ''\n    title: string = ''\n    position: [number, number] = [0, 0]\n    menuFont: string = ''\n    loFont: string = ''\n    hiFont: string = ''\n    itemCount: number = 0\n    menuImage: string = ''\n    autoCenter: boolean = false\n    displayTitle: boolean = false\n    overlays: any[] = []\n    playRandom: boolean = false\n    itemsLabel: MenuLabelItemCfg[] = []\n    itemsSlider: MenuSliderItemCfg[] = []\n    itemsCycle: MenuCycleItemCfg[] = []\n    anchored: boolean = false\n    canScroll: boolean = false\n\n    constructor(cfgObj: any) {\n        super()\n        BaseConfig.setFromCfg(this, cfgObj)\n    }\n\n    assignValue(objKey, lCfgKeyName, cfgValue): boolean {\n        if (lCfgKeyName.match(/item\\d+/i)) {\n            const lActionName = cfgValue[0].toLowerCase()\n            if (lActionName === 'next' || lActionName === 'trigger') {\n                this.itemsLabel.push(new MenuLabelItemCfg(cfgValue))\n            } else if (lActionName === 'slider') {\n                this.itemsSlider.push(new MenuSliderItemCfg(cfgValue))\n            } else if (lActionName === 'cycle') {\n                this.itemsCycle.push(new MenuCycleItemCfg(cfgValue))\n            } else {\n                console.warn('Unexpected item action name: ' + cfgValue[0])\n                return false\n            }\n            return true\n        } else if (lCfgKeyName.match(/overlay\\d+/i)) {\n            this.overlays.push(cfgValue)\n            return true\n        }\n        return super.assignValue(objKey, lCfgKeyName, cfgValue)\n    }\n\n    parseValue(lCfgKeyName: string, cfgValue: any): any {\n        if (lCfgKeyName === 'fullName'.toLowerCase() || lCfgKeyName === 'title') {\n            return cfgValue.replace(/_/g, ' ')\n        } else {\n            return super.parseValue(lCfgKeyName, cfgValue)\n        }\n    }\n\n}\n","import { MenuEntryCfg } from './MenuEntryCfg'\nimport { BaseConfig } from './BaseConfig'\n\nexport class MenuCfg extends BaseConfig {\n\n    menuCount: number = 0\n    menus: MenuEntryCfg[] = []\n\n    constructor(cfgObj: any) {\n        super()\n        BaseConfig.setFromCfg(this, cfgObj)\n    }\n\n    assignValue(objKey, lCfgKeyName, cfgValue): boolean {\n        if (lCfgKeyName.match(/menu\\d+/i)) {\n            this.menus.push(new MenuEntryCfg(cfgValue))\n            return true\n        }\n        return super.assignValue(objKey, lCfgKeyName, cfgValue)\n    }\n\n}\n","export class ConfigColor {\n\n    r: number\n    g: number\n    b: number\n\n    constructor(values: number[]) {\n        [this.r, this.g, this.b] = values\n    }\n\n}\n","export class ObjectiveImageCfg {\n\n    filename: string\n    x: number\n    y: number\n\n    constructor(cfgValue: any) {\n        [this.filename, this.x, this.y] = cfgValue\n    }\n\n}\n","export function getFilename(url: string) {\n    if (!url) return url\n    let strUrl = url.toString().replace(/\\\\/g, '/')\n    if (strUrl.startsWith('/')) strUrl = strUrl.substring(1)\n    const lastInd = strUrl.lastIndexOf('/')\n    return strUrl.substring(lastInd + 1)\n}\n\nexport function iGet(obj, ...keys: string[]): any {\n    keys.forEach((keyname) => {\n        obj = Object.keys(obj)\n            .filter((key) => key.toLowerCase() === keyname.toLowerCase())\n            .map((key) => obj[key])\n        obj = obj ? obj[0] : obj\n    })\n    return obj\n}\n\nexport function decodeString(data) {\n    return new TextDecoder().decode(data).replace(/\\0/g, '')\n}\n\nexport function decodeFilepath(data) {\n    return decodeString(data).replace(/\\\\/g, '/')\n}\n\nexport function getRandomInclusive(min, max) {\n    min = Math.ceil(min)\n    max = Math.floor(max)\n    return Math.floor(Math.random() * (max - min + 1)) + min\n}\n\nexport function getRandom(max) {\n    return getRandomInclusive(0, max)\n}\n\nexport function getRandomSign() {\n    return -1 + getRandomInclusive(0, 1) * 2\n}\n\nexport function clearTimeoutSafe(timeout: NodeJS.Timeout) {\n    if (timeout) clearTimeout(timeout)\n    return null\n}\n\nexport function clearIntervalSafe(interval: NodeJS.Timeout) {\n    if (interval) clearInterval(interval)\n    return null\n}\n\ndeclare global {\n\n    interface Array<T> {\n        remove(element: T): T\n    }\n\n    interface Map<K, V> {\n        getOrUpdate(key: K, updateCallback: () => V): V\n    }\n\n}\n\nArray.prototype.remove = function <T>(element: T): void {\n    const index = this.indexOf(element)\n    if (index !== -1) this.splice(index, 1)\n}\n\n// noinspection JSUnusedGlobalSymbols\nMap.prototype.getOrUpdate = function <K, V>(key: K, updateCallback: () => V): V {\n    let value = this.get(key)\n    if (value === undefined) {\n        value = updateCallback()\n        this.set(key, value)\n    }\n    return value\n}\n","import { encodeChar } from './EncodingHelper'\n\nexport class ObjectiveTextParser {\n\n    parseObjectiveTextFile(txtFileContent: Uint8Array) {\n        const result = {}\n        let state = PARSING_STATE.DROP\n        let currentLevel: LevelObjectiveTextEntry = null\n        let value = ''\n        let line = ''\n        for (let c = 0; c < txtFileContent.length; c++) {\n            const code = encodeChar[txtFileContent[c]]\n            let char = String.fromCharCode(code)\n            if (state === PARSING_STATE.DROP) {\n                if (char === '[') {\n                    if (currentLevel) result[currentLevel.key] = currentLevel\n                    currentLevel = new LevelObjectiveTextEntry()\n                    state = PARSING_STATE.KEY\n                } else if (currentLevel && char === ':') {\n                    const lLine = line.toLowerCase()\n                    if (lLine === 'objective') {\n                        line = ''\n                        state = PARSING_STATE.OBJECTIVE\n                    } else if (lLine === 'failure') {\n                        line = ''\n                        state = PARSING_STATE.FAILURE\n                    } else if (lLine === 'completion') {\n                        line = ''\n                        state = PARSING_STATE.COMPLETION\n                    } else if (lLine === 'crystalfailure') {\n                        line = ''\n                        state = PARSING_STATE.CRYSTAL_FAILURE\n                    }\n                    for (; c < txtFileContent.length && txtFileContent[c + 1] === '\\t'.charCodeAt(0); c++) {\n                    }\n                } else if (char === '\\n' || char === '\\r') {\n                    line = ''\n                } else {\n                    line += char\n                }\n            } else if (state === PARSING_STATE.KEY) {\n                if (char === ']') {\n                    currentLevel.key = value\n                    value = ''\n                    state = PARSING_STATE.DROP\n                } else if (char === '\\n' || char === '\\r') {\n                    throw 'Malformed objective text file'\n                } else {\n                    value += char\n                }\n            } else if (state === PARSING_STATE.OBJECTIVE) {\n                if (char === '\\n' || char === '\\r') {\n                    currentLevel.objective = value\n                    value = ''\n                    state = PARSING_STATE.DROP\n                } else {\n                    value += char\n                }\n            } else if (state === PARSING_STATE.FAILURE) {\n                if (char === '\\n' || char === '\\r') {\n                    currentLevel.failure = value\n                    value = ''\n                    state = PARSING_STATE.DROP\n                } else {\n                    value += char\n                }\n            } else if (state === PARSING_STATE.COMPLETION) {\n                if (char === '\\n' || char === '\\r') {\n                    currentLevel.completion = value\n                    value = ''\n                    state = PARSING_STATE.DROP\n                } else {\n                    value += char\n                }\n            } else if (state === PARSING_STATE.CRYSTAL_FAILURE) {\n                if (char === '\\n' || char === '\\r') {\n                    currentLevel.crystalFailure = value\n                    value = ''\n                    state = PARSING_STATE.DROP\n                } else {\n                    value += char\n                }\n            }\n        }\n        if (currentLevel) result[currentLevel.key] = currentLevel\n        currentLevel = null\n        return result\n    }\n\n}\n\nenum PARSING_STATE {\n\n    DROP,\n    KEY,\n    OBJECTIVE,\n    FAILURE,\n    COMPLETION,\n    CRYSTAL_FAILURE,\n\n}\n\nexport class LevelObjectiveTextEntry {\n\n    key: string\n    objective: string\n    failure: string\n    completion: string\n    crystalFailure: string\n\n}\n","import { BaseConfig } from './BaseConfig'\nimport { ConfigColor } from './ConfigColor'\nimport { ObjectiveImageCfg } from './ObjectiveImageCfg'\nimport { PriorityIdentifier } from '../game/model/job/PriorityIdentifier'\nimport { iGet } from '../core/Util'\n\nexport class LevelsCfg {\n\n    levelsByName: {} = []\n\n    constructor(cfgObj: any) {\n        Object.keys(cfgObj).forEach((levelKey) => {\n            if (!levelKey.startsWith('Tutorial') && !levelKey.startsWith('Level')) return // ignore incomplete test levels and duplicates\n            this.levelsByName[levelKey] = new LevelEntryCfg(cfgObj[levelKey])\n        })\n    }\n\n}\n\nexport class LevelEntryCfg extends BaseConfig {\n\n    fullName: string = ''\n    endGameAvi1: string = ''\n    endGameAvi2: string = ''\n    allowRename: boolean = false\n    recallOLObjects: boolean = false\n    generateSpiders: boolean = false\n    video: string = ''\n    disableEndTeleport: any = ''\n    disableStartTeleport: any = ''\n    emergeTimeOut: any = ''\n    boulderAnimation: any = ''\n    noMultiSelect: any = ''\n    noAutoEat: any = ''\n    disableToolTipSound: any = ''\n    blockSize: any = ''\n    digDepth: any = ''\n    roughLevel: any = ''\n    roofHeight: any = ''\n    useRoof: any = ''\n    selBoxHeight: any = ''\n    fpRotLightRGB: any = ''\n    fogColourRGB: any = ''\n    highFogColourRGB: any = ''\n    fogRate: number = 0\n    fallinMultiplier: number = 0\n    numberOfLandSlidesTillCaveIn: number = 0\n    noFallins: boolean = false\n    oxygenRate: number = 0 // 0 - 100\n    surfaceMap: string = ''\n    predugMap: string = ''\n    terrainMap: string = ''\n    emergeMap: string = ''\n    erodeMap: string = ''\n    fallinMap: string = ''\n    blockPointersMap: string = ''\n    cryOreMap: string = ''\n    pathMap: string = ''\n    noGather: boolean = false\n    textureSet: string = ''\n    rockFallStyle: any = ''\n    emergeCreature: any = ''\n    safeCaverns: any = ''\n    seeThroughWalls: any = ''\n    oListFile: any = ''\n    ptlFile: any = ''\n    nerpFile: any = ''\n    nerpMessageFile: any = ''\n    objectiveText: any = ''\n    objectiveImage640x480: ObjectiveImageCfg = null\n    erodeTriggerTime: number = 0\n    erodeErodeTime: number = 0\n    erodeLockTime: number = 0\n    nextLevel: any = ''\n    levelLinks: any = ''\n    frontEndX: number = 0\n    frontEndY: number = 0\n    frontEndOpen: boolean = false\n    priorities: LevelPrioritiesEntryConfig[] = [] // priority order matters!\n    reward: LevelRewardConfig = null\n    menuBMP: string[] = []\n\n    constructor(cfgObj: any) {\n        super()\n        BaseConfig.setFromCfg(this, cfgObj)\n    }\n\n    parseValue(lCfgKeyName: string, cfgValue: any): any {\n        if (lCfgKeyName === 'fullName'.toLowerCase()) {\n            return cfgValue.replace(/_/g, ' ')\n        } else if (lCfgKeyName.endsWith('rgb')) {\n            return new ConfigColor(cfgValue)\n        } else if (lCfgKeyName === 'priorities') {\n            return Object.keys(cfgValue)\n                .filter(name => name.toLowerCase() !== 'AI_Priority_GetTool'.toLowerCase()) // not used in the game\n                .map(name => new LevelPrioritiesEntryConfig(name, cfgValue[name]))\n        } else if (lCfgKeyName === 'reward') {\n            return new LevelRewardConfig(cfgValue)\n        } else if (lCfgKeyName === 'objectiveimage640x480') {\n            return new ObjectiveImageCfg(cfgValue)\n        } else {\n            return super.parseValue(lCfgKeyName, cfgValue)\n        }\n    }\n\n}\n\nexport class LevelPrioritiesEntryConfig {\n\n    key: PriorityIdentifier\n    enabled: boolean\n\n    constructor(name: string, enabled: boolean) {\n        this.key = iGet(PriorityIdentifier, name.replace(/_/g, ''))\n        this.enabled = enabled\n    }\n\n}\n\nexport class LevelRewardConfig extends BaseConfig {\n\n    enable: boolean = true\n    modifier: number = null\n    importance: LevelRewardImportanceConfig = null\n    quota: LevelRewardQuotaConfig = null\n\n    constructor(cfgObj: any) {\n        super()\n        BaseConfig.setFromCfg(this, cfgObj)\n    }\n\n    parseValue(lCfgKeyName: string, cfgValue: any): any {\n        if (lCfgKeyName === 'importance') {\n            return new LevelRewardImportanceConfig(cfgValue)\n        } else if (lCfgKeyName === 'quota') {\n            return new LevelRewardQuotaConfig(cfgValue)\n        } else {\n            return super.parseValue(lCfgKeyName, cfgValue)\n        }\n    }\n}\n\nexport class LevelRewardImportanceConfig extends BaseConfig {\n\n    crystals: number = 0\n    timer: number = 0\n    caverns: number = 0\n    constructions: number = 0\n    oxygen: number = 0\n    figures: number = 0\n\n    constructor(cfgObj: any) {\n        super()\n        BaseConfig.setFromCfg(this, cfgObj)\n    }\n\n}\n\nexport class LevelRewardQuotaConfig extends BaseConfig {\n\n    crystals: number = null\n    timer: number = null\n    caverns: number = null\n    constructions: number = null\n\n    constructor(cfgObj: any) {\n        super()\n        BaseConfig.setFromCfg(this, cfgObj)\n    }\n\n}\n","import { BaseConfig } from './BaseConfig'\n\nexport class RewardCfg extends BaseConfig {\n\n    display: boolean = true\n    wallpaper: string = ''\n    images: RewardImageCfg[] = []\n    texts: RewardTextCfg[] = []\n    boxImages: RewardImageCfg[] = []\n    fonts: RewardFontsCfg = null\n    flics: { flhFilepath: string, x: number, y: number, w: number, h: number } = null\n    scrollSpeed: number = 0\n    centreText: boolean = false\n    vertSpacing: number = 0\n    backFont: string = ''\n    font: string = ''\n    titleFont: string = ''\n    timer: number = 0\n    saveButton: any = ''\n    advanceButton: any = ''\n    completeText: string = ''\n    failedText: string = ''\n    quitText: string = ''\n    textPos: [number, number] = [0, 0]\n\n    constructor(cfgObj: any) {\n        super()\n        BaseConfig.setFromCfg(this, cfgObj)\n    }\n\n    assignValue(objKey, lCfgKeyName, cfgValue): boolean {\n        if (lCfgKeyName === 'images') {\n            Object.values(cfgValue).forEach((imgConf) => this.images.push(new RewardImageCfg(imgConf)))\n            return true\n        } else if (lCfgKeyName === 'text') {\n            Object.values(cfgValue).forEach((imgConf) => this.texts.push(new RewardTextCfg(imgConf)))\n            return true\n        } else if (lCfgKeyName === 'boximages') {\n            Object.values(cfgValue).forEach((imgConf) => this.boxImages.push(new RewardImageCfg(imgConf)))\n            return true\n        } else if (lCfgKeyName === 'fonts') {\n            this.fonts = new RewardFontsCfg(cfgValue)\n            return true\n        } else {\n            return super.assignValue(objKey, lCfgKeyName, cfgValue)\n        }\n    }\n\n}\n\nexport class RewardImageCfg {\n\n    filePath: string = ''\n    x: number = 0\n    y: number = 0\n\n    constructor(cfgObj: any) {\n        [this.filePath, this.x, this.y] = cfgObj\n    }\n\n}\n\nexport class RewardTextCfg {\n\n    text: string = ''\n    x: number = 0\n    y: number = 0\n\n    constructor(cfgObj: any) {\n        [this.text, this.x, this.y] = cfgObj\n    }\n\n}\n\nexport class RewardFontsCfg extends BaseConfig {\n\n    crystals: string = ''\n    ore: string = ''\n    diggable: string = ''\n    constructions: string = ''\n    caverns: string = ''\n    figures: string = ''\n    rockMonsters: string = ''\n    oxygen: string = ''\n    timer: string = ''\n    score: string = ''\n\n    constructor(cfgObj: any) {\n        super()\n        BaseConfig.setFromCfg(this, cfgObj)\n    }\n\n}\n","export class WorkerMessage {\n\n    type: WorkerMessageType = null\n    text?: string\n    cfg?: any\n    totalResources?: number\n    assetName?: string\n    assetObj?: any\n    loadingTimeSeconds?: string\n\n    constructor(type: WorkerMessageType) {\n        this.type = type\n    }\n\n    static createTextMessage(msg: string): WorkerMessage {\n        return {type: WorkerMessageType.MSG, text: msg}\n    }\n\n    static createCfgLoaded(cfg: any, totalResources: number): WorkerMessage {\n        return {type: WorkerMessageType.CFG, cfg: cfg, totalResources: totalResources}\n    }\n\n    static createAssetLoaded(assetIndex: number, assetName: string, assetObj: any) {\n        return {type: WorkerMessageType.ASSET, assetName: assetName, assetObj: assetObj}\n    }\n\n    static createLoadDone(totalResources: number, loadingTimeSeconds: string) {\n        return {type: WorkerMessageType.DONE, totalResources: totalResources, loadingTimeSeconds: loadingTimeSeconds}\n    }\n\n}\n\nexport enum WorkerMessageType {\n\n    MSG,\n    CFG,\n    CACHE_MISS,\n    SFX,\n    ASSET,\n    DONE,\n\n}\n","import { CfgFileParser } from './CfgFileParser'\nimport { WadFile } from './WadFile'\nimport { getFilename, getPath, iGet } from './WadUtil'\nimport { RonFile } from './RonFile'\nimport { AlphaBitmapDecoder } from './AlphaBitmapDecoder'\nimport { MenuCfg } from '../../cfg/MenuCfg'\nimport { LevelEntryCfg, LevelsCfg } from '../../cfg/LevelsCfg'\nimport { RewardCfg } from '../../cfg/RewardCfg'\nimport { ObjectiveTextParser } from './ObjectiveTextParser'\n\nexport class WadLoader {\n\n    wad0File: WadFile = null\n    wad1File: WadFile = null\n    startTime: Date\n    assetIndex: number = 0\n    totalResources: number = 0\n    assetsFromCfgByName: Map<string, { method: ((name: string, callback: (any) => void) => void), assetPath: string, optional: boolean }> = new Map()\n\n    onMessage: (msg: string) => any = (msg: string) => {\n        console.log(msg)\n    }\n    onInitialLoad: (totalResources: number, cfg: any) => any = () => {\n        console.log('Initial loading done.')\n    }\n    onAssetLoaded: (assetIndex: number, assetName: string, assetObj: any) => any = () => {\n    }\n    onLoadDone: (totalResources: number, loadingTimeSeconds: string) => any = (totalResources: number, loadingTimeSeconds: string) => {\n        console.log('Loading of about ' + totalResources + ' assets complete! Total load time: ' + loadingTimeSeconds + ' seconds.')\n    }\n\n    loadWadImageAsset(name: string, callback: (obj: ImageData) => any) {\n        const data = this.wad0File.getEntryData(name)\n        const imgData = AlphaBitmapDecoder.parse(data)\n        callback(imgData)\n    }\n\n    loadWadTexture(name: string, callback: (obj: ImageData) => any) {\n        function isTranslucentTexture(filename: string): boolean { // TODO check for better approach\n            return !!filename.match(/\\d\\d\\d\\..+$/i) || !!filename.match(/^trans/i)\n                || !!filename.match(/telepulse/i) || !!filename.match(/^t_/i)\n                || !!filename.includes('crystalglow') || !!filename.match(/^glin/i)\n                || !!filename.match(/glow.bmp/i) || !!filename.match(/spankle/i)\n                || !!filename.startsWith('rd_')\n        }\n\n        function isAlphaTexture(filename: string): boolean { // TODO check for better approach\n            return !!filename.match(/^a.+/i) || !!filename.match(/\\d\\.bmp/i) // later one used with dynamite\n        }\n\n        const data = this.wad0File.getEntryData(name)\n        const imgData = AlphaBitmapDecoder.parse(data)\n        const filename = getFilename(name)\n        if (isTranslucentTexture(filename)) {\n            for (let n = 0; n < imgData.data.length; n += 4) {\n                if (imgData.data[n] === 255 && imgData.data[n + 1] === 255 && imgData.data[n + 2] === 255) {\n                    // TODO BitmapDecoder not working for sequence textures, surrounding color is white instead of black\n                    imgData.data[n + 3] = 0\n                } else {\n                    imgData.data[n + 3] = Math.max(imgData.data[n], imgData.data[n + 1], imgData.data[n + 2])\n                }\n            }\n        } else if (isAlphaTexture(filename)) {\n            let alpha = { // last pixel defines alpha color\n                r: imgData.data[imgData.data.length - 4],\n                g: imgData.data[imgData.data.length - 3],\n                b: imgData.data[imgData.data.length - 2],\n            }\n            if (filename.toLowerCase() === 'a000_sides.bmp') {\n                alpha = { // FIRST pixel defines alpha color\n                    r: imgData.data[0],\n                    g: imgData.data[1],\n                    b: imgData.data[2],\n                }\n            }\n            for (let n = 0; n < imgData.data.length; n += 4) {\n                if (imgData.data[n] === alpha.r && imgData.data[n + 1] === alpha.g && imgData.data[n + 2] === alpha.b) {\n                    imgData.data[n + 3] = 0\n                }\n            }\n        }\n        callback(imgData)\n    }\n\n    loadAlphaImageAsset(name: string, callback: (obj: ImageData) => any) {\n        const data = this.wad0File.getEntryData(name)\n        const imgData = AlphaBitmapDecoder.parse(data)\n        for (let n = 0; n < imgData.data.length; n += 4) {\n            if (imgData.data[n] <= 2 && imgData.data[n + 1] <= 2 && imgData.data[n + 2] <= 2) { // Interface/Reward/RSoxygen.bmp uses 2/2/2 as \"black\" alpha background\n                imgData.data[n + 3] = 0\n            }\n        }\n        callback(imgData)\n    }\n\n    loadFontImageAsset(name: string, callback: (obj: ImageData) => any) {\n        const data = this.wad0File.getEntryData(name)\n        const imgData = AlphaBitmapDecoder.parse(data)\n        callback(imgData)\n    }\n\n    loadNerpAsset(name: string, callback: (obj: string) => any) {\n        name = name.replace(/.npl$/, '.nrn')\n        const script = this.wad0File.getEntryText(name)\n        callback(script)\n    }\n\n    loadNerpMsg(name: string, callback: (obj: any) => any) {\n        const result = this.parseNerpMsgFile(this.wad0File, name)\n        const msg1 = this.parseNerpMsgFile(this.wad1File, name)\n        for (let c = 0; c < msg1.length; c++) {\n            const m1 = msg1[c]\n            if (!m1) continue\n            if (m1.txt) {\n                result[c].txt = m1.txt\n            }\n            if (m1.snd) {\n                result[c].snd = m1.snd\n            }\n        }\n        callback(result)\n    }\n\n    parseNerpMsgFile(wadFile: WadFile, name: string) {\n        const result = []\n        const lines = wadFile.getEntryText(name).split('\\n')\n        for (let c = 0; c < lines.length; c++) {\n            const line = lines[c].trim()\n            if (line.length < 1 || line === '-') {\n                continue\n            }\n            // line formatting differs between wad0 and wad1 files!\n            const txt0Match = line.match(/\\\\\\[([^\\\\]+)\\\\](\\s*#([^#]+)#)?/)\n            const txt1Match = line.match(/^([^$][^#]+)(\\s*#([^#]+)#)?/)\n            const sndMatch = line.match(/\\$([^\\s]+)\\s*([^\\s]+)/)\n            if (wadFile === this.wad0File && txt0Match) {\n                const index = txt0Match[3] !== undefined ? this.numericNameToNumber(txt0Match[3]) : c // THIS IS MADNESS! #number# at the end of line is OPTIONAL\n                result[index] = result[index] || {}\n                result[index].txt = txt0Match[1]\n            } else if (wadFile === this.wad1File && txt1Match) {\n                const index = txt1Match[3] !== undefined ? this.numericNameToNumber(txt1Match[3]) : c // THIS IS MADNESS! #number# at the end of line is OPTIONAL\n                result[index] = result[index] || {}\n                result[index].txt = txt1Match[1].replace(/_/g, ' ').trim()\n            } else if (sndMatch && sndMatch.length === 3) {\n                const index = this.numericNameToNumber(sndMatch[1])\n                result[index] = result[index] || {}\n                result[index].snd = sndMatch[2].replace(/\\\\/g, '/')\n            } else {\n                throw 'Line in nerps message file did not match anything'\n            }\n        }\n        return result\n    }\n\n    numericNameToNumber(name: string) {\n        if (name === undefined) {\n            throw 'Numeric name must not be undefined'\n        }\n        const digits = {one: 1, two: 2, three: 3, four: 4, five: 5, six: 6, seven: 7, eight: 8, nine: 9}\n        const specials = {\n            ten: 10, eleven: 11, twelve: 12, thirteen: 13, fourteen: 14, fifteen: 15,\n            sixteen: 16, seventeen: 17, eighteen: 18, nineteen: 19,\n        }\n        const tens = {twenty: 20, thirty: 30, forty: 40}\n        let number = specials[name] || digits[name]\n        if (number === undefined) {\n            Object.keys(tens).forEach(ten => {\n                if (name.startsWith(ten)) {\n                    const digitName = name.replace(ten, '')\n                    number = tens[ten] + (digitName ? digits[digitName] : 0)\n                }\n            })\n        }\n        if (number === undefined) {\n            throw 'Found unexpected numeric name ' + name\n        }\n        return number\n    }\n\n    loadObjectiveTexts(name: string, callback: (obj: any) => any) {\n        const txtContent = this.wad1File.getEntryData(name)\n        const result = new ObjectiveTextParser().parseObjectiveTextFile(txtContent)\n        callback(result)\n    }\n\n    loadMapAsset(name: string, callback: (obj: any) => any) {\n        const buffer = this.wad0File.getEntryData(name)\n        if (buffer.length < 13 || String.fromCharCode.apply(String, buffer.slice(0, 3)) !== 'MAP') {\n            console.log('Invalid map data provided')\n            return\n        }\n        const map = {width: buffer[8], height: buffer[12], level: []}\n        let row = []\n        for (let seek = 16; seek < buffer.length; seek += 2) {\n            row.push(buffer[seek])\n            if (row.length >= map.width) {\n                map.level.push(row)\n                row = []\n            }\n        }\n        callback(map)\n    }\n\n    loadObjectListAsset(name: string, callback: (obj: any) => any) {\n        const lines = this.wad0File.getEntryText(name).split('\\n')\n        const objectList = []\n        let currentObject = null\n        for (let c = 0; c < lines.length; c++) {\n            const line = lines[c].trim()\n            const objectStartMatch = line.match(/(.+)\\s+{/)\n            const drivingMatch = line.match(/driving\\s+(.+)/)\n            if (line.length < 1 || line.startsWith(';') || line.startsWith('Lego*')) {\n                // ignore empty lines, comments and the root object\n            } else if (objectStartMatch) {\n                currentObject = {}\n                objectList[objectStartMatch[1]] = currentObject\n            } else if (line === '}') {\n                currentObject = null\n            } else if (drivingMatch) {\n                currentObject.driving = drivingMatch[1]\n            } else {\n                const split = line.split(/\\s+/)\n                if (split.length !== 2 || currentObject === null) {\n                    throw 'Unexpected key value entry: ' + line\n                }\n                const key = split[0]\n                let val: any = split[1]\n                if (key === 'xPos' || key === 'yPos' || key === 'heading') {\n                    val = parseFloat(val)\n                } else if (key !== 'type') {\n                    throw 'Unexpected key value entry: ' + line\n                }\n                currentObject[key] = val\n            }\n        }\n        callback(objectList)\n    }\n\n    /**\n     * Load a WAV file format sound asset from the WAD file.\n     * @param path Path inside the WAD file\n     * @param callback A callback that is triggered after the file has been loaded\n     * @param key Optional key to store the sound, should look like SND_pilotdrill\n     */\n    loadWavAsset(path, callback, key) {\n        console.error('wav asset loading not yet implemented') // TODO implement this\n        // const snd = document.createElement('audio');\n        // if (callback != null) {\n        //     snd.oncanplay = function () {\n        //         snd.oncanplay = null; // otherwise the callback is triggered multiple times\n        //         const keyPath = key || path;\n        //         // use array, because sounds have multiple variants sometimes\n        //         ResourceManager.sounds[keyPath] = ResourceManager.sounds[keyPath] || [];\n        //         ResourceManager.sounds[keyPath].push(snd);\n        //         callback();\n        //     };\n        // }\n        // // try (localized) wad1 file first, then use generic wad0 file\n        // try {\n        //     snd.src = this.wad1File.getEntryUrl(path);\n        // } catch (e) {\n        //     snd.src = this.wad0File.getEntryUrl(path);\n        // }\n    }\n\n    loadLWOFile(lwoFilepath: string, callback: (obj: any) => any) {\n        let lwoContent\n        try {\n            lwoContent = this.wad0File.getEntryBuffer(lwoFilepath)\n        } catch (e) {\n            try {\n                lwoContent = this.wad0File.getEntryBuffer('world/shared/' + getFilename(lwoFilepath))\n            } catch (e) {\n                console.error('Could not load LWO file ' + lwoFilepath + '; Error: ' + e)\n                return\n            }\n        }\n        callback(lwoContent.buffer)\n    }\n\n    registerAllAssets(mainConf: any) { // dynamically register all assets from config\n        // add fonts and cursors\n        this.addAssetFolder(this.loadFontImageAsset, 'Interface/Fonts/')\n        this.addAssetFolder(this.loadAlphaImageAsset, 'Interface/Pointers/')\n        // add menu assets\n        this.addMenuWithAssets(mainConf, 'MainMenuFull', false)\n        this.addMenuWithAssets(mainConf, 'PausedMenu')\n        this.addMenuWithAssets(mainConf, 'OptionsMenu')\n        this.addAsset(this.loadAlphaImageAsset, 'Interface/BriefingPanel/BriefingPanel.bmp')\n        this.addAsset(this.loadObjectiveTexts, 'Languages/ObjectiveText.txt')\n        // add in-game assets\n        this.addAlphaImageFolder('Interface/TopPanel/') // top panel\n        this.addAlphaImageFolder('Interface/RightPanel/') // crystal side bar\n        this.addAlphaImageFolder('Interface/RadarPanel/')\n        this.addAlphaImageFolder('Interface/MessagePanel/')\n        this.addAsset(this.loadWadImageAsset, 'Interface/Airmeter/msgpanel_air_juice.bmp')\n        this.addAlphaImageFolder('Interface/InfoPanel/')\n        this.addAlphaImageFolder('Interface/PriorityPanel/')\n        this.addAlphaImageFolder('Interface/Priorities')\n        this.addAlphaImageFolder('Interface/CameraControl/')\n        this.addAlphaImageFolder('Interface/MessageTabs/')\n        this.addAlphaImageFolder('Interface/IconPanel/')\n        this.addAlphaImageFolder('Interface/Icons/')\n        this.addAlphaImageFolder('Interface/Menus/')\n        this.addAlphaImageFolder('Interface/Buttons/')\n        this.addAlphaImageFolder('Interface/InfoImages/')\n        this.addAssetFolder(this.loadAlphaImageAsset, 'Interface/FrontEnd/Vol_')\n        this.addAssetFolder(this.loadWadImageAsset, 'Interface/FrontEnd/lp_')\n        this.addAsset(this.loadAlphaImageAsset, 'Interface/FrontEnd/LowerPanel.bmp')\n        // level files\n        this.addAsset(this.loadNerpAsset, 'Levels/nerpnrn.h')\n        const levelsCfg = new LevelsCfg(iGet(mainConf, 'Levels'))\n        this.onAssetLoaded(0, 'Levels', levelsCfg)\n        Object.values(levelsCfg.levelsByName).forEach((level: LevelEntryCfg) => {\n            level.menuBMP.forEach((bmpName) => {\n                this.addAsset(this.loadAlphaImageAsset, bmpName)\n            })\n            this.addAsset(this.loadMapAsset, level.surfaceMap)\n            this.addAsset(this.loadMapAsset, level.predugMap)\n            this.addAsset(this.loadMapAsset, level.terrainMap)\n            this.addAsset(this.loadMapAsset, level.blockPointersMap, true)\n            this.addAsset(this.loadMapAsset, level.cryOreMap)\n            this.addAsset(this.loadMapAsset, level.pathMap, true)\n            if (level.fallinMap) this.addAsset(this.loadMapAsset, level.fallinMap)\n            if (level.erodeMap) this.addAsset(this.loadMapAsset, level.erodeMap)\n            this.addAsset(this.loadObjectListAsset, level.oListFile)\n            this.addAsset(this.loadNerpAsset, level.nerpFile)\n            this.addAsset(this.loadNerpMsg, level.nerpMessageFile)\n        })\n        // load all shared textures\n        this.addTextureFolder('World/Shared/')\n        // load all building types\n        const buildingTypes = mainConf['BuildingTypes']\n        Object.values(buildingTypes).forEach((bType: string) => {\n            const bName = bType.split('/')[1]\n            const aeFile = bType + '/' + bName + '.ae'\n            this.addAnimatedEntity(aeFile)\n        })\n        this.addAnimatedEntity('mini-figures/pilot/pilot.ae')\n        // load monsters\n        this.addAnimatedEntity('Creatures/SpiderSB/SpiderSB.ae')\n        this.addAnimatedEntity('Creatures/bat/bat.ae')\n        // load misc objects\n        this.addAnimatedEntity(iGet(mainConf, 'MiscObjects', 'Dynamite') + '/Dynamite.ae')\n        this.addAsset(this.loadLWOFile, 'World/Shared/Crystal.lwo') // highpoly version, but unused?\n        this.addAsset(this.loadLWOFile, iGet(mainConf, 'MiscObjects', 'Crystal') + '.lwo')\n        this.addTextureFolder('MiscAnims/Crystal/')\n        this.addAsset(this.loadLWOFile, iGet(mainConf, 'MiscObjects', 'Ore') + '.lwo')\n        this.addAsset(this.loadWadTexture, 'MiscAnims/Ore/Ore.bmp')\n        this.addAsset(this.loadLWOFile, 'World/Shared/Brick.lwo')\n        this.addAsset(this.loadLWOFile, iGet(mainConf, 'MiscObjects', 'ProcessedOre') + '.lwo')\n        this.addAsset(this.loadLWOFile, iGet(mainConf, 'MiscObjects', 'ElectricFence') + '.lwo')\n        this.addTextureFolder('Buildings/E-Fence/')\n        this.addAnimatedEntity(iGet(mainConf, 'MiscObjects', 'Barrier') + '/Barrier.ae')\n        this.addAnimatedEntity('MiscAnims/Dynamite/Dynamite.ae')\n        this.addLWSFile('MiscAnims/RockFall/Rock3Sides.lws')\n        this.addTextureFolder('MiscAnims/RockFall/')\n        // spaces\n        this.addTextureFolder('World/WorldTextures/IceSplit/Ice')\n        this.addTextureFolder('World/WorldTextures/LavaSplit/Lava')\n        this.addTextureFolder('World/WorldTextures/RockSplit/Rock')\n        // reward screen\n        const rewardCfg = new RewardCfg(iGet(mainConf, 'Reward'))\n        this.onAssetLoaded(0, 'Reward', rewardCfg)\n        this.addAsset(this.loadWadImageAsset, rewardCfg.wallpaper)\n        this.addAsset(this.loadFontImageAsset, rewardCfg.backFont)\n        Object.values(rewardCfg.fonts).forEach(imgPath => this.addAsset(this.loadFontImageAsset, imgPath))\n        rewardCfg.images.forEach(img => this.addAsset(this.loadAlphaImageAsset, img.filePath))\n        rewardCfg.boxImages.forEach(img => this.addAsset(this.loadWadImageAsset, img.filePath))\n        rewardCfg.saveButton.splice(0, 4).forEach(img => this.addAsset(this.loadWadImageAsset, img))\n        rewardCfg.advanceButton.splice(0, 4).forEach(img => this.addAsset(this.loadWadImageAsset, img))\n        // // sounds\n        // const samplesConf = mainConf['Samples'];\n        // Object.keys(samplesConf).forEach(sndKey => {\n        //     let sndPath = samplesConf[sndKey] + '.wav';\n        //     if (sndKey.startsWith('!')) { // TODO no clue what this means... loop? duplicate?!\n        //         sndKey = sndKey.slice(1);\n        //     }\n        //     if (sndPath.startsWith('*')) { // TODO no clue what this means... don't loop, see telportup\n        //         sndPath = sndPath.slice(1);\n        //     } else if (sndPath.startsWith('@')) {\n        //         // sndPath = sndPath.slice(1);\n        //         // console.warn('Sound ' + sndPath + ' must be loaded from program files folder. Not yet implemented!');\n        //         return;\n        //     }\n        //     sndPath.split(',').forEach(sndPath => {\n        //         this.addAsset(this.loadWavAsset, sndPath, false, sndKey);\n        //     });\n        // });\n    }\n\n    addAnimatedEntity(aeFile: string) {\n        const content = this.wad0File.getEntryText(aeFile)\n        const cfgRoot = iGet(RonFile.parse(content), 'Lego*')\n        this.onAssetLoaded(0, aeFile, cfgRoot)\n        const path = getPath(aeFile);\n        ['HighPoly', 'MediumPoly', 'LowPoly'].forEach((polyType) => { // TODO add 'FPPoly' (contains two cameras)\n            const cfgPoly = iGet(cfgRoot, polyType)\n            if (cfgPoly) {\n                Object.keys(cfgPoly).forEach((key) => {\n                    this.addAsset(this.loadLWOFile, path + cfgPoly[key] + '.lwo')\n                })\n            }\n        })\n        const activities = iGet(cfgRoot, 'Activities')\n        if (activities) {\n            Object.keys(activities).forEach((activity) => {\n                try {\n                    let keyname = iGet(activities, activity)\n                    const act = iGet(cfgRoot, keyname)\n                    const file = iGet(act, 'FILE')\n                    const isLws = iGet(act, 'LWSFILE') === true\n                    if (isLws) {\n                        this.addLWSFile(path + file + '.lws')\n                    } else {\n                        console.error('Found activity which is not an LWS file')\n                    }\n                } catch (e) {\n                    console.error(e)\n                    console.log(cfgRoot)\n                    console.log(activities)\n                    console.log(activity)\n                }\n            })\n        }\n        // load all textures for this type\n        this.addTextureFolder(getPath(aeFile))\n    }\n\n    addLWSFile(lwsFilepath: string) {\n        const content = this.wad0File.getEntryText(lwsFilepath)\n        this.onAssetLoaded(0, lwsFilepath, content)\n        const lwoFiles: string[] = this.extractLwoFiles(getPath(lwsFilepath), content)\n        lwoFiles.forEach((lwoFile) => this.addAsset(this.loadLWOFile, lwoFile))\n    }\n\n    extractLwoFiles(path: string, content: string): string[] {\n        const lines: string[] = content.replace(/\\r\\n/g, '\\n').replace(/\\r/g, '\\n') // normalize newlines\n            .replace(/\\t/g, ' ') // tabs to spaces\n            .split('\\n')\n            .map((l) => l.trim())\n\n        if (lines[0] !== 'LWSC') {\n            throw 'Invalid start of file! Expected \\'LWSC\\' in first line'\n        }\n\n        return lines.filter((line) => line.toLowerCase().startsWith('LoadObject '.toLowerCase()))\n            .map((objLine) => path + getFilename(objLine.substring('LoadObject '.length)).toLowerCase())\n    }\n\n    addAlphaImageFolder(folderPath: string) {\n        this.addAssetFolder(this.loadAlphaImageAsset, folderPath)\n    }\n\n    addTextureFolder(folderPath: string) {\n        this.addAssetFolder(this.loadWadTexture, folderPath)\n    }\n\n    addAssetFolder(callback: (name: string, callback: (obj: any) => any) => void, folderPath) {\n        this.wad0File.filterEntryNames(folderPath + '.+\\\\.bmp').forEach((assetPath) => {\n            this.addAsset(callback, assetPath)\n        })\n    }\n\n    addMenuWithAssets(mainConf, name: string, menuImageAlpha: boolean = true) {\n        const menuCfg = new MenuCfg(iGet(mainConf, 'Menu', name))\n        this.onAssetLoaded(0, name, menuCfg)\n        menuCfg.menus.forEach((menuCfg) => {\n            const method = menuImageAlpha ? this.loadAlphaImageAsset : this.loadWadImageAsset\n            const menuImage = Array.isArray(menuCfg.menuImage) ? menuCfg.menuImage[0] : menuCfg.menuImage\n            this.addAsset(method, menuImage)\n            this.addAsset(this.loadFontImageAsset, menuCfg.menuFont)\n            this.addAsset(this.loadFontImageAsset, menuCfg.loFont)\n            this.addAsset(this.loadFontImageAsset, menuCfg.hiFont)\n        })\n    }\n\n    addAsset(method: (name: string, callback: (obj: any) => any) => void, assetPath, optional = false) {\n        if (!assetPath || this.assetsFromCfgByName.hasOwnProperty(assetPath) || assetPath === 'NULL') {\n            return // do not load assets twice\n        }\n        this.assetsFromCfgByName.set(assetPath, {method: method.bind(this), assetPath: assetPath, optional: optional})\n    }\n\n    loadAssetsParallel() {\n        const promises = []\n        const that = this\n        this.assetsFromCfgByName.forEach((asset) => {\n            promises.push(new Promise<void>((resolve) => {\n                try {\n                    asset.method(asset.assetPath, (assetObj) => {\n                        this.assetIndex++\n                        that.onAssetLoaded(this.assetIndex, asset.assetPath, assetObj)\n                        resolve()\n                    })\n                } catch (e) {\n                    if (!asset.optional) throw e\n                    this.assetIndex++\n                    that.onAssetLoaded(this.assetIndex, asset.assetPath, null)\n                    resolve()\n                }\n            }))\n        })\n        Promise.all(promises).then(() => {\n            // indicate that loading has finished, and display the total loading time\n            const loadingTimeSeconds = ((new Date().getTime() - this.startTime.getTime()) / 1000).toFixed(3).toString()\n            this.onLoadDone(this.totalResources, loadingTimeSeconds)\n        })\n    }\n\n    startWithCachedFiles(onCacheMiss: () => any) {\n        this.startTime = new Date()\n        const _onerror = () => {\n            this.onMessage('WAD files not found in cache')\n            onCacheMiss()\n        }\n        this.onMessage('Loading WAD files from cache...')\n        const that = this\n        this.openLocalCache((objectStore) => {\n            const request1 = objectStore.get('wad0')\n            request1.onerror = _onerror\n            request1.onsuccess = function () {\n                if (request1.result === undefined) {\n                    _onerror()\n                    return\n                }\n                // console.log('First WAD file loaded from cache after ' + ((new Date().getTime() - that.startTime.getTime()) / 1000));\n                that.wad0File = new WadFile()\n                for (let prop in request1.result) { // class info are runtime info and not stored in cache => use copy constructor\n                    if (request1.result.hasOwnProperty(prop)) {\n                        that.wad0File[prop] = request1.result[prop]\n                    }\n                }\n                const request2 = objectStore.get('wad1')\n                request2.onerror = _onerror\n                request2.onsuccess = function () {\n                    if (request2.result === undefined) {\n                        _onerror()\n                        return\n                    }\n                    that.wad1File = new WadFile()\n                    for (let prop in request2.result) { // class info are runtime info and not stored in cache => use copy constructor\n                        if (request2.result.hasOwnProperty(prop)) {\n                            that.wad1File[prop] = request2.result[prop]\n                        }\n                    }\n                    console.log('WAD files loaded from cache after ' + ((new Date().getTime() - that.startTime.getTime()) / 1000))\n                    that.startLoadingProcess()\n                }\n            }\n        })\n    }\n\n    /**\n     * Private helper method, which combines file loading and waits for them to become ready before continuing\n     * @param wad0Url Url to parse the LegoRR0.wad file from\n     * @param wad1Url Url to parse the LegoRR1.wad file from\n     */\n    loadWadFiles(wad0Url: string, wad1Url: string) {\n        const that = this\n        Promise.all([this.loadWadFile(wad0Url), this.loadWadFile(wad1Url)]).then(wadFiles => {\n            that.wad0File = wadFiles[0] as WadFile\n            that.wad1File = wadFiles[1] as WadFile\n            this.openLocalCache((objectStore) => {\n                objectStore.put(that.wad0File, 'wad0')\n                objectStore.put(that.wad1File, 'wad1')\n            })\n            this.startLoadingProcess()\n        })\n    }\n\n    /**\n     * Read WAD file as binary blob from the given URL and parse it on success\n     * @param url the url to the WAD file, can be local file url (file://...) too\n     */\n    loadWadFile(url: string) {\n        return new Promise(resolve => {\n            console.log('Loading WAD file from ' + url)\n            fetch(url).then((response) => {\n                if (response.ok) {\n                    response.arrayBuffer().then((buffer) => {\n                        const wadFile = new WadFile()\n                        wadFile.parseWadFile(buffer)\n                        resolve(wadFile)\n                    })\n                }\n            }).catch((e) => console.error(e))\n        })\n    }\n\n    openLocalCache(onopen: (IDBObjectStore) => void) {\n        const request: IDBOpenDBRequest = indexedDB.open('RockRaidersWeb')\n        request.onupgradeneeded = function () {\n            const db = request.result\n            if (db.objectStoreNames.contains('wadfiles')) {\n                db.deleteObjectStore('wadfiles')\n            }\n            db.createObjectStore('wadfiles')\n        }\n        request.onsuccess = function () {\n            const db = request.result\n            const transaction = db.transaction(['wadfiles'], 'readwrite')\n            const objectStore = transaction.objectStore('wadfiles')\n            onopen(objectStore)\n        }\n    }\n\n    /**\n     * Load essential files, to begin the chain of asset loading\n     */\n    startLoadingProcess() {\n        this.startTime = new Date()\n        this.assetsFromCfgByName = new Map()\n        this.onMessage('Loading configuration...')\n        const cfg = CfgFileParser.parse(this.wad1File.getEntryData('Lego.cfg'))\n        this.registerAllAssets(cfg)\n        this.onMessage('Loading initial assets...')\n        Promise.all([\n            new Promise<void>((resolve) => {\n                const name = iGet(cfg, 'Main', 'LoadScreen') // loading screen image\n                this.loadWadImageAsset(name, (imgData) => {\n                    this.onAssetLoaded(0, name, imgData)\n                    resolve()\n                })\n            }),\n            new Promise<void>((resolve) => {\n                const name = iGet(cfg, 'Main', 'ProgressBar') // loading bar container image\n                this.loadWadImageAsset(name, (imgData) => {\n                    this.onAssetLoaded(0, name, imgData)\n                    resolve()\n                })\n            }),\n            new Promise<void>((resolve) => {\n                const name = iGet(cfg, 'Pointers', 'Pointer_Standard')\n                this.loadAlphaImageAsset(name, (imgData) => {\n                    this.onAssetLoaded(0, name, imgData)\n                    resolve()\n                })\n            }),\n            new Promise<void>((resolve) => {\n                const name = 'Interface/Fonts/Font5_Hi.bmp'\n                this.loadFontImageAsset(name, (imgData) => {\n                    this.onAssetLoaded(0, name, imgData)\n                    resolve()\n                })\n            }),\n        ]).then(() => {\n            this.onMessage('Start loading assets...')\n            this.totalResources = this.assetsFromCfgByName.size\n            this.onInitialLoad(this.totalResources, cfg)\n            this.assetIndex = 0\n            this.loadAssetsParallel()\n        })\n    }\n\n}\n","import { InitLoadingMessage } from './InitLoadingMessage'\nimport { WadLoader } from './WadLoader'\nimport { WorkerMessage, WorkerMessageType } from './WorkerMessage'\n\nconst resourceWorker: Worker = self as any\n\nfunction postMessage(assetMessage: WorkerMessage) {\n    resourceWorker.postMessage(assetMessage)\n}\n\nresourceWorker.addEventListener('message', (event) => {\n    const wadLoader = new WadLoader()\n    // set callbacks on wadLoader\n    wadLoader.onMessage = (text: string) => postMessage(WorkerMessage.createTextMessage(text))\n    wadLoader.onInitialLoad = (totalResources: number, cfg: any) => postMessage(WorkerMessage.createCfgLoaded(cfg, totalResources))\n    wadLoader.onAssetLoaded = (assetIndex: number, assetName: string, assetObj: any) => {\n        postMessage(WorkerMessage.createAssetLoaded(assetIndex, assetName, assetObj))\n    }\n    wadLoader.onLoadDone = (totalResources: number, loadingTimeSeconds: string) => {\n        postMessage(WorkerMessage.createLoadDone(totalResources, loadingTimeSeconds))\n    }\n    // start loading\n    const msg = event.data as InitLoadingMessage\n    if (msg) {\n        wadLoader.loadWadFiles(msg.wad0FileUrl, msg.wad1FileUrl)\n    } else {\n        wadLoader.startWithCachedFiles(() => postMessage(new WorkerMessage(WorkerMessageType.CACHE_MISS)))\n    }\n})\n"],"sourceRoot":""}