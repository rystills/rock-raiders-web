(()=>{"use strict";const t=[];for(let e=0;e<256;e++)t[e]=e;t[130]=228,t[142]=196,t[162]=246,t[167]=220,t[171]=252,t[195]=223;var e=function(){function e(){}return e.parse=function(s){for(var a={},i=[],r=a,n=!1,o=0,l="",h="",d=0;d<s.length;d++){var u=s[d];123===u&&"FullName"===l&&(u=142);var c=String.fromCharCode(t[u]);if(";"===c||"/"===c?n=!0:10!==u&&13!==u||(n=!1),!n)if(u>32)0===o?"}"===c?r=i.pop():(o++,l=c):1===o?l+=c:2===o?"{"===c?(i.push(r),r={},i[i.length-1][l]=r,o=0):(o++,h=c):3===o&&(h+=c);else if(1===o)o++;else if(3===o){o=0;var f=e.parseValue(h);r.hasOwnProperty(l)?r[l].push(f):r[l]=[f]}}for(var p=[a],g=function(){var t=p.pop();Object.keys(t).forEach((function(e){var s=t[e];Array.isArray(s)?1===s.length?t[e]=s[0]:s.forEach((function(t){return p.push(t)})):Object.keys(s).length>1&&p.push(s)}))};p.length>0;)g();return Object.values(a["Lego*"].Levels).forEach((function(t){t.CryoreMap&&(t.CryOreMap=t.CryoreMap,delete t.CryoreMap),t.CryOreMap&&(t.CryOreMap=t.CryOreMap.replace("Cryo_","Cror_")),t.PredugMap&&(t.PreDugMap=t.PredugMap,delete t.PredugMap)})),a["Lego*"]},e.parseValue=function(t){function s(s){0===(t=t.split(s).filter((function(t){return""!==t})).map((function(t){return e.parseValue(t)}))).length?t="":1===t.length&&(t=t[0])}var a=Number(t);if(isNaN(a)){var i=(t=t.toString().replace(/\\/g,"/")).toLowerCase();return"true"===i||"false"!==i&&("null"===i?"":(t.includes(":")?s.call(this,":"):t.includes(",")?s.call(this,","):t.includes("|")&&s.call(this,"|"),t))}return a},e}(),s=function(){function e(){this.buffer=null,this.entryIndexByName=new Map,this.fLength=[],this.fStart=[]}return e.prototype.parseWadFile=function(t,e){void 0===e&&(e=!1);var s=new DataView(t);this.buffer=new Int8Array(t);var a=0;if("WWAD"!==String.fromCharCode.apply(null,this.buffer.slice(a,4)))throw"Invalid WAD0 file provided";e&&console.log("WAD0 file seems legit"),a=4;var i=s.getInt32(a,!0);e&&console.log(i);for(var r=a=8,n=0;n<i;a++)0===this.buffer[a]&&(this.entryIndexByName.set(String.fromCharCode.apply(null,this.buffer.slice(r,a)).replace(/\\/g,"/").toLowerCase(),n),r=a+1,n++);for(e&&console.log(this.entryIndexByName),n=0;n<i;a++)0===this.buffer[a]&&(r=a+1,n++);for(e&&console.log("Offset after absolute original names is "+a),n=0;n<i;n++)this.fLength[n]=s.getInt32(a+8,!0),this.fStart[n]=s.getInt32(a+12,!0),a+=16;e&&(console.log(this.fLength),console.log(this.fStart))},e.prototype.getEntryData=function(t){return new Uint8Array(this.getEntryBuffer(t))},e.prototype.getEntryText=function(e){return(new TextDecoder).decode(this.getEntryBuffer(e).map((function(e){return t[e]})))},e.prototype.getEntryBuffer=function(t){var e=this.entryIndexByName.get(t.toLowerCase());if(null==e)throw"Entry '"+t+"' not found in WAD file";return this.buffer.slice(this.fStart[e],this.fStart[e]+this.fLength[e])},e.prototype.filterEntryNames=function(t){var e=new RegExp(t.toLowerCase()),s=[];return this.entryIndexByName.forEach((function(t,a){a.match(e)&&s.push(a)})),s},e}();function a(t){if(!t)return t;var e=t.toString().replace(/\\/g,"/");e.startsWith("/")&&(e=e.substring(1));var s=e.lastIndexOf("/");return(e=e.substring(0,s+1)).startsWith("/")&&(e=e.substring(1)),e}function i(t){if(!t)return t;var e=t.toString().replace(/\\/g,"/");e.startsWith("/")&&(e=e.substring(1));var s=e.lastIndexOf("/");return e.substring(s+1)}function r(t){for(var e=[],s=1;s<arguments.length;s++)e[s-1]=arguments[s];return e.forEach((function(e){t=(t=Object.keys(t).filter((function(t){return t.toLowerCase()===e.toLowerCase()})).map((function(e){return t[e]})))?t[0]:t})),t}var n,o=function(){function t(){}return t.prototype.parse=function(t){var e=t.replace(/\r\n/g,"\n").replace(/\r/g,"\n").replace(/\t/g," ").split("\n").map((function(t){var e=t.indexOf("//");e>-1&&(t=t.substring(0,e));var s=t.indexOf(";");return s>-1&&(t=t.substring(0,s)),t})).map((function(t){return t.trim()})).filter((function(t){return""!==t})).map((function(t){return t.split(" ").filter((function(t){return""!==t}))})),s={};return this.parseObj(s,e,0),s},t.prototype.parseObj=function(t,e,s){for(var a=this,i=s;i<e.length;i++){var r=e[i],n=r[0],o=r[1],l=n.toLowerCase();if("{"===o)t[l]={},i=this.parseObj(t[l],e,i+1);else{if("}"===l)return i;for(var h=o.split(":").filter((function(t){return""!==t})).map((function(t){return t.split(",").map((function(t){return t.split("|").map((function(t){return a.parseValue(t)}))}))}));1===h.length;)h=h[0];t[l]=h}}return e.length},t.prototype.parseValue=function(t){var e=Number(t),s=t.toLowerCase();return isNaN(e)?"false"!==s&&("true"===s||t):e},t}();!function(t){t[t.BITMAP_INFO_HEADER=40]="BITMAP_INFO_HEADER",t[t.BITMAP_V2_INFO_HEADER=52]="BITMAP_V2_INFO_HEADER",t[t.BITMAP_V3_INFO_HEADER=56]="BITMAP_V3_INFO_HEADER",t[t.BITMAP_V4_HEADER=108]="BITMAP_V4_HEADER",t[t.BITMAP_V5_HEADER=124]="BITMAP_V5_HEADER"}(n||(n={}));var l,h,d=function(){function t(t,e){var s=(void 0===e?{toRGBA:!1}:e).toRGBA;if(this.buffer=t,this.bufferView=new DataView(t.buffer,t.byteOffset,t.byteLength),this.toRGBA=!!s,this.bottomUp=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos=2,"BM"!==this.flag)throw new Error("Invalid BMP File");this.locRed=this.toRGBA?0:3,this.locGreen=this.toRGBA?1:2,this.locBlue=this.toRGBA?2:1,this.locAlpha=this.toRGBA?3:0,this.parseHeader(),this.parseRGBA()}return t.prototype.parseHeader=function(){if(this.fileSize=this.readUInt32LE(),this.reserved1=this.bufferView.getUint16(this.pos,!0),this.pos+=2,this.reserved2=this.bufferView.getUint16(this.pos,!0),this.pos+=2,this.offset=this.readUInt32LE(),this.headerSize=this.readUInt32LE(),!(this.headerSize in n))throw new Error("Unsupported BMP header size "+this.headerSize);if(this.width=this.readUInt32LE(),this.height=this.readUInt32LE(),this.planes=this.bufferView.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.bufferView.getUint16(this.pos,!0),this.pos+=2,this.compression=this.readUInt32LE(),this.rawSize=this.readUInt32LE(),this.hr=this.readUInt32LE(),this.vr=this.readUInt32LE(),this.colors=this.readUInt32LE(),this.importantColors=this.readUInt32LE(),32===this.bitPP?(this.maskAlpha=0,this.maskRed=16711680,this.maskGreen=65280,this.maskBlue=255):16===this.bitPP&&(this.maskAlpha=0,this.maskRed=31744,this.maskGreen=992,this.maskBlue=31),(this.headerSize>n.BITMAP_INFO_HEADER||3===this.compression||6===this.compression)&&(this.maskRed=this.readUInt32LE(),this.maskGreen=this.readUInt32LE(),this.maskBlue=this.readUInt32LE()),(this.headerSize>n.BITMAP_V2_INFO_HEADER||6===this.compression)&&(this.maskAlpha=this.readUInt32LE()),this.headerSize>n.BITMAP_V3_INFO_HEADER&&(this.pos+=n.BITMAP_V4_HEADER-n.BITMAP_V3_INFO_HEADER),this.headerSize>n.BITMAP_V4_HEADER&&(this.pos+=n.BITMAP_V5_HEADER-n.BITMAP_V4_HEADER),this.bitPP<=8||this.colors>0){var t=0===this.colors?1<<this.bitPP:this.colors;this.palette=new Array(t);for(var e=0;e<t;e++){var s=this.buffer[this.pos++],a=this.buffer[this.pos++],i=this.buffer[this.pos++],r=this.buffer[this.pos++];this.palette[e]={red:i,green:a,blue:s,quad:r}}}this.height<0&&(this.height*=-1,this.bottomUp=!1);var o,l,h,d,u,c,f,p,g,m,A,y,v=(o=this.maskRed,l=this.maskGreen,h=this.maskBlue,d=this.maskAlpha,g=o/(u=1+~o&o)+1,m=l/(c=1+~l&l)+1,A=h/(f=1+~h&h)+1,y=d/(p=1+~d&d)+1,{shiftRed:function(t){return(t&o)/u*256/g},shiftGreen:function(t){return(t&l)/c*256/m},shiftBlue:function(t){return(t&h)/f*256/A},shiftAlpha:0!==d?function(t){return(t&d)/p*256/y}:function(){return 255}});this.shiftRed=v.shiftRed,this.shiftGreen=v.shiftGreen,this.shiftBlue=v.shiftBlue,this.shiftAlpha=v.shiftAlpha},t.prototype.parseRGBA=function(){switch(this.data=new Uint8Array(this.width*this.height*4),this.bitPP){case 1:this.bit1();break;case 4:this.bit4();break;case 8:this.bit8();break;case 16:this.bit16();break;case 24:this.bit24();break;default:this.bit32()}},t.prototype.bit1=function(){var t,e=this,s=Math.ceil(this.width/8),a=s%4,i=0!==a?4-a:0;this.scanImage(i,s,(function(s,a){a!==t&&(t=a);for(var i=e.buffer[e.pos++],r=a*e.width*4+8*s*4,n=0;n<8&&8*s+n<e.width;n++){var o=e.palette[i>>7-n&1];e.data[r+n*e.locAlpha]=0,e.data[r+4*n+e.locBlue]=o.blue,e.data[r+4*n+e.locGreen]=o.green,e.data[r+4*n+e.locRed]=o.red}}))},t.prototype.bit4=function(){var t=this;if(2===this.compression){this.data.fill(0);for(var e=!1,s=this.bottomUp?this.height-1:0,a=0;a<this.data.length;){var i=this.buffer[this.pos++],r=this.buffer[this.pos++];if(0===i){if(0===r){a=(s+=this.bottomUp?-1:1)*this.width*4,e=!1;continue}if(1===r)break;if(2===r){var n=this.buffer[this.pos++],o=this.buffer[this.pos++];s+=this.bottomUp?-o:o,a+=o*this.width*4+4*n}else{for(var l=this.buffer[this.pos++],h=0;h<r;h++)a=this.setPixelData(a,e?15&l:(240&l)>>4),1&h&&h+1<r&&(l=this.buffer[this.pos++]),e=!e;1==(r+1>>1&1)&&this.pos++}}else for(h=0;h<i;h++)a=this.setPixelData(a,e?15&r:(240&r)>>4),e=!e}}else{var d=Math.ceil(this.width/2),u=d%4,c=0!==u?4-u:0;this.scanImage(c,d,(function(e,s){var a=t.buffer[t.pos++],i=s*t.width*4+2*e*4,r=a>>4,n=t.palette[r];if(t.data[i]=0,t.data[i+1]=n.blue,t.data[i+2]=n.green,t.data[i+3]=n.red,2*e+1>=t.width)return!1;var o=15&a;n=t.palette[o],t.data[i+4]=0,t.data[i+4+1]=n.blue,t.data[i+4+2]=n.green,t.data[i+4+3]=n.red}))}},t.prototype.bit8=function(){var t=this;if(1===this.compression){this.data.fill(0);for(var e=this.bottomUp?this.height-1:0,s=0;s<this.data.length;){var a=this.buffer[this.pos++],i=this.buffer[this.pos++];if(0===a){if(0===i){s=(e+=this.bottomUp?-1:1)*this.width*4;continue}if(1===i)break;if(2===i){var r=this.buffer[this.pos++],n=this.buffer[this.pos++];e+=this.bottomUp?-n:n,s+=n*this.width*4+4*r}else{for(var o=0;o<i;o++){var l=this.buffer[this.pos++];s=this.setPixelData(s,l)}!0&i&&this.pos++}}else for(o=0;o<a;o++)s=this.setPixelData(s,i)}}else{var h=this.width%4,d=0!==h?4-h:0;this.scanImage(d,this.width,(function(e,s){var a=t.buffer[t.pos++],i=s*t.width*4+4*e;if(a<t.palette.length){var r=t.palette[a];t.data[i]=0,t.data[i+1]=r.blue,t.data[i+2]=r.green,t.data[i+3]=r.red}else t.data[i]=0,t.data[i+1]=255,t.data[i+2]=255,t.data[i+3]=255}))}},t.prototype.bit16=function(){var t=this,e=this.width%2*2;this.scanImage(e,this.width,(function(e,s){var a=s*t.width*4+4*e,i=t.bufferView.getUint16(t.pos,!0);t.pos+=2,t.data[a+t.locRed]=t.shiftRed(i),t.data[a+t.locGreen]=t.shiftGreen(i),t.data[a+t.locBlue]=t.shiftBlue(i),t.data[a+t.locAlpha]=t.shiftAlpha(i)}))},t.prototype.bit24=function(){var t=this,e=this.width%4;this.scanImage(e,this.width,(function(e,s){var a=s*t.width*4+4*e,i=t.buffer[t.pos++],r=t.buffer[t.pos++],n=t.buffer[t.pos++];t.data[a+t.locRed]=n,t.data[a+t.locGreen]=r,t.data[a+t.locBlue]=i,t.data[a+t.locAlpha]=0}))},t.prototype.bit32=function(){var t=this;this.scanImage(0,this.width,(function(e,s){var a=s*t.width*4+4*e,i=t.readUInt32LE();t.data[a+t.locRed]=t.shiftRed(i),t.data[a+t.locGreen]=t.shiftGreen(i),t.data[a+t.locBlue]=t.shiftBlue(i),t.data[a+t.locAlpha]=t.shiftAlpha(i)}))},t.prototype.scanImage=function(t,e,s){void 0===t&&(t=0),void 0===e&&(e=this.width);for(var a=this.height-1;a>=0;a--){for(var i=this.bottomUp?a:this.height-1-a,r=0;r<e;r++)s.call(this,r,i);this.pos+=t}},t.prototype.readUInt32LE=function(){var t=this.bufferView.getUint32(this.pos,!0);return this.pos+=4,t},t.prototype.setPixelData=function(t,e){var s=this.palette[e],a=s.blue,i=s.green,r=s.red;return this.data[t+this.locAlpha]=0,this.data[t+1+this.locBlue]=a,this.data[t+2+this.locGreen]=i,this.data[t+3+this.locRed]=r,t+4},t}(),u=function(){function t(){}return t.parse=function(t){for(var e=new d(t),s=new Uint8ClampedArray(e.data.length),a=0;a<e.data.length;a+=4)s[a]=e.data[a+3],s[a+1]=e.data[a+2],s[a+2]=e.data[a+1],s[a+3]=255-e.data[a];return new ImageData(s,e.width,e.height)},t}(),c=function(){function t(){}return t.setFromCfg=function(t,e){return Object.keys(e).forEach((function(s){var a=(s.startsWith("!")?s.substring(1):s).toLowerCase().replace(/_/g,"").replace(/-/g,"");Object.keys(t).some((function(i){return t.assignValue(i,a,e[s])}))||console.warn("cfg key does not exist: "+s)})),t},t.prototype.assignValue=function(t,e,s){if(t.toLowerCase()===e){var a=this[t],i=Array.isArray(a),r=this.parseValue(e,s),n=Array.isArray(r);return a&&i!==n&&i&&(r=[r]),this[t]=r,!0}},t.prototype.parseValue=function(t,e){return e},t}(),f=function(t){5===t.length||6===t.length?(this.actionName=t[0],this.x=t[1],this.y=t[2],this.label=t[3],this.target=t[4],this.flag=t[5],this.label=Array.isArray(this.label)?this.label.join(","):this.label,this.label=this.label.replace(/_/g," ")):8===t.length?(this.actionName=t[0],this.x=t[1],this.y=t[2],this.imgNormal=t[3],this.imgHover=t[4],this.imgPressed=t[5],this.tooltip=t[6],this.target=t[7]):(console.warn("Unexpected cfg object length: "+t.length),console.log(t))},p=function(t){this.actionName=t[0],this.x=t[1],this.y=t[2],this.width=t[3],this.height=t[4],this.description=t[5],this.min=t[6],this.max=t[7],this.imgOff=t[8],this.imgOn=t[9],this.imgLeft=t[10],this.imgRight=t[11],this.btnRightNormal=t[12],this.btnLeftNormal=t[13],this.btnRightHover=t[14],this.btnLeftHover=t[15]},g=function(t){this.actionName=t[0],this.x=t[1],this.y=t[2],this.width=t[3],this.height=t[4],this.description=t[5],this.two=t[6],this.labelOff=t[7],this.labelOn=t[8],this.description=this.description.replace(/_/g," ")},m=(l=function(t,e){return(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function s(){this.constructor=t}l(t,e),t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)}),A=function(t){function e(e){var s=t.call(this)||this;return s.fullName="",s.title="",s.position=[0,0],s.menuFont="",s.loFont="",s.hiFont="",s.itemCount=0,s.menuImage="",s.autoCenter=!1,s.displayTitle=!1,s.overlays=[],s.playRandom=!1,s.itemsLabel=[],s.itemsSlider=[],s.itemsCycle=[],s.anchored=!1,s.canScroll=!1,c.setFromCfg(s,e),s}return m(e,t),e.prototype.assignValue=function(e,s,a){if(s.match(/item\d+/i)){var i=a[0].toLowerCase();if("next"===i||"trigger"===i)this.itemsLabel.push(new f(a));else if("slider"===i)this.itemsSlider.push(new p(a));else{if("cycle"!==i)return console.warn("Unexpected item action name: "+a[0]),!1;this.itemsCycle.push(new g(a))}return!0}return s.match(/overlay\d+/i)?(this.overlays.push(a),!0):t.prototype.assignValue.call(this,e,s,a)},e.prototype.parseValue=function(e,s){return e==="fullName".toLowerCase()||"title"===e?s.replace(/_/g," "):t.prototype.parseValue.call(this,e,s)},e}(c),y=function(){var t=function(e,s){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])})(e,s)};return function(e,s){if("function"!=typeof s&&null!==s)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");function a(){this.constructor=e}t(e,s),e.prototype=null===s?Object.create(s):(a.prototype=s.prototype,new a)}}(),v=function(t){function e(e){var s=t.call(this)||this;return s.menuCount=0,s.menus=[],c.setFromCfg(s,e),s}return y(e,t),e.prototype.assignValue=function(e,s,a){return s.match(/menu\d+/i)?(this.menus.push(new A(a)),!0):t.prototype.assignValue.call(this,e,s,a)},e}(c),w=function(t){this.r=t[0],this.g=t[1],this.b=t[2]},b=function(t){this.filename=t[0],this.x=t[1],this.y=t[2]},I=function(){var t=function(e,s){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])})(e,s)};return function(e,s){if("function"!=typeof s&&null!==s)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");function a(){this.constructor=e}t(e,s),e.prototype=null===s?Object.create(s):(a.prototype=s.prototype,new a)}}(),F=function(t){var e=this;this.levelsByName=[],Object.keys(t).forEach((function(s){(s.startsWith("Tutorial")||s.startsWith("Level"))&&(e.levelsByName[s]=new E(t[s]))}))},E=function(t){function e(e){var s=t.call(this)||this;return s.fullName="",s.endGameAvi1="",s.endGameAvi2="",s.allowRename=!1,s.recallOLObjects=!1,s.generateSpiders=!1,s.video="",s.disableEndTeleport="",s.disableStartTeleport="",s.emergeTimeOut="",s.boulderAnimation="",s.noMultiSelect="",s.noAutoEat="",s.disableToolTipSound="",s.blockSize="",s.digDepth="",s.roughLevel="",s.roofHeight="",s.useRoof="",s.selBoxHeight="",s.fpRotLightRGB="",s.fogColourRGB="",s.highFogColourRGB="",s.fogRate=0,s.fallinMultiplier=0,s.numberOfLandSlidesTillCaveIn=0,s.noFallins=!1,s.oxygenRate=0,s.surfaceMap="",s.predugMap="",s.terrainMap="",s.emergeMap="",s.erodeMap="",s.fallinMap="",s.blockPointersMap="",s.cryOreMap="",s.pathMap="",s.noGather=!1,s.textureSet="",s.rockFallStyle="",s.emergeCreature="",s.safeCaverns="",s.seeThroughWalls="",s.oListFile="",s.ptlFile="",s.nerpFile="",s.nerpMessageFile="",s.objectiveText="",s.objectiveImage640x480=null,s.erodeTriggerTime=0,s.erodeErodeTime=0,s.erodeLockTime=0,s.nextLevel="",s.levelLinks="",s.frontEndX=0,s.frontEndY=0,s.frontEndOpen=!1,s.priorities=[],s.reward=null,s.menuBMP=[],c.setFromCfg(s,e),s}return I(e,t),e.prototype.parseValue=function(e,s){return e==="fullName".toLowerCase()?s.replace(/_/g," "):e.endsWith("rgb")?new w(s):"priorities"===e?Object.keys(s).filter((function(t){return t.toLowerCase()!=="AI_Priority_GetTool".toLowerCase()})).map((function(t){return new L(t,s[t])})):"reward"===e?new O(s):"objectiveimage640x480"===e?new b(s):t.prototype.parseValue.call(this,e,s)},e}(c),L=function(t,e){this.key=t.replace(/_/g,""),this.enabled=e},O=function(t){function e(e){var s=t.call(this)||this;return s.enable=!0,s.modifier=null,s.importance=null,s.quota=null,c.setFromCfg(s,e),s}return I(e,t),e.prototype.parseValue=function(e,s){return"importance"===e?new M(s):"quota"===e?new P(s):t.prototype.parseValue.call(this,e,s)},e}(c),M=function(t){function e(e){var s=t.call(this)||this;return s.crystals=0,s.timer=0,s.caverns=0,s.constructions=0,s.oxygen=0,s.figures=0,c.setFromCfg(s,e),s}return I(e,t),e}(c),P=function(t){function e(e){var s=t.call(this)||this;return s.crystals=null,s.timer=null,s.caverns=null,s.constructions=null,c.setFromCfg(s,e),s}return I(e,t),e}(c),C=function(){var t=function(e,s){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])})(e,s)};return function(e,s){if("function"!=typeof s&&null!==s)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");function a(){this.constructor=e}t(e,s),e.prototype=null===s?Object.create(s):(a.prototype=s.prototype,new a)}}(),x=function(t){function e(e){var s=t.call(this)||this;return s.display=!0,s.wallpaper="",s.images=[],s.texts=[],s.boxImages=[],s.fonts=null,s.flics=null,s.scrollSpeed=0,s.centreText=!1,s.vertSpacing=0,s.backFont="",s.font="",s.titleFont="",s.timer=0,s.saveButton="",s.advanceButton="",s.completeText="",s.failedText="",s.quitText="",s.textPos=[0,0],c.setFromCfg(s,e),s}return C(e,t),e.prototype.assignValue=function(e,s,a){var i=this;return"images"===s?(Object.values(a).forEach((function(t){return i.images.push(new T(t))})),!0):"text"===s?(Object.values(a).forEach((function(t){return i.texts.push(new _(t))})),!0):"boximages"===s?(Object.values(a).forEach((function(t){return i.boxImages.push(new T(t))})),!0):"fonts"===s?(this.fonts=new R(a),!0):t.prototype.assignValue.call(this,e,s,a)},e}(c),T=function(t){this.filePath="",this.x=0,this.y=0,this.filePath=t[0],this.x=t[1],this.y=t[2]},_=function(t){this.text="",this.x=0,this.y=0,this.text=t[0],this.x=t[1],this.y=t[2]},R=function(t){function e(e){var s=t.call(this)||this;return s.crystals="",s.ore="",s.diggable="",s.constructions="",s.caverns="",s.figures="",s.rockMonsters="",s.oxygen="",s.timer="",s.score="",c.setFromCfg(s,e),s}return C(e,t),e}(c),B=function(){function e(){}return e.prototype.parseObjectiveTextFile=function(e){for(var s={},a=h.DROP,i=null,r="",n="",o=0;o<e.length;o++){var l=t[e[o]],d=String.fromCharCode(l);if(a===h.DROP)if("["===d)i&&(s[i.key]=i),i=new W,a=h.KEY;else if(i&&":"===d){var u=n.toLowerCase();for("objective"===u?(n="",a=h.OBJECTIVE):"failure"===u?(n="",a=h.FAILURE):"completion"===u?(n="",a=h.COMPLETION):"crystalfailure"===u&&(n="",a=h.CRYSTAL_FAILURE);o<e.length&&e[o+1]==="\t".charCodeAt(0);o++);}else"\n"===d||"\r"===d?n="":n+=d;else if(a===h.KEY)if("]"===d)i.key=r,r="",a=h.DROP;else{if("\n"===d||"\r"===d)throw"Malformed objective text file";r+=d}else a===h.OBJECTIVE?"\n"===d||"\r"===d?(i.objective=r,r="",a=h.DROP):r+=d:a===h.FAILURE?"\n"===d||"\r"===d?(i.failure=r,r="",a=h.DROP):r+=d:a===h.COMPLETION?"\n"===d||"\r"===d?(i.completion=r,r="",a=h.DROP):r+=d:a===h.CRYSTAL_FAILURE&&("\n"===d||"\r"===d?(i.crystalFailure=r,r="",a=h.DROP):r+=d)}return i&&(s[i.key]=i),i=null,s},e}();!function(t){t[t.DROP=0]="DROP",t[t.KEY=1]="KEY",t[t.OBJECTIVE=2]="OBJECTIVE",t[t.FAILURE=3]="FAILURE",t[t.COMPLETION=4]="COMPLETION",t[t.CRYSTAL_FAILURE=5]="CRYSTAL_FAILURE"}(h||(h={}));var S,W=function(){},D=function(){function t(){this.wad0File=null,this.wad1File=null,this.assetIndex=0,this.totalResources=0,this.assetsFromCfgByName=new Map,this.onMessage=function(t){console.log(t)},this.onInitialLoad=function(){console.log("Initial loading done.")},this.onAssetLoaded=function(){},this.onLoadDone=function(t,e){console.log("Loading of about "+t+" assets complete! Total load time: "+e+" seconds.")}}return t.prototype.loadWadImageAsset=function(t,e){var s=this.wad0File.getEntryData(t);e(u.parse(s))},t.prototype.loadWadTexture=function(t,e){var s=this.wad0File.getEntryData(t),a=u.parse(s);if(function(t){var e=i(t);return!!(e.match(/\d\d\d\..+$/i)||e.match(/^trans/i)||e.match(/telepulse/i)||e.match(/^t_/i)||e.includes("crystalglow")||e.match(/^glin/i)||e.match(/glow.bmp/i)||e.match(/spankle/i))}(t))for(var r=0;r<a.data.length;r+=4)255===a.data[r]&&255===a.data[r+1]&&255===a.data[r+2]?a.data[r+3]=0:a.data[r+3]=Math.max(a.data[r],a.data[r+1],a.data[r+2]);else if(function(t){return!!i(t).match(/^a.+/i)}(t)){var n={r:a.data[a.data.length-4],g:a.data[a.data.length-3],b:a.data[a.data.length-2]};for(r=0;r<a.data.length;r+=4)a.data[r]===n.r&&a.data[r+1]===n.g&&a.data[r+2]===n.b&&(a.data[r+3]=0)}e(a)},t.prototype.loadAlphaImageAsset=function(t,e){for(var s=this.wad0File.getEntryData(t),a=u.parse(s),i=0;i<a.data.length;i+=4)a.data[i]<=2&&a.data[i+1]<=2&&a.data[i+2]<=2&&(a.data[i+3]=0);e(a)},t.prototype.loadFontImageAsset=function(t,e){var s=this.wad0File.getEntryData(t);e(u.parse(s))},t.prototype.loadNerpAsset=function(t,e){t=t.replace(/.npl$/,".nrn"),e(this.wad0File.getEntryText(t))},t.prototype.loadNerpMsg=function(t,e){for(var s=this.parseNerpMsgFile(this.wad0File,t),a=this.parseNerpMsgFile(this.wad1File,t),i=0;i<a.length;i++){var r=a[i];r&&(r.txt&&(s[i].txt=r.txt),r.snd&&(s[i].snd=r.snd))}e(s)},t.prototype.parseNerpMsgFile=function(t,e){for(var s=[],a=t.getEntryText(e).split("\n"),i=0;i<a.length;i++){var r=a[i].trim();if(!(r.length<1||"-"===r)){var n=r.match(/\\\[([^\\]+)\\](\s*#([^#]+)#)?/),o=r.match(/^([^$][^#]+)(\s*#([^#]+)#)?/),l=r.match(/\$([^\s]+)\s*([^\s]+)/);if(t===this.wad0File&&n)s[h=void 0!==n[3]?this.numericNameToNumber(n[3]):i]=s[h]||{},s[h].txt=n[1];else if(t===this.wad1File&&o)s[h=void 0!==o[3]?this.numericNameToNumber(o[3]):i]=s[h]||{},s[h].txt=o[1].replace(/_/g," ").trim();else{if(!l||3!==l.length)throw"Line in nerps message file did not match anything";var h;s[h=this.numericNameToNumber(l[1])]=s[h]||{},s[h].snd=l[2].replace(/\\/g,"/")}}}return s},t.prototype.numericNameToNumber=function(t){if(void 0===t)throw"Numeric name must not be undefined";var e={one:1,two:2,three:3,four:4,five:5,six:6,seven:7,eight:8,nine:9},s={twenty:20,thirty:30,forty:40},a={ten:10,eleven:11,twelve:12,thirteen:13,fourteen:14,fifteen:15,sixteen:16,seventeen:17,eighteen:18,nineteen:19}[t]||e[t];if(void 0===a&&Object.keys(s).forEach((function(i){if(t.startsWith(i)){var r=t.replace(i,"");a=s[i]+(r?e[r]:0)}})),void 0===a)throw"Found unexpected numeric name "+t;return a},t.prototype.loadObjectiveTexts=function(t,e){var s=this.wad1File.getEntryData(t);e((new B).parseObjectiveTextFile(s))},t.prototype.loadMapAsset=function(t,e){var s=this.wad0File.getEntryData(t);if(s.length<13||"MAP"!==String.fromCharCode.apply(String,s.slice(0,3)))console.log("Invalid map data provided");else{for(var a={width:s[8],height:s[12],level:[]},i=[],r=16;r<s.length;r+=2)i.push(s[r]),i.length>=a.width&&(a.level.push(i),i=[]);e(a)}},t.prototype.loadObjectListAsset=function(t,e){for(var s=this.wad0File.getEntryText(t).split("\n"),a=[],i=null,r=0;r<s.length;r++){var n=s[r].trim(),o=n.match(/(.+)\s+{/),l=n.match(/driving\s+(.+)/);if(n.length<1||n.startsWith(";")||n.startsWith("Lego*"));else if(o)i={},a[o[1]]=i;else if("}"===n)i=null;else if(l)i.driving=l[1];else{var h=n.split(/\s+/);if(2!==h.length||null===i)throw"Unexpected key value entry: "+n;var d=h[0],u=h[1];if("xPos"===d||"yPos"===d||"heading"===d)u=parseFloat(u);else if("type"!==d)throw"Unexpected key value entry: "+n;i[d]=u}}e(a)},t.prototype.loadWavAsset=function(t,e,s){console.error("wav asset loading not yet implemented")},t.prototype.loadLWOFile=function(t,e){var s;try{s=this.wad0File.getEntryBuffer(t)}catch(e){try{s=this.wad0File.getEntryBuffer("world/shared/"+i(t))}catch(e){return void console.error("Could not load LWO file "+t+"; Error: "+e)}}e(s.buffer)},t.prototype.registerAllAssets=function(t){var e=this;this.addAssetFolder(this.loadFontImageAsset,"Interface/Fonts/"),this.addAssetFolder(this.loadAlphaImageAsset,"Interface/Pointers/"),this.addMenuWithAssets(t,"MainMenuFull",!1),this.addMenuWithAssets(t,"PausedMenu"),this.addMenuWithAssets(t,"OptionsMenu"),this.addAsset(this.loadAlphaImageAsset,"Interface/BriefingPanel/BriefingPanel.bmp"),this.addAsset(this.loadObjectiveTexts,"Languages/ObjectiveText.txt"),this.addAlphaImageFolder("Interface/TopPanel/"),this.addAlphaImageFolder("Interface/RightPanel/"),this.addAlphaImageFolder("Interface/RadarPanel/"),this.addAlphaImageFolder("Interface/MessagePanel/"),this.addAsset(this.loadWadImageAsset,"Interface/Airmeter/msgpanel_air_juice.bmp"),this.addAlphaImageFolder("Interface/InfoPanel/"),this.addAlphaImageFolder("Interface/PriorityPanel/"),this.addAlphaImageFolder("Interface/Priorities"),this.addAlphaImageFolder("Interface/CameraControl/"),this.addAlphaImageFolder("Interface/MessageTabs/"),this.addAlphaImageFolder("Interface/IconPanel/"),this.addAlphaImageFolder("Interface/Icons/"),this.addAlphaImageFolder("Interface/Menus/"),this.addAlphaImageFolder("Interface/Buttons/"),this.addAlphaImageFolder("Interface/InfoImages/"),this.addAssetFolder(this.loadAlphaImageAsset,"Interface/FrontEnd/Vol_"),this.addAssetFolder(this.loadWadImageAsset,"Interface/FrontEnd/lp_"),this.addAsset(this.loadAlphaImageAsset,"Interface/FrontEnd/LowerPanel.bmp"),this.addAsset(this.loadNerpAsset,"Levels/nerpnrn.h");var s=new F(r(t,"Levels"));this.onAssetLoaded(0,"Levels",s),Object.values(s.levelsByName).forEach((function(t){t.menuBMP.forEach((function(t){e.addAsset(e.loadAlphaImageAsset,t)})),e.addAsset(e.loadMapAsset,t.surfaceMap),e.addAsset(e.loadMapAsset,t.predugMap),e.addAsset(e.loadMapAsset,t.terrainMap),e.addAsset(e.loadMapAsset,t.blockPointersMap,!0),e.addAsset(e.loadMapAsset,t.cryOreMap),e.addAsset(e.loadMapAsset,t.pathMap,!0),t.fallinMap&&e.addAsset(e.loadMapAsset,t.fallinMap),t.erodeMap&&e.addAsset(e.loadMapAsset,t.erodeMap),e.addAsset(e.loadObjectListAsset,t.oListFile),e.addAsset(e.loadNerpAsset,t.nerpFile),e.addAsset(e.loadNerpMsg,t.nerpMessageFile)})),this.addTextureFolder("World/Shared/");var a=t.BuildingTypes;Object.values(a).forEach((function(t){var s=t.split("/")[1],a=t+"/"+s+".ae";e.addAnimatedEntity(a)})),this.addAnimatedEntity("mini-figures/pilot/pilot.ae"),this.addAnimatedEntity("Creatures/SpiderSB/SpiderSB.ae"),this.addAnimatedEntity("Creatures/bat/bat.ae"),this.addAnimatedEntity(r(t,"MiscObjects","Dynamite")+"/Dynamite.ae"),this.addAsset(this.loadLWOFile,"World/Shared/Crystal.lwo"),this.addAsset(this.loadLWOFile,r(t,"MiscObjects","Crystal")+".lwo"),this.addTextureFolder("MiscAnims/Crystal/");var i=r(t,"MiscObjects","Ore");this.addAsset(this.loadLWOFile,i+".lwo"),this.addAsset(this.loadWadTexture,"MiscAnims/Ore/Ore.bmp"),this.addAsset(this.loadLWOFile,"World/Shared/Brick.lwo"),this.addAsset(this.loadLWOFile,r(t,"MiscObjects","ProcessedOre")+".lwo"),this.addAnimatedEntity(r(t,"MiscObjects","Barrier")+"/Barrier.ae"),this.addAnimatedEntity("MiscAnims/Dynamite/Dynamite.ae"),this.addLWSFile("MiscAnims/RockFall/Rock3Sides.lws"),this.addTextureFolder("MiscAnims/RockFall/"),this.addTextureFolder("World/WorldTextures/IceSplit/Ice"),this.addTextureFolder("World/WorldTextures/LavaSplit/Lava"),this.addTextureFolder("World/WorldTextures/RockSplit/Rock");var n=new x(r(t,"Reward"));this.onAssetLoaded(0,"Reward",n),this.addAsset(this.loadWadImageAsset,n.wallpaper),this.addAsset(this.loadFontImageAsset,n.backFont),Object.values(n.fonts).forEach((function(t){return e.addAsset(e.loadFontImageAsset,t)})),n.images.forEach((function(t){return e.addAsset(e.loadAlphaImageAsset,t.filePath)})),n.boxImages.forEach((function(t){return e.addAsset(e.loadWadImageAsset,t.filePath)})),n.saveButton.splice(0,4).forEach((function(t){return e.addAsset(e.loadWadImageAsset,t)})),n.advanceButton.splice(0,4).forEach((function(t){return e.addAsset(e.loadWadImageAsset,t)}))},t.prototype.addAnimatedEntity=function(t){var e=this,s=this.wad0File.getEntryText(t),i=r((new o).parse(s),"Lego*");this.onAssetLoaded(0,t,i);var n=a(t);["HighPoly","MediumPoly","LowPoly"].forEach((function(t){var s=r(i,t);s&&Object.keys(s).forEach((function(t){e.addAsset(e.loadLWOFile,n+s[t]+".lwo")}))}));var l=r(i,"Activities");l&&Object.keys(l).forEach((function(t){try{var s=r(l,t),a=r(i,s),o=r(a,"FILE");!0===r(a,"LWSFILE")?e.addLWSFile(n+o+".lws"):console.error("Found activity which is not an LWS file")}catch(e){console.error(e),console.log(i),console.log(l),console.log(t)}})),this.addTextureFolder(a(t))},t.prototype.addLWSFile=function(t){var e=this,s=this.wad0File.getEntryText(t);this.onAssetLoaded(0,t,s),this.extractLwoFiles(a(t),s).forEach((function(t){return e.addAsset(e.loadLWOFile,t)}))},t.prototype.extractLwoFiles=function(t,e){var s=e.replace(/\r\n/g,"\n").replace(/\r/g,"\n").replace(/\t/g," ").split("\n").map((function(t){return t.trim()}));if("LWSC"!==s[0])throw"Invalid start of file! Expected 'LWSC' in first line";return s.filter((function(t){return t.toLowerCase().startsWith("LoadObject ".toLowerCase())})).map((function(e){return t+i(e.substring("LoadObject ".length)).toLowerCase()}))},t.prototype.addAlphaImageFolder=function(t){this.addAssetFolder(this.loadAlphaImageAsset,t)},t.prototype.addTextureFolder=function(t){this.addAssetFolder(this.loadWadTexture,t)},t.prototype.addAssetFolder=function(t,e){var s=this;this.wad0File.filterEntryNames(e+".+\\.bmp").forEach((function(e){s.addAsset(t,e)}))},t.prototype.addMenuWithAssets=function(t,e,s){var a=this;void 0===s&&(s=!0);var i=new v(r(t,"Menu",e));this.onAssetLoaded(0,e,i),i.menus.forEach((function(t){var e=s?a.loadAlphaImageAsset:a.loadWadImageAsset,i=Array.isArray(t.menuImage)?t.menuImage[0]:t.menuImage;a.addAsset(e,i),a.addAsset(a.loadFontImageAsset,t.menuFont),a.addAsset(a.loadFontImageAsset,t.loFont),a.addAsset(a.loadFontImageAsset,t.hiFont)}))},t.prototype.addAsset=function(t,e,s){void 0===s&&(s=!1),e&&!this.assetsFromCfgByName.hasOwnProperty(e)&&"NULL"!==e&&this.assetsFromCfgByName.set(e,{method:t.bind(this),assetPath:e,optional:s})},t.prototype.loadAssetsParallel=function(){var t=this,e=[],s=this;this.assetsFromCfgByName.forEach((function(a){e.push(new Promise((function(e){try{a.method(a.assetPath,(function(i){t.assetIndex++,s.onAssetLoaded(t.assetIndex,a.assetPath,i),e()}))}catch(i){if(!a.optional)throw i;t.assetIndex++,s.onAssetLoaded(t.assetIndex,a.assetPath,null),e()}})))})),Promise.all(e).then((function(){var e=(((new Date).getTime()-t.startTime.getTime())/1e3).toFixed(3).toString();t.onLoadDone(t.totalResources,e)}))},t.prototype.startWithCachedFiles=function(t){var e=this;this.startTime=new Date;var a=function(){e.onMessage("WAD files not found in cache"),t()};this.onMessage("Loading WAD files from cache...");var i=this;this.openLocalCache((function(t){var e=t.get("wad0");e.onerror=a,e.onsuccess=function(){if(void 0!==e.result){for(var r in i.wad0File=new s,e.result)e.result.hasOwnProperty(r)&&(i.wad0File[r]=e.result[r]);var n=t.get("wad1");n.onerror=a,n.onsuccess=function(){if(void 0!==n.result){for(var t in i.wad1File=new s,n.result)n.result.hasOwnProperty(t)&&(i.wad1File[t]=n.result[t]);console.log("WAD files loaded from cache after "+((new Date).getTime()-i.startTime.getTime())/1e3),i.startLoadingProcess()}else a()}}else a()}}))},t.prototype.loadWadFiles=function(t,e){var s=this,a=this;Promise.all([this.loadWadFile(t),this.loadWadFile(e)]).then((function(t){a.wad0File=t[0],a.wad1File=t[1],s.openLocalCache((function(t){t.put(a.wad0File,"wad0"),t.put(a.wad1File,"wad1")})),s.startLoadingProcess()}))},t.prototype.loadWadFile=function(t){return new Promise((function(e){console.log("Loading WAD file from "+t),fetch(t).then((function(t){t.ok&&t.arrayBuffer().then((function(t){var a=new s;a.parseWadFile(t),e(a)}))})).catch((function(t){return console.error(t)}))}))},t.prototype.openLocalCache=function(t){var e=indexedDB.open("RockRaidersWeb");e.onupgradeneeded=function(){var t=e.result;t.objectStoreNames.contains("wadfiles")&&t.deleteObjectStore("wadfiles"),t.createObjectStore("wadfiles")},e.onsuccess=function(){var s=e.result.transaction(["wadfiles"],"readwrite").objectStore("wadfiles");t(s)}},t.prototype.startLoadingProcess=function(){var t=this;this.startTime=new Date,this.assetsFromCfgByName=new Map,this.onMessage("Loading configuration...");var s=e.parse(this.wad1File.getEntryData("Lego.cfg"));this.registerAllAssets(s),this.onMessage("Loading initial assets..."),Promise.all([new Promise((function(e){var a=r(s,"Main","LoadScreen");t.loadWadImageAsset(a,(function(s){t.onAssetLoaded(0,a,s),e()}))})),new Promise((function(e){var a=r(s,"Main","ProgressBar");t.loadWadImageAsset(a,(function(s){t.onAssetLoaded(0,a,s),e()}))})),new Promise((function(e){var a=r(s,"Pointers","Pointer_Standard");t.loadAlphaImageAsset(a,(function(s){t.onAssetLoaded(0,a,s),e()}))})),new Promise((function(e){var s="Interface/Fonts/Font5_Hi.bmp";t.loadFontImageAsset(s,(function(a){t.onAssetLoaded(0,s,a),e()}))}))]).then((function(){t.onMessage("Start loading assets..."),t.totalResources=t.assetsFromCfgByName.size,t.onInitialLoad(t.totalResources,s),t.assetIndex=0,t.loadAssetsParallel()}))},t}(),N=function(){function t(t){this.type=null,this.type=t}return t.createTextMessage=function(t){return{type:S.MSG,text:t}},t.createCfgLoaded=function(t,e){return{type:S.CFG,cfg:t,totalResources:e}},t.createAssetLoaded=function(t,e,s){return{type:S.ASSET,assetIndex:t,assetName:e,assetObj:s}},t.createLoadDone=function(t,e){return{type:S.DONE,totalResources:t,loadingTimeSeconds:e}},t}();!function(t){t[t.MSG=0]="MSG",t[t.CFG=1]="CFG",t[t.CACHE_MISS=2]="CACHE_MISS",t[t.SFX=3]="SFX",t[t.ASSET=4]="ASSET",t[t.DONE=5]="DONE"}(S||(S={}));var j=self;function k(t){j.postMessage(t)}j.addEventListener("message",(function(t){var e=new D;e.onMessage=function(t){return k(N.createTextMessage(t))},e.onInitialLoad=function(t,e){return k(N.createCfgLoaded(e,t))},e.onAssetLoaded=function(t,e,s){k(N.createAssetLoaded(t,e,s))},e.onLoadDone=function(t,e){k(N.createLoadDone(t,e))};var s=t.data;s?e.loadWadFiles(s.wad0FileUrl,s.wad1FileUrl):e.startWithCachedFiles((function(){return k(new N(S.CACHE_MISS))}))}))})();
//# sourceMappingURL=index.worker.js.map