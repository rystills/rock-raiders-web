(self.webpackChunkrock_raiders_web=self.webpackChunkrock_raiders_web||[]).push([[969],{930:(t,e,s)=>{"use strict";s.d(e,{p:()=>i});class i{constructor(){this.buttonType=null,this.normalFile=null,this.highlightFile=null,this.pressedFile=null,this.disabledFile=null,this.relX=0,this.relY=0,this.width=0,this.height=0,this.tooltip=null}}},935:(t,e,s)=>{"use strict";s.d(e,{l:()=>i});class i{static setFromCfg(t,e){return Object.keys(e).forEach((s=>{var i;const n=(s.startsWith("!")?s.substring(1):s).toLowerCase().replace(/_/g,"").replace(/-/g,"");Object.keys(t).some((i=>t.assignValue(i,n,e[s])))||console.warn("cfg key: "+s+" does not exist in cfg: "+(null===(i=null==t?void 0:t.constructor)||void 0===i?void 0:i.name))})),t}assignValue(t,e,s){if(t.toLowerCase()===e){const i=this[t],n=Array.isArray(i);let r=this.parseValue(e,s);const h=Array.isArray(r);return i&&n!==h&&n&&(r=[r]),this[t]=r,!0}}parseValue(t,e){return e}}},234:(t,e,s)=>{"use strict";s.d(e,{l:()=>i});class i{constructor(t){[this.filename,this.xOut,this.yOut,this.xIn,this.yIn]=t}}},538:(t,e,s)=>{"use strict";function i(t,...e){return e.forEach((e=>{t=(t=Object.keys(t).filter((t=>t.toLowerCase()===e.toLowerCase())).map((e=>t[e])))?t[0]:t})),t}function n(t){return t&&clearTimeout(t),null}s.d(e,{hh:()=>i,L4:()=>n}),Array.prototype.remove=function(t){const e=this.indexOf(t);-1!==e&&this.splice(e,1)},Array.prototype.last=function(){return this.length>0?this[this.length-1]:void 0},Array.prototype.count=function(t){let e=0;return this.forEach((s=>t(s)&&e++)),e},Array.prototype.partition=function(t){const e=[],s=[];return this.forEach((i=>t(i)?e.push(i):s.push(i))),[e,s]},Map.prototype.getOrUpdate=function(t,e){let s=this.get(t);return void 0===s&&(s=e(),this.set(t,s)),s},String.prototype.equalsIgnoreCase=function(t){return this.toLowerCase()===(null==t?void 0:t.toLowerCase())}},320:(t,e,s)=>{"use strict";var i;s.d(e,{Z:()=>i}),function(t){t[t.SELECTION_CHANGED=0]="SELECTION_CHANGED",t[t.BUILDINGS_CHANGED=1]="BUILDINGS_CHANGED",t[t.RAIDERS_CHANGED=2]="RAIDERS_CHANGED",t[t.MATERIAL_AMOUNT_CHANGED=3]="MATERIAL_AMOUNT_CHANGED",t[t.JOB_CREATE=4]="JOB_CREATE",t[t.JOB_DELETE=5]="JOB_DELETE",t[t.REQUESTED_RAIDERS_CHANGED=6]="REQUESTED_RAIDERS_CHANGED",t[t.CAVERN_DISCOVERED=7]="CAVERN_DISCOVERED",t[t.ORE_FOUND=8]="ORE_FOUND",t[t.AIR_LEVEL_CHANGED=9]="AIR_LEVEL_CHANGED",t[t.CHANGE_PRIORITY_LIST=10]="CHANGE_PRIORITY_LIST",t[t.SETUP_PRIORITY_LIST=11]="SETUP_PRIORITY_LIST",t[t.CHANGE_CURSOR=12]="CHANGE_CURSOR",t[t.COMMAND_CHANGE_RAIDER_SPAWN_REQUEST=13]="COMMAND_CHANGE_RAIDER_SPAWN_REQUEST",t[t.COMMAND_CREATE_POWER_PATH=14]="COMMAND_CREATE_POWER_PATH",t[t.COMMAND_PLACE_FENCE=15]="COMMAND_PLACE_FENCE",t[t.COMMAND_MAKE_RUBBLE=16]="COMMAND_MAKE_RUBBLE",t[t.COMMAND_CREATE_CLEAR_RUBBLE_JOB=17]="COMMAND_CREATE_CLEAR_RUBBLE_JOB",t[t.COMMAND_CREATE_DRILL_JOB=18]="COMMAND_CREATE_DRILL_JOB",t[t.COMMAND_CREATE_REINFORCE_JOB=19]="COMMAND_CREATE_REINFORCE_JOB",t[t.COMMAND_CREATE_DYNAMITE_JOB=20]="COMMAND_CREATE_DYNAMITE_JOB",t[t.COMMAND_CANCEL_SURFACE_JOBS=21]="COMMAND_CANCEL_SURFACE_JOBS",t[t.COMMAND_CHANGE_BUILDING_POWER_STATE=22]="COMMAND_CHANGE_BUILDING_POWER_STATE",t[t.COMMAND_UPGRADE_BUILDING=23]="COMMAND_UPGRADE_BUILDING",t[t.COMMAND_BUILDING_BEAMUP=24]="COMMAND_BUILDING_BEAMUP",t[t.COMMAND_RAIDER_EAT=25]="COMMAND_RAIDER_EAT",t[t.COMMAND_PICK_TOOL=26]="COMMAND_PICK_TOOL",t[t.COMMAND_RAIDER_UPGRADE=27]="COMMAND_RAIDER_UPGRADE",t[t.COMMAND_RAIDER_BEAMUP=28]="COMMAND_RAIDER_BEAMUP",t[t.COMMAND_TRAIN_RAIDER=29]="COMMAND_TRAIN_RAIDER",t[t.COMMAND_RAIDER_DROP=30]="COMMAND_RAIDER_DROP",t[t.COMMAND_SELECT_BUILD_MODE=31]="COMMAND_SELECT_BUILD_MODE",t[t.COMMAND_CANCEL_BUILD_MODE=32]="COMMAND_CANCEL_BUILD_MODE",t[t.LOCATION_DEATH=33]="LOCATION_DEATH",t[t.LOCATION_MONSTER=34]="LOCATION_MONSTER",t[t.LOCATION_CRYSTAL_FOUND=35]="LOCATION_CRYSTAL_FOUND",t[t.LOCATION_UNDER_ATTACK=36]="LOCATION_UNDER_ATTACK",t[t.LOCATION_LANDSLIDE=37]="LOCATION_LANDSLIDE",t[t.LOCATION_POWER_DRAIN=38]="LOCATION_POWER_DRAIN",t[t.LOCATION_SLUG_EMERGE=39]="LOCATION_SLUG_EMERGE",t[t.LOCATION_RAIDER_DISCOVERED=40]="LOCATION_RAIDER_DISCOVERED"}(i||(i={}))},796:(t,e,s)=>{"use strict";function i(t,e){if(t<1||e<1)return console.error("Can't create context with size "+t+" x "+e),function(t,e){const s=i(64,64);for(let t=0;t<64;t+=16)for(let e=0;e<64;e+=16)s.fillStyle=e/16%2==t/16%2?"rgb(0,255,255)":"rgb(255,0,255)",s.fillRect(e,t,16,16);return s}();let s;"undefined"!=typeof document?(s=document.createElement("canvas"),s.setAttribute("width",t),s.setAttribute("height",e)):s=new OffscreenCanvas(t,e);const n=s.getContext("2d");return n.width=t,n.height=e,n}function n(t,e){const s=new ImageData(t,e);for(let i=0;i<e;i+=16)for(let e=0;e<t;e+=16){const t=e/16%2==i/16%2;for(let n=e;n<e+16;n++)for(let e=i;e<i+16;e++)r(s,n,e,t?0:255,t?255:0,255)}return s}function r(t,e,s,i,n,r,h=255){const a=4*(s*t.width+e);t.data[a]=i,t.data[a+1]=n,t.data[a+2]=r,t.data[a+3]=h}function h(t,e,s){const i=4*(s*t.width+e);return{r:t.data[i],g:t.data[i+1],b:t.data[i+2],a:t.data[i+3]}}s.d(e,{x:()=>l});class a{constructor(t,e=10,s=19){this.letters=[];const i=[" ","!",'"',"#","$","%","⌵","`","(",")","*","+",",","-",".","/","0","1","2","3","4","5","6","7","8","9",":",";","<","=",">","?","@","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","[","\\","]","^","_","'","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","Ä","Å","Á","À","Â","Ã","Ą","ä","å","á","à","â","ã","ą","Ë","E̊","É","È","É","Ę","ë","e̊","é","è","e̊","ę̊","","","","","","","","","Ö","","","","","ö","","","","","Ü","","","","ü","","","","","","","","","","","","","","","","","","","","","","","","ß","","","","Ñ","","ñ",""],r=t.width/e;function h(t){for(let e=0;e<t.height/s;e++){let s=4*e*t.width;if(255!==t.data[s]&&255!==t.data[s+2]){for(let e=0;e<r;e++){let s=4*e;if(255===t.data[s]||255===t.data[s+2])return e}return r}}return 0}this.charHeight=t.height/s;for(let e=0;e<i.length;e++){let s=this.extractData(t,e%10*r,Math.floor(e/10)*this.charHeight,r,this.charHeight),a=h(s);s=a>0?this.extractData(s,0,0,a,this.charHeight):n(r,this.charHeight),this.letters[i[e]]=s}}extractData(t,e,s,i,n){const a=h(t,e+i-1,s+n-1),o=new ImageData(i,n);for(let E=0;E<i;E++)for(let i=0;i<n;i++){const n=h(t,e+E,s+i);n.r===a.r&&n.g===a.g&&n.b===a.b&&(n.a=0),r(o,E,i,n.r,n.g,n.b,n.a)}return o}createTextImage(t,e,s=!0){if(null==t||t.length<1)return i(1,1).canvas;t=t.replace(/_/g," ");const n=this.determineRows(t,e),a=Math.max(...n.map((t=>t.width))),o=new ImageData(a,this.charHeight*n.length);n.forEach(((t,e)=>{const i=s?Math.round((a-t.width)/2):0,n=e*this.charHeight;let E=0;for(let e=0;e<t.text.length;e++){const s=this.letters[t.text.charAt(e)];if(s){for(let t=E;t<E+s.width;t++)for(let e=0;e<s.height;e++){const a=h(s,t-E,e);r(o,i+t,n+e,a.r,a.g,a.b,a.a)}E+=s.width}}}));const E=i(o.width,o.height);return E.putImageData(o,0,0),E.canvas}determineRows(t,e){const s=this.letters[" "].width,i=[];let n="",r=0;return t.split(" ").map((t=>{let h=0;for(let e=0;e<t.length;e++){const s=t.charAt(e),i=this.letters[s];i?h+=i.width:console.error("Letter '"+s+"' not found in charset! Ignoring it")}return r>0?!e||r+s+h<e?(n+=" "+t,r+=s+h):(i.push({text:n,width:r}),n=t,r=h):(n+=t,r+=h),h})),r>0&&i.push({text:n,width:r}),i}}var o=s(538);class E{static cfg(...t){return(0,o.hh)(this.configuration,...t)}static getResource(t){var e;const s=(null===(e=null==t?void 0:t.toString())||void 0===e?void 0:e.toLowerCase())||null;return this.resourceByName.get(s)||null}static getImageData(t){if(!t)throw"imageName must not be undefined, null or empty - was "+t;return this.resourceByName.getOrUpdate(t.toLowerCase(),(()=>(console.error("Image '"+t+"' unknown! Using placeholder image instead"),n(64,64))))}static getImage(t){const e=this.getImageData(t),s=i(e.width,e.height);return s.putImageData(e,0,0),s.canvas}static getImageOrNull(t){return t?this.getImage(t):null}static getBitmapFont(t){return this.fontCache.getOrUpdate(t,(()=>{const e=this.getResource(t);if(!e)throw"Could not load font image data for: "+t;return new a(e)}))}static getDefaultFont(){return this.getBitmapFont("Interface/Fonts/Font5_Hi.bmp")}}E.configuration={},E.resourceByName=new Map,E.fontCache=new Map;class l extends E{}},360:(t,e,s)=>{"use strict";s.d(e,{H:()=>n});var i=s(320);class n{constructor(t){this.parent=null,this.x=0,this.y=0,this.relX=0,this.relY=0,this.width=0,this.height=0,this.children=[],this.hidden=!1,this.disabled=!1,this.hover=!1,this.pressed=!1,this.onPublishEvent=t=>console.log("TODO publish event: "+i.Z[t.eventKey]),this.parent=t}reset(){this.hidden=!1,this.disabled=!1,this.hover=!1,this.pressed=!1,this.children.forEach((t=>t.reset()))}addChild(t){return t.parent=this,this.children.push(t),t.updatePosition(),t}onRedraw(t){this.hidden||(this.children.forEach((e=>e.onRedraw(t))),this.children.forEach((e=>e.drawHover(t))),this.children.forEach((e=>e.drawTooltip(t))))}drawHover(t){}drawTooltip(t){}onClick(){}isInactive(){for(let t=this.parent;t;t=t.parent)if(t.isInactive())return!0;return this.hidden||this.disabled}hide(){this.hidden=!0,this.children.forEach((t=>t.hide()))}show(){this.hidden=!1,this.children.forEach((t=>t.show()))}updatePosition(){this.x=this.parent?this.parent.x+this.relX:this.relX,this.y=this.parent?this.parent.y+this.relY:this.relY,this.children.forEach((t=>t.updatePosition()))}isInRect(t,e){return t>=this.x&&e>=this.y&&t<this.x+this.width&&e<this.y+this.height}checkHover(t,e){if(this.isInactive())return!1;const s=this.isInRect(t,e);let i=this.hover!==s;return this.hover=s,this.pressed=this.pressed&&this.hover,this.children.forEach((s=>i=s.checkHover(t,e)||i)),i}checkClick(t,e){if(this.isInactive())return!1;const s=this.isInRect(t,e);let i=this.pressed!==s;return this.pressed=s,this.children.forEach((s=>i=s.checkClick(t,e)||i)),i}checkRelease(t,e){if(this.isInactive())return!1;this.isInRect(t,e)&&this.pressed&&this.onClick();let s=!1;return this.children.forEach((i=>s=i.checkRelease(t,e)||s)),s=this.pressed||s,this.pressed=!1,s}release(){let t=this.pressed||this.hover;return this.pressed=!1,this.hover=!1,this.children.forEach((e=>t=e.release()||t)),t}notifyRedraw(){var t;null===(t=this.parent)||void 0===t||t.notifyRedraw()}publishEvent(t){this.parent?this.parent.publishEvent(t):this.onPublishEvent(t)}registerEventListener(t,e){this.parent.registerEventListener(t,e)}}},211:(t,e,s)=>{"use strict";s.d(e,{z:()=>r});var i=s(796),n=s(360);class r extends n.H{constructor(t,e){var s,n,r,h,a;super(t),this.buttonType=null,this.imgNormal=null,this.imgHover=null,this.imgPressed=null,this.imgDisabled=null,this.tooltip=null,this.buttonType=e.buttonType,this.imgNormal=i.x.getImageOrNull(e.normalFile),this.imgHover=i.x.getImageOrNull(e.highlightFile),this.imgPressed=i.x.getImageOrNull(e.pressedFile),this.imgDisabled=i.x.getImageOrNull(e.disabledFile),this.relX=e.relX,this.relY=e.relY,this.width=e.width||(null===(s=this.imgNormal)||void 0===s?void 0:s.width)||(null===(n=this.imgPressed)||void 0===n?void 0:n.width),this.height=e.height||(null===(r=this.imgNormal)||void 0===r?void 0:r.height)||(null===(h=this.imgPressed)||void 0===h?void 0:h.height),this.tooltip=null===(a=e.tooltip)||void 0===a?void 0:a.replace(/_/g," "),this.updatePosition()}onClick(){console.log("button pressed: "+this.buttonType)}checkHover(t,e){const s=super.checkHover(t,e);return s&&this.notifyRedraw(),s}checkClick(t,e){const s=super.checkClick(t,e);return s&&this.notifyRedraw(),s}checkRelease(t,e){const s=super.checkRelease(t,e);return s&&this.notifyRedraw(),s}release(){const t=super.release();return t&&this.notifyRedraw(),t}onRedraw(t){if(this.hidden)return;let e=this.imgNormal;this.disabled?e=this.imgDisabled||this.imgPressed||this.imgNormal:this.pressed?e=this.imgPressed||this.imgNormal:this.hover&&(e=this.imgHover||this.imgNormal),e&&t.drawImage(e,this.x,this.y),super.onRedraw(t)}}},670:(t,e,s)=>{"use strict";s.d(e,{s:()=>a});var i=s(538),n=s(848),r=s(796),h=s(360);class a extends h.H{constructor(t,e){super(t),this.img=null,this.xOut=0,this.yOut=0,this.xIn=0,this.yIn=0,this.animationTimeout=null,this.movedIn=!0,e&&(this.img=r.x.getImage(e.filename),this.xOut=e.xOut,this.yOut=e.yOut,this.xIn=e.xIn,this.yIn=e.yIn,this.relX=this.xIn,this.relY=this.yIn)}reset(){super.reset(),this.animationTimeout=(0,i.L4)(this.animationTimeout),this.relX=this.xIn,this.relY=this.yIn,this.movedIn=!0,this.updatePosition()}isInactive(){return this.animationTimeout||super.isInactive()}setMovedIn(t,e=null){this.movedIn!==t?this.toggleState(e):e&&e()}toggleState(t=null){this.animationTimeout=(0,i.L4)(this.animationTimeout),this.movedIn?(this.movedIn=!1,this.updateAnimation(this.xOut,this.yOut,n.CM,t)):(this.movedIn=!0,this.updateAnimation(this.xIn,this.yIn,n.CM,t))}updateAnimation(t,e,s,i){const r=t-this.relX,h=e-this.relY;if(Math.abs(r)<=s&&Math.abs(h)<=s)this.relX=t,this.relY=e,this.animationTimeout=null,i&&i();else{this.relX+=Math.round(Math.sign(r)*Math.sqrt(Math.abs(r))*s),this.relY+=Math.round(Math.sign(h)*Math.sqrt(Math.abs(h))*s);const a=this;this.animationTimeout=setTimeout((()=>a.updateAnimation(t,e,s,i)),1e3/n.OK)}this.updatePosition(),this.notifyRedraw()}onRedraw(t){this.hidden||(this.img&&t.drawImage(this.img,this.x,this.y),super.onRedraw(t))}}},346:(t,e,s)=>{"use strict";var i;s.d(e,{n:()=>i}),function(t){t[t.MSG=0]="MSG",t[t.CFG=1]="CFG",t[t.CACHE_MISS=2]="CACHE_MISS",t[t.SFX=3]="SFX",t[t.ASSET=4]="ASSET",t[t.DONE=5]="DONE",t[t.INIT=6]="INIT",t[t.CANVAS=7]="CANVAS",t[t.REDRAW=8]="REDRAW",t[t.RESET=9]="RESET",t[t.EVENT_POINTER=10]="EVENT_POINTER",t[t.EVENT_KEY=11]="EVENT_KEY",t[t.EVENT_WHEEL=12]="EVENT_WHEEL",t[t.RESPONSE_EVENT=13]="RESPONSE_EVENT",t[t.OVERLAY_SETUP=14]="OVERLAY_SETUP",t[t.SPACE_TO_CONINUE=15]="SPACE_TO_CONINUE",t[t.SHOW_OPTIONS=16]="SHOW_OPTIONS",t[t.GAME_ABORT=17]="GAME_ABORT",t[t.GAME_RESTART=18]="GAME_RESTART",t[t.GAME_EVENT=19]="GAME_EVENT"}(i||(i={}))},18:(t,e,s)=>{"use strict";s.d(e,{x:()=>o});var i=s(800),n=s(360),r=s(848),h=s(346);class a extends class{constructor(t){this.messageState=null,this.type=t}}{constructor(t){super(h.n.GAME_EVENT),this.gameEvent=t}}class o extends class{constructor(t){this.canvas=null,this.context=null,this.eventListener=new Map,this.worker=t}redraw(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}reset(){}setCanvas(t){this.canvas=t,this.context=t.getContext("2d"),this.context.scale(this.canvas.width/r.Du,this.canvas.height/r.DG),this.redraw()}handlePointerEvent(t){return!1}handleKeyEvent(t){return!1}handleWheelEvent(t){return!1}sendResponse(t){this.worker.postMessage(t)}sendEventResponse(t){this.sendResponse(t)}processMessage(t){if(t.type===h.n.CANVAS)this.setCanvas(t.canvas);else if(t.type===h.n.EVENT_POINTER){const e=this.handlePointerEvent(t.inputEvent);this.sendEventResponse({type:h.n.RESPONSE_EVENT,eventId:t.eventId,eventConsumed:e})}else if(t.type===h.n.EVENT_KEY){const e=this.handleKeyEvent(t.inputEvent);this.sendEventResponse({type:h.n.RESPONSE_EVENT,eventId:t.eventId,eventConsumed:e})}else if(t.type===h.n.EVENT_WHEEL){const e=this.handleWheelEvent(t.inputEvent);this.sendEventResponse({type:h.n.RESPONSE_EVENT,eventId:t.eventId,eventConsumed:e})}else if(t.type===h.n.RESET)this.reset();else if(t.type===h.n.REDRAW)this.redraw();else if(t.type===h.n.GAME_EVENT){const e=t.gameEvent;this.eventListener.getOrUpdate(e.eventKey,(()=>[])).forEach((t=>t(e)))}else this.onProcessMessage(t)||console.warn("Worker ignores message of type: "+h.n[t.type]);return!0}publishEvent(t){this.sendResponse(new a(t))}registerEventListener(t,e){this.eventListener.getOrUpdate(t,(()=>[])).push(e)}}{constructor(t){super(t),this.rootElement=new n.H(null),this.panels=[],this.rootElement.notifyRedraw=()=>this.redraw(),this.rootElement.publishEvent=t=>{this.publishEvent(t)},this.rootElement.registerEventListener=(t,e)=>{this.registerEventListener(t,e)}}redraw(){super.redraw(),this.rootElement.onRedraw(this.context)}reset(){super.reset(),this.panels.forEach((t=>t.reset()))}addPanel(t){return this.rootElement.addChild(t),this.panels.push(t),t}handlePointerEvent(t){const[e,s]=[t.canvasX,t.canvasY],[n,h]=[e/(this.canvas.width/r.Du),s/(this.canvas.height/r.DG)].map((t=>Math.round(t))),a=this.context&&this.context.getImageData(e,s,1,1).data[3]>0;return a?t.eventEnum===i.iW.MOVE?this.rootElement.checkHover(n,h):t.eventEnum===i.iW.DOWN?t.button===i.T.MAIN&&this.rootElement.checkClick(n,h):t.eventEnum===i.iW.UP&&t.button===i.T.MAIN&&this.rootElement.checkRelease(n,h):t.eventEnum===i.iW.MOVE&&this.rootElement.release(),a}handleWheelEvent(t){return!this.context||this.context.getImageData(t.canvasX,t.canvasY,1,1).data[3]>0}}}}]);
//# sourceMappingURL=969.index.js.map