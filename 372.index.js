(()=>{"use strict";var e,t,i={800:(e,t,i)=>{var s,r,a;i.d(t,{T:()=>s,iW:()=>r,Zf:()=>a}),function(e){e[e.MAIN=0]="MAIN",e[e.MIDDLE=1]="MIDDLE",e[e.SECONDARY=2]="SECONDARY"}(s||(s={})),function(e){e[e.MOVE=0]="MOVE",e[e.DOWN=1]="DOWN",e[e.UP=2]="UP"}(r||(r={})),function(e){e[e.DOWN=0]="DOWN",e[e.UP=1]="UP"}(a||(a={}))},89:(e,t,i)=>{i.d(t,{FB:()=>g,RD:()=>u,s4:()=>m});var s=i(986),r=i(625),a=i(599),n=i(352),h=i(378),l=i(260),o=i(320),c=i(722);class d extends c.Z{constructor(e){super(e),this.isLocal=!0}}class g extends d{constructor(e=l.R.NOTHING,t=null,i=null,c=null){super(o.Z.SELECTION_CHANGED),this.canDoTraining=new Map,this.everyHasTool=new Map,this.selectionType=e,this.isGround=(null==t?void 0:t.surfaceType)===a.c.GROUND,this.isPowerPath=(null==t?void 0:t.surfaceType)===a.c.POWER_PATH,this.isFloor=null==t?void 0:t.surfaceType.floor,this.isSite=(null==t?void 0:t.surfaceType)===a.c.POWER_PATH_CONSTRUCTION||(null==t?void 0:t.surfaceType)===a.c.POWER_PATH_BUILDING_SITE,this.hasRubble=null==t?void 0:t.hasRubble(),this.isDrillable=null==t?void 0:t.isDrillable(),this.isDrillableHard=null==t?void 0:t.isDrillableHard(),this.isReinforcable=null==t?void 0:t.isReinforcable(),this.canPlaceFence=(null==t?void 0:t.canPlaceFence())&&r.D.buildings.some((e=>e.entityType===s.p.POWER_STATION&&e.isUsable())),this.someCarries=!!(null==c?void 0:c.some((e=>!!e.carries))),this.everyHasMaxLevel=!!(null==c?void 0:c.every((e=>e.level>=e.stats.Levels))),h.Y_.forEach((e=>this.canDoTraining.set(e,r.D.getTrainingSites(e).length>0&&(null==c?void 0:c.some((t=>!t.hasTraining(e))))))),n.C.forEach((e=>this.everyHasTool.set(e,!!(null==c?void 0:c.every((t=>t.hasTool(e))))))),this.buildingCanUpgrade=null==i?void 0:i.canUpgrade(),this.buildingCanSwitchPower=!(null==i?void 0:i.stats.SelfPowered)&&!(null==i?void 0:i.stats.PowerBuilding)}}class u extends d{constructor(e,t=null){super(o.Z.CHANGE_CURSOR),this.cursor=e,this.timeout=t}}class m extends d{constructor(e){super(o.Z.PLAY_SOUND),this.sample=e}}},986:(e,t,i)=>{var s,r;i.d(t,{p:()=>s}),function(e){e[e.PILOT=0]="PILOT",e[e.TOOLSTATION=1]="TOOLSTATION",e[e.TELEPORT_PAD=2]="TELEPORT_PAD",e[e.DOCKS=3]="DOCKS",e[e.POWER_STATION=4]="POWER_STATION",e[e.BARRACKS=5]="BARRACKS",e[e.UPGRADE=6]="UPGRADE",e[e.GEODOME=7]="GEODOME",e[e.ORE_REFINERY=8]="ORE_REFINERY",e[e.GUNSTATION=9]="GUNSTATION",e[e.TELEPORT_BIG=10]="TELEPORT_BIG",e[e.BAT=11]="BAT",e[e.SMALL_SPIDER=12]="SMALL_SPIDER",e[e.DYNAMITE=13]="DYNAMITE",e[e.ELECTRIC_FENCE=14]="ELECTRIC_FENCE",e[e.CRYSTAL=15]="CRYSTAL",e[e.ORE=16]="ORE",e[e.BRICK=17]="BRICK",e[e.BARRIER=18]="BARRIER"}(s||(s={})),function(e){e[e.RAIDER=0]="RAIDER",e[e.BUILDING=1]="BUILDING",e[e.MONSTER=2]="MONSTER",e[e.MATERIAL=3]="MATERIAL"}(r||(r={}))},625:(e,t,i)=>{i.d(t,{D:()=>c});var s,r=i(815),a=i(89),n=i(848),h=i(986),l=i(378),o=i(260);!function(e){e[e.RUNNING=0]="RUNNING",e[e.COMPLETE=1]="COMPLETE",e[e.FAILED=2]="FAILED"}(s||(s={}));class c{static reset(){this.resultState=s.RUNNING,this.numCrystal=0,this.numOre=0,this.numBrick=0,this.usedCrystals=0,this.neededCrystals=0,this.airLevel=1,this.selectedEntities=[],this.selectionType=null,this.buildings=[],this.buildingsUndiscovered=[],this.raiders=[],this.raidersUndiscovered=[],this.requestedRaiders=0,this.materials=[],this.materialsUndiscovered=[],this.buildingSites=[],this.spiders=[],this.spidersBySurface=new Map,this.bats=[],this.totalCrystals=0,this.totalOres=0,this.totalDiggables=0,this.remainingDiggables=0,this.totalCaverns=0,this.discoveredCaverns=0,this.levelStartTime=0,this.levelStopTime=0,this.oxygenRate=0,this.buildModeSelection=null}static getBuildingsByType(...e){return this.buildings.filter((t=>t.isUsable()&&e.some((e=>t.entityType===e))))}static getClosestBuildingByType(e,...t){const i=c.getBuildingsByType(...t);let s=null,r=null;return i.forEach((t=>{const i=t.getDropPosition(),a=e.distanceToSquared(i);(null===s||a<r)&&(s=t,r=a)})),s}static getTrainingSites(e){return this.buildings.filter((t=>t.entityType===l.u1[e]&&t.isUsable()&&t.stats[l.gd[e]][t.level]))}static selectEntities(e){this.selectedEntities=this.selectedEntities.filter((t=>{const i=-1!==e.indexOf(t);return i||t.deselect(),i})),e.forEach((e=>{e.select()&&this.selectedEntities.push(e)}));const t=this.selectedEntities.length;t>1?this.selectionType=o.R.GROUP:1===t?this.selectionType=this.selectedEntities[0].getSelectionType():null!==this.selectionType&&(this.selectionType=o.R.NOTHING),r.N.publishEvent(new a.FB(this.selectionType,this.selectedSurface,this.selectedBuilding,this.selectedRaiders))}static getMaxRaiders(){return n.d+c.buildings.count((e=>e.isUsable()&&e.entityType===h.p.BARRACKS))*n.oq}static discoverSurface(e){const t=e.x*n.pM,i=e.y*n.pM,s=t+n.pM,r=i+n.pM;this.discoverEntities(this.raidersUndiscovered,t,s,i,r),this.discoverEntities(this.buildingsUndiscovered,t,s,i,r),this.discoverEntities(this.materialsUndiscovered,t,s,i,r)}static discoverEntities(e,t,i,s,r){const a=[];e.forEach((e=>{const n=e.getPosition();n.x>=t&&n.x<i&&n.z>=s&&n.z<r&&(e.onDiscover(),a.push(e))})),a.forEach((t=>e.remove(t)))}static get gameTimeSeconds(){return Math.round((c.levelStopTime-c.levelStartTime)/1e3)}static get selectedSurface(){return this.selectionType===o.R.SURFACE&&this.selectedEntities.length>0?this.selectedEntities[0]:null}static get selectedBuilding(){return this.selectionType===o.R.BUILDING&&this.selectedEntities.length>0?this.selectedEntities[0]:null}static get selectedRaiders(){return(this.selectionType===o.R.RAIDER||this.selectionType===o.R.GROUP)&&this.selectedEntities.length>0?this.selectedEntities:[]}static get totalOre(){return this.numOre+5*this.numBrick}static getNearbySpiders(e){const t=e.sceneMgr.terrain,i=t.getSurfaceFromWorld(e.getPosition()),s=[];for(let e=i.x;e<=i.x+1;e++)for(let r=i.y;r<=i.y+1;r++){const i=t.getSurface(e,r);s.push(...c.spidersBySurface.get(i)||[])}return s}}c.resultState=s.RUNNING,c.numCrystal=0,c.numOre=0,c.numBrick=0,c.usedCrystals=0,c.neededCrystals=0,c.airLevel=1,c.selectedEntities=[],c.selectionType=null,c.buildings=[],c.buildingsUndiscovered=[],c.raiders=[],c.raidersUndiscovered=[],c.requestedRaiders=0,c.materials=[],c.materialsUndiscovered=[],c.buildingSites=[],c.spiders=[],c.spidersBySurface=new Map,c.bats=[],c.totalCrystals=0,c.totalOres=0,c.totalDiggables=0,c.remainingDiggables=0,c.totalCaverns=0,c.discoveredCaverns=0,c.levelStartTime=0,c.levelStopTime=0,c.oxygenRate=0,c.buildModeSelection=null},260:(e,t,i)=>{var s;i.d(t,{R:()=>s}),function(e){e[e.NOTHING=0]="NOTHING",e[e.SURFACE=1]="SURFACE",e[e.RAIDER=2]="RAIDER",e[e.BUILDING=3]="BUILDING",e[e.VEHICLE=4]="VEHICLE",e[e.GROUP=5]="GROUP"}(s||(s={}))},599:(e,t,i)=>{i.d(t,{c:()=>r});var s=i(505);class r{constructor(e={}){this.shaping=!1,this.matIndex="00",this.floor=!1,this.selectable=!1,this.drillable=!1,this.drillableHard=!1,this.explodable=!1,this.reinforcable=!1,this.cursor=s.C.Pointer_Standard,this.cursorFulfiller=s.C.Pointer_Standard,this.statsDrillName=null,this.canCarryFence=!1,Object.assign(this,e)}static getByNum(e){switch(e){case 0:return r.POWER_PATH_BUILDING;case 1:return r.SOLID_ROCK;case 2:return r.HARD_ROCK;case 3:return r.LOOSE_ROCK;case 4:case 5:return r.DIRT;case 6:return r.LAVA;case 8:return r.ORE_SEAM;case 9:return r.WATER;case 10:return r.CRYSTAL_SEAM;case 11:return r.RECHARGE_SEAM;case 30:case 40:return r.SLUG_HOLE;case 100:return r.RUBBLE4;case 101:return r.RUBBLE3;case 102:return r.RUBBLE2;case 103:return r.RUBBLE1;default:return console.error("Unexpected surface type num: "+e),r.SOLID_ROCK}}}r.GROUND=new r({name:"ground",floor:!0,selectable:!0,canCarryFence:!0}),r.SOLID_ROCK=new r({name:"solid rock",shaping:!0,matIndex:"5",cursor:s.C.Pointer_SurfaceType_Immovable}),r.HARD_ROCK=new r({name:"hard rock",shaping:!0,matIndex:"4",selectable:!0,drillableHard:!0,explodable:!0,reinforcable:!0,cursor:s.C.Pointer_SurfaceType_Hard,statsDrillName:"HardDrillTime"}),r.LOOSE_ROCK=new r({name:"loose rock",shaping:!0,matIndex:"3",selectable:!0,drillable:!0,drillableHard:!0,explodable:!0,reinforcable:!0,cursor:s.C.Pointer_SurfaceType_Medium,statsDrillName:"LooseDrillTime"}),r.DIRT=new r({name:"dirt",shaping:!0,matIndex:"2",selectable:!0,drillable:!0,drillableHard:!0,explodable:!0,reinforcable:!0,cursor:s.C.Pointer_SurfaceType_Loose,statsDrillName:"SoilDrillTime"}),r.SLUG_HOLE=new r({name:"slug hole",floor:!0,matIndex:"30"}),r.LAVA=new r({name:"lava",floor:!0,matIndex:"46"}),r.ORE_SEAM=new r({name:"ore seam",matIndex:"40",selectable:!0,drillable:!0,drillableHard:!0,explodable:!0,reinforcable:!0,cursor:s.C.Pointer_SurfaceType_OreSeam,statsDrillName:"SeamDrillTime"}),r.WATER=new r({name:"water",floor:!0,matIndex:"45"}),r.CRYSTAL_SEAM=new r({name:"energy crystal seam",matIndex:"20",selectable:!0,drillable:!0,drillableHard:!0,explodable:!0,reinforcable:!0,cursor:s.C.Pointer_SurfaceType_CrystalSeam,statsDrillName:"SeamDrillTime"}),r.RECHARGE_SEAM=new r({name:"recharge seam",matIndex:"67",cursor:s.C.Pointer_SurfaceType_RechargeSeam}),r.POWER_PATH=new r({name:"power path all",floor:!0,matIndex:"60",selectable:!0,canCarryFence:!0}),r.POWER_PATH_BUILDING_SITE=new r({name:"power path building site",floor:!0,matIndex:"61",selectable:!0,canCarryFence:!0}),r.POWER_PATH_BUILDING=new r({name:"power path building",floor:!0,matIndex:"76"}),r.POWER_PATH_CONSTRUCTION=new r({name:"power path construction",floor:!0,matIndex:"76",selectable:!0}),r.RUBBLE1=new r({name:"rubble 1",floor:!0,matIndex:"13",selectable:!0,canCarryFence:!0,cursorFulfiller:s.C.Pointer_Clear}),r.RUBBLE2=new r({name:"rubble 2",floor:!0,matIndex:"12",selectable:!0,canCarryFence:!0,cursorFulfiller:s.C.Pointer_Clear}),r.RUBBLE3=new r({name:"rubble 3",floor:!0,matIndex:"11",selectable:!0,canCarryFence:!0,cursorFulfiller:s.C.Pointer_Clear}),r.RUBBLE4=new r({name:"rubble 4",floor:!0,matIndex:"10",selectable:!0,canCarryFence:!0,cursorFulfiller:s.C.Pointer_Clear})},352:(e,t,i)=>{var s;i.d(t,{C:()=>r}),function(e){e[e.DRILL=0]="DRILL",e[e.HAMMER=1]="HAMMER",e[e.SHOVEL=2]="SHOVEL",e[e.SPANNER=3]="SPANNER",e[e.FREEZERGUN=4]="FREEZERGUN",e[e.LASER=5]="LASER",e[e.PUSHERGUN=6]="PUSHERGUN",e[e.BIRDSCARER=7]="BIRDSCARER"}(s||(s={}));const r=[s.DRILL,s.HAMMER,s.SHOVEL,s.SPANNER,s.FREEZERGUN,s.LASER,s.PUSHERGUN,s.BIRDSCARER]},378:(e,t,i)=>{i.d(t,{Y_:()=>a,u1:()=>n,gd:()=>h});var s,r=i(986);!function(e){e[e.DRIVER=0]="DRIVER",e[e.ENGINEER=1]="ENGINEER",e[e.GEOLOGIST=2]="GEOLOGIST",e[e.PILOT=3]="PILOT",e[e.SAILOR=4]="SAILOR",e[e.DEMOLITION=5]="DEMOLITION"}(s||(s={}));const a=[s.DRIVER,s.ENGINEER,s.GEOLOGIST,s.PILOT,s.SAILOR,s.DEMOLITION],n=[];n[s.DRIVER]=r.p.BARRACKS,n[s.DRIVER]=r.p.BARRACKS,n[s.ENGINEER]=r.p.UPGRADE,n[s.GEOLOGIST]=r.p.GEODOME,n[s.PILOT]=r.p.TELEPORT_PAD,n[s.SAILOR]=r.p.DOCKS,n[s.DEMOLITION]=r.p.TOOLSTATION;const h=[];h[s.DRIVER]="TrainDriver",h[s.ENGINEER]="TrainRepair",h[s.GEOLOGIST]="TrainScanner",h[s.PILOT]="TrainPilot",h[s.SAILOR]="TrainSailor",h[s.DEMOLITION]="TrainDynamite"},848:(e,t,i)=>{i.d(t,{Sl:()=>s,d:()=>r,oq:()=>a,CM:()=>n,Du:()=>h,DG:()=>l,pM:()=>o,OK:()=>c});const s=!1,r=12,a=10,n=3,h=640,l=480,o=40,c=30},633:(e,t,i)=>{var s=i(800),r=i(211),a=i(670),n=i(458);class h{constructor(e){this.x=0,this.y=0,this.w=0,this.h=0,[this.x,this.y,this.w,this.h]=e}}var l=i(935);class o extends l.l{constructor(e){super(),this.image=null,this.titleWindow=null,this.textWindow=null,this.okWindow=null,this.cancelWindow=null,this.contrastOverlay=null,l.l.setFromCfg(this,e)}parseValue(e,t){return e.endsWith("window")?new h(t):super.parseValue(e,t)}}var c=i(234);class d extends c.l{constructor(){super([]),this.titleFont=n.x.getBitmapFont("Interface/Fonts/MbriefFont2.bmp"),this.title=n.x.cfg("Main","MissionBriefingText");const e=new o(n.x.cfg("Dialog"));this.titleWindow=e.titleWindow,this.textFont=n.x.getBitmapFont("Interface/Fonts/MbriefFont.bmp"),this.textWindow=e.textWindow,this.textWindow.y-=10,this.nextButtonCfg={buttonType:"Next briefing paragraph",relX:394,relY:214,normalFile:n.x.cfg("Main","NextButton640x480")},this.backButtonCfg={buttonType:"Previous briefing paragraph",relX:54,relY:214,normalFile:n.x.cfg("Main","BackArrow")}}}class g extends a.s{constructor(e){super(e),this.cfg=null,this.imgTitle=null,this.titleRelX=0,this.titleRelY=0,this.btnNext=null,this.btnBack=null,this.imgBack=null,this.imgParagraphList=[],this.paragraph=0,this.imgParagraph=null,this.onSetSpaceToContinue=e=>console.log("Message: press space to continue = "+e),this.cfg=new d,this.imgTitle=this.cfg.titleFont.createTextImage(this.cfg.title),this.titleRelX=this.cfg.titleWindow.x+(this.cfg.titleWindow.w-this.imgTitle.width)/2,this.titleRelY=this.cfg.titleWindow.y,this.btnNext=this.addChild(new r.z(this,this.cfg.nextButtonCfg)),this.btnNext.onClick=()=>this.nextParagraph(),this.btnBack=this.addChild(new r.z(this,this.cfg.backButtonCfg)),this.btnBack.onClick=()=>this.prevParagraph(),this.hidden=!0}reset(){super.reset(),this.hidden=!0,this.setParagraph(0)}setup(e,t){this.imgBack=n.x.getImageOrNull(t.filename),this.xIn=t.x,this.yIn=t.y,this.width=this.imgBack.width,this.height=this.imgBack.height,this.updatePosition(),this.imgParagraphList=e.split("\\a").map((e=>this.cfg.textFont.createTextImage(e,this.cfg.textWindow.w,!1)))}setParagraph(e){if(!(e<0)){if(e>this.imgParagraphList.length-1)return this.hide(),void this.notifyRedraw();this.paragraph=e,this.imgParagraph=this.imgParagraphList[this.paragraph],this.btnNext.hidden=this.paragraph>=this.imgParagraphList.length-1,this.btnBack.hidden=this.paragraph<1,this.notifyRedraw()}}nextParagraph(){this.setParagraph(this.paragraph+1)}prevParagraph(){this.setParagraph(this.paragraph-1)}show(){super.show(),this.setParagraph(0),this.btnNext.hidden=this.paragraph>=this.imgParagraphList.length-1,this.btnBack.hidden=this.paragraph<1,this.onSetSpaceToContinue(!0)}hide(){super.hide(),this.onSetSpaceToContinue(!1)}onRedraw(e){this.hidden||(this.imgBack&&e.drawImage(this.imgBack,this.x,this.y),this.imgTitle&&e.drawImage(this.imgTitle,this.x+this.titleRelX,this.y+this.titleRelY),this.imgParagraph&&e.drawImage(this.imgParagraph,this.x+this.cfg.textWindow.x,this.y+this.cfg.textWindow.y),super.onRedraw(e))}}var u=i(848),m=i(360);class p extends m.H{constructor(e,t){super(e),this.labelX=0,this.state=!1,this.relX=t.x,this.relY=t.y,this.labelX=t.width,this.imgTextNormal=e.loFont.createTextImage(t.description),this.imgTextHover=e.hiFont.createTextImage(t.description),this.imgLabelOffNormal=e.loFont.createTextImage(t.labelOff),this.imgLabelOffHover=e.hiFont.createTextImage(t.labelOff),this.imgLabelOnNormal=e.loFont.createTextImage(t.labelOn),this.imgLabelOnHover=e.hiFont.createTextImage(t.labelOn),this.width=t.width+Math.max(this.imgLabelOnHover.width,this.imgLabelOffHover.width),this.height=this.imgTextNormal.height,this.onClick=()=>{this.state=!this.state,console.log("TODO: cycle item clicked; state: "+this.state)}}checkHover(e,t){const i=super.checkHover(e,t);return i&&this.notifyRedraw(),i}checkClick(e,t){const i=super.checkClick(e,t);return i&&this.notifyRedraw(),i}checkRelease(e,t){const i=super.checkRelease(e,t);return i&&this.notifyRedraw(),i}release(){const e=super.release();return e&&this.notifyRedraw(),e}onRedraw(e){if(this.hidden)return;let t=this.imgTextNormal,i=this.state?this.imgLabelOnNormal:this.imgLabelOffNormal;this.hover&&(t=this.imgTextHover,i=this.state?this.imgLabelOnHover:this.imgLabelOffHover),e.drawImage(t,this.x,this.y),e.drawImage(i,this.x+this.labelX,this.y),super.onRedraw(e)}}class R extends m.H{constructor(e,t,i){super(e),this.target=t.target,this.loImg=e.loFont.createTextImage(t.label),this.hiImg=e.hiFont.createTextImage(t.label),this.width=this.loImg.width,this.height=this.loImg.height,this.relX=i?-e.relX+(e.menuImage.width-this.width)/2:t.x,this.relY=t.y}checkHover(e,t){const i=super.checkHover(e,t);return i&&this.notifyRedraw(),i}checkClick(e,t){const i=super.checkClick(e,t);return i&&this.notifyRedraw(),i}checkRelease(e,t){const i=super.checkRelease(e,t);return i&&this.notifyRedraw(),i}release(){const e=super.release();return e&&this.notifyRedraw(),e}onRedraw(e){this.hidden||(this.hover?e.drawImage(this.hiImg,this.x,this.y):e.drawImage(this.loImg,this.x,this.y),super.onRedraw(e))}}var E=i(930);class T extends m.H{constructor(e,t){super(e),this.sliderX=0,this.min=0,this.max=1,this.value=0,this.onValueChanged=e=>console.log("value changed to: "+e),this.relX=t.x,this.relY=t.y,this.sliderX=t.width,this.imgLeft=n.x.getImage(t.imgLeft),this.imgNormal=n.x.getImage(t.imgOff),this.imgHover=n.x.getImage(t.imgOn),this.imgRight=n.x.getImage(t.imgRight);const i=this.addChild(new r.z(this,new E.p));i.imgNormal=n.x.getImage(t.btnLeftNormal),i.imgHover=n.x.getImage(t.btnLeftHover),i.relX=this.sliderX-this.imgLeft.width-i.imgHover.width,i.width=i.imgHover.width,i.height=i.imgHover.height,i.updatePosition(),i.onClick=()=>{this.value>this.min&&(this.value--,this.onValueChanged(this.value))};const s=this.addChild(new r.z(this,new E.p));s.imgNormal=n.x.getImage(t.btnRightNormal),s.imgHover=n.x.getImage(t.btnRightHover),s.relX=this.sliderX+this.imgNormal.width+2*this.imgRight.width,s.width=s.imgHover.width,s.height=s.imgHover.height,s.updatePosition(),s.onClick=()=>{this.value<this.max&&(this.value++,this.onValueChanged(this.value))},this.width=t.width+i.imgHover.width+this.imgLeft.width+this.imgNormal.width+2*this.imgRight.width+s.imgHover.width,this.min=t.min,this.max=t.max||1,this.value=this.min,this.imgTextNormal=e.loFont.createTextImage(t.description),this.imgTextHover=e.hiFont.createTextImage(t.description),this.height=this.imgTextNormal.height}checkHover(e,t){const i=super.checkHover(e,t);return i&&this.notifyRedraw(),i}onRedraw(e){if(this.hidden)return;let t=this.imgTextNormal;this.hover&&(t=this.imgTextHover),e.drawImage(t,this.x,this.y);let i=this.x+this.sliderX;e.drawImage(this.imgLeft,i,this.y),e.drawImage(this.imgNormal,i,this.y);const s=Math.round(this.value/this.max*this.imgHover.width);e.drawImage(this.imgHover,0,0,s,this.imgHover.height,i,this.y,s,this.imgHover.height),i+=this.imgNormal.width,e.drawImage(this.imgRight,i,this.y),super.onRedraw(e)}}class f extends m.H{constructor(e,t){super(e),this.itemsTrigger=[],this.itemsNext=[],this.relX=t.position[0],this.relY=t.position[1],this.menuImage=n.x.getImageOrNull(t.menuImage[0]),this.titleImage=n.x.getBitmapFont(t.menuFont).createTextImage(t.fullName),this.loFont=n.x.getBitmapFont(t.loFont),this.hiFont=n.x.getBitmapFont(t.hiFont),t.itemsLabel.forEach((e=>{const i=this.addChild(new R(this,e,t.autoCenter));"trigger"===e.actionName.toLowerCase()?this.itemsTrigger.push(i):this.itemsNext.push(i)})),t.itemsCycle.forEach((e=>this.addChild(new p(this,e)))),t.itemsSlider.forEach((e=>this.addChild(new T(this,e)))),this.hidden=!0}reset(){super.reset(),this.hidden=!0}onRedraw(e){this.hidden||(e.drawImage(this.menuImage,(u.Du-this.menuImage.width)/2,(u.DG-this.menuImage.height)/2),e.drawImage(this.titleImage,(u.Du-this.titleImage.width)/2,this.y),super.onRedraw(e))}}class I extends a.s{constructor(e,t){super(e),this.layersByKey=new Map,this.hidden=!0,t.menus.forEach(((e,t)=>this.layersByKey.set("menu"+(t+1),this.addChild(new f(this,e))))),this.layersByKey.forEach((e=>e.itemsNext.forEach((e=>e.onClick=()=>this.selectLayer(e.target)))))}reset(){super.reset(),this.hidden=!0}show(){this.hidden=!1,this.selectLayer("menu1")}hide(){super.hide(),this.notifyRedraw()}selectLayer(e){const t=this.layersByKey.get(e.toLowerCase());this.layersByKey.forEach((e=>e!==t&&e.hide())),t.show(),this.notifyRedraw()}}class O extends I{constructor(e,t){super(e,t),this.onRepeatBriefing=()=>console.log("repeat mission briefing"),this.layersByKey.get("menu1").itemsTrigger[0].onClick=()=>this.onRepeatBriefing(),this.layersByKey.get("menu1").itemsTrigger[1].onClick=()=>this.hide()}}class y extends I{constructor(e,t){super(e,t),this.onRepeatBriefing=()=>console.log("repeat mission briefing"),this.onAbortGame=()=>console.log("abort mission"),this.onRestartGame=()=>console.log("restart mission"),this.layersByKey.get("menu1").itemsTrigger[0].onClick=()=>this.hide(),this.layersByKey.get("menu2").itemsTrigger[0].onClick=()=>this.onRepeatBriefing(),this.layersByKey.get("menu3").itemsTrigger[0].onClick=()=>this.onAbortGame(),this.layersByKey.get("menu4").itemsTrigger[0].onClick=()=>this.onRestartGame()}}var w=i(346),v=i(18);class x extends v.x{constructor(e){super(e),this.panelPause=this.addPanel(new y(this.rootElement,n.x.getResource("PausedMenu"))),this.panelOptions=this.addPanel(new O(this.rootElement,n.x.getResource("OptionsMenu"))),this.panelBriefing=this.addPanel(new g(this.rootElement)),this.panelPause.onRepeatBriefing=()=>this.setActivePanel(this.panelBriefing),this.panelOptions.onRepeatBriefing=()=>this.setActivePanel(this.panelBriefing),this.panelBriefing.onSetSpaceToContinue=e=>this.sendResponse({type:w.n.SPACE_TO_CONINUE,messageState:e}),this.panelPause.onAbortGame=()=>this.sendResponse({type:w.n.GAME_ABORT}),this.panelPause.onRestartGame=()=>this.sendResponse({type:w.n.GAME_RESTART})}setCanvas(e){super.setCanvas(e),this.panelPause.width=this.canvas.width,this.panelPause.height=this.canvas.height,this.panelOptions.width=this.canvas.width,this.panelOptions.height=this.canvas.height}onProcessMessage(e){if(e.type===w.n.OVERLAY_SETUP)this.setup(e.objectiveText,e.objectiveBackImgCfg);else{if(e.type!==w.n.SHOW_OPTIONS)return!1;this.panelOptions.show()}return!0}setActivePanel(e){this.panels.forEach((t=>t!==e&&t.hide())),e.show(),this.redraw()}setup(e,t){this.panelBriefing.setup(e,t),u.Sl||this.setActivePanel(this.panelBriefing)}handlePointerEvent(e){return!this.panels.every((e=>e.hidden))&&(super.handlePointerEvent(e)||!0)}handleKeyEvent(e){let t=!1;const i=e.key.toLowerCase();return e.eventEnum===s.Zf.UP&&("escape"===i?this.panelBriefing.hidden&&this.panelOptions.hidden&&(this.panelPause.hidden?this.setActivePanel(this.panelPause):this.panelPause.hide(),t=!0):" "===i&&(this.panelBriefing.hidden||(this.panelBriefing.nextParagraph(),t=!0))),t}}let b=null;const S=self;S.addEventListener("message",(e=>{const t=e.data;t.type===w.n.INIT?(n.x.resourceByName=t.resourceByName,n.x.configuration=t.cfg,n.x.stats=t.stats,b=new x(S)):b.processMessage(t)}))}},s={};function r(e){var t=s[e];if(void 0!==t)return t.exports;var a=s[e]={exports:{}};return i[e](a,a.exports,r),a.exports}r.m=i,r.x=()=>{var e=r.O(void 0,[529,969],(()=>r(633)));return r.O(e)},e=[],r.O=(t,i,s,a)=>{if(!i){var n=1/0;for(o=0;o<e.length;o++){for(var[i,s,a]=e[o],h=!0,l=0;l<i.length;l++)(!1&a||n>=a)&&Object.keys(r.O).every((e=>r.O[e](i[l])))?i.splice(l--,1):(h=!1,a<n&&(n=a));h&&(e.splice(o--,1),t=s())}return t}a=a||0;for(var o=e.length;o>0&&e[o-1][2]>a;o--)e[o]=e[o-1];e[o]=[i,s,a]},r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.f={},r.e=e=>Promise.all(Object.keys(r.f).reduce(((t,i)=>(r.f[i](e,t),t)),[])),r.u=e=>e+".index.js",r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;r.g.importScripts&&(e=r.g.location+"");var t=r.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var i=t.getElementsByTagName("script");i.length&&(e=i[i.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=e})(),(()=>{var e={372:1};r.f.i=(t,i)=>{e[t]||importScripts(r.p+r.u(t))};var t=self.webpackChunkrock_raiders_web=self.webpackChunkrock_raiders_web||[],i=t.push.bind(t);t.push=t=>{var[s,a,n]=t;for(var h in a)r.o(a,h)&&(r.m[h]=a[h]);for(n&&n(r);s.length;)e[s.pop()]=1;i(t)}})(),t=r.x,r.x=()=>Promise.all([r.e(529),r.e(969)]).then(t),r.x()})();
//# sourceMappingURL=372.index.js.map