(()=>{"use strict";var e,t,i={800:(e,t,i)=>{var s,n,a;i.d(t,{T:()=>s,iW:()=>n}),function(e){e[e.MAIN=0]="MAIN",e[e.MIDDLE=1]="MIDDLE",e[e.SECONDARY=2]="SECONDARY"}(s||(s={})),function(e){e[e.MOVE=0]="MOVE",e[e.DOWN=1]="DOWN",e[e.UP=2]="UP"}(n||(n={})),function(e){e[e.DOWN=0]="DOWN",e[e.UP=1]="UP"}(a||(a={}))},848:(e,t,i)=>{i.d(t,{d:()=>s,VD:()=>n,oq:()=>a,CM:()=>r,Du:()=>l,DG:()=>o,pM:()=>h,OK:()=>d});const s=12,n=9,a=10,r=3,l=640,o=480,h=40,d=30},375:(e,t,i)=>{var s=i(935),n=i(930);class a extends n.p{constructor(e){if(super(),9!==e.length)throw"Invalid number of arguments ("+e.length+") given for button configuration expected 9 or 5";[this.buttonType,this.normalFile,this.highlightFile,this.pressedFile,this.relX,this.relY,this.width,this.height,this.tooltip]=e}}class r extends s.l{constructor(e){super(),this.panelButtonInfoDockGoto=null,this.panelButtonInfoDockClose=null,s.l.setFromCfg(this,e)}parseValue(e,t){return new a(t)}}var l=i(211),o=i(670);class h extends o.s{constructor(e,t,i,s,n){super(e,t),this.fill=this.addChild(new o.s(this,i)),this.fill.relX=this.relX-this.fill.relX,this.fill.relY=this.relY-this.fill.relY,this.overlay=this.addChild(new o.s(this,s)),this.btnToggle=this.addChild(new l.z(this,n.panelButtonRadarToggle)),this.btnToggle.onClick=()=>this.toggleState(),this.btnMap=this.addChild(new l.z(this,n.panelButtonRadarMapView)),this.btnMap.onClick=()=>{},this.btnTagged=this.addChild(new l.z(this,n.panelButtonRadarTaggedObjectView)),this.btnTagged.onClick=()=>{}}}class d extends s.l{constructor(e){super(),this.panelButtonRadarToggle=null,this.panelButtonRadarTaggedObjectView=null,this.panelButtonRadarZoomIn=null,this.panelButtonRadarZoomOut=null,this.panelButtonRadarMapView=null,s.l.setFromCfg(this,e)}parseValue(e,t){return new a(t)}}var u=i(320),c=i(796),m=i(360);class g extends m.H{constructor(e,t){super(e),this.relX=t.relX,this.relY=t.relY,this.width=t.width,this.height=t.height,this.tooltip=t.tooltip,this.label="0",this.updatePosition()}reset(){super.reset(),this.label="0"}onRedraw(e){this.hidden||(e.textAlign="center",e.font="bold 10px Arial",e.fillStyle="#fff",e.fillText(this.label,this.x+this.width/2,this.y+this.height-2),super.onRedraw(e))}}class p extends o.s{constructor(e,t,i){super(e,t),this.numCrystal=0,this.usedCrystals=0,this.neededCrystals=0,this.totalOre=0,this.labelOre=this.addChild(new g(this,i.panelButtonCrystalSideBarOre)),this.labelCrystal=this.addChild(new g(this,i.panelButtonCrystalSideBarCrystals)),this.imgNoCrystal=c.x.getImage("Interface/RightPanel/NoSmallCrystal.bmp"),this.imgSmallCrystal=c.x.getImage("Interface/RightPanel/SmallCrystal.bmp"),this.imgUsedCrystal=c.x.getImage("Interface/RightPanel/UsedCrystal.bmp"),this.imgOre=c.x.getImage("Interface/RightPanel/CrystalSideBar_Ore.bmp"),this.registerEventListener(u.Z.MATERIAL_AMOUNT_CHANGED,(e=>{this.labelOre.label=e.totalOre.toString(),this.labelCrystal.label=e.numCrystal.toString(),this.numCrystal=e.numCrystal,this.usedCrystals=e.usedCrystal,this.neededCrystals=e.neededCrystal,this.totalOre=e.totalOre,this.notifyRedraw()}))}reset(){super.reset(),this.numCrystal=0,this.usedCrystals=0,this.neededCrystals=0,this.totalOre=0}onRedraw(e){super.onRedraw(e);let t=this.x+this.img.width-8,i=this.y+this.img.height-34;for(let s=0;(this.neededCrystals<1||s<Math.max(this.neededCrystals,this.numCrystal))&&i>=Math.max(this.imgNoCrystal.height,this.imgSmallCrystal.height,this.imgUsedCrystal.height);s++){let n=this.imgNoCrystal;this.usedCrystals>s?n=this.imgUsedCrystal:this.numCrystal>s&&(n=this.imgSmallCrystal),i-=n.height,e.drawImage(n,t-n.width/2,i)}t=this.x+this.img.width-21,i=this.y+this.img.height-42;for(let s=0;s<this.totalOre&&i>=this.imgOre.height;++s)i-=this.imgOre.height,e.drawImage(this.imgOre,t-this.imgOre.width/2,i)}}class I extends s.l{constructor(e){super(),this.panelButtonCrystalSideBarOre=null,this.panelButtonCrystalSideBarCrystals=null,s.l.setFromCfg(this,e)}parseValue(e,t){return new a(t)}}class P extends s.l{constructor(e){super(),this.panelButtonPriorityListDisable=[],this.panelButtonPriorityListUpOne=[],this.panelButtonPriorityListClose=null,this.panelButtonPriorityListReset=null,s.l.setFromCfg(this,e)}assignValue(e,t,i){return t.match(/panelButtonPriorityListDisable\d+/i)?(this.panelButtonPriorityListDisable.push(this.parseValue(t,i)),!0):t.match(/panelButtonPriorityListUpOne\d+/i)?(this.panelButtonPriorityListUpOne.push(this.parseValue(t,i)),!0):super.assignValue(e,t,i)}parseValue(e,t){return new a(t)}}class C extends s.l{constructor(e){super(),this.panelButtonTopPanelCallToArms=null,this.panelButtonTopPanelOptions=null,this.panelButtonTopPanelPriorities=null,s.l.setFromCfg(this,e)}parseValue(e,t){return new a(t)}}class E extends s.l{constructor(e){super(),this.panelButtonCameraControlZoomIn=null,this.panelButtonCameraControlZoomOut=null,this.panelButtonCameraControlCycleBuildings=null,this.panelButtonCameraControlRotate=null,s.l.setFromCfg(this,e)}parseValue(e,t){return new a(t)}}class f extends s.l{constructor(e){super(),this.panelButtonInformationToggle=null,this.panelButtonInformationFunction=null,s.l.setFromCfg(this,e)}parseValue(e,t){return new a(t)}}class R extends s.l{constructor(e){super(),this.panelRadar=null,this.panelCrystalSideBar=null,this.panelTopPanel=null,this.panelInformation=null,this.panelPriorityList=null,this.panelCameraControl=null,this.panelInfoDock=null,this.panelEncyclopedia=null,s.l.setFromCfg(this,e)}parseValue(e,t){const i={};return t.forEach((e=>i[e[0]]=e)),e==="panelRadar".toLowerCase()?new d(i):e==="panelCrystalSideBar".toLowerCase()?new I(i):e==="panelTopPanel".toLowerCase()?new C(i):e==="panelInformation".toLowerCase()?new f(i):e==="panelPriorityList".toLowerCase()?new P(i):e==="panelCameraControl".toLowerCase()?new E(i):e==="panelInfoDock".toLowerCase()?new r(i):e==="panelEncyclopedia".toLowerCase()?null:i}}var T=i(234);class y extends s.l{constructor(e){super(),this.panelRadar=null,this.panelRadarFill=null,this.panelRadarOverlay=null,this.panelMessages=null,this.panelMessagesSide=null,this.panelCrystalSideBar=null,this.panelTopPanel=null,this.panelInformation=null,this.panelPriorityList=null,this.panelCameraControl=null,this.panelInfoDock=null,this.panelEncyclopedia=null,s.l.setFromCfg(this,e)}parseValue(e,t){return new T.l(t)}}class _ extends n.p{constructor(e){super(),this.normalFile=e,this.highlightFile=e,this.pressedFile=e,this.disabledFile=e,this.relX=0,this.relY=0}}var S,b,O,M=i(538),D=i(848);class w extends l.z{constructor(e,t,i){super(e,new _(t.buttonImageFilename)),this.messages=[],this.text=null,this.animationTimeout=null,this.animationSpeedX=.5,this.animationSpeedY=1,this.text=t.message,this.hidden=!0,this.onClick=()=>{this.messages.length<1||e.buttonClicked(this)},this.registerEventListener(i,(t=>{for(this.hidden=!1;this.messages.length>=9;)this.messages.pop();this.messages.unshift(t),e.showButton(this)}))}reset(){super.reset(),this.animationTimeout=(0,M.L4)(this.animationTimeout),this.hidden=!0,this.messages=[]}slideToTarget(e,t){return new Promise((i=>this.updateAnimation(e,t,i)))}updateAnimation(e,t,i){const s=e-this.relX,n=t-this.relY;if(Math.abs(s)<=this.animationSpeedX&&Math.abs(n)<=this.animationSpeedY)this.relX=e,this.relY=t,this.animationTimeout=null,i&&i();else{this.relX+=Math.round(Math.sign(s)*Math.sqrt(Math.abs(s))*this.animationSpeedX),this.relY+=Math.round(Math.sign(n)*Math.sqrt(Math.abs(n))*this.animationSpeedY);const a=this;this.animationTimeout=setTimeout((()=>a.updateAnimation(e,t,i)),1e3/D.OK)}this.updatePosition(),this.notifyRedraw()}onRedraw(e){super.onRedraw(e),this.hidden||(e.textAlign="left",e.font="bold 10px Arial",e.fillStyle="#fff",e.fillText(this.messages.length.toString(),this.x+2,this.y+this.height/2+2))}}class L extends o.s{constructor(e,t,i,s,n){super(e,t),this.stackButtons=[],this.informationPanel=null,this.informationPanel=n,this.addChild(new l.z(this,i.panelButtonInfoDockGoto)).onClick=()=>this.gotoLatestMessage(),this.addChild(new l.z(this,i.panelButtonInfoDockClose)).onClick=()=>this.dropLatestMessage(),this.addChild(new w(this,s.infoGenericDeath,u.Z.LOCATION_DEATH)),this.addChild(new w(this,s.infoGenericMonster,u.Z.LOCATION_MONSTER)),this.addChild(new w(this,s.infoCrystalFound,u.Z.LOCATION_CRYSTAL_FOUND)),this.addChild(new w(this,s.infoUnderAttack,u.Z.LOCATION_UNDER_ATTACK)),this.addChild(new w(this,s.infoLandslide,u.Z.LOCATION_LANDSLIDE)),this.addChild(new w(this,s.infoPowerDrain,u.Z.LOCATION_POWER_DRAIN)),this.addChild(new w(this,s.infoSlugEmerge,u.Z.LOCATION_SLUG_EMERGE)),this.addChild(new w(this,s.infoFoundMinifigure,u.Z.LOCATION_RAIDER_DISCOVERED))}reset(){super.reset(),this.stackButtons=[]}gotoLatestMessage(){if(this.stackButtons.length<1)return;const e=this.stackButtons[0];if(e.messages.length<1)return;const t=e.messages[0];console.log("TODO force move camera to",t.location)}dropLatestMessage(){if(this.stackButtons.length<1)return;const e=this.stackButtons[0];e.messages.length<1||(e.messages.shift(),e.messages.length<1&&(e.hidden=!0,this.informationPanel.setMovedIn(!0),this.stackButtons.splice(this.stackButtons.indexOf(e),1),this.slideStackIntoPosition().then()),e.notifyRedraw())}showButton(e){this.stackButtons.includes(e)?e.notifyRedraw():this.slideInButton(e)}slideInButton(e){this.stackButtons.forEach((e=>e.disabled=!0));const t=-this.stackButtons.map((e=>e.height)).reduce(((e,t)=>e+t),0);this.stackButtons.push(e),e.relX=-e.width,e.relY=t-e.height,e.updatePosition(),e.slideToTarget(0,t).then((()=>this.stackButtons.forEach((e=>e.disabled=!1))))}buttonClicked(e){e!==this.stackButtons[0]?this.pushFirst(e):(this.informationPanel.setText(e.text),this.informationPanel.toggleState())}pushFirst(e){this.stackButtons.splice(this.stackButtons.indexOf(e),1),this.stackButtons.unshift(e),this.slideStackIntoPosition().then((()=>{this.informationPanel.setText(e.text),this.informationPanel.setMovedIn(!1)}))}slideStackIntoPosition(){this.stackButtons.forEach((e=>e.disabled=!0));let e=0;const t=this.stackButtons.map((t=>{const i=t.slideToTarget(0,e);return e-=t.height,i}));return new Promise((e=>{Promise.all(t).then((()=>{this.stackButtons.forEach((e=>e.disabled=!1)),e()}))}))}}class A{constructor(e){this.message=null,this.buttonImageFilename=null,this.sfx=null,this.timing=null,this.flag=null,[this.message,this.buttonImageFilename,this.sfx,this.timing,this.flag]=e,this.message=this.message.replace(/_/g," ")}}class B extends s.l{constructor(e){super(),this.infoGenericDeath=null,this.infoGenericMonster=null,this.infoCrystalFound=null,this.infoUnderAttack=null,this.infoLandslide=null,this.infoPowerDrain=null,this.infoSlugEmerge=null,this.infoFoundMinifigure=null,s.l.setFromCfg(this,e)}parseValue(e,t){return new A(t)}}class v extends o.s{constructor(e,t){super(e,t),this.font=null,this.textImage=null,this.font=c.x.getDefaultFont()}setText(e){this.textImage=e?this.font.createTextImage(e,this.img.width-80):null,this.notifyRedraw()}onRedraw(e){super.onRedraw(e),this.textImage&&e.drawImage(this.textImage,this.x+(this.img.width-this.textImage.width)/2,this.y+12)}}!function(e){e[e.PILOT=0]="PILOT",e[e.TOOLSTATION=1]="TOOLSTATION",e[e.TELEPORT_PAD=2]="TELEPORT_PAD",e[e.DOCKS=3]="DOCKS",e[e.POWER_STATION=4]="POWER_STATION",e[e.BARRACKS=5]="BARRACKS",e[e.UPGRADE=6]="UPGRADE",e[e.GEODOME=7]="GEODOME",e[e.ORE_REFINERY=8]="ORE_REFINERY",e[e.GUNSTATION=9]="GUNSTATION",e[e.TELEPORT_BIG=10]="TELEPORT_BIG",e[e.BAT=11]="BAT",e[e.SMALL_SPIDER=12]="SMALL_SPIDER",e[e.DYNAMITE=13]="DYNAMITE",e[e.ELECTRIC_FENCE=14]="ELECTRIC_FENCE",e[e.CRYSTAL=15]="CRYSTAL",e[e.ORE=16]="ORE",e[e.BRICK=17]="BRICK",e[e.BARRIER=18]="BARRIER"}(S||(S={})),function(e){e[e.RAIDER=0]="RAIDER",e[e.BUILDING=1]="BUILDING",e[e.MONSTER=2]="MONSTER",e[e.MATERIAL=3]="MATERIAL"}(b||(b={}));class N{static publishEvent(e){this.blockedEvents.includes(e.eventKey)||(e.isLocal||console.log("Event published: "+u.Z[e.eventKey]),this.blockedEvents.push(e.eventKey),this.workerListener.forEach((t=>t(e))),this.getListener(e.eventKey).forEach((t=>t(e))),this.blockedEvents.remove(e.eventKey))}static registerEventListener(e,t){this.getListener(e).push(t)}static getListener(e){return this.eventListener.getOrUpdate(e,(()=>[]))}static registerWorkerListener(e){this.workerListener.push(e)}}N.eventListener=new Map,N.workerListener=[],N.blockedEvents=[];class x{constructor(){this.levelDefault=[],this.current=[]}setList(e){this.levelDefault=e,this.reset()}toggle(e){this.current[e].enabled=!this.current[e].enabled}upOne(e){const t=this.current[e];this.current[e]=this.current[e+1],this.current[e+1]=t}reset(){this.current=this.levelDefault.map((e=>new G(e)))}pushToTop(e){const t=this.current[e];for(let t=e;t>0;t--)this.current[t]=this.current[t-1];this.current[0]=t}getPriority(e){let t=0;return this.current.some(((i,s)=>{if(i.key===e.getPriorityIdentifier())return t=s,!0})),t}isEnabled(e){var t;return(null===(t=this.current.find((t=>t.key===e)))||void 0===t?void 0:t.enabled)||!1}}class G{constructor(e){this.key=e.key,this.enabled=e.enabled}}!function(e){e[e.DRIVER=0]="DRIVER",e[e.ENGINEER=1]="ENGINEER",e[e.GEOLOGIST=2]="GEOLOGIST",e[e.PILOT=3]="PILOT",e[e.SAILOR=4]="SAILOR",e[e.DEMOLITION=5]="DEMOLITION"}(O||(O={}));const k=[O.DRIVER,O.ENGINEER,O.GEOLOGIST,O.PILOT,O.SAILOR,O.DEMOLITION],U=[];U[O.DRIVER]=S.BARRACKS,U[O.DRIVER]=S.BARRACKS,U[O.ENGINEER]=S.UPGRADE,U[O.GEOLOGIST]=S.GEODOME,U[O.PILOT]=S.TELEPORT_PAD,U[O.SAILOR]=S.DOCKS,U[O.DEMOLITION]=S.TOOLSTATION;const F=[];var H,Z,V,Y;F[O.DRIVER]="TrainDriver",F[O.ENGINEER]="TrainRepair",F[O.GEOLOGIST]="TrainScanner",F[O.PILOT]="TrainPilot",F[O.SAILOR]="TrainSailor",F[O.DEMOLITION]="TrainDynamite",function(e){e[e.NOTHING=0]="NOTHING",e[e.SURFACE=1]="SURFACE",e[e.RAIDER=2]="RAIDER",e[e.BUILDING=3]="BUILDING",e[e.VEHICLE=4]="VEHICLE",e[e.GROUP=5]="GROUP"}(H||(H={})),function(e){e[e.RUNNING=0]="RUNNING",e[e.COMPLETE=1]="COMPLETE",e[e.FAILED=2]="FAILED"}(Z||(Z={}));class W{static reset(){this.resultState=Z.RUNNING,this.levelFullName="",this.numCrystal=0,this.numOre=0,this.numBrick=0,this.usedCrystals=0,this.neededCrystals=0,this.airLevel=1,this.selectedEntities=[],this.selectionType=null,this.buildings=[],this.buildingsUndiscovered=[],this.raiders=[],this.raidersUndiscovered=[],this.requestedRaiders=0,this.materials=[],this.materialsUndiscovered=[],this.buildingSites=[],this.spiders=[],this.spidersBySurface=new Map,this.bats=[],this.totalCrystals=0,this.totalOres=0,this.totalDiggables=0,this.remainingDiggables=0,this.totalCaverns=0,this.discoveredCaverns=0,this.levelStartTime=0,this.levelStopTime=0,this.rewardConfig=null,this.priorityList=new x,this.oxygenRate=0,this.buildModeSelection=null,this.objectiveShown=!1,this.objectiveSwitch=!1}static getBuildingsByType(...e){return this.buildings.filter((t=>t.isUsable()&&e.some((e=>t.entityType===e))))}static getClosestBuildingByType(e,...t){const i=W.getBuildingsByType(...t);let s=null,n=null;return i.forEach((t=>{const i=t.getDropPosition(),a=e.distanceToSquared(i);(null===s||a<n)&&(s=t,n=a)})),s}static getTrainingSites(e){return this.buildings.filter((t=>t.entityType===U[e]&&t.isUsable()&&t.stats[F[e]][t.level]))}static selectEntities(e){this.selectedEntities=this.selectedEntities.filter((t=>{const i=-1!==e.indexOf(t);return i||t.deselect(),i})),e.forEach((e=>{e.select()&&this.selectedEntities.push(e)}));const t=this.selectedEntities.length;t>1?this.selectionType=H.GROUP:1===t?this.selectionType=this.selectedEntities[0].getSelectionType():null!==this.selectionType&&(this.selectionType=H.NOTHING),N.publishEvent(new q(this.selectionType,this.selectedSurface,this.selectedBuilding,this.selectedRaiders))}static getMaxRaiders(){return D.d+W.buildings.count((e=>e.isUsable()&&e.entityType===S.BARRACKS))*D.oq}static discoverSurface(e){const t=e.x*D.pM,i=e.y*D.pM,s=t+D.pM,n=i+D.pM;this.discoverEntities(this.raidersUndiscovered,t,s,i,n),this.discoverEntities(this.buildingsUndiscovered,t,s,i,n),this.discoverEntities(this.materialsUndiscovered,t,s,i,n)}static discoverEntities(e,t,i,s,n){const a=[];e.forEach((e=>{const r=e.getPosition();r.x>=t&&r.x<i&&r.z>=s&&r.z<n&&(e.onDiscover(),a.push(e))})),a.forEach((t=>e.remove(t)))}static get gameTimeSeconds(){return Math.round((W.levelStopTime-W.levelStartTime)/1e3)}static get score(){if(!W.rewardConfig)return 0;let e=W.rewardConfig.quota,t=W.rewardConfig.importance;const i=W.numCrystal>=(e.crystals||1/0)?t.crystals:0,s=W.gameTimeSeconds<=(e.timer||0)?t.timer:0,n=e.caverns?Math.min(1,W.discoveredCaverns/e.caverns)*t.caverns:0,a=e.constructions?Math.min(1,W.buildings.length/e.constructions*t.constructions):0,r=W.airLevel*t.oxygen,l=W.raiders.length>=D.d?t.figures:0;return Math.round(i+s+n+a+r+l)/100}static get selectedSurface(){return this.selectionType===H.SURFACE&&this.selectedEntities.length>0?this.selectedEntities[0]:null}static get selectedBuilding(){return this.selectionType===H.BUILDING&&this.selectedEntities.length>0?this.selectedEntities[0]:null}static get selectedRaiders(){return(this.selectionType===H.RAIDER||this.selectionType===H.GROUP)&&this.selectedEntities.length>0?this.selectedEntities:[]}static get totalOre(){return this.numOre+5*this.numBrick}static getNearbySpiders(e){const t=e.sceneMgr.terrain,i=t.getSurfaceFromWorld(e.getPosition()),s=[];for(let e=i.x;e<=i.x+1;e++)for(let n=i.y;n<=i.y+1;n++){const i=t.getSurface(e,n);s.push(...W.spidersBySurface.get(i)||[])}return s}}W.resultState=Z.RUNNING,W.levelFullName="",W.numCrystal=0,W.numOre=0,W.numBrick=0,W.usedCrystals=0,W.neededCrystals=0,W.airLevel=1,W.selectedEntities=[],W.selectionType=null,W.buildings=[],W.buildingsUndiscovered=[],W.raiders=[],W.raidersUndiscovered=[],W.requestedRaiders=0,W.materials=[],W.materialsUndiscovered=[],W.buildingSites=[],W.spiders=[],W.spidersBySurface=new Map,W.bats=[],W.totalCrystals=0,W.totalOres=0,W.totalDiggables=0,W.remainingDiggables=0,W.totalCaverns=0,W.discoveredCaverns=0,W.levelStartTime=0,W.levelStopTime=0,W.rewardConfig=null,W.priorityList=new x,W.oxygenRate=0,W.buildModeSelection=null,W.objectiveShown=!1,W.objectiveSwitch=!1,function(e){e[e.Pointer_Blank=0]="Pointer_Blank",e[e.Pointer_Standard=1]="Pointer_Standard",e[e.Pointer_Drill=2]="Pointer_Drill",e[e.Pointer_CantDrill=3]="Pointer_CantDrill",e[e.Pointer_Clear=4]="Pointer_Clear",e[e.Pointer_Go=5]="Pointer_Go",e[e.Pointer_CantGo=6]="Pointer_CantGo",e[e.Pointer_Teleport=7]="Pointer_Teleport",e[e.Pointer_CantTeleport=8]="Pointer_CantTeleport",e[e.Pointer_Reinforce=9]="Pointer_Reinforce",e[e.Pointer_CantReinforce=10]="Pointer_CantReinforce",e[e.Pointer_Selected=11]="Pointer_Selected",e[e.Pointer_RadarPan=12]="Pointer_RadarPan",e[e.Pointer_TrackObject=13]="Pointer_TrackObject",e[e.Pointer_Zoom=14]="Pointer_Zoom",e[e.Pointer_CantZoom=15]="Pointer_CantZoom",e[e.Pointer_Help=16]="Pointer_Help",e[e.Pointer_CantHelp=17]="Pointer_CantHelp",e[e.Pointer_PutDown=18]="Pointer_PutDown",e[e.Pointer_GetIn=19]="Pointer_GetIn",e[e.Pointer_GetOut=20]="Pointer_GetOut",e[e.Pointer_Okay=21]="Pointer_Okay",e[e.Pointer_NotOkay=22]="Pointer_NotOkay",e[e.Pointer_CanBuild=23]="Pointer_CanBuild",e[e.Pointer_CannotBuild=24]="Pointer_CannotBuild",e[e.Pointer_Dynamite=25]="Pointer_Dynamite",e[e.Pointer_CantDynamite=26]="Pointer_CantDynamite",e[e.Pointer_PickUp=27]="Pointer_PickUp",e[e.Pointer_CantPickUp=28]="Pointer_CantPickUp",e[e.Pointer_PickUpOre=29]="Pointer_PickUpOre",e[e.Pointer_LegoManCantDig=30]="Pointer_LegoManCantDig",e[e.Pointer_VehicleCantDig=31]="Pointer_VehicleCantDig",e[e.Pointer_LegoManDig=32]="Pointer_LegoManDig",e[e.Pointer_VehicleDig=33]="Pointer_VehicleDig",e[e.Pointer_LegoManCantPickUp=34]="Pointer_LegoManCantPickUp",e[e.Pointer_VehicleCantPickUp=35]="Pointer_VehicleCantPickUp",e[e.Pointer_LegoManPickUp=36]="Pointer_LegoManPickUp",e[e.Pointer_VehiclePickUp=37]="Pointer_VehiclePickUp",e[e.Pointer_LegoManCantGo=38]="Pointer_LegoManCantGo",e[e.Pointer_VehicleCantGo=39]="Pointer_VehicleCantGo",e[e.Pointer_LegoManGo=40]="Pointer_LegoManGo",e[e.Pointer_VehicleGo=41]="Pointer_VehicleGo",e[e.Pointer_LegoManClear=42]="Pointer_LegoManClear",e[e.Pointer_VehicleClear=43]="Pointer_VehicleClear",e[e.Pointer_SurfaceType_Immovable=44]="Pointer_SurfaceType_Immovable",e[e.Pointer_SurfaceType_Hard=45]="Pointer_SurfaceType_Hard",e[e.Pointer_SurfaceType_Medium=46]="Pointer_SurfaceType_Medium",e[e.Pointer_SurfaceType_Loose=47]="Pointer_SurfaceType_Loose",e[e.Pointer_SurfaceType_Soil=48]="Pointer_SurfaceType_Soil",e[e.Pointer_SurfaceType_OreSeam=49]="Pointer_SurfaceType_OreSeam",e[e.Pointer_SurfaceType_CrystalSeam=50]="Pointer_SurfaceType_CrystalSeam",e[e.Pointer_SurfaceType_RechargeSeam=51]="Pointer_SurfaceType_RechargeSeam"}(V||(V={}));class K{constructor(e={}){this.shaping=!1,this.matIndex="00",this.floor=!1,this.selectable=!1,this.drillable=!1,this.drillableHard=!1,this.explodable=!1,this.reinforcable=!1,this.cursor=V.Pointer_Standard,this.statsDrillName=null,this.canCarryFence=!1,Object.assign(this,e)}static getByNum(e){switch(e){case 0:return K.POWER_PATH_BUILDING;case 1:return K.SOLID_ROCK;case 2:return K.HARD_ROCK;case 3:return K.LOOSE_ROCK;case 4:case 5:return K.DIRT;case 6:return K.LAVA;case 8:return K.ORE_SEAM;case 9:return K.WATER;case 10:return K.CRYSTAL_SEAM;case 11:return K.RECHARGE_SEAM;case 30:case 40:return K.SLUG_HOLE;case 100:return K.RUBBLE4;case 101:return K.RUBBLE3;case 102:return K.RUBBLE2;case 103:return K.RUBBLE1;default:return console.error("Unexpected surface type num: "+e),K.SOLID_ROCK}}}K.GROUND=new K({name:"ground",floor:!0,selectable:!0,canCarryFence:!0}),K.SOLID_ROCK=new K({name:"solid rock",shaping:!0,matIndex:"5",cursor:V.Pointer_SurfaceType_Immovable}),K.HARD_ROCK=new K({name:"hard rock",shaping:!0,matIndex:"4",selectable:!0,drillableHard:!0,explodable:!0,reinforcable:!0,cursor:V.Pointer_SurfaceType_Hard,statsDrillName:"HardDrillTime"}),K.LOOSE_ROCK=new K({name:"loose rock",shaping:!0,matIndex:"3",selectable:!0,drillable:!0,drillableHard:!0,explodable:!0,reinforcable:!0,cursor:V.Pointer_SurfaceType_Medium,statsDrillName:"LooseDrillTime"}),K.DIRT=new K({name:"dirt",shaping:!0,matIndex:"2",selectable:!0,drillable:!0,drillableHard:!0,explodable:!0,reinforcable:!0,cursor:V.Pointer_SurfaceType_Loose,statsDrillName:"SoilDrillTime"}),K.SLUG_HOLE=new K({name:"slug hole",floor:!0,matIndex:"30"}),K.LAVA=new K({name:"lava",floor:!0,matIndex:"46"}),K.ORE_SEAM=new K({name:"ore seam",matIndex:"40",selectable:!0,drillable:!0,drillableHard:!0,explodable:!0,reinforcable:!0,cursor:V.Pointer_SurfaceType_OreSeam,statsDrillName:"SeamDrillTime"}),K.WATER=new K({name:"water",floor:!0,matIndex:"45"}),K.CRYSTAL_SEAM=new K({name:"energy crystal seam",matIndex:"20",selectable:!0,drillable:!0,drillableHard:!0,explodable:!0,reinforcable:!0,cursor:V.Pointer_SurfaceType_CrystalSeam,statsDrillName:"SeamDrillTime"}),K.RECHARGE_SEAM=new K({name:"recharge seam",matIndex:"67",cursor:V.Pointer_SurfaceType_RechargeSeam}),K.POWER_PATH=new K({name:"power path all",floor:!0,matIndex:"60",selectable:!0,canCarryFence:!0}),K.POWER_PATH_SITE=new K({name:"power path site",floor:!0,matIndex:"61",selectable:!0,canCarryFence:!0}),K.POWER_PATH_BUILDING=new K({name:"power path building",floor:!0,matIndex:"76"}),K.RUBBLE1=new K({name:"rubble 1",floor:!0,matIndex:"13",selectable:!0,canCarryFence:!0}),K.RUBBLE2=new K({name:"rubble 2",floor:!0,matIndex:"12",selectable:!0,canCarryFence:!0}),K.RUBBLE3=new K({name:"rubble 3",floor:!0,matIndex:"11",selectable:!0,canCarryFence:!0}),K.RUBBLE4=new K({name:"rubble 4",floor:!0,matIndex:"10",selectable:!0,canCarryFence:!0}),function(e){e[e.DRILL=0]="DRILL",e[e.HAMMER=1]="HAMMER",e[e.SHOVEL=2]="SHOVEL",e[e.SPANNER=3]="SPANNER",e[e.FREEZERGUN=4]="FREEZERGUN",e[e.LASER=5]="LASER",e[e.PUSHERGUN=6]="PUSHERGUN",e[e.BIRDSCARER=7]="BIRDSCARER"}(Y||(Y={}));const z=[Y.DRILL,Y.HAMMER,Y.SHOVEL,Y.SPANNER,Y.FREEZERGUN,Y.LASER,Y.PUSHERGUN,Y.BIRDSCARER];class X extends class{constructor(e){this.eventKey=e,this.guiForward=!0}}{constructor(e){super(e),this.isLocal=!0}}class q extends X{constructor(e=H.NOTHING,t=null,i=null,s=null){super(u.Z.SELECTION_CHANGED),this.canDoTraining=new Map,this.everyHasTool=new Map,this.selectionType=e,this.isGround=(null==t?void 0:t.surfaceType)===K.GROUND,this.isPowerPath=(null==t?void 0:t.surfaceType)===K.POWER_PATH,this.isFloor=null==t?void 0:t.surfaceType.floor,this.hasRubble=null==t?void 0:t.hasRubble(),this.isDrillable=null==t?void 0:t.isDrillable(),this.isDrillableHard=null==t?void 0:t.isDrillableHard(),this.isReinforcable=null==t?void 0:t.isReinforcable(),this.canPlaceFence=(null==t?void 0:t.canPlaceFence())&&W.buildings.some((e=>e.entityType===S.POWER_STATION&&e.isUsable())),this.someCarries=!!(null==s?void 0:s.some((e=>!!e.carries))),this.everyHasMaxLevel=!!(null==s?void 0:s.every((e=>e.level>=e.stats.Levels))),k.forEach((e=>this.canDoTraining.set(e,W.getTrainingSites(e).length>0&&(null==s?void 0:s.some((t=>!t.hasTraining(e))))))),z.forEach((e=>this.everyHasTool.set(e,!!(null==s?void 0:s.every((t=>t.hasTool(e))))))),this.buildingCanUpgrade=null==i?void 0:i.canUpgrade(),this.buildingCanSwitchPower=(null==i?void 0:i.stats.SelfPowered)||(null==i?void 0:i.stats.PowerBuilding)}}class j extends X{constructor(){super(u.Z.BUILDINGS_CHANGED),this.usableBuildingsByTypeAndLevel=new Map,W.buildings.forEach((e=>{if(e.isUsable()){const t=this.usableBuildingsByTypeAndLevel.getOrUpdate(e.entityType,(()=>new Map));t.set(e.level,t.getOrUpdate(e.level,(()=>0))+1)}}))}static countUsable(e,t,i=0){let s=0;return e.usableBuildingsByTypeAndLevel.getOrUpdate(t,(()=>new Map)).forEach(((e,t)=>{t>=i&&(s+=e)})),s}}class J extends X{}class Q extends J{constructor(){super(u.Z.COMMAND_CANCEL_BUILD_MODE)}}class $ extends J{constructor(e){super(u.Z.COMMAND_SELECT_BUILD_MODE),this.entityType=e}}class ee extends J{constructor(e){super(u.Z.COMMAND_PICK_TOOL),this.tool=e}}class te extends J{constructor(){super(u.Z.COMMAND_CREATE_POWER_PATH)}}class ie extends J{constructor(){super(u.Z.COMMAND_PLACE_FENCE)}}class se extends J{constructor(){super(u.Z.COMMAND_MAKE_RUBBLE)}}class ne extends J{constructor(e){super(u.Z.COMMAND_CHANGE_RAIDER_SPAWN_REQUEST),this.increase=e}}class ae extends J{constructor(){super(u.Z.COMMAND_CREATE_CLEAR_RUBBLE_JOB)}}class re extends J{constructor(){super(u.Z.COMMAND_UPGRADE_BUILDING)}}class le extends J{constructor(){super(u.Z.COMMAND_BUILDING_BEAMUP)}}class oe extends J{constructor(e){super(u.Z.CHANGE_PRIORITY_LIST),this.priorityList=e}}class he extends J{constructor(e){super(u.Z.COMMAND_CHANGE_BUILDING_POWER_STATE),this.state=e}}class de extends J{constructor(){super(u.Z.COMMAND_CREATE_DRILL_JOB)}}class ue extends J{constructor(){super(u.Z.COMMAND_CREATE_REINFORCE_JOB)}}class ce extends J{constructor(){super(u.Z.COMMAND_CREATE_DYNAMITE_JOB)}}class me extends J{constructor(){super(u.Z.COMMAND_CANCEL_SURFACE_JOBS)}}class ge extends J{constructor(){super(u.Z.COMMAND_RAIDER_EAT)}}class pe extends J{constructor(){super(u.Z.COMMAND_RAIDER_DROP)}}class Ie extends J{constructor(){super(u.Z.COMMAND_RAIDER_UPGRADE)}}class Pe extends J{constructor(){super(u.Z.COMMAND_RAIDER_BEAMUP)}}class Ce extends J{constructor(e){super(u.Z.COMMAND_TRAIN_RAIDER),this.training=e}}class Ee extends n.p{constructor(e){super(),[this.width,this.height,this.highlightFile,this.pressedFile,this.tooltip]=e,this.relX=4,this.relY=14}}class fe extends n.p{constructor(e){var t,i;if(super(),this.tooltipSfx=null,this.tooltipDisabled=null,this.tooltipDisabledSfx=null,this.hotkey=null,4===e.length)[this.normalFile,this.disabledFile,this.pressedFile,this.hotkey]=e;else if(6===e.length||7===e.length){let t,i;[this.normalFile,this.disabledFile,this.pressedFile,t,i,this.hotkey]=e,t&&(Array.isArray(t)?[this.tooltip,this.tooltipSfx]=t:this.tooltip=t),i&&(Array.isArray(i)?[this.tooltipDisabled,this.tooltipDisabledSfx]=i:this.tooltipDisabled=i)}else console.error("Unexpected menu item cfg value length: "+e.length);null===(t=this.tooltip)||void 0===t||t.replace(/_/g," "),null===(i=this.tooltipDisabled)||void 0===i||i.replace(/_/g," "),this.width=40,this.height=40}}class Re extends l.z{constructor(e,t,i,s,n){super(e,t),this.tooltipSfx=null,this.tooltipDisabled=null,this.tooltipDisabledSfx=null,this.hotkey=null,this.isDisabled=()=>this.disabled,this.buttonType=i,this.relX=s-59,this.relY=9+this.height*n,this.tooltipSfx=t.tooltipSfx,this.tooltipDisabled=t.tooltipDisabled,this.tooltipDisabledSfx=t.tooltipDisabledSfx,this.hotkey=t.hotkey,this.disabled=!0}reset(){super.reset(),this.disabled=!0,this.updateState(!1)}onClick(){console.log("menu item pressed: "+this.buttonType)}updateState(e=!0){const t=!!this.isDisabled(),i=this.disabled!==t;return this.disabled=t,i&&e&&this.notifyRedraw(),i}drawHover(e){super.drawHover(e),!this.disabled&&this.hover&&(e.strokeStyle="#0f0",e.lineWidth=2,e.strokeRect(this.x-e.lineWidth/2,this.y-e.lineWidth/2,this.width+e.lineWidth-1,this.height+e.lineWidth-1))}}class Te extends o.s{constructor(e,t,i=null){if(super(e),this.backBtn=null,this.iconPanelButtons=[],i){const e=new Ee(c.x.cfg("InterfaceBackButton"));this.backBtn=this.addChild(new l.z(this,e)),this.backBtn.onClick=()=>this.toggleState((()=>i.toggleState()))}const s=c.x.cfg("InterfaceSurroundImages",t.toString()),[n,a,r,o,h,d,u,m]=s;this.img=i?c.x.getImage(n):c.x.getImage(d),this.xOut=-this.img.width}addMenuItem(e,t){const i=new fe(c.x.cfg(e,t)),s=this.addChild(new Re(this,i,t,this.img.width,this.iconPanelButtons.length));return this.iconPanelButtons.push(s),s}toggleState(e=null){super.toggleState(e),this.movedIn||this.updateAllButtonStates()}updateAllButtonStates(){this.iconPanelButtons.forEach((e=>e.updateState(!1))),this.notifyRedraw()}}class ye extends Te{constructor(e,t){super(e,10,t),this.backBtn.onClick=()=>{this.publishEvent(new Q),this.toggleState((()=>t.toggleState()))},this.addBuildMenuItem("InterfaceBuildImages","Toolstation",S.TOOLSTATION),this.addBuildMenuItem("InterfaceBuildImages","TeleportPad",S.TELEPORT_PAD),this.addBuildMenuItem("InterfaceBuildImages","Docks",S.DOCKS),this.addBuildMenuItem("InterfaceBuildImages","Powerstation",S.POWER_STATION),this.addBuildMenuItem("InterfaceBuildImages","Barracks",S.BARRACKS),this.addBuildMenuItem("InterfaceBuildImages","Upgrade",S.UPGRADE),this.addBuildMenuItem("InterfaceBuildImages","Geo-dome",S.GEODOME),this.addBuildMenuItem("InterfaceBuildImages","OreRefinery",S.ORE_REFINERY),this.addBuildMenuItem("InterfaceBuildImages","Gunstation",S.GUNSTATION),this.addBuildMenuItem("InterfaceBuildImages","TeleportBIG",S.TELEPORT_BIG)}addBuildMenuItem(e,t,i){const s=this.addMenuItem(e,t);return s.isDisabled=()=>!1,s.onClick=()=>this.publishEvent(new $(i)),s}}class _e extends Te{constructor(e,t){super(e,8,t),this.numUsableToolstations=0,this.everyHasTool=new Map,this.addGetToolItem("InterfaceImages","Interface_MenuItem_GetDrill",Y.DRILL),this.addGetToolItem("InterfaceImages","Interface_MenuItem_GetSpade",Y.SHOVEL),this.addGetToolItem("InterfaceImages","Interface_MenuItem_GetHammer",Y.HAMMER),this.addGetToolItem("InterfaceImages","Interface_MenuItem_GetSpanner",Y.SPANNER),this.addGetToolItem("InterfaceImages","Interface_MenuItem_GetFreezerGun",Y.FREEZERGUN),this.addGetToolItem("InterfaceImages","Interface_MenuItem_GetLaser",Y.LASER),this.addGetToolItem("InterfaceImages","Interface_MenuItem_GetPusherGun",Y.PUSHERGUN),this.addGetToolItem("InterfaceImages","Interface_MenuItem_GetBirdScarer",Y.BIRDSCARER),this.registerEventListener(u.Z.BUILDINGS_CHANGED,(e=>{this.numUsableToolstations=j.countUsable(e,S.TOOLSTATION),this.updateAllButtonStates()})),this.registerEventListener(u.Z.SELECTION_CHANGED,(e=>{this.everyHasTool=e.everyHasTool,this.updateAllButtonStates()}))}addGetToolItem(e,t,i){const s=super.addMenuItem(e,t);return s.isDisabled=()=>this.numUsableToolstations<1||!!this.everyHasTool.get(i),s.onClick=()=>this.publishEvent(new ee(i)),s}reset(){super.reset(),this.numUsableToolstations=0,this.everyHasTool=new Map}}class Se extends m.H{constructor(e){super(e),this.numRequestedRaiders="",this.relX=4,this.relY=11,this.registerEventListener(u.Z.REQUESTED_RAIDERS_CHANGED,(e=>{this.numRequestedRaiders=(e.numRequestedRaiders||"").toString(),this.notifyRedraw()}))}reset(){super.reset(),this.numRequestedRaiders=""}onRedraw(e){this.hidden||(e.textAlign="left",e.font="bold 10px Arial",e.fillStyle=this.disabled||this.parent&&this.parent.disabled?"#444":"#fff",e.fillText(this.numRequestedRaiders,this.x,this.y),super.onRedraw(e))}}class be extends Te{constructor(e,t){super(e,5,t),this.addMenuItem("InterfaceBuildImages","BullDozer"),this.addMenuItem("InterfaceBuildImages","WalkerDigger"),this.addMenuItem("InterfaceBuildImages","LargeMLP"),this.addMenuItem("InterfaceBuildImages","LargeDigger"),this.addMenuItem("InterfaceBuildImages","LargeCat")}}class Oe extends Re{constructor(e,t,i,s,n){super(e,t,null,s,n),this.toggleState=!1,this.imgOnNormal=c.x.getImageOrNull(i.normalFile),this.imgOnHover=c.x.getImageOrNull(i.highlightFile),this.imgOnPressed=c.x.getImageOrNull(i.pressedFile),this.imgOnDisabled=c.x.getImageOrNull(i.disabledFile)}onClick(){this.toggleState=!this.toggleState,this.onToggleStateChange()}onToggleStateChange(){}onRedraw(e){if(this.hidden)return;let t=this.toggleState?this.imgOnNormal:this.imgNormal;this.disabled?t=this.toggleState?this.imgOnDisabled||this.imgOnPressed||this.imgOnNormal:this.imgDisabled||this.imgPressed||this.imgNormal:this.pressed?t=this.toggleState?this.imgOnPressed||this.imgOnNormal:this.imgPressed||this.imgNormal:this.hover&&(t=this.toggleState?this.imgOnHover||this.imgOnNormal:this.imgHover||this.imgNormal),t&&e.drawImage(t,this.x,this.y),this.children.forEach((t=>t.onRedraw(e))),this.children.forEach((t=>t.drawHover(e))),this.children.forEach((t=>t.drawTooltip(e)))}}class Me extends Te{constructor(e,t,i){super(e,t,i),this.backBtn.onClick=()=>this.publishEvent(new q)}}class De extends Me{constructor(e,t){super(e,4,t),this.usedCrystal=0,this.numCrystal=0,this.buildingCanUpgrade=!1,this.buildingCanSwitchPower=!1,this.addMenuItem("InterfaceImages","Interface_MenuItem_Repair");const i=new fe(c.x.cfg("InterfaceImages","Interface_MenuItem_PowerOff")),s=new fe(c.x.cfg("InterfaceImages","Interface_MenuItem_PowerOn")),n=this.addChild(new Oe(this,i,s,this.img.width,this.iconPanelButtons.length));this.iconPanelButtons.push(n),n.isDisabled=()=>this.usedCrystal>=this.numCrystal||!this.buildingCanSwitchPower,n.onToggleStateChange=()=>this.publishEvent(new he(!n.toggleState));const a=this.addMenuItem("InterfaceImages","Interface_MenuItem_UpgradeBuilding");a.isDisabled=()=>!this.buildingCanUpgrade,a.onClick=()=>this.publishEvent(new re);const r=this.addMenuItem("InterfaceImages","Interface_MenuItem_DeleteBuilding");r.isDisabled=()=>!1,r.onClick=()=>this.publishEvent(new le),this.registerEventListener(u.Z.SELECTION_CHANGED,(e=>{this.buildingCanUpgrade=e.buildingCanUpgrade,this.buildingCanSwitchPower=e.buildingCanSwitchPower,this.updateAllButtonStates()})),this.registerEventListener(u.Z.MATERIAL_AMOUNT_CHANGED,(e=>{this.numCrystal=e.numCrystal,this.usedCrystal=e.usedCrystal,this.updateAllButtonStates()}))}reset(){super.reset(),this.usedCrystal=0,this.numCrystal=0,this.buildingCanUpgrade=!1,this.buildingCanSwitchPower=!1}}class we extends Me{constructor(e,t){super(e,3,t),this.isGround=!1,this.isPowerPath=!1,this.canPlaceFence=!1;const i=this.addMenuItem("InterfaceImages","Interface_MenuItem_LayPath");i.onClick=()=>this.publishEvent(new te),i.isDisabled=()=>!this.isGround;const s=this.addMenuItem("InterfaceImages","Interface_MenuItem_RemovePath");s.onClick=()=>this.publishEvent(new se),s.isDisabled=()=>!this.isPowerPath;const n=this.addMenuItem("InterfaceImages","Interface_MenuItem_PlaceFence");n.isDisabled=()=>!this.canPlaceFence,n.onClick=()=>this.publishEvent(new ie),this.registerEventListener(u.Z.SELECTION_CHANGED,(e=>{this.isGround=e.isGround,this.isPowerPath=e.isPowerPath,this.canPlaceFence=e.canPlaceFence,this.updateAllButtonStates()}))}reset(){super.reset(),this.isGround=!1,this.isPowerPath=!1,this.canPlaceFence=!1}}class Le extends Me{constructor(e,t){super(e,10,t),this.someCarries=!1,this.everyHasMaxLevel=!1,this.numToolstations=0;const i=this.addMenuItem("InterfaceImages","Interface_MenuItem_GoFeed");i.isDisabled=()=>!1,i.onClick=()=>this.publishEvent(new ge);const s=this.addMenuItem("InterfaceImages","Interface_MenuItem_UnLoadMinifigure");s.isDisabled=()=>!this.someCarries,s.onClick=()=>this.publishEvent(new pe),this.addMenuItem("InterfaceImages","Interface_MenuItem_MinifigurePickUp"),this.getToolItem=this.addMenuItem("InterfaceImages","Interface_MenuItem_GetTool"),this.getToolItem.isDisabled=()=>!1,this.addMenuItem("InterfaceImages","Interface_MenuItem_DropBirdScarer");const n=this.addMenuItem("InterfaceImages","Interface_MenuItem_UpgradeMan");n.isDisabled=()=>this.everyHasMaxLevel||this.numToolstations<1,n.onClick=()=>this.publishEvent(new Ie),this.trainItem=this.addMenuItem("InterfaceImages","Interface_MenuItem_TrainSkill"),this.trainItem.isDisabled=()=>!1,this.addMenuItem("InterfaceImages","Interface_MenuItem_GotoFirstPerson"),this.addMenuItem("InterfaceImages","Interface_MenuItem_GotoSecondPerson");const a=this.addMenuItem("InterfaceImages","Interface_MenuItem_DeleteMan");a.isDisabled=()=>!1,a.onClick=()=>this.publishEvent(new Pe),this.registerEventListener(u.Z.SELECTION_CHANGED,(e=>{this.someCarries=e.someCarries,this.everyHasMaxLevel=e.everyHasMaxLevel,this.updateAllButtonStates()})),this.registerEventListener(u.Z.BUILDINGS_CHANGED,(e=>{this.numToolstations=j.countUsable(e,S.TOOLSTATION),this.updateAllButtonStates()}))}reset(){super.reset(),this.someCarries=!1,this.everyHasMaxLevel=!1,this.numToolstations=0}}class Ae extends Me{constructor(e,t){super(e,2,t),this.hasRubble=!1,this.canPlaceFence=!1;const i=this.addMenuItem("InterfaceImages","Interface_MenuItem_ClearRubble");i.isDisabled=()=>!this.hasRubble,i.onClick=()=>this.publishEvent(new ae),this.addMenuItem("InterfaceImages","Interface_MenuItem_PlaceFence").isDisabled=()=>!this.canPlaceFence,this.registerEventListener(u.Z.SELECTION_CHANGED,(e=>{this.hasRubble=e.hasRubble,this.canPlaceFence=e.canPlaceFence,this.updateAllButtonStates()}))}reset(){super.reset(),this.hasRubble=!1,this.canPlaceFence=!1}}class Be extends Me{constructor(e,t){super(e,7,t)}}class ve extends Me{constructor(e,t){super(e,4,t),this.isDrillable=!1,this.isHardDrillable=!1,this.isReinforcable=!1,this.numToolstationsLevel2=0;const i=this.addMenuItem("InterfaceImages","Interface_MenuItem_Dig");i.isDisabled=()=>!this.isDrillable&&!this.isHardDrillable,i.onClick=()=>this.publishEvent(new de);const s=this.addMenuItem("InterfaceImages","Interface_MenuItem_Reinforce");s.isDisabled=()=>!this.isReinforcable,s.onClick=()=>this.publishEvent(new ue);const n=this.addMenuItem("InterfaceImages","Interface_MenuItem_Dynamite");n.isDisabled=()=>this.numToolstationsLevel2<1,n.onClick=()=>this.publishEvent(new ce);const a=this.addMenuItem("InterfaceImages","Interface_MenuItem_DeselectDig");a.isDisabled=()=>!1,a.onClick=()=>this.publishEvent(new me),this.registerEventListener(u.Z.SELECTION_CHANGED,(e=>{this.isDrillable=e.isDrillable,this.isHardDrillable=e.isDrillableHard,this.isReinforcable=e.isReinforcable,this.updateAllButtonStates()})),this.registerEventListener(u.Z.BUILDINGS_CHANGED,(e=>{this.numToolstationsLevel2=j.countUsable(e,S.TOOLSTATION,2)}))}reset(){super.reset(),this.isDrillable=!1,this.isHardDrillable=!1,this.isReinforcable=!1,this.numToolstationsLevel2=0}}class Ne extends Te{constructor(e,t){super(e,6,t),this.addMenuItem("InterfaceBuildImages","Hoverboard"),this.addMenuItem("InterfaceBuildImages","SmallDigger"),this.addMenuItem("InterfaceBuildImages","SmallTruck"),this.addMenuItem("InterfaceBuildImages","SmallCat"),this.addMenuItem("InterfaceBuildImages","SmallMLP"),this.addMenuItem("InterfaceBuildImages","SmallHeli")}}class xe extends Te{constructor(e,t){super(e,6,t),this.canDoTraining=new Map,this.addTrainingItem("Interface_MenuItem_TrainDriver",O.DRIVER),this.addTrainingItem("Interface_MenuItem_TrainEngineer",O.ENGINEER),this.addTrainingItem("Interface_MenuItem_TrainGeologist",O.GEOLOGIST),this.addTrainingItem("Interface_MenuItem_TrainPilot",O.PILOT),this.addTrainingItem("Interface_MenuItem_TrainSailor",O.SAILOR),this.addTrainingItem("Interface_MenuItem_TrainDynamite",O.DEMOLITION),this.registerEventListener(u.Z.SELECTION_CHANGED,(e=>{this.canDoTraining=e.canDoTraining}))}addTrainingItem(e,t){const i=this.addMenuItem("InterfaceImages",e);i.isDisabled=()=>!this.canDoTraining.get(t),i.onClick=()=>this.publishEvent(new Ce(t))}reset(){super.reset(),this.canDoTraining=new Map}}class Ge extends o.s{constructor(e){super(e),this.subPanels=[],this.numRequestedRaiders=0,this.numToolstations=0,this.numTeleportPads=0,this.numBarracks=0,this.numRaiders=0,this.relX=this.xOut=624,this.xIn=735,this.relY=this.yOut=this.yIn=9,this.movedIn=!1,this.mainPanel=this.addSubPanel(new Te(this,4)),this.mainPanel.relX=this.mainPanel.xOut,this.mainPanel.relY=this.mainPanel.yOut,this.mainPanel.movedIn=!1;const t=this.addSubPanel(new ye(this,this.mainPanel)),i=this.addSubPanel(new Ne(this,this.mainPanel)),s=this.addSubPanel(new be(this,this.mainPanel));this.selectWallPanel=this.addSubPanel(new ve(this,this.mainPanel)),this.selectFloorPanel=this.addSubPanel(new we(this,this.mainPanel)),this.selectRubblePanel=this.addSubPanel(new Ae(this,this.mainPanel));const n=this.addSubPanel(new De(this,this.mainPanel)),a=this.addSubPanel(new Le(this,this.mainPanel)),r=this.addSubPanel(new xe(this,a));a.trainItem.onClick=()=>a.toggleState((()=>r.toggleState()));const l=this.addSubPanel(new _e(this,a));a.getToolItem.onClick=()=>a.toggleState((()=>l.toggleState()));const o=this.addSubPanel(new Be(this,this.mainPanel)),h=this.mainPanel.addMenuItem("InterfaceImages","Interface_MenuItem_TeleportMan");h.isDisabled=()=>this.numRaiders>=this.getMaxRaiders()||this.numRequestedRaiders>=D.VD||this.numToolstations<1&&this.numTeleportPads<1,h.updateState(),h.onClick=()=>this.publishEvent(new ne(!0)),h.addChild(new Se(h)),this.registerEventListener(u.Z.REQUESTED_RAIDERS_CHANGED,(e=>{this.numRequestedRaiders=e.numRequestedRaiders,h.updateState()}));const d=this.mainPanel.addMenuItem("InterfaceImages","Interface_MenuItem_BuildBuilding");d.isDisabled=()=>!1,d.onClick=()=>this.mainPanel.toggleState((()=>t.toggleState()));const c=this.mainPanel.addMenuItem("InterfaceImages","Interface_MenuItem_BuildSmallVehicle");c.isDisabled=()=>!1,c.onClick=()=>this.mainPanel.toggleState((()=>i.toggleState()));const m=this.mainPanel.addMenuItem("InterfaceImages","Interface_MenuItem_BuildLargeVehicle");m.isDisabled=()=>!1,m.onClick=()=>this.mainPanel.toggleState((()=>s.toggleState())),this.registerEventListener(u.Z.SELECTION_CHANGED,(e=>{e.selectionType===H.NOTHING?this.selectSubPanel(this.mainPanel):e.selectionType===H.BUILDING?this.selectSubPanel(n):e.selectionType===H.RAIDER?this.selectSubPanel(a):e.selectionType===H.VEHICLE?this.selectSubPanel(o):e.selectionType===H.SURFACE&&this.onSelectedSurfaceChange(e.isFloor,e.hasRubble)})),this.registerEventListener(u.Z.BUILDINGS_CHANGED,(e=>{this.numToolstations=j.countUsable(e,S.TOOLSTATION),this.numTeleportPads=j.countUsable(e,S.TELEPORT_PAD),this.numBarracks=j.countUsable(e,S.BARRACKS),h.updateState()})),this.registerEventListener(u.Z.RAIDERS_CHANGED,(e=>{this.numRaiders=e.numRaiders,h.updateState()}))}getMaxRaiders(){return D.d+this.numBarracks*D.oq}reset(){super.reset(),this.relX=this.xOut,this.relY=this.yOut,this.movedIn=!1,this.updatePosition(),this.mainPanel.relX=this.mainPanel.xOut,this.mainPanel.relY=this.mainPanel.yOut,this.mainPanel.movedIn=!1,this.mainPanel.updatePosition(),this.numRequestedRaiders=0,this.numToolstations=0,this.numTeleportPads=0,this.numBarracks=0,this.numRaiders=0}addSubPanel(e){return this.addChild(e),this.subPanels.push(e),e}selectSubPanel(e){this.subPanels.forEach((t=>t!==e&&t.setMovedIn(!0))),e.setMovedIn(!1)}onSelectedSurfaceChange(e,t){e?t?this.selectSubPanel(this.selectRubblePanel):this.selectSubPanel(this.selectFloorPanel):this.selectSubPanel(this.selectWallPanel)}}class ke{constructor(e,t,i){this.textImage=e.createTextImage(t.text,i),this.infoImage=c.x.getImageOrNull(t.imageFilename)}}class Ue extends o.s{constructor(e,t,i){super(e,t),this.imgAir=null,this.currentMessage=null,this.messageTimeout=null,this.airLevel=1,this.relX=this.xOut=this.xIn=42,this.relY=this.yOut=this.yIn=409,this.imgAir=c.x.getImage("Interface/Airmeter/msgpanel_air_juice.bmp");const s=c.x.getDefaultFont(),n=new ke(s,i.textCrystalFound,this.img.width);this.registerEventListener(u.Z.LOCATION_CRYSTAL_FOUND,(()=>this.setMessage(n))),this.msgSpaceToContinue=new ke(s,i.textSpaceToContinue,this.img.width);const a=new ke(s,i.textCavernDiscovered,this.img.width);this.registerEventListener(u.Z.CAVERN_DISCOVERED,(()=>this.setMessage(a)));const r=new ke(s,i.textOreFound,this.img.width);this.registerEventListener(u.Z.ORE_FOUND,(()=>this.setMessage(r))),this.msgAirSupplyLow=new ke(s,i.textAirSupplyLow,this.img.width),this.msgAirSupplyRunningOut=new ke(s,i.textAirSupplyRunningOut,this.img.width),this.msgGameCompleted=new ke(s,i.textGameCompleted,this.img.width),this.msgManTrained=new ke(s,i.textManTrained,this.img.width),this.registerEventListener(u.Z.RAIDERS_CHANGED,(e=>e.training&&this.setMessage(this.msgManTrained))),this.msgUnitUpgraded=new ke(s,i.textUnitUpgraded,this.img.width),this.registerEventListener(u.Z.AIR_LEVEL_CHANGED,(()=>this.notifyRedraw())),this.registerEventListener(u.Z.AIR_LEVEL_CHANGED,(e=>{this.airLevel=e.airLevel}))}reset(){super.reset(),this.airLevel=1}setMessage(e,t=3e3){if(this.messageTimeout=(0,M.L4)(this.messageTimeout),this.currentMessage=e,this.notifyRedraw(),t){const e=this;this.messageTimeout=setTimeout((()=>{e.currentMessage=null,e.notifyRedraw()}),t)}}unsetMessage(e){this.currentMessage===e&&(this.currentMessage=null,this.notifyRedraw())}onRedraw(e){var t,i;if(super.onRedraw(e),this.airLevel>0){const t=Math.round(236*Math.min(1,this.airLevel));e.drawImage(this.imgAir,this.x+85,this.y+6,t,8)}const s=null===(t=this.currentMessage)||void 0===t?void 0:t.textImage,n=null===(i=this.currentMessage)||void 0===i?void 0:i.infoImage;if(s){const t=this.x+(this.img.width-s.width-(n?n.width:0))/2;e.drawImage(s,t,this.y+26)}if(n){const t=this.x+this.img.width-n.width;e.drawImage(n,t,this.y+16)}}}class Fe{constructor(e){[this.text,this.imageFilename,this.sfxName]=e}}class He extends s.l{constructor(e){super(),this.textCrystalFound=null,this.textSpaceToContinue=null,this.textCavernDiscovered=null,this.textOreFound=null,this.textAirSupplyLow=null,this.textAirSupplyRunningOut=null,this.textGameCompleted=null,this.textManTrained=null,this.textUnitUpgraded=null,s.l.setFromCfg(this,e)}parseValue(e,t){return new Fe(t)}}class Ze extends s.l{constructor(e){super(),this.aiPriorityTrain=null,this.aiPriorityGetIn=null,this.aiPriorityCrystal=null,this.aiPriorityOre=null,this.aiPriorityRepair=null,this.aiPriorityClearing=null,this.aiPriorityDestruction=null,this.aiPriorityConstruction=null,this.aiPriorityReinforce=null,this.aiPriorityRecharge=null,s.l.setFromCfg(this,e)}parseValue(e,t){return{buttonType:t[0],normalFile:t[1],highlightFile:t[1],pressedFile:t[2],disabledFile:t[3]}}}var Ve;!function(e){e[e.aiPriorityTrain=0]="aiPriorityTrain",e[e.aiPriorityGetIn=1]="aiPriorityGetIn",e[e.aiPriorityCrystal=2]="aiPriorityCrystal",e[e.aiPriorityOre=3]="aiPriorityOre",e[e.aiPriorityRepair=4]="aiPriorityRepair",e[e.aiPriorityClearing=5]="aiPriorityClearing",e[e.aiPriorityDestruction=6]="aiPriorityDestruction",e[e.aiPriorityConstruction=7]="aiPriorityConstruction",e[e.aiPriorityReinforce=8]="aiPriorityReinforce",e[e.aiPriorityRecharge=9]="aiPriorityRecharge"}(Ve||(Ve={}));class Ye extends o.s{constructor(e,t,i,s,n){super(e,t),this.prioPositions=[],this.prioByName=new Map,this.priorityList=new x,i.panelButtonPriorityListDisable.forEach(((e,t)=>{this.addChild(new l.z(this,e)).onClick=()=>{this.priorityList.toggle(t),this.publishEvent(new oe(this.priorityList.current))}})),i.panelButtonPriorityListUpOne.forEach(((e,t)=>{this.addChild(new l.z(this,e)).onClick=()=>{this.priorityList.upOne(t),this.publishEvent(new oe(this.priorityList.current))}})),this.addChild(new l.z(this,i.panelButtonPriorityListReset)).onClick=()=>{this.priorityList.reset(),this.publishEvent(new oe(this.priorityList.current))},this.prioPositions=s,this.prioByName.set(Ve.aiPriorityTrain,this.addChild(new l.z(this,n.aiPriorityTrain))),this.prioByName.set(Ve.aiPriorityGetIn,this.addChild(new l.z(this,n.aiPriorityGetIn))),this.prioByName.set(Ve.aiPriorityCrystal,this.addChild(new l.z(this,n.aiPriorityCrystal))),this.prioByName.set(Ve.aiPriorityOre,this.addChild(new l.z(this,n.aiPriorityOre))),this.prioByName.set(Ve.aiPriorityRepair,this.addChild(new l.z(this,n.aiPriorityRepair))),this.prioByName.set(Ve.aiPriorityClearing,this.addChild(new l.z(this,n.aiPriorityClearing))),this.prioByName.set(Ve.aiPriorityDestruction,this.addChild(new l.z(this,n.aiPriorityDestruction))),this.prioByName.set(Ve.aiPriorityConstruction,this.addChild(new l.z(this,n.aiPriorityConstruction))),this.prioByName.set(Ve.aiPriorityReinforce,this.addChild(new l.z(this,n.aiPriorityReinforce))),this.prioByName.set(Ve.aiPriorityRecharge,this.addChild(new l.z(this,n.aiPriorityRecharge))),this.registerEventListener(u.Z.SETUP_PRIORITY_LIST,(e=>{this.setList(e.priorityList)}))}reset(){super.reset(),this.priorityList.reset()}setList(e){this.priorityList.setList(e),this.prioByName.forEach((e=>e.hidden=!0));let t=0,i=!1;e.forEach((e=>{const s=this.prioByName.get(e.key);if(s){i=i||s.hidden||s.disabled!==!e.enabled,s.hidden=!1,s.disabled=!e.enabled,s.relX=this.prioPositions[t].x,s.relY=this.prioPositions[t].y,s.updatePosition();const n=t;s.onClick=()=>{this.priorityList.pushToTop(n),this.publishEvent(new oe(this.priorityList.current))},t++}})),i&&this.notifyRedraw()}}class We{constructor(e){[this.x,this.y]=e}}class Ke extends l.z{constructor(e,t){super(e,t),this.toggleState=!1}checkHover(e,t){if(this.isInactive())return!1;const i=this.isInRect(e,t);let s=this.hover!==i;return this.hover=i,this.pressed=this.pressed&&this.hover||this.toggleState,this.children.forEach((i=>s=i.checkHover(e,t)||s)),s&&this.notifyRedraw(),s}checkClick(e,t){if(this.isInactive())return!1;const i=this.isInRect(e,t)||this.toggleState;let s=this.pressed!==i;return this.pressed=i,this.children.forEach((i=>s=i.checkClick(e,t)||s)),s&&this.notifyRedraw(),s}checkRelease(e,t){if(this.isInactive())return!1;const i=this.isInRect(e,t);let s=i&&this.pressed;return s&&(this.toggleState=!this.toggleState,this.onClick(),this.pressed=s&&this.toggleState,this.hover=i),this.children.forEach((i=>s=i.checkRelease(e,t)||s)),s&&this.notifyRedraw(),s}release(){return!1}}class ze extends o.s{constructor(e,t,i){super(e,t),this.btnCallToArms=this.addChild(new Ke(this,i.panelButtonTopPanelCallToArms)),this.btnOptions=this.addChild(new l.z(this,i.panelButtonTopPanelOptions)),this.btnPriorities=this.addChild(new Ke(this,i.panelButtonTopPanelPriorities))}}var Xe=i(346),qe=i(18);class je extends qe.x{constructor(e){super(e);const t=new y(c.x.cfg("Panels640x480")),i=new R(c.x.cfg("Buttons640x480"));this.panelEncyclopedia=this.addPanel(new o.s(this.rootElement,t.panelEncyclopedia)),this.panelInformation=this.addPanel(new v(this.rootElement,t.panelInformation)),this.panelInfoDock=this.addPanel(new L(this.rootElement,t.panelInfoDock,i.panelInfoDock,new B(c.x.cfg("InfoMessages")),this.panelInformation)),this.panelCameraControl=this.addPanel(new o.s(this.rootElement,t.panelCameraControl));const s=new Ze(c.x.cfg("PriorityImages")),n=Object.values(c.x.cfg("PrioritiesImagePositions")).map((e=>new We(e)));this.panelPriorityList=this.addPanel(new Ye(this.rootElement,t.panelPriorityList,i.panelPriorityList,n,s)),this.panelTopPanel=this.addPanel(new ze(this.rootElement,t.panelTopPanel,i.panelTopPanel)),this.panelMain=this.addPanel(new Ge(this.rootElement)),this.panelCrystalSideBar=this.addPanel(new p(this.rootElement,t.panelCrystalSideBar,i.panelCrystalSideBar)),this.panelMessagesSide=this.addPanel(new o.s(this.rootElement,t.panelMessagesSide)),this.panelMessages=this.addPanel(new Ue(this.rootElement,t.panelMessages,new He(c.x.cfg("TextMessagesWithImages")))),this.panelRadar=this.addPanel(new h(this.rootElement,t.panelRadar,t.panelRadarFill,t.panelRadarOverlay,i.panelRadar)),this.panelTopPanel.btnOptions.onClick=()=>{this.sendResponse({type:Xe.n.SHOW_OPTIONS})},this.panelTopPanel.btnPriorities.onClick=()=>{this.panelTopPanel.btnPriorities.toggleState?this.panelMain.setMovedIn(!0,(()=>this.panelPriorityList.setMovedIn(!1))):this.panelPriorityList.setMovedIn(!0,(()=>this.panelMain.setMovedIn(!1)))}}onProcessMessage(e){return e.type===Xe.n.SPACE_TO_CONINUE&&(e.messageState?this.panelMessages.setMessage(this.panelMessages.msgSpaceToContinue,0):this.panelMessages.unsetMessage(this.panelMessages.msgSpaceToContinue),!0)}}let Je=null;const Qe=self;Qe.addEventListener("message",(e=>{const t=e.data;t.type===Xe.n.INIT?(c.x.resourceByName=t.resourceByName,c.x.configuration=t.cfg,c.x.stats=t.stats,Je=new je(Qe)):Je.processMessage(t)}))}},s={};function n(e){var t=s[e];if(void 0!==t)return t.exports;var a=s[e]={exports:{}};return i[e](a,a.exports,n),a.exports}n.m=i,n.x=()=>{var e=n.O(void 0,[969],(()=>n(375)));return n.O(e)},e=[],n.O=(t,i,s,a)=>{if(!i){var r=1/0;for(h=0;h<e.length;h++){for(var[i,s,a]=e[h],l=!0,o=0;o<i.length;o++)(!1&a||r>=a)&&Object.keys(n.O).every((e=>n.O[e](i[o])))?i.splice(o--,1):(l=!1,a<r&&(r=a));l&&(e.splice(h--,1),t=s())}return t}a=a||0;for(var h=e.length;h>0&&e[h-1][2]>a;h--)e[h]=e[h-1];e[h]=[i,s,a]},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce(((t,i)=>(n.f[i](e,t),t)),[])),n.u=e=>e+".index.js",n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var i=t.getElementsByTagName("script");i.length&&(e=i[i.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e})(),(()=>{var e={588:1};n.f.i=(t,i)=>{e[t]||importScripts(n.p+n.u(t))};var t=self.webpackChunkrock_raiders_web=self.webpackChunkrock_raiders_web||[],i=t.push.bind(t);t.push=t=>{var[s,a,r]=t;for(var l in a)n.o(a,l)&&(n.m[l]=a[l]);for(r&&r(n);s.length;)e[s.pop()]=1;i(t)}})(),t=n.x,n.x=()=>n.e(969).then(t),n.x()})();
//# sourceMappingURL=588.index.js.map