(()=>{"use strict";var e,t,s={800:(e,t,s)=>{var i,n,a;s.d(t,{T:()=>i,iW:()=>n}),function(e){e[e.MAIN=0]="MAIN",e[e.MIDDLE=1]="MIDDLE",e[e.SECONDARY=2]="SECONDARY"}(i||(i={})),function(e){e[e.MOVE=0]="MOVE",e[e.DOWN=1]="DOWN",e[e.UP=2]="UP"}(n||(n={})),function(e){e[e.DOWN=0]="DOWN",e[e.UP=1]="UP"}(a||(a={}))},89:(e,t,s)=>{s.d(t,{MI:()=>u,FB:()=>c,RD:()=>m,Ry:()=>p,s4:()=>g});var i=s(986),n=s(625),a=s(599),r=s(352),l=s(378),o=s(260),h=s(320),d=s(722);class u extends d.Z{constructor(e){super(e),this.isLocal=!0}}class c extends u{constructor(e=o.R.NOTHING,t=null,s=null,d=null){super(h.Z.SELECTION_CHANGED),this.canDoTraining=new Map,this.everyHasTool=new Map,this.selectionType=e,this.isGround=(null==t?void 0:t.surfaceType)===a.c.GROUND,this.isPowerPath=(null==t?void 0:t.surfaceType)===a.c.POWER_PATH,this.isFloor=null==t?void 0:t.surfaceType.floor,this.isSite=(null==t?void 0:t.surfaceType)===a.c.POWER_PATH_CONSTRUCTION||(null==t?void 0:t.surfaceType)===a.c.POWER_PATH_BUILDING_SITE,this.hasRubble=null==t?void 0:t.hasRubble(),this.isDrillable=null==t?void 0:t.isDrillable(),this.isDrillableHard=null==t?void 0:t.isDrillableHard(),this.isReinforcable=null==t?void 0:t.isReinforcable(),this.canPlaceFence=(null==t?void 0:t.canPlaceFence())&&n.D.buildings.some((e=>e.entityType===i.p.POWER_STATION&&e.isUsable())),this.someCarries=!!(null==d?void 0:d.some((e=>!!e.carries))),this.everyHasMaxLevel=!!(null==d?void 0:d.every((e=>e.level>=e.stats.Levels))),l.Y_.forEach((e=>this.canDoTraining.set(e,n.D.getTrainingSites(e).length>0&&(null==d?void 0:d.some((t=>!t.hasTraining(e))))))),r.C.forEach((e=>this.everyHasTool.set(e,!!(null==d?void 0:d.every((t=>t.hasTool(e))))))),this.buildingCanUpgrade=null==s?void 0:s.canUpgrade(),this.buildingCanSwitchPower=!(null==s?void 0:s.stats.SelfPowered)&&!(null==s?void 0:s.stats.PowerBuilding)}}class m extends u{constructor(e,t=null){super(h.Z.CHANGE_CURSOR),this.cursor=e,this.timeout=t}}class p extends u{constructor(){super(h.Z.BUILDINGS_CHANGED),this.usableBuildingsByTypeAndLevel=new Map,n.D.buildings.forEach((e=>{if(e.isUsable()){const t=this.usableBuildingsByTypeAndLevel.getOrUpdate(e.entityType,(()=>new Map));t.set(e.level,t.getOrUpdate(e.level,(()=>0))+1)}}))}static countUsable(e,t,s=0){let i=0;return e.usableBuildingsByTypeAndLevel.getOrUpdate(t,(()=>new Map)).forEach(((e,t)=>{t>=s&&(i+=e)})),i}}class g extends u{constructor(e){super(h.Z.PLAY_SOUND),this.sample=e}}},986:(e,t,s)=>{var i,n;s.d(t,{p:()=>i}),function(e){e[e.PILOT=0]="PILOT",e[e.TOOLSTATION=1]="TOOLSTATION",e[e.TELEPORT_PAD=2]="TELEPORT_PAD",e[e.DOCKS=3]="DOCKS",e[e.POWER_STATION=4]="POWER_STATION",e[e.BARRACKS=5]="BARRACKS",e[e.UPGRADE=6]="UPGRADE",e[e.GEODOME=7]="GEODOME",e[e.ORE_REFINERY=8]="ORE_REFINERY",e[e.GUNSTATION=9]="GUNSTATION",e[e.TELEPORT_BIG=10]="TELEPORT_BIG",e[e.BAT=11]="BAT",e[e.SMALL_SPIDER=12]="SMALL_SPIDER",e[e.DYNAMITE=13]="DYNAMITE",e[e.ELECTRIC_FENCE=14]="ELECTRIC_FENCE",e[e.CRYSTAL=15]="CRYSTAL",e[e.ORE=16]="ORE",e[e.BRICK=17]="BRICK",e[e.BARRIER=18]="BARRIER"}(i||(i={})),function(e){e[e.RAIDER=0]="RAIDER",e[e.BUILDING=1]="BUILDING",e[e.MONSTER=2]="MONSTER",e[e.MATERIAL=3]="MATERIAL"}(n||(n={}))},625:(e,t,s)=>{s.d(t,{D:()=>d});var i,n=s(815),a=s(89),r=s(848),l=s(986),o=s(378),h=s(260);!function(e){e[e.RUNNING=0]="RUNNING",e[e.COMPLETE=1]="COMPLETE",e[e.FAILED=2]="FAILED"}(i||(i={}));class d{static reset(){this.resultState=i.RUNNING,this.numCrystal=0,this.numOre=0,this.numBrick=0,this.usedCrystals=0,this.neededCrystals=0,this.airLevel=1,this.selectedEntities=[],this.selectionType=null,this.buildings=[],this.buildingsUndiscovered=[],this.raiders=[],this.raidersUndiscovered=[],this.requestedRaiders=0,this.materials=[],this.materialsUndiscovered=[],this.buildingSites=[],this.spiders=[],this.spidersBySurface=new Map,this.bats=[],this.totalCrystals=0,this.totalOres=0,this.totalDiggables=0,this.remainingDiggables=0,this.totalCaverns=0,this.discoveredCaverns=0,this.levelStartTime=0,this.levelStopTime=0,this.oxygenRate=0,this.buildModeSelection=null}static getBuildingsByType(...e){return this.buildings.filter((t=>t.isUsable()&&e.some((e=>t.entityType===e))))}static getClosestBuildingByType(e,...t){const s=d.getBuildingsByType(...t);let i=null,n=null;return s.forEach((t=>{const s=t.getDropPosition(),a=e.distanceToSquared(s);(null===i||a<n)&&(i=t,n=a)})),i}static getTrainingSites(e){return this.buildings.filter((t=>t.entityType===o.u1[e]&&t.isUsable()&&t.stats[o.gd[e]][t.level]))}static selectEntities(e){this.selectedEntities=this.selectedEntities.filter((t=>{const s=-1!==e.indexOf(t);return s||t.deselect(),s})),e.forEach((e=>{e.select()&&this.selectedEntities.push(e)}));const t=this.selectedEntities.length;t>1?this.selectionType=h.R.GROUP:1===t?this.selectionType=this.selectedEntities[0].getSelectionType():null!==this.selectionType&&(this.selectionType=h.R.NOTHING),n.N.publishEvent(new a.FB(this.selectionType,this.selectedSurface,this.selectedBuilding,this.selectedRaiders))}static getMaxRaiders(){return r.d+d.buildings.count((e=>e.isUsable()&&e.entityType===l.p.BARRACKS))*r.oq}static discoverSurface(e){const t=e.x*r.pM,s=e.y*r.pM,i=t+r.pM,n=s+r.pM;this.discoverEntities(this.raidersUndiscovered,t,i,s,n),this.discoverEntities(this.buildingsUndiscovered,t,i,s,n),this.discoverEntities(this.materialsUndiscovered,t,i,s,n)}static discoverEntities(e,t,s,i,n){const a=[];e.forEach((e=>{const r=e.getPosition();r.x>=t&&r.x<s&&r.z>=i&&r.z<n&&(e.onDiscover(),a.push(e))})),a.forEach((t=>e.remove(t)))}static get gameTimeSeconds(){return Math.round((d.levelStopTime-d.levelStartTime)/1e3)}static get selectedSurface(){return this.selectionType===h.R.SURFACE&&this.selectedEntities.length>0?this.selectedEntities[0]:null}static get selectedBuilding(){return this.selectionType===h.R.BUILDING&&this.selectedEntities.length>0?this.selectedEntities[0]:null}static get selectedRaiders(){return(this.selectionType===h.R.RAIDER||this.selectionType===h.R.GROUP)&&this.selectedEntities.length>0?this.selectedEntities:[]}static get totalOre(){return this.numOre+5*this.numBrick}static getNearbySpiders(e){const t=e.sceneMgr.terrain,s=t.getSurfaceFromWorld(e.getPosition()),i=[];for(let e=s.x;e<=s.x+1;e++)for(let n=s.y;n<=s.y+1;n++){const s=t.getSurface(e,n);i.push(...d.spidersBySurface.get(s)||[])}return i}}d.resultState=i.RUNNING,d.numCrystal=0,d.numOre=0,d.numBrick=0,d.usedCrystals=0,d.neededCrystals=0,d.airLevel=1,d.selectedEntities=[],d.selectionType=null,d.buildings=[],d.buildingsUndiscovered=[],d.raiders=[],d.raidersUndiscovered=[],d.requestedRaiders=0,d.materials=[],d.materialsUndiscovered=[],d.buildingSites=[],d.spiders=[],d.spidersBySurface=new Map,d.bats=[],d.totalCrystals=0,d.totalOres=0,d.totalDiggables=0,d.remainingDiggables=0,d.totalCaverns=0,d.discoveredCaverns=0,d.levelStartTime=0,d.levelStopTime=0,d.oxygenRate=0,d.buildModeSelection=null},260:(e,t,s)=>{var i;s.d(t,{R:()=>i}),function(e){e[e.NOTHING=0]="NOTHING",e[e.SURFACE=1]="SURFACE",e[e.RAIDER=2]="RAIDER",e[e.BUILDING=3]="BUILDING",e[e.VEHICLE=4]="VEHICLE",e[e.GROUP=5]="GROUP"}(i||(i={}))},599:(e,t,s)=>{s.d(t,{c:()=>n});var i=s(505);class n{constructor(e={}){this.shaping=!1,this.matIndex="00",this.floor=!1,this.selectable=!1,this.drillable=!1,this.drillableHard=!1,this.explodable=!1,this.reinforcable=!1,this.cursor=i.C.Pointer_Standard,this.cursorFulfiller=i.C.Pointer_Standard,this.statsDrillName=null,this.canCarryFence=!1,Object.assign(this,e)}static getByNum(e){switch(e){case 0:return n.POWER_PATH_BUILDING;case 1:return n.SOLID_ROCK;case 2:return n.HARD_ROCK;case 3:return n.LOOSE_ROCK;case 4:case 5:return n.DIRT;case 6:return n.LAVA;case 8:return n.ORE_SEAM;case 9:return n.WATER;case 10:return n.CRYSTAL_SEAM;case 11:return n.RECHARGE_SEAM;case 30:case 40:return n.SLUG_HOLE;case 100:return n.RUBBLE4;case 101:return n.RUBBLE3;case 102:return n.RUBBLE2;case 103:return n.RUBBLE1;default:return console.error("Unexpected surface type num: "+e),n.SOLID_ROCK}}}n.GROUND=new n({name:"ground",floor:!0,selectable:!0,canCarryFence:!0}),n.SOLID_ROCK=new n({name:"solid rock",shaping:!0,matIndex:"5",cursor:i.C.Pointer_SurfaceType_Immovable}),n.HARD_ROCK=new n({name:"hard rock",shaping:!0,matIndex:"4",selectable:!0,drillableHard:!0,explodable:!0,reinforcable:!0,cursor:i.C.Pointer_SurfaceType_Hard,statsDrillName:"HardDrillTime"}),n.LOOSE_ROCK=new n({name:"loose rock",shaping:!0,matIndex:"3",selectable:!0,drillable:!0,drillableHard:!0,explodable:!0,reinforcable:!0,cursor:i.C.Pointer_SurfaceType_Medium,statsDrillName:"LooseDrillTime"}),n.DIRT=new n({name:"dirt",shaping:!0,matIndex:"2",selectable:!0,drillable:!0,drillableHard:!0,explodable:!0,reinforcable:!0,cursor:i.C.Pointer_SurfaceType_Loose,statsDrillName:"SoilDrillTime"}),n.SLUG_HOLE=new n({name:"slug hole",floor:!0,matIndex:"30"}),n.LAVA=new n({name:"lava",floor:!0,matIndex:"46"}),n.ORE_SEAM=new n({name:"ore seam",matIndex:"40",selectable:!0,drillable:!0,drillableHard:!0,explodable:!0,reinforcable:!0,cursor:i.C.Pointer_SurfaceType_OreSeam,statsDrillName:"SeamDrillTime"}),n.WATER=new n({name:"water",floor:!0,matIndex:"45"}),n.CRYSTAL_SEAM=new n({name:"energy crystal seam",matIndex:"20",selectable:!0,drillable:!0,drillableHard:!0,explodable:!0,reinforcable:!0,cursor:i.C.Pointer_SurfaceType_CrystalSeam,statsDrillName:"SeamDrillTime"}),n.RECHARGE_SEAM=new n({name:"recharge seam",matIndex:"67",cursor:i.C.Pointer_SurfaceType_RechargeSeam}),n.POWER_PATH=new n({name:"power path all",floor:!0,matIndex:"60",selectable:!0,canCarryFence:!0}),n.POWER_PATH_BUILDING_SITE=new n({name:"power path building site",floor:!0,matIndex:"61",selectable:!0,canCarryFence:!0}),n.POWER_PATH_BUILDING=new n({name:"power path building",floor:!0,matIndex:"76"}),n.POWER_PATH_CONSTRUCTION=new n({name:"power path construction",floor:!0,matIndex:"76",selectable:!0}),n.RUBBLE1=new n({name:"rubble 1",floor:!0,matIndex:"13",selectable:!0,canCarryFence:!0,cursorFulfiller:i.C.Pointer_Clear}),n.RUBBLE2=new n({name:"rubble 2",floor:!0,matIndex:"12",selectable:!0,canCarryFence:!0,cursorFulfiller:i.C.Pointer_Clear}),n.RUBBLE3=new n({name:"rubble 3",floor:!0,matIndex:"11",selectable:!0,canCarryFence:!0,cursorFulfiller:i.C.Pointer_Clear}),n.RUBBLE4=new n({name:"rubble 4",floor:!0,matIndex:"10",selectable:!0,canCarryFence:!0,cursorFulfiller:i.C.Pointer_Clear})},352:(e,t,s)=>{var i;s.d(t,{q:()=>i,C:()=>n}),function(e){e[e.DRILL=0]="DRILL",e[e.HAMMER=1]="HAMMER",e[e.SHOVEL=2]="SHOVEL",e[e.SPANNER=3]="SPANNER",e[e.FREEZERGUN=4]="FREEZERGUN",e[e.LASER=5]="LASER",e[e.PUSHERGUN=6]="PUSHERGUN",e[e.BIRDSCARER=7]="BIRDSCARER"}(i||(i={}));const n=[i.DRILL,i.HAMMER,i.SHOVEL,i.SPANNER,i.FREEZERGUN,i.LASER,i.PUSHERGUN,i.BIRDSCARER]},378:(e,t,s)=>{s.d(t,{PP:()=>i,Y_:()=>a,u1:()=>r,gd:()=>l});var i,n=s(986);!function(e){e[e.DRIVER=0]="DRIVER",e[e.ENGINEER=1]="ENGINEER",e[e.GEOLOGIST=2]="GEOLOGIST",e[e.PILOT=3]="PILOT",e[e.SAILOR=4]="SAILOR",e[e.DEMOLITION=5]="DEMOLITION"}(i||(i={}));const a=[i.DRIVER,i.ENGINEER,i.GEOLOGIST,i.PILOT,i.SAILOR,i.DEMOLITION],r=[];r[i.DRIVER]=n.p.BARRACKS,r[i.DRIVER]=n.p.BARRACKS,r[i.ENGINEER]=n.p.UPGRADE,r[i.GEOLOGIST]=n.p.GEODOME,r[i.PILOT]=n.p.TELEPORT_PAD,r[i.SAILOR]=n.p.DOCKS,r[i.DEMOLITION]=n.p.TOOLSTATION;const l=[];l[i.DRIVER]="TrainDriver",l[i.ENGINEER]="TrainRepair",l[i.GEOLOGIST]="TrainScanner",l[i.PILOT]="TrainPilot",l[i.SAILOR]="TrainSailor",l[i.DEMOLITION]="TrainDynamite"},848:(e,t,s)=>{s.d(t,{d:()=>i,VD:()=>n,oq:()=>a,CM:()=>r,Du:()=>l,DG:()=>o,pM:()=>h,OK:()=>d});const i=12,n=9,a=10,r=3,l=640,o=480,h=40,d=30},298:(e,t,s)=>{var i=s(935),n=s(930);class a extends n.p{constructor(e){if(super(),9!==e.length)throw"Invalid number of arguments ("+e.length+") given for button configuration expected 9 or 5";[this.buttonType,this.normalFile,this.highlightFile,this.pressedFile,this.relX,this.relY,this.width,this.height,this.tooltip]=e}}class r extends i.l{constructor(e){super(),this.panelButtonInfoDockGoto=null,this.panelButtonInfoDockClose=null,i.l.setFromCfg(this,e)}parseValue(e,t){return new a(t)}}var l=s(211),o=s(670);class h extends o.s{constructor(e,t,s,i,n){super(e,t),this.fill=this.addChild(new o.s(this,s)),this.fill.relX=this.relX-this.fill.relX,this.fill.relY=this.relY-this.fill.relY,this.overlay=this.addChild(new o.s(this,i)),this.btnToggle=this.addChild(new l.z(this,n.panelButtonRadarToggle)),this.btnToggle.onClick=()=>this.toggleState(),this.btnMap=this.addChild(new l.z(this,n.panelButtonRadarMapView)),this.btnMap.onClick=()=>{},this.btnTagged=this.addChild(new l.z(this,n.panelButtonRadarTaggedObjectView)),this.btnTagged.onClick=()=>{}}}class d extends i.l{constructor(e){super(),this.panelButtonRadarToggle=null,this.panelButtonRadarTaggedObjectView=null,this.panelButtonRadarZoomIn=null,this.panelButtonRadarZoomOut=null,this.panelButtonRadarMapView=null,i.l.setFromCfg(this,e)}parseValue(e,t){return new a(t)}}var u=s(320),c=s(458),m=s(360);class p extends m.H{constructor(e,t){super(e),this.relX=t.relX,this.relY=t.relY,this.width=t.width,this.height=t.height,this.tooltip=t.tooltip,this.label="0",this.updatePosition()}reset(){super.reset(),this.label="0"}onRedraw(e){this.hidden||(e.textAlign="center",e.font="bold 10px Arial",e.fillStyle="#fff",e.fillText(this.label,this.x+this.width/2,this.y+this.height-2),super.onRedraw(e))}}class g extends o.s{constructor(e,t,s){super(e,t),this.numCrystal=0,this.usedCrystals=0,this.neededCrystals=0,this.totalOre=0,this.labelOre=this.addChild(new p(this,s.panelButtonCrystalSideBarOre)),this.labelCrystal=this.addChild(new p(this,s.panelButtonCrystalSideBarCrystals)),this.imgNoCrystal=c.x.getImage("Interface/RightPanel/NoSmallCrystal.bmp"),this.imgSmallCrystal=c.x.getImage("Interface/RightPanel/SmallCrystal.bmp"),this.imgUsedCrystal=c.x.getImage("Interface/RightPanel/UsedCrystal.bmp"),this.imgOre=c.x.getImage("Interface/RightPanel/CrystalSideBar_Ore.bmp"),this.registerEventListener(u.Z.MATERIAL_AMOUNT_CHANGED,(e=>{this.labelOre.label=e.totalOre.toString(),this.labelCrystal.label=e.numCrystal.toString(),this.numCrystal=e.numCrystal,this.usedCrystals=e.usedCrystal,this.neededCrystals=e.neededCrystal,this.totalOre=e.totalOre,this.notifyRedraw()}))}reset(){super.reset(),this.numCrystal=0,this.usedCrystals=0,this.neededCrystals=0,this.totalOre=0}onRedraw(e){super.onRedraw(e);let t=this.x+this.img.width-8,s=this.y+this.img.height-34;for(let i=0;(this.neededCrystals<1||i<Math.max(this.neededCrystals,this.numCrystal))&&s>=Math.max(this.imgNoCrystal.height,this.imgSmallCrystal.height,this.imgUsedCrystal.height);i++){let n=this.imgNoCrystal;this.usedCrystals>i?n=this.imgUsedCrystal:this.numCrystal>i&&(n=this.imgSmallCrystal),s-=n.height,e.drawImage(n,t-n.width/2,s)}t=this.x+this.img.width-21,s=this.y+this.img.height-42;for(let i=0;i<this.totalOre&&s>=this.imgOre.height;++i)s-=this.imgOre.height,e.drawImage(this.imgOre,t-this.imgOre.width/2,s)}}class I extends i.l{constructor(e){super(),this.panelButtonCrystalSideBarOre=null,this.panelButtonCrystalSideBarCrystals=null,i.l.setFromCfg(this,e)}parseValue(e,t){return new a(t)}}class E extends i.l{constructor(e){super(),this.panelButtonPriorityListDisable=[],this.panelButtonPriorityListUpOne=[],this.panelButtonPriorityListClose=null,this.panelButtonPriorityListReset=null,i.l.setFromCfg(this,e)}assignValue(e,t,s){return t.match(/panelButtonPriorityListDisable\d+/i)?(this.panelButtonPriorityListDisable.push(this.parseValue(t,s)),!0):t.match(/panelButtonPriorityListUpOne\d+/i)?(this.panelButtonPriorityListUpOne.push(this.parseValue(t,s)),!0):super.assignValue(e,t,s)}parseValue(e,t){return new a(t)}}class C extends i.l{constructor(e){super(),this.panelButtonTopPanelCallToArms=null,this.panelButtonTopPanelOptions=null,this.panelButtonTopPanelPriorities=null,i.l.setFromCfg(this,e)}parseValue(e,t){return new a(t)}}class R extends i.l{constructor(e){super(),this.panelButtonCameraControlZoomIn=null,this.panelButtonCameraControlZoomOut=null,this.panelButtonCameraControlCycleBuildings=null,this.panelButtonCameraControlRotate=null,i.l.setFromCfg(this,e)}parseValue(e,t){return new a(t)}}class f extends i.l{constructor(e){super(),this.panelButtonInformationToggle=null,this.panelButtonInformationFunction=null,i.l.setFromCfg(this,e)}parseValue(e,t){return new a(t)}}class P extends i.l{constructor(e){super(),this.panelRadar=null,this.panelCrystalSideBar=null,this.panelTopPanel=null,this.panelInformation=null,this.panelPriorityList=null,this.panelCameraControl=null,this.panelInfoDock=null,this.panelEncyclopedia=null,i.l.setFromCfg(this,e)}parseValue(e,t){const s={};return t.forEach((e=>s[e[0]]=e)),e==="panelRadar".toLowerCase()?new d(s):e==="panelCrystalSideBar".toLowerCase()?new I(s):e==="panelTopPanel".toLowerCase()?new C(s):e==="panelInformation".toLowerCase()?new f(s):e==="panelPriorityList".toLowerCase()?new E(s):e==="panelCameraControl".toLowerCase()?new R(s):e==="panelInfoDock".toLowerCase()?new r(s):e==="panelEncyclopedia".toLowerCase()?null:s}}var T=s(234);class y extends i.l{constructor(e){super(),this.panelRadar=null,this.panelRadarFill=null,this.panelRadarOverlay=null,this.panelMessages=null,this.panelMessagesSide=null,this.panelCrystalSideBar=null,this.panelTopPanel=null,this.panelInformation=null,this.panelPriorityList=null,this.panelCameraControl=null,this.panelInfoDock=null,this.panelEncyclopedia=null,i.l.setFromCfg(this,e)}parseValue(e,t){return new T.l(t)}}class S extends n.p{constructor(e){super(),this.normalFile=e,this.highlightFile=e,this.pressedFile=e,this.disabledFile=e,this.relX=0,this.relY=0}}var b=s(538),O=s(848);class D extends l.z{constructor(e,t,s){super(e,new S(t.buttonImageFilename)),this.messages=[],this.text=null,this.animationTimeout=null,this.animationSpeedX=.5,this.animationSpeedY=1,this.text=t.message,this.hidden=!0,this.onClick=()=>{this.messages.length<1||e.buttonClicked(this)},this.registerEventListener(s,(t=>{for(this.hidden=!1;this.messages.length>=9;)this.messages.pop();this.messages.unshift(t),e.showButton(this)}))}reset(){super.reset(),this.animationTimeout=(0,b.L4)(this.animationTimeout),this.hidden=!0,this.messages=[]}slideToTarget(e,t){return new Promise((s=>this.updateAnimation(e,t,s)))}updateAnimation(e,t,s){const i=e-this.relX,n=t-this.relY;if(Math.abs(i)<=this.animationSpeedX&&Math.abs(n)<=this.animationSpeedY)this.relX=e,this.relY=t,this.animationTimeout=null,s&&s();else{this.relX+=Math.round(Math.sign(i)*Math.sqrt(Math.abs(i))*this.animationSpeedX),this.relY+=Math.round(Math.sign(n)*Math.sqrt(Math.abs(n))*this.animationSpeedY);const a=this;this.animationTimeout=setTimeout((()=>a.updateAnimation(e,t,s)),1e3/O.OK)}this.updatePosition(),this.notifyRedraw()}onRedraw(e){super.onRedraw(e),this.hidden||(e.textAlign="left",e.font="bold 10px Arial",e.fillStyle="#fff",e.fillText(this.messages.length.toString(),this.x+2,this.y+this.height/2+2))}}class M extends o.s{constructor(e,t,s,i,n){super(e,t),this.stackButtons=[],this.informationPanel=null,this.informationPanel=n,this.addChild(new l.z(this,s.panelButtonInfoDockGoto)).onClick=()=>this.gotoLatestMessage(),this.addChild(new l.z(this,s.panelButtonInfoDockClose)).onClick=()=>this.dropLatestMessage(),this.addChild(new D(this,i.infoGenericDeath,u.Z.LOCATION_DEATH)),this.addChild(new D(this,i.infoGenericMonster,u.Z.LOCATION_MONSTER)),this.addChild(new D(this,i.infoCrystalFound,u.Z.LOCATION_CRYSTAL_FOUND)),this.addChild(new D(this,i.infoUnderAttack,u.Z.LOCATION_UNDER_ATTACK)),this.addChild(new D(this,i.infoLandslide,u.Z.LOCATION_LANDSLIDE)),this.addChild(new D(this,i.infoPowerDrain,u.Z.LOCATION_POWER_DRAIN)),this.addChild(new D(this,i.infoSlugEmerge,u.Z.LOCATION_SLUG_EMERGE)),this.addChild(new D(this,i.infoFoundMinifigure,u.Z.LOCATION_RAIDER_DISCOVERED))}reset(){super.reset(),this.stackButtons=[]}gotoLatestMessage(){if(this.stackButtons.length<1)return;const e=this.stackButtons[0];if(e.messages.length<1)return;const t=e.messages[0];console.log("TODO force move camera to",t.location)}dropLatestMessage(){if(this.stackButtons.length<1)return;const e=this.stackButtons[0];e.messages.length<1||(e.messages.shift(),e.messages.length<1&&(e.hidden=!0,this.informationPanel.setMovedIn(!0),this.stackButtons.splice(this.stackButtons.indexOf(e),1),this.slideStackIntoPosition().then()),e.notifyRedraw())}showButton(e){this.stackButtons.includes(e)?e.notifyRedraw():this.slideInButton(e)}slideInButton(e){this.stackButtons.forEach((e=>e.disabled=!0));const t=-this.stackButtons.map((e=>e.height)).reduce(((e,t)=>e+t),0);this.stackButtons.push(e),e.relX=-e.width,e.relY=t-e.height,e.updatePosition(),e.slideToTarget(0,t).then((()=>this.stackButtons.forEach((e=>e.disabled=!1))))}buttonClicked(e){e!==this.stackButtons[0]?this.pushFirst(e):(this.informationPanel.setText(e.text),this.informationPanel.toggleState())}pushFirst(e){this.stackButtons.splice(this.stackButtons.indexOf(e),1),this.stackButtons.unshift(e),this.slideStackIntoPosition().then((()=>{this.informationPanel.setText(e.text),this.informationPanel.setMovedIn(!1)}))}slideStackIntoPosition(){this.stackButtons.forEach((e=>e.disabled=!0));let e=0;const t=this.stackButtons.map((t=>{const s=t.slideToTarget(0,e);return e-=t.height,s}));return new Promise((e=>{Promise.all(t).then((()=>{this.stackButtons.forEach((e=>e.disabled=!1)),e()}))}))}}class w{constructor(e){this.message=null,this.buttonImageFilename=null,this.sfx=null,this.timing=null,this.flag=null,[this.message,this.buttonImageFilename,this.sfx,this.timing,this.flag]=e,this.message=this.message.replace(/_/g," ")}}class _ extends i.l{constructor(e){super(),this.infoGenericDeath=null,this.infoGenericMonster=null,this.infoCrystalFound=null,this.infoUnderAttack=null,this.infoLandslide=null,this.infoPowerDrain=null,this.infoSlugEmerge=null,this.infoFoundMinifigure=null,i.l.setFromCfg(this,e)}parseValue(e,t){return new w(t)}}class L extends o.s{constructor(e,t){super(e,t),this.font=null,this.textImage=null,this.font=c.x.getDefaultFont()}setText(e){this.textImage=e?this.font.createTextImage(e,this.img.width-80):null,this.notifyRedraw()}onRedraw(e){super.onRedraw(e),this.textImage&&e.drawImage(this.textImage,this.x+(this.img.width-this.textImage.width)/2,this.y+12)}}var A=s(89);class B extends A.MI{}class N extends B{constructor(){super(u.Z.COMMAND_CANCEL_BUILD_MODE)}}class x extends B{constructor(e){super(u.Z.COMMAND_SELECT_BUILD_MODE),this.entityType=e}}class v extends B{constructor(e){super(u.Z.COMMAND_PICK_TOOL),this.tool=e}}class G extends B{constructor(){super(u.Z.COMMAND_CREATE_POWER_PATH)}}class U extends B{constructor(){super(u.Z.COMMAND_PLACE_FENCE)}}class k extends B{constructor(){super(u.Z.COMMAND_MAKE_RUBBLE)}}class F extends B{constructor(e){super(u.Z.COMMAND_CHANGE_RAIDER_SPAWN_REQUEST),this.increase=e}}class H extends B{constructor(){super(u.Z.COMMAND_CREATE_CLEAR_RUBBLE_JOB)}}class Z extends B{constructor(){super(u.Z.COMMAND_UPGRADE_BUILDING)}}class V extends B{constructor(){super(u.Z.COMMAND_BUILDING_BEAMUP)}}class Y extends B{constructor(e){super(u.Z.CHANGE_PRIORITY_LIST),this.priorityList=e}}class W extends B{constructor(e){super(u.Z.COMMAND_CHANGE_BUILDING_POWER_STATE),this.state=e}}class q extends B{constructor(){super(u.Z.COMMAND_CREATE_DRILL_JOB)}}class z extends B{constructor(){super(u.Z.COMMAND_CREATE_REINFORCE_JOB)}}class K extends B{constructor(){super(u.Z.COMMAND_CREATE_DYNAMITE_JOB)}}class X extends B{constructor(){super(u.Z.COMMAND_CANCEL_SURFACE_JOBS)}}class j extends B{constructor(){super(u.Z.COMMAND_RAIDER_EAT)}}class J extends B{constructor(){super(u.Z.COMMAND_RAIDER_DROP)}}class Q extends B{constructor(){super(u.Z.COMMAND_RAIDER_UPGRADE)}}class $ extends B{constructor(){super(u.Z.COMMAND_RAIDER_BEAMUP)}}class ee extends B{constructor(e){super(u.Z.COMMAND_TRAIN_RAIDER),this.training=e}}class te extends B{constructor(){super(u.Z.COMMAND_CANCEL_CONSTRUCTION)}}var se=s(986),ie=s(260);class ne extends n.p{constructor(e){super(),[this.width,this.height,this.highlightFile,this.pressedFile,this.tooltip]=e,this.relX=4,this.relY=14}}class ae extends n.p{constructor(e){var t,s;if(super(),this.tooltipSfx=null,this.tooltipDisabled=null,this.tooltipDisabledSfx=null,this.hotkey=null,4===e.length)[this.normalFile,this.disabledFile,this.pressedFile,this.hotkey]=e;else if(6===e.length||7===e.length){let t,s;[this.normalFile,this.disabledFile,this.pressedFile,t,s,this.hotkey]=e,t&&(Array.isArray(t)?[this.tooltip,this.tooltipSfx]=t:this.tooltip=t),s&&(Array.isArray(s)?[this.tooltipDisabled,this.tooltipDisabledSfx]=s:this.tooltipDisabled=s)}else console.error("Unexpected menu item cfg value length: "+e.length);null===(t=this.tooltip)||void 0===t||t.replace(/_/g," "),null===(s=this.tooltipDisabled)||void 0===s||s.replace(/_/g," "),this.width=40,this.height=40}}class re extends l.z{constructor(e,t,s,i,n){super(e,t),this.tooltipSfx=null,this.tooltipDisabled=null,this.tooltipDisabledSfx=null,this.hotkey=null,this.isDisabled=()=>this.disabled,this.buttonType=s,this.relX=i-59,this.relY=9+this.height*n,this.tooltipSfx=t.tooltipSfx,this.tooltipDisabled=t.tooltipDisabled,this.tooltipDisabledSfx=t.tooltipDisabledSfx,this.hotkey=t.hotkey,this.disabled=!0,this.onClick=()=>console.log("menu item pressed: "+this.buttonType)}reset(){super.reset(),this.disabled=!0,this.updateState(!1)}updateState(e=!0){const t=!!this.isDisabled(),s=this.disabled!==t;return this.disabled=t,s&&e&&this.notifyRedraw(),s}drawHover(e){super.drawHover(e),!this.disabled&&this.hover&&(e.strokeStyle="#0f0",e.lineWidth=2,e.strokeRect(this.x-e.lineWidth/2,this.y-e.lineWidth/2,this.width+e.lineWidth-1,this.height+e.lineWidth-1))}}class le extends o.s{constructor(e,t,s=null){if(super(e),this.backBtn=null,this.iconPanelButtons=[],s){const e=new ne(c.x.cfg("InterfaceBackButton"));this.backBtn=this.addChild(new l.z(this,e)),this.backBtn.onClick=()=>this.toggleState((()=>s.toggleState()))}const i=c.x.cfg("InterfaceSurroundImages",t.toString()),[n,a,r,o,h,d,u,m]=i;this.img=s?c.x.getImage(n):c.x.getImage(d),this.xOut=-this.img.width}addMenuItem(e,t){const s=new ae(c.x.cfg(e,t)),i=this.addChild(new re(this,s,t,this.img.width,this.iconPanelButtons.length));return this.iconPanelButtons.push(i),i}toggleState(e=null){super.toggleState(e),this.movedIn||this.updateAllButtonStates()}updateAllButtonStates(){this.iconPanelButtons.forEach((e=>e.updateState(!1))),this.notifyRedraw()}}class oe extends le{constructor(e,t){super(e,10,t),this.backBtn.onClick=()=>{this.publishEvent(new N),this.toggleState((()=>t.toggleState()))},this.addBuildMenuItem("InterfaceBuildImages","Toolstation",se.p.TOOLSTATION),this.addBuildMenuItem("InterfaceBuildImages","TeleportPad",se.p.TELEPORT_PAD),this.addBuildMenuItem("InterfaceBuildImages","Docks",se.p.DOCKS),this.addBuildMenuItem("InterfaceBuildImages","Powerstation",se.p.POWER_STATION),this.addBuildMenuItem("InterfaceBuildImages","Barracks",se.p.BARRACKS),this.addBuildMenuItem("InterfaceBuildImages","Upgrade",se.p.UPGRADE),this.addBuildMenuItem("InterfaceBuildImages","Geo-dome",se.p.GEODOME),this.addBuildMenuItem("InterfaceBuildImages","OreRefinery",se.p.ORE_REFINERY),this.addBuildMenuItem("InterfaceBuildImages","Gunstation",se.p.GUNSTATION),this.addBuildMenuItem("InterfaceBuildImages","TeleportBIG",se.p.TELEPORT_BIG)}addBuildMenuItem(e,t,s){const i=this.addMenuItem(e,t);return i.isDisabled=()=>!1,i.onClick=()=>this.publishEvent(new x(s)),i}}var he=s(352);class de extends le{constructor(e,t){super(e,8,t),this.numUsableToolstations=0,this.everyHasTool=new Map,this.addGetToolItem("InterfaceImages","Interface_MenuItem_GetDrill",he.q.DRILL),this.addGetToolItem("InterfaceImages","Interface_MenuItem_GetSpade",he.q.SHOVEL),this.addGetToolItem("InterfaceImages","Interface_MenuItem_GetHammer",he.q.HAMMER),this.addGetToolItem("InterfaceImages","Interface_MenuItem_GetSpanner",he.q.SPANNER),this.addGetToolItem("InterfaceImages","Interface_MenuItem_GetFreezerGun",he.q.FREEZERGUN),this.addGetToolItem("InterfaceImages","Interface_MenuItem_GetLaser",he.q.LASER),this.addGetToolItem("InterfaceImages","Interface_MenuItem_GetPusherGun",he.q.PUSHERGUN),this.addGetToolItem("InterfaceImages","Interface_MenuItem_GetBirdScarer",he.q.BIRDSCARER),this.registerEventListener(u.Z.BUILDINGS_CHANGED,(e=>{this.numUsableToolstations=A.Ry.countUsable(e,se.p.TOOLSTATION),this.updateAllButtonStates()})),this.registerEventListener(u.Z.SELECTION_CHANGED,(e=>{this.everyHasTool=e.everyHasTool,this.updateAllButtonStates()}))}addGetToolItem(e,t,s){const i=super.addMenuItem(e,t);return i.isDisabled=()=>this.numUsableToolstations<1||!!this.everyHasTool.get(s),i.onClick=()=>this.publishEvent(new v(s)),i}reset(){super.reset(),this.numUsableToolstations=0,this.everyHasTool=new Map}}class ue extends m.H{constructor(e){super(e),this.numRequestedRaiders="",this.relX=4,this.relY=11,this.registerEventListener(u.Z.REQUESTED_RAIDERS_CHANGED,(e=>{this.numRequestedRaiders=(e.numRequestedRaiders||"").toString(),this.notifyRedraw()}))}reset(){super.reset(),this.numRequestedRaiders=""}onRedraw(e){this.hidden||(e.textAlign="left",e.font="bold 10px Arial",e.fillStyle=this.disabled||this.parent&&this.parent.disabled?"#444":"#fff",e.fillText(this.numRequestedRaiders,this.x,this.y),super.onRedraw(e))}}class ce extends le{constructor(e,t){super(e,5,t),this.addMenuItem("InterfaceBuildImages","BullDozer"),this.addMenuItem("InterfaceBuildImages","WalkerDigger"),this.addMenuItem("InterfaceBuildImages","LargeMLP"),this.addMenuItem("InterfaceBuildImages","LargeDigger"),this.addMenuItem("InterfaceBuildImages","LargeCat")}}class me extends re{constructor(e,t,s,i,n){super(e,t,null,i,n),this.toggleState=!1,this.imgOnNormal=c.x.getImageOrNull(s.normalFile),this.imgOnHover=c.x.getImageOrNull(s.highlightFile),this.imgOnPressed=c.x.getImageOrNull(s.pressedFile),this.imgOnDisabled=c.x.getImageOrNull(s.disabledFile)}clicked(){this.toggleState=!this.toggleState,super.clicked()}onRedraw(e){if(this.hidden)return;let t=this.toggleState?this.imgOnNormal:this.imgNormal;this.disabled?t=this.toggleState?this.imgOnDisabled||this.imgOnPressed||this.imgOnNormal:this.imgDisabled||this.imgPressed||this.imgNormal:this.pressed?t=this.toggleState?this.imgOnPressed||this.imgOnNormal:this.imgPressed||this.imgNormal:this.hover&&(t=this.toggleState?this.imgOnHover||this.imgOnNormal:this.imgHover||this.imgNormal),t&&e.drawImage(t,this.x,this.y),this.children.forEach((t=>t.onRedraw(e))),this.children.forEach((t=>t.drawHover(e))),this.children.forEach((t=>t.drawTooltip(e)))}}class pe extends le{constructor(e,t,s){super(e,t,s),this.backBtn.onClick=()=>this.publishEvent(new A.FB)}}class ge extends pe{constructor(e,t){super(e,4,t),this.usedCrystal=0,this.numCrystal=0,this.buildingCanUpgrade=!1,this.buildingCanSwitchPower=!1,this.addMenuItem("InterfaceImages","Interface_MenuItem_Repair");const s=new ae(c.x.cfg("InterfaceImages","Interface_MenuItem_PowerOff")),i=new ae(c.x.cfg("InterfaceImages","Interface_MenuItem_PowerOn")),n=this.addChild(new me(this,s,i,this.img.width,this.iconPanelButtons.length));this.iconPanelButtons.push(n),n.isDisabled=()=>this.usedCrystal>=this.numCrystal||!this.buildingCanSwitchPower,n.onClick=()=>this.publishEvent(new W(!n.toggleState));const a=this.addMenuItem("InterfaceImages","Interface_MenuItem_UpgradeBuilding");a.isDisabled=()=>!this.buildingCanUpgrade,a.onClick=()=>this.publishEvent(new Z);const r=this.addMenuItem("InterfaceImages","Interface_MenuItem_DeleteBuilding");r.isDisabled=()=>!1,r.onClick=()=>this.publishEvent(new V),this.registerEventListener(u.Z.SELECTION_CHANGED,(e=>{this.buildingCanUpgrade=e.buildingCanUpgrade,this.buildingCanSwitchPower=e.buildingCanSwitchPower,this.updateAllButtonStates()})),this.registerEventListener(u.Z.MATERIAL_AMOUNT_CHANGED,(e=>{this.numCrystal=e.numCrystal,this.usedCrystal=e.usedCrystal,this.updateAllButtonStates()}))}reset(){super.reset(),this.usedCrystal=0,this.numCrystal=0,this.buildingCanUpgrade=!1,this.buildingCanSwitchPower=!1}}class Ie extends pe{constructor(e,t){super(e,3,t),this.isGround=!1,this.isPowerPath=!1,this.canPlaceFence=!1;const s=this.addMenuItem("InterfaceImages","Interface_MenuItem_LayPath");s.onClick=()=>this.publishEvent(new G),s.isDisabled=()=>!this.isGround;const i=this.addMenuItem("InterfaceImages","Interface_MenuItem_RemovePath");i.onClick=()=>this.publishEvent(new k),i.isDisabled=()=>!this.isPowerPath;const n=this.addMenuItem("InterfaceImages","Interface_MenuItem_PlaceFence");n.isDisabled=()=>!this.canPlaceFence,n.onClick=()=>this.publishEvent(new U),this.registerEventListener(u.Z.SELECTION_CHANGED,(e=>{this.isGround=e.isGround,this.isPowerPath=e.isPowerPath,this.canPlaceFence=e.canPlaceFence,this.updateAllButtonStates()}))}reset(){super.reset(),this.isGround=!1,this.isPowerPath=!1,this.canPlaceFence=!1}}class Ee extends pe{constructor(e,t){super(e,10,t),this.someCarries=!1,this.everyHasMaxLevel=!1,this.numToolstations=0;const s=this.addMenuItem("InterfaceImages","Interface_MenuItem_GoFeed");s.isDisabled=()=>!1,s.onClick=()=>this.publishEvent(new j);const i=this.addMenuItem("InterfaceImages","Interface_MenuItem_UnLoadMinifigure");i.isDisabled=()=>!this.someCarries,i.onClick=()=>this.publishEvent(new J),this.addMenuItem("InterfaceImages","Interface_MenuItem_MinifigurePickUp"),this.getToolItem=this.addMenuItem("InterfaceImages","Interface_MenuItem_GetTool"),this.getToolItem.isDisabled=()=>!1,this.addMenuItem("InterfaceImages","Interface_MenuItem_DropBirdScarer");const n=this.addMenuItem("InterfaceImages","Interface_MenuItem_UpgradeMan");n.isDisabled=()=>this.everyHasMaxLevel||this.numToolstations<1,n.onClick=()=>this.publishEvent(new Q),this.trainItem=this.addMenuItem("InterfaceImages","Interface_MenuItem_TrainSkill"),this.trainItem.isDisabled=()=>!1,this.addMenuItem("InterfaceImages","Interface_MenuItem_GotoFirstPerson"),this.addMenuItem("InterfaceImages","Interface_MenuItem_GotoSecondPerson");const a=this.addMenuItem("InterfaceImages","Interface_MenuItem_DeleteMan");a.isDisabled=()=>!1,a.onClick=()=>this.publishEvent(new $),this.registerEventListener(u.Z.SELECTION_CHANGED,(e=>{this.someCarries=e.someCarries,this.everyHasMaxLevel=e.everyHasMaxLevel,this.updateAllButtonStates()})),this.registerEventListener(u.Z.BUILDINGS_CHANGED,(e=>{this.numToolstations=A.Ry.countUsable(e,se.p.TOOLSTATION),this.updateAllButtonStates()}))}reset(){super.reset(),this.someCarries=!1,this.everyHasMaxLevel=!1,this.numToolstations=0}}class Ce extends pe{constructor(e,t){super(e,2,t),this.hasRubble=!1,this.canPlaceFence=!1;const s=this.addMenuItem("InterfaceImages","Interface_MenuItem_ClearRubble");s.isDisabled=()=>!this.hasRubble,s.onClick=()=>this.publishEvent(new H),this.addMenuItem("InterfaceImages","Interface_MenuItem_PlaceFence").isDisabled=()=>!this.canPlaceFence,this.registerEventListener(u.Z.SELECTION_CHANGED,(e=>{this.hasRubble=e.hasRubble,this.canPlaceFence=e.canPlaceFence,this.updateAllButtonStates()}))}reset(){super.reset(),this.hasRubble=!1,this.canPlaceFence=!1}}class Re extends pe{constructor(e,t){super(e,1,t);const s=this.addMenuItem("InterfaceImages","Interface_MenuItem_CancelConstruction");s.isDisabled=()=>!1,s.onClick=()=>{this.publishEvent(new te)}}}class fe extends pe{constructor(e,t){super(e,7,t)}}class Pe extends pe{constructor(e,t){super(e,4,t),this.isDrillable=!1,this.isHardDrillable=!1,this.isReinforcable=!1,this.numToolstationsLevel2=0;const s=this.addMenuItem("InterfaceImages","Interface_MenuItem_Dig");s.isDisabled=()=>!this.isDrillable&&!this.isHardDrillable,s.onClick=()=>this.publishEvent(new q);const i=this.addMenuItem("InterfaceImages","Interface_MenuItem_Reinforce");i.isDisabled=()=>!this.isReinforcable,i.onClick=()=>this.publishEvent(new z);const n=this.addMenuItem("InterfaceImages","Interface_MenuItem_Dynamite");n.isDisabled=()=>this.numToolstationsLevel2<1,n.onClick=()=>this.publishEvent(new K);const a=this.addMenuItem("InterfaceImages","Interface_MenuItem_DeselectDig");a.isDisabled=()=>!1,a.onClick=()=>this.publishEvent(new X),this.registerEventListener(u.Z.SELECTION_CHANGED,(e=>{this.isDrillable=e.isDrillable,this.isHardDrillable=e.isDrillableHard,this.isReinforcable=e.isReinforcable,this.updateAllButtonStates()})),this.registerEventListener(u.Z.BUILDINGS_CHANGED,(e=>{this.numToolstationsLevel2=A.Ry.countUsable(e,se.p.TOOLSTATION,2)}))}reset(){super.reset(),this.isDrillable=!1,this.isHardDrillable=!1,this.isReinforcable=!1,this.numToolstationsLevel2=0}}class Te extends le{constructor(e,t){super(e,6,t),this.addMenuItem("InterfaceBuildImages","Hoverboard"),this.addMenuItem("InterfaceBuildImages","SmallDigger"),this.addMenuItem("InterfaceBuildImages","SmallTruck"),this.addMenuItem("InterfaceBuildImages","SmallCat"),this.addMenuItem("InterfaceBuildImages","SmallMLP"),this.addMenuItem("InterfaceBuildImages","SmallHeli")}}var ye=s(378);class Se extends le{constructor(e,t){super(e,6,t),this.canDoTraining=new Map,this.addTrainingItem("Interface_MenuItem_TrainDriver",ye.PP.DRIVER),this.addTrainingItem("Interface_MenuItem_TrainEngineer",ye.PP.ENGINEER),this.addTrainingItem("Interface_MenuItem_TrainGeologist",ye.PP.GEOLOGIST),this.addTrainingItem("Interface_MenuItem_TrainPilot",ye.PP.PILOT),this.addTrainingItem("Interface_MenuItem_TrainSailor",ye.PP.SAILOR),this.addTrainingItem("Interface_MenuItem_TrainDynamite",ye.PP.DEMOLITION),this.registerEventListener(u.Z.SELECTION_CHANGED,(e=>{this.canDoTraining=e.canDoTraining}))}addTrainingItem(e,t){const s=this.addMenuItem("InterfaceImages",e);s.isDisabled=()=>!this.canDoTraining.get(t),s.onClick=()=>this.publishEvent(new ee(t))}reset(){super.reset(),this.canDoTraining=new Map}}class be extends o.s{constructor(e){super(e),this.subPanels=[],this.numRequestedRaiders=0,this.numToolstations=0,this.numTeleportPads=0,this.numBarracks=0,this.numRaiders=0,this.relX=this.xOut=624,this.xIn=735,this.relY=this.yOut=this.yIn=9,this.movedIn=!1,this.mainPanel=this.addSubPanel(new le(this,4)),this.mainPanel.relX=this.mainPanel.xOut,this.mainPanel.relY=this.mainPanel.yOut,this.mainPanel.movedIn=!1;const t=this.addSubPanel(new oe(this,this.mainPanel)),s=this.addSubPanel(new Te(this,this.mainPanel)),i=this.addSubPanel(new ce(this,this.mainPanel));this.selectWallPanel=this.addSubPanel(new Pe(this,this.mainPanel)),this.selectFloorPanel=this.addSubPanel(new Ie(this,this.mainPanel)),this.selectRubblePanel=this.addSubPanel(new Ce(this,this.mainPanel)),this.selectSitePanel=this.addSubPanel(new Re(this,this.mainPanel));const n=this.addSubPanel(new ge(this,this.mainPanel)),a=this.addSubPanel(new Ee(this,this.mainPanel)),r=this.addSubPanel(new Se(this,a));a.trainItem.onClick=()=>a.toggleState((()=>r.toggleState()));const l=this.addSubPanel(new de(this,a));a.getToolItem.onClick=()=>a.toggleState((()=>l.toggleState()));const o=this.addSubPanel(new fe(this,this.mainPanel)),h=this.mainPanel.addMenuItem("InterfaceImages","Interface_MenuItem_TeleportMan");h.isDisabled=()=>this.numRaiders>=this.getMaxRaiders()||this.numRequestedRaiders>=O.VD||this.numToolstations<1&&this.numTeleportPads<1,h.updateState(),h.onClick=()=>this.publishEvent(new F(!0)),h.addChild(new ue(h)),this.registerEventListener(u.Z.REQUESTED_RAIDERS_CHANGED,(e=>{this.numRequestedRaiders=e.numRequestedRaiders,h.updateState()}));const d=this.mainPanel.addMenuItem("InterfaceImages","Interface_MenuItem_BuildBuilding");d.isDisabled=()=>!1,d.onClick=()=>this.mainPanel.toggleState((()=>t.toggleState()));const c=this.mainPanel.addMenuItem("InterfaceImages","Interface_MenuItem_BuildSmallVehicle");c.isDisabled=()=>!1,c.onClick=()=>this.mainPanel.toggleState((()=>s.toggleState()));const m=this.mainPanel.addMenuItem("InterfaceImages","Interface_MenuItem_BuildLargeVehicle");m.isDisabled=()=>!1,m.onClick=()=>this.mainPanel.toggleState((()=>i.toggleState())),this.registerEventListener(u.Z.SELECTION_CHANGED,(e=>{e.selectionType===ie.R.NOTHING?this.selectSubPanel(this.mainPanel):e.selectionType===ie.R.BUILDING?this.selectSubPanel(n):e.selectionType===ie.R.RAIDER||e.selectionType===ie.R.GROUP?this.selectSubPanel(a):e.selectionType===ie.R.VEHICLE?this.selectSubPanel(o):e.selectionType===ie.R.SURFACE&&this.onSelectedSurfaceChange(e.isFloor,e.isSite,e.hasRubble)})),this.registerEventListener(u.Z.BUILDINGS_CHANGED,(e=>{this.numToolstations=A.Ry.countUsable(e,se.p.TOOLSTATION),this.numTeleportPads=A.Ry.countUsable(e,se.p.TELEPORT_PAD),this.numBarracks=A.Ry.countUsable(e,se.p.BARRACKS),h.updateState()})),this.registerEventListener(u.Z.RAIDERS_CHANGED,(e=>{this.numRaiders=e.numRaiders,h.updateState()}))}getMaxRaiders(){return O.d+this.numBarracks*O.oq}reset(){super.reset(),this.relX=this.xOut,this.relY=this.yOut,this.movedIn=!1,this.updatePosition(),this.mainPanel.relX=this.mainPanel.xOut,this.mainPanel.relY=this.mainPanel.yOut,this.mainPanel.movedIn=!1,this.mainPanel.updatePosition(),this.numRequestedRaiders=0,this.numToolstations=0,this.numTeleportPads=0,this.numBarracks=0,this.numRaiders=0}addSubPanel(e){return this.addChild(e),this.subPanels.push(e),e}selectSubPanel(e){this.subPanels.forEach((t=>t!==e&&t.setMovedIn(!0))),e.setMovedIn(!1)}onSelectedSurfaceChange(e,t,s){e?s?this.selectSubPanel(this.selectRubblePanel):t?this.selectSubPanel(this.selectSitePanel):this.selectSubPanel(this.selectFloorPanel):this.selectSubPanel(this.selectWallPanel)}}var Oe,De=s(309);class Me{constructor(e,t,s){this.textImage=e.createTextImage(t.text,s),this.infoImage=c.x.getImageOrNull(t.imageFilename),this.sfxSample=De.d[t.sfxName]}}class we extends o.s{constructor(e,t,s){super(e,t),this.imgAir=null,this.currentMessage=null,this.messageTimeout=null,this.airLevel=1,this.relX=this.xOut=this.xIn=42,this.relY=this.yOut=this.yIn=409,this.imgAir=c.x.getImage("Interface/Airmeter/msgpanel_air_juice.bmp");const i=c.x.getDefaultFont(),n=new Me(i,s.textCrystalFound,this.img.width);this.registerEventListener(u.Z.LOCATION_CRYSTAL_FOUND,(()=>this.setMessage(n))),this.msgSpaceToContinue=new Me(i,s.textSpaceToContinue,this.img.width);const a=new Me(i,s.textCavernDiscovered,this.img.width);this.registerEventListener(u.Z.CAVERN_DISCOVERED,(()=>this.setMessage(a)));const r=new Me(i,s.textOreFound,this.img.width);this.registerEventListener(u.Z.ORE_FOUND,(()=>this.setMessage(r))),this.msgAirSupplyLow=new Me(i,s.textAirSupplyLow,this.img.width),this.msgAirSupplyRunningOut=new Me(i,s.textAirSupplyRunningOut,this.img.width),this.msgGameCompleted=new Me(i,s.textGameCompleted,this.img.width),this.msgManTrained=new Me(i,s.textManTrained,this.img.width),this.registerEventListener(u.Z.RAIDERS_CHANGED,(e=>e.training&&this.setMessage(this.msgManTrained))),this.msgUnitUpgraded=new Me(i,s.textUnitUpgraded,this.img.width),this.registerEventListener(u.Z.AIR_LEVEL_CHANGED,(()=>this.notifyRedraw())),this.registerEventListener(u.Z.AIR_LEVEL_CHANGED,(e=>{this.airLevel=e.airLevel}))}reset(){super.reset(),this.airLevel=1}setMessage(e,t=3e3){if(this.messageTimeout=(0,b.L4)(this.messageTimeout),this.currentMessage=e,this.notifyRedraw(),e.sfxSample&&this.publishEvent(new A.s4(e.sfxSample)),t){const e=this;this.messageTimeout=setTimeout((()=>{e.currentMessage=null,e.notifyRedraw()}),t)}}unsetMessage(e){this.currentMessage===e&&(this.currentMessage=null,this.notifyRedraw())}onRedraw(e){var t,s;if(super.onRedraw(e),this.airLevel>0){const t=Math.round(236*Math.min(1,this.airLevel));e.drawImage(this.imgAir,this.x+85,this.y+6,t,8)}const i=null===(t=this.currentMessage)||void 0===t?void 0:t.textImage,n=null===(s=this.currentMessage)||void 0===s?void 0:s.infoImage;if(i){const t=this.x+(this.img.width-i.width-(n?n.width:0))/2;e.drawImage(i,t,this.y+26)}if(n){const t=this.x+this.img.width-n.width;e.drawImage(n,t,this.y+16)}}}class _e{constructor(e){[this.text,this.imageFilename,this.sfxName]=e}}class Le extends i.l{constructor(e){super(),this.textCrystalFound=null,this.textSpaceToContinue=null,this.textCavernDiscovered=null,this.textOreFound=null,this.textAirSupplyLow=null,this.textAirSupplyRunningOut=null,this.textGameCompleted=null,this.textManTrained=null,this.textUnitUpgraded=null,i.l.setFromCfg(this,e)}parseValue(e,t){return new _e(t)}}class Ae extends i.l{constructor(e){super(),this.aiPriorityTrain=null,this.aiPriorityGetIn=null,this.aiPriorityCrystal=null,this.aiPriorityOre=null,this.aiPriorityRepair=null,this.aiPriorityClearing=null,this.aiPriorityDestruction=null,this.aiPriorityConstruction=null,this.aiPriorityReinforce=null,this.aiPriorityRecharge=null,i.l.setFromCfg(this,e)}parseValue(e,t){return{buttonType:t[0],normalFile:t[1],highlightFile:t[1],pressedFile:t[2],disabledFile:t[3]}}}!function(e){e[e.aiPriorityTrain=0]="aiPriorityTrain",e[e.aiPriorityGetIn=1]="aiPriorityGetIn",e[e.aiPriorityCrystal=2]="aiPriorityCrystal",e[e.aiPriorityOre=3]="aiPriorityOre",e[e.aiPriorityRepair=4]="aiPriorityRepair",e[e.aiPriorityClearing=5]="aiPriorityClearing",e[e.aiPriorityDestruction=6]="aiPriorityDestruction",e[e.aiPriorityConstruction=7]="aiPriorityConstruction",e[e.aiPriorityReinforce=8]="aiPriorityReinforce",e[e.aiPriorityRecharge=9]="aiPriorityRecharge"}(Oe||(Oe={}));class Be{constructor(){this.levelDefault=[],this.current=[]}setList(e){this.levelDefault=e,this.reset()}toggle(e){this.current[e].enabled=!this.current[e].enabled}upOne(e){const t=this.current[e];this.current[e]=this.current[e+1],this.current[e+1]=t}reset(){this.current=this.levelDefault.map((e=>new Ne(e)))}pushToTop(e){const t=this.current[e];for(let t=e;t>0;t--)this.current[t]=this.current[t-1];this.current[0]=t}getPriority(e){let t=0;return this.current.some(((s,i)=>{if(s.key===e.getPriorityIdentifier())return t=i,!0})),t}isEnabled(e){var t;return(null===(t=this.current.find((t=>t.key===e)))||void 0===t?void 0:t.enabled)||!1}}class Ne{constructor(e){this.key=e.key,this.enabled=e.enabled}}class xe extends o.s{constructor(e,t,s,i,n){super(e,t),this.prioPositions=[],this.prioByName=new Map,this.priorityList=new Be,s.panelButtonPriorityListDisable.forEach(((e,t)=>{this.addChild(new l.z(this,e)).onClick=()=>{this.priorityList.toggle(t),this.publishEvent(new Y(this.priorityList.current))}})),s.panelButtonPriorityListUpOne.forEach(((e,t)=>{this.addChild(new l.z(this,e)).onClick=()=>{this.priorityList.upOne(t),this.publishEvent(new Y(this.priorityList.current))}})),this.addChild(new l.z(this,s.panelButtonPriorityListReset)).onClick=()=>{this.priorityList.reset(),this.publishEvent(new Y(this.priorityList.current))},this.prioPositions=i,this.prioByName.set(Oe.aiPriorityTrain,this.addChild(new l.z(this,n.aiPriorityTrain))),this.prioByName.set(Oe.aiPriorityGetIn,this.addChild(new l.z(this,n.aiPriorityGetIn))),this.prioByName.set(Oe.aiPriorityCrystal,this.addChild(new l.z(this,n.aiPriorityCrystal))),this.prioByName.set(Oe.aiPriorityOre,this.addChild(new l.z(this,n.aiPriorityOre))),this.prioByName.set(Oe.aiPriorityRepair,this.addChild(new l.z(this,n.aiPriorityRepair))),this.prioByName.set(Oe.aiPriorityClearing,this.addChild(new l.z(this,n.aiPriorityClearing))),this.prioByName.set(Oe.aiPriorityDestruction,this.addChild(new l.z(this,n.aiPriorityDestruction))),this.prioByName.set(Oe.aiPriorityConstruction,this.addChild(new l.z(this,n.aiPriorityConstruction))),this.prioByName.set(Oe.aiPriorityReinforce,this.addChild(new l.z(this,n.aiPriorityReinforce))),this.prioByName.set(Oe.aiPriorityRecharge,this.addChild(new l.z(this,n.aiPriorityRecharge))),this.registerEventListener(u.Z.SETUP_PRIORITY_LIST,(e=>{this.setList(e.priorityList)}))}reset(){super.reset(),this.priorityList.reset()}setList(e){this.priorityList.setList(e),this.prioByName.forEach((e=>e.hidden=!0));let t=0,s=!1;e.forEach((e=>{const i=this.prioByName.get(e.key);if(i){s=s||i.hidden||i.disabled!==!e.enabled,i.hidden=!1,i.disabled=!e.enabled,i.relX=this.prioPositions[t].x,i.relY=this.prioPositions[t].y,i.updatePosition();const n=t;i.onClick=()=>{this.priorityList.pushToTop(n),this.publishEvent(new Y(this.priorityList.current))},t++}})),s&&this.notifyRedraw()}}class ve{constructor(e){[this.x,this.y]=e}}class Ge extends l.z{constructor(e,t){super(e,t),this.toggleState=!1}checkHover(e,t){if(this.isInactive())return!1;const s=this.isInRect(e,t);let i=this.hover!==s;return this.hover=s,this.pressed=this.pressed&&this.hover||this.toggleState,this.children.forEach((s=>i=s.checkHover(e,t)||i)),i&&this.notifyRedraw(),i}checkClick(e,t){if(this.isInactive())return!1;const s=this.isInRect(e,t)||this.toggleState;let i=this.pressed!==s;return this.pressed=s,this.children.forEach((s=>i=s.checkClick(e,t)||i)),i&&this.notifyRedraw(),i}checkRelease(e,t){if(this.isInactive())return!1;const s=this.isInRect(e,t);let i=s&&this.pressed;return i&&(this.clicked(),this.pressed=i&&this.toggleState,this.hover=s),this.children.forEach((s=>i=s.checkRelease(e,t)||i)),i&&this.notifyRedraw(),i}clicked(){this.toggleState=!this.toggleState,super.clicked()}release(){return!1}}class Ue extends o.s{constructor(e,t,s){super(e,t),this.btnCallToArms=this.addChild(new Ge(this,s.panelButtonTopPanelCallToArms)),this.btnOptions=this.addChild(new l.z(this,s.panelButtonTopPanelOptions)),this.btnPriorities=this.addChild(new Ge(this,s.panelButtonTopPanelPriorities))}}var ke=s(346),Fe=s(18);class He extends Fe.x{constructor(e){super(e);const t=new y(c.x.cfg("Panels640x480")),s=new P(c.x.cfg("Buttons640x480"));this.panelEncyclopedia=this.addPanel(new o.s(this.rootElement,t.panelEncyclopedia)),this.panelInformation=this.addPanel(new L(this.rootElement,t.panelInformation)),this.panelInfoDock=this.addPanel(new M(this.rootElement,t.panelInfoDock,s.panelInfoDock,new _(c.x.cfg("InfoMessages")),this.panelInformation)),this.panelCameraControl=this.addPanel(new o.s(this.rootElement,t.panelCameraControl));const i=new Ae(c.x.cfg("PriorityImages")),n=Object.values(c.x.cfg("PrioritiesImagePositions")).map((e=>new ve(e)));this.panelPriorityList=this.addPanel(new xe(this.rootElement,t.panelPriorityList,s.panelPriorityList,n,i)),this.panelTopPanel=this.addPanel(new Ue(this.rootElement,t.panelTopPanel,s.panelTopPanel)),this.panelMain=this.addPanel(new be(this.rootElement)),this.panelCrystalSideBar=this.addPanel(new g(this.rootElement,t.panelCrystalSideBar,s.panelCrystalSideBar)),this.panelMessagesSide=this.addPanel(new o.s(this.rootElement,t.panelMessagesSide)),this.panelMessages=this.addPanel(new we(this.rootElement,t.panelMessages,new Le(c.x.cfg("TextMessagesWithImages")))),this.panelRadar=this.addPanel(new h(this.rootElement,t.panelRadar,t.panelRadarFill,t.panelRadarOverlay,s.panelRadar)),this.panelTopPanel.btnOptions.onClick=()=>{this.sendResponse({type:ke.n.SHOW_OPTIONS})},this.panelTopPanel.btnPriorities.onClick=()=>{this.panelTopPanel.btnPriorities.toggleState?this.panelMain.setMovedIn(!0,(()=>this.panelPriorityList.setMovedIn(!1))):this.panelPriorityList.setMovedIn(!0,(()=>this.panelMain.setMovedIn(!1)))}}onProcessMessage(e){return e.type===ke.n.SPACE_TO_CONINUE&&(e.messageState?this.panelMessages.setMessage(this.panelMessages.msgSpaceToContinue,0):this.panelMessages.unsetMessage(this.panelMessages.msgSpaceToContinue),!0)}}let Ze=null;const Ve=self;Ve.addEventListener("message",(e=>{const t=e.data;t.type===ke.n.INIT?(c.x.resourceByName=t.resourceByName,c.x.configuration=t.cfg,c.x.stats=t.stats,Ze=new He(Ve)):Ze.processMessage(t)}))}},i={};function n(e){var t=i[e];if(void 0!==t)return t.exports;var a=i[e]={exports:{}};return s[e](a,a.exports,n),a.exports}n.m=s,n.x=()=>{var e=n.O(void 0,[529,969],(()=>n(298)));return n.O(e)},e=[],n.O=(t,s,i,a)=>{if(!s){var r=1/0;for(h=0;h<e.length;h++){for(var[s,i,a]=e[h],l=!0,o=0;o<s.length;o++)(!1&a||r>=a)&&Object.keys(n.O).every((e=>n.O[e](s[o])))?s.splice(o--,1):(l=!1,a<r&&(r=a));l&&(e.splice(h--,1),t=i())}return t}a=a||0;for(var h=e.length;h>0&&e[h-1][2]>a;h--)e[h]=e[h-1];e[h]=[s,i,a]},n.d=(e,t)=>{for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce(((t,s)=>(n.f[s](e,t),t)),[])),n.u=e=>e+".index.js",n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var s=t.getElementsByTagName("script");s.length&&(e=s[s.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e})(),(()=>{var e={294:1};n.f.i=(t,s)=>{e[t]||importScripts(n.p+n.u(t))};var t=self.webpackChunkrock_raiders_web=self.webpackChunkrock_raiders_web||[],s=t.push.bind(t);t.push=t=>{var[i,a,r]=t;for(var l in a)n.o(a,l)&&(n.m[l]=a[l]);for(r&&r(n);i.length;)e[i.pop()]=1;s(t)}})(),t=n.x,n.x=()=>Promise.all([n.e(529),n.e(969)]).then(t),n.x()})();
//# sourceMappingURL=294.index.js.map